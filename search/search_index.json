{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"What is Tangerine? \u00b6 Tangerine is an open source software that helps with mobile data collection in low resource environments. Tangerine helps with skills measurement, continous and summative assessments, classroom observations, and health surveys and studies. Tangerine is flexible and customizable, allowing you to adapt the product to your specific project needs. The documentation in this site should guide you in making Tangerine work for your needs. Find the source for this in the Tangerine docs folder on Github.","title":"Home"},{"location":"#what-is-tangerine","text":"Tangerine is an open source software that helps with mobile data collection in low resource environments. Tangerine helps with skills measurement, continous and summative assessments, classroom observations, and health surveys and studies. Tangerine is flexible and customizable, allowing you to adapt the product to your specific project needs. The documentation in this site should guide you in making Tangerine work for your needs. Find the source for this in the Tangerine docs folder on Github.","title":"What is Tangerine?"},{"location":"CONTRIBUTING/","text":"How to Contribute Documentation \u00b6 Documentation in Tangerine is managed using the same process as all code contributions. In short, all changes should be completed within a feature-branch or fork of Tangerine and submitted as a pull request to the \"next\" branch. Documentation Overview \u00b6 Tangerine documentation is written using Markdown as the standard source. Documentation is compiled using MkDocs and is available within GitHub Pages. Links are as follows: GitHub Pages: https://docs.tangerinecentral.org/ Documentation Standards \u00b6 All documentation must be created and published using Markdown (.md) files and must reside in the docs/ folder or a subdirectory of the docs folder. Adding your Document to the Navigation \u00b6 Please follow the instructions on the MkDocs Documentation for adding pages to the navigation. The mkdocs.yml file can be found at the root level of the Tangerine repository. ... nav : - Home : index.md - About : about.md ... Setting up your Environment for Local Documentation Development \u00b6 Since Tangerine documentation is written in Markdown it's not necessary to have a full local development environment setup to add or modify documentation. That said, if you're making significant changes you may desire to have the ability to build the documentation locally. If you are on Mac OS, you will first need to install python 3. This tutorial worked great for RJ. Make sure to follow the \"What to do\" section, not the others. Then in the top level tangerine directory, run the following commands to install dependencies. If any of the commands fail, try running the failed command again (that worked for R.J.). pip install mkdocs pip install mkdocs-material pip install mkdocs-git-revision-date-localized-plugin pip install mkdocs-awesome-pages-plugin pip install mkdocs-minify-plugin Now you have everything installed, get started viewing content by running the following in the tangerine root directory (not the tangerine/docs/ directory!)... mkdocs serve Contribution Guide \u00b6 TODO: Replace this video with an updated version to reflect the new process","title":"How to Contribute Documentation"},{"location":"CONTRIBUTING/#how-to-contribute-documentation","text":"Documentation in Tangerine is managed using the same process as all code contributions. In short, all changes should be completed within a feature-branch or fork of Tangerine and submitted as a pull request to the \"next\" branch.","title":"How to Contribute Documentation"},{"location":"CONTRIBUTING/#documentation-overview","text":"Tangerine documentation is written using Markdown as the standard source. Documentation is compiled using MkDocs and is available within GitHub Pages. Links are as follows: GitHub Pages: https://docs.tangerinecentral.org/","title":"Documentation Overview"},{"location":"CONTRIBUTING/#documentation-standards","text":"All documentation must be created and published using Markdown (.md) files and must reside in the docs/ folder or a subdirectory of the docs folder.","title":"Documentation Standards"},{"location":"CONTRIBUTING/#adding-your-document-to-the-navigation","text":"Please follow the instructions on the MkDocs Documentation for adding pages to the navigation. The mkdocs.yml file can be found at the root level of the Tangerine repository. ... nav : - Home : index.md - About : about.md ...","title":"Adding your Document to the Navigation"},{"location":"CONTRIBUTING/#setting-up-your-environment-for-local-documentation-development","text":"Since Tangerine documentation is written in Markdown it's not necessary to have a full local development environment setup to add or modify documentation. That said, if you're making significant changes you may desire to have the ability to build the documentation locally. If you are on Mac OS, you will first need to install python 3. This tutorial worked great for RJ. Make sure to follow the \"What to do\" section, not the others. Then in the top level tangerine directory, run the following commands to install dependencies. If any of the commands fail, try running the failed command again (that worked for R.J.). pip install mkdocs pip install mkdocs-material pip install mkdocs-git-revision-date-localized-plugin pip install mkdocs-awesome-pages-plugin pip install mkdocs-minify-plugin Now you have everything installed, get started viewing content by running the following in the tangerine root directory (not the tangerine/docs/ directory!)... mkdocs serve","title":"Setting up your Environment for Local Documentation Development"},{"location":"CONTRIBUTING/#contribution-guide","text":"TODO: Replace this video with an updated version to reflect the new process","title":"Contribution Guide"},{"location":"about/","text":"About Tangerine \u00b6 Tangerine is electronic data collection software designed for use on Android mobile devices. Its primary use is to enable offline data capture in low-resource areas. Tangerine was first developed to capture student responses in in oral early grade reading and mathematics skills assessments, specifically Early Grade Reading Assessment (EGRA) and Early Grade Mathematics Assessment (EGMA). As well as capture interview responses from students, teachers and principals on home and school context information. Tangerine's capabilities have been expanded for data capture and management for rural health intervention projects. Using Tangerine improves data quality and the efficiency of data collection and analysis by simplifying the preparation and implementation of field work, reducing measurement and data entry errors, and eliminating manual data entry from paper forms. Tangerine was developed in 2011 by RTI International with its own internal research funds, and made available to the public through a GNU General Public License. RTI redesigned Tangerine and developed a new codebase using latest technologies in 2018 with funding support from Google.org. As an open source software platform Tangerine's source code is available for anyone who wishes to install and use Tangerine on their own web server. Tangerine's source code and related documentation is available on Github, a commonly used repository for open source software. To learn more and have a look under the hood, check out Tangerine's Code Repositories on Github. How it works \u00b6","title":"About Tangerine"},{"location":"about/#about-tangerine","text":"Tangerine is electronic data collection software designed for use on Android mobile devices. Its primary use is to enable offline data capture in low-resource areas. Tangerine was first developed to capture student responses in in oral early grade reading and mathematics skills assessments, specifically Early Grade Reading Assessment (EGRA) and Early Grade Mathematics Assessment (EGMA). As well as capture interview responses from students, teachers and principals on home and school context information. Tangerine's capabilities have been expanded for data capture and management for rural health intervention projects. Using Tangerine improves data quality and the efficiency of data collection and analysis by simplifying the preparation and implementation of field work, reducing measurement and data entry errors, and eliminating manual data entry from paper forms. Tangerine was developed in 2011 by RTI International with its own internal research funds, and made available to the public through a GNU General Public License. RTI redesigned Tangerine and developed a new codebase using latest technologies in 2018 with funding support from Google.org. As an open source software platform Tangerine's source code is available for anyone who wishes to install and use Tangerine on their own web server. Tangerine's source code and related documentation is available on Github, a commonly used repository for open source software. To learn more and have a look under the hood, check out Tangerine's Code Repositories on Github.","title":"About Tangerine"},{"location":"about/#how-it-works","text":"","title":"How it works"},{"location":"getting-started/","text":"Getting Started \u00b6 The starting point for Tangerine is dependent on what your role with the product will be. Are you a Project Manager looking to deploy Tangerine to help you manage data collection in your next project? Are you a Systems Administrator working on the back-end to make sure that Tangerine is operational on your company's technology? Or are you a forms developer, taking the questions for the survey and creating the digital forms in Tangerine, or are you a in the field data collector actually running the surveys? Depending on which of these roles fits will define where you should start. If you fall into multiple roles, try to follow this documentation path System Administrator -> Project Manager -> Forms Editor -> Data Collector. Use the tables below to determine your starting point. Since Tangerine is an open-source platform, you are welcome to develop off of our code if you wish. Go to the Tangerine Community to see the code or navigate to our Developer Guide . Roles \u00b6 Role Function Skill Set User Guide System Administrator Install and implement the technical side of Tangerine. AWS, SSL, SSH, running script in Terminal, Server/DB Management System Administrator Guide Project Manager Manages the technical aspects of the project. What and how data should be collected, defining how the project works within the Tangerine platform, and deploying the project in the field. Project Management, Data Collection Methodology Forms Editor Converts surveys into a digitial form using the Tangerine Form Editor and/or Javascript. Web Form Editor, Javascript (For Advanced Functions only) Form Editor Guide Data Collector Field Level Data collector, administers surveys, directly handles devices loaded with Tangerine Survey and Data Collection Data Collector Guide Overview of How Tangerine Works \u00b6 Case to Group to Form - How they interact with each other \u00b6 Flow Chart of Interactions \u00b6","title":"Getting Started"},{"location":"getting-started/#getting-started","text":"The starting point for Tangerine is dependent on what your role with the product will be. Are you a Project Manager looking to deploy Tangerine to help you manage data collection in your next project? Are you a Systems Administrator working on the back-end to make sure that Tangerine is operational on your company's technology? Or are you a forms developer, taking the questions for the survey and creating the digital forms in Tangerine, or are you a in the field data collector actually running the surveys? Depending on which of these roles fits will define where you should start. If you fall into multiple roles, try to follow this documentation path System Administrator -> Project Manager -> Forms Editor -> Data Collector. Use the tables below to determine your starting point. Since Tangerine is an open-source platform, you are welcome to develop off of our code if you wish. Go to the Tangerine Community to see the code or navigate to our Developer Guide .","title":"Getting Started"},{"location":"getting-started/#roles","text":"Role Function Skill Set User Guide System Administrator Install and implement the technical side of Tangerine. AWS, SSL, SSH, running script in Terminal, Server/DB Management System Administrator Guide Project Manager Manages the technical aspects of the project. What and how data should be collected, defining how the project works within the Tangerine platform, and deploying the project in the field. Project Management, Data Collection Methodology Forms Editor Converts surveys into a digitial form using the Tangerine Form Editor and/or Javascript. Web Form Editor, Javascript (For Advanced Functions only) Form Editor Guide Data Collector Field Level Data collector, administers surveys, directly handles devices loaded with Tangerine Survey and Data Collection Data Collector Guide","title":"Roles"},{"location":"getting-started/#overview-of-how-tangerine-works","text":"","title":"Overview of How Tangerine Works"},{"location":"getting-started/#case-to-group-to-form-how-they-interact-with-each-other","text":"","title":"Case to Group to Form - How they interact with each other"},{"location":"getting-started/#flow-chart-of-interactions","text":"","title":"Flow Chart of Interactions"},{"location":"guides/","text":"Guides \u00b6 Welcome to the Tangerine Documentation site. Find the source for this in the Tangerine docs folder on Github. Editor Guide Data Collector Guide System Administrator Guide Developer Guide","title":"Guides"},{"location":"guides/#guides","text":"Welcome to the Tangerine Documentation site. Find the source for this in the Tangerine docs folder on Github. Editor Guide Data Collector Guide System Administrator Guide Developer Guide","title":"Guides"},{"location":"navigation/","text":"Other Resources \u00b6 .nav li a { height: 75px; padding-top: 29px; } .navbar-header { padding-top: 13px; margin-left: 120px; } .logo img { } .logo { position: fixed; top: 15px; left: 30px; z-index: 987654321; } How to contribute documentation Issue Queue Code Releases Technical Chat Community Forum Tangerine Central","title":"Other Resources"},{"location":"navigation/#other-resources","text":".nav li a { height: 75px; padding-top: 29px; } .navbar-header { padding-top: 13px; margin-left: 120px; } .logo img { } .logo { position: fixed; top: 15px; left: 30px; z-index: 987654321; } How to contribute documentation Issue Queue Code Releases Technical Chat Community Forum Tangerine Central","title":"Other Resources"},{"location":"whats-new/","text":"What's new \u00b6 v3.19.2 \u00b6 Fixes - Added process indicator when archiving, un-archiving, or deleting a case. Issue: #2974 - Add v3.19.2 update to recover if v3.19.0 search indexing failed Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.19.2 ./start.sh v3.19.2 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.19.1 # Perform additional upgrades. docker exec -it tangerine bash # This will index all database views in all groups. It may take many hours if # the project has a lot of data. wedge pre-warm-views --target $T_COUCHDB_ENDPOINT v3.19.1 \u00b6 Fixes - Improved backup and restore file processing. Docs: Restoring from a Backup PR: #2910 - Added archive/unarchive Case functionality and permission for \"can delete\" #2954 Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.19.1 ./start.sh v3.19.1 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.19.0 # Perform additional upgrades. docker exec -it tangerine bash # This will index all database views in all groups. It may take many hours if # the project has a lot of data. wedge pre-warm-views --target $T_COUCHDB_ENDPOINT v3.19.0 \u00b6 New Features Data Manager requests and downloads CSVs for multiple forms as a set. When logged into the server and in a group, you will now find a \"Download CSV Data Set\" menu item under \"Data\". From there you can view all of the CSV Data Sets you have generated in the past, the status of wether or not they have finished generating, a link to download them, and other meta data. Click the \"New Data Set\" button and you will be able to select any number of forms to generate CSVs for, data for all time or a specific month, and wether or not to exclude PII. This is especially useful for generating CSVs that take longer to generate than the automatic logout built into the server. You may request a CSV Data Set, log out, and then log back in later to check in on the status and download it. A Server Administrator can also configure cron with a generate-csv-data-set command to generate a data set on a daily, weekly, or monthly basis, handy for situations where you want CSVs to automatically generate on the weekend and then download them on Monday. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2768 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2777 ) Data Manager archives a Case to remove it from reporting output and Devices. This adds an \"archive\" button on Cases that flags all related Form Responses as archived and removes them from CSV output and Search on Devices. This uses the new T.case.archive() API which adds an 'archived' flag for those docs and saves a minimal version of the doc with enough data to be indexed on the server. Search on client and server CSV output are modified to filter archived docs. When viewing cases in Editor, displays \"Archived\" when viewing an archived case. When client syncs, it deletes any docs with the 'archived' flag and sets deletedArchivedDocs In the replicationStatus log. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2843 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2776 ) Devices Manager reconfigures claimed Device sync settings and selects multiple Sync Locations for a Device. Details: To change a Device's sync settings currently requires a reinstall of the app on the Device and setting up all the accounts again. This PR will allow system admins to change the sync settings for a Device which then triggers on next sync a Rewind Push, database delete, then a first pull with the new sync settings. Subsequent syncs then use the new sync settings. This PR also refactors the Create and Edit forms for Devices on the server so that multiple sync locations can be added. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2867 ) (PR: #2782 ) Device Manager estimates how large an initial sync will be given selected sync settings. When setting up sync settings for a Device, it is useful to know how many documents will need to be downloaded given which forms are configured for syncing down and the locations assigned. There is now a \"calculate down-sync size\" button at the bottom of Device edit/creation forms that when pressed will tally up the documents needing to be down synced given the device sync settings. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2845 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2818 ) Devices Manager monitors for Devices close to filling up disk space. Devices now report how much free space they have to the server after a sync. This can be monitored on the Deploy > Devices list. When a Device reports having less than 1GB free storage, a warning is shown on the Devices list. (Ticket: 2779 ) (PR: 2795 ) Server User views the version of Tangerine installed. Any user on the server can now view the version of Tangerine installed by going to Help menu in the left nav bar. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2846 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2794 ) Database Consumer accesses Tangerine MySQL databases via web browser. Users of Tangerine's MySQL database sometimes are not allowed to install tools such as MySQL Workbench on their work computers. This PR makes starting PHPmyAdmin (a mysql viewer) as a web service a configuration option in Tangerine so no one has to install software on their computer to access Tangerine MySQL. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2847 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2793 ) Data Collector creates Account on Device and associates with any User Profile in Group (ignoring Device assignment/sync settings). By default, when a Data Collector creates an Account on Device, they can only associate with User Profiles that are assigned to the same location as the Device's Assigned Location. Add \"disableDeviceUserFilteringByAssignment\":true to the app-config.json for the group and this restriction will be removed. Tablets will also sync all User Profiles, ignoring the Device's configured Sync Location(s). (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2848 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2792 ) Form Developer writes code that can access Case's related Location metadata without writing asynchronous code. When working synchronously in forms, we don't currently have access to the related Location Node data without loading the Location List async and using T.case.case.location to search the hierarchy for the node we want. This PR loads all related Location Nodes into memory at T.case.location when the context of a Case is set. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2849 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2791 ) Server Administrator configures substitutions for CSV output. This feature allows a Server Administrator to update the group's configuration in the app database to contains Regex string replacements for CSV output. This can be handy in situations where Data Analysts are having trouble parsing CSV data that contains line breaks and commas. An example configuration to remove line breaks and commas from data would be \"csvReplacementCharacters\": [{\"search\": \",\", \"replace\": \"|\"}, {\"search\": \"\\n\", \"replace\": \"___\"}] . (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2787 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2788 ) Server Administrator configures Tangerine to not auto-commit in groups' data directories to preserver manually managed git content repositories. When using git to manage group content in a git flow like manner, the automatic commit can result in unnintentional commits. System Administrators can now turn off this auto-commit by configuring Tangerine's config.sh with T_AUTO_COMMIT=\"false\" . If set to true also include the frequency T_AUTO_COMMIT_FREQUENCY=\"60000\" (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2614 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2748 ) Data Collector proposes change to a Form on a Case. The issues feature that has been available on the server is now optionally also available on Devices by \"allowCreationOfIssues\": true to client/app-config.json for the group you want this enabled. Most of the features of Issues you are familiar with from the server are there, except for merging proposals which is not allowed. Issues from Devices are uploaded to the server where proposals can be merged by a Data Manager. We also streamlined the Issue creation and proposal process by skipping the page to fill out an issue title/description, and then forward them directly to creating a proposal. To aid in issue titles/descriptions that make sense, Content Developers can now add templateIssueTitle and templateIssueDescription to Case Definition files. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2850 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2330 ) ( Demo Video ) Data Manager updates Issue Title and Issue Description Data Managers will now find a metadata tab on an Issue where they can update the Title, Description, and new \"Send to\" settings. (Issue: https://github.com/Tangerine-Community/Tangerine/issues/2851 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2330 ) Data Manager sends an Issue to all Devices in Sync Area or specific Device When create/configuring an Issue, Data Managers now have the option to send an Issue to a specific location in a Sync Area, or send it to a specific Device by Device ID. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2854 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2330 ) Forms Developer defines custom logic for Device's search of Cases and Forms In some cases there are situations where the standard variables for searching do not cover all things we want searched, or there is a compound field we want to be searched. Adding a client/custom-search.js file allows the Forms Developer to hook into the map function used to generate the search index. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2852 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2740 ) Data Manager views list of Issues related to Case When viewing a Case on the server, the first screen when opened will now show a list of related Issues. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2723 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2573 ) Form Developer uses API to override Device User based access to Event Forms on a per Case Event basis Currently we can configure in a Case Definition the operation permissions on all instances of an Event Form. This change allows a Form Developer to write logic that would control those permissions on a per Event Form basis by setting the same permissions property on the Event Form itself. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2624 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2660 ) Form Developer configures Devices to skip optimization of database views not in use on Device. Some projects relying heavily on a custom app will find they do not use all of the standard Tangerine database views, thus they can be skipped during the data optimization phase after a sync. In app-config.json , you can add a new doNotOptimize property with a value as an array of views to skip. To discover what views your app is indexing, see the console logs from a device during the optimization phase. You may discover some views you can add to doNotOptimize to speed up that optmization process. (Commit: https://github.com/Tangerine-Community/Tangerine/commit/4b8864470c1cad98e43152dd6bb3c91ee3e576a6 ) System Administrator batch imports all forms from a Tangerine v2 group into a Tangerine v3 group Tangerine v3 now has a script that will import all v2 group forms into a v3 group without having to do each form individually. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2857 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2584 ) Fixes Issue created programatically in on-submit says we must rebase but no button to rebase #2785 Cases that have used the T.case.createIssue() API in forms to create Issues on the current form have recently found the resulting issues are broken. This is due to a change in when the Form Response is associated with the case (later than when T.case.createIssue() is called in a form's on-submit). To remedy this, we've added a new T.case.queueIssueForCreation(\"Some label\", \"Some comment\") API. If you are using T.case.createIssue(), immediately upgrade and replace its usage with T.case.queueIssueForCreation() . (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2785 ) (Example: https://github.com/Tangerine-Community/Tangerine/blob/next/content-sets/case-module/client/test-issues-created-programatically-on-client/form.html#L5 ) Using a simpler reverse sort for device status (PR: https://github.com/Tangerine-Community/Tangerine/pull/2775 ) Increase likelihood that migration of data to mysql will recover where it left off if server restarts. (PR: https://github.com/Tangerine-Community/Tangerine/pull/2773 ) From Case Definitions, the onCaseOpen and onCaseClose now also run in the server context. (PR: https://github.com/Tangerine-Community/Tangerine/pull/2696 ) \"openEvent is not defined\" when accessing a case in Editor (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2800 ) Synclog date/time header is incorrect and sort is broken (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2762 ) Synchronization UX Improvements - remove error state after retries when retry is successful (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2808 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2826 ) Fix missing 'form_' from id for v2 import (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2856 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2726 ) Minor tweak to tangerine-preview README (PR: https://github.com/Tangerine-Community/Tangerine/pull/2735 ) Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.19.0 ./start.sh v3.19.0 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.18.3 # Perform additional upgrades. docker exec -it tangerine bash push-all-groups-views update-down-sync-doc-count-by-location-id-index '*' # This will index all database views in all groups. It may take many hours if # the project has a lot of data. wedge pre-warm-views --target $T_COUCHDB_ENDPOINT v3.18.7 \u00b6 Fixes Back-ported some fixes to the backup and restore feature from the v3.19.1 branch. Fixed issue with Teach where third subtask would not open correctly. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.18.7 ./start.sh v3.18.7 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.18.6 v3.18.6 \u00b6 Updates Updated tangy-form lib from 4.25.11 to 4.25.14 ( Changelog ), which provides: A fix for photo-capture so that it de-activates the camera when going to the next page or leaving a form. Implemented a new 'before-submit' event to tangy-form in order to listen to events before the 'submit' event is dispatched. A fix for User defined Cycle Sequences. Fixes Remove incorrect exception classes for changes processing #2883 PR: #2883 Issue: #2882 Added backup and restore feature for Tangerine databases using device encryption. Increase the appConfig.json parameter dbBackupSplitNumberFiles (default: 200) to speed up the backup/restore process if your database is large. You may also change that parameter in the Export Backup user interface. Updated docs: Restoring from a Backup PR: #2910 Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.18.6 ./start.sh v3.18.6 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.18.5 v3.18.5 \u00b6 Fixes Server admin can configure regex-based password policy for Editor. Instructions in the PR: #2858 Issue: #2844 v3.18.4 \u00b6 Fixes Backported a fix from the v3.19.0 branch for \"Save the lastSequence number after each change is processed in the tangerine-mysql connector\" Issue #2772 Address crashes when importing data using the mysql module #2820 cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.18.4 ./start.sh v3.18.4 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.18.3 v3.18.3 \u00b6 Fixes Important If your site uses csvReplacementCharacters to support search and replace configuration for CSV output, which was released v3.18.2, you must change the configuration string. See issue #2804 for information about the new schema. Backported a fix from the v3.19.0 branch for \"Issue created programmatically in on-submit says we must rebase but no button to rebase #2785\" Description: Cases that have used the T.case.createIssue() API in forms to create Issues on the current form have recently found the resulting issues are broken. This is due to a change in when the Form Response is associated with the case (later than when T.case.createIssue() is called in a form's on-submit). To remedy this, we've added a new T.case.queueIssueForCreation(\"Some label\", \"Some comment\") API. If you are using T.case.createIssue(), immediately upgrade and replace its usage with T.case.queueIssueForCreation() . Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2785 Example: https://github.com/Tangerine-Community/Tangerine/blob/next/content-sets/case-module/client/test-issues-created-programatically-on-client/form.html#L5 v3.18.2 \u00b6 Feature: Editor User downloads CSVs for multiple forms as a set Issue: #2768 PR: #2777 Feature: Remove configurable characters from CSV output #2787 . Documentation updates for backup/restore and fixes to image paths Fix default user profile so it doesn't assume use of roles or location Disabled \"Print form backup\" in Editor Improvements to display of \"Print metadata\" in Editor Update and fix for Cycle Sequences to enable numbering of sequences starting from 1. PR's: #231 , #269 Bump tangy-form to 4.25.11 and tangy-form-editor to 7.8.8. v3.18.1 \u00b6 Fix backup when using os encryption and sync protocol 2 and cordova. (PR: #2767 ) Fix creating of new Device Users when using Sync Protocol 2. (PR: #2769 ) Fix default user profile form for Sync Protocol 1 users. We should not assume they are using roles or location. v3.18.0 \u00b6 New Features \u00b6 Enable configurable image capture in client #2695 Makes image capture work with a max size attribute - PR: #218 Add photo capture widget #203 Serve base64 image data as image files #2706 PR: #2725 Add Cycle sequences 1603 Sort by lastModified in the client case search #2692 Enable assigning multiple roles in forCaseRole in the eventFormDefinition #2694 Enable defining custom functions or valid JavaScript expressions that will be called when an event is opened and when an event is closed. On open and close events for case and case-events: #2696 Teach-specific strings in Russian for default content-set #2676 Uploads status such as app version when updating the app #2756 Bugfixes \u00b6 Initialize git in content repository before running git commands #2667 Only show the links to historical releases when T_ARCHIVE_PWAS_TO_DISK and T_ARCHIVE_APKS_TO_DISK in the config.sh are set to true #2608 Fix form breaking when form name has single quote #2489 Add print options to archived forms #1987 Fix Grid having negative values #2294 Fix to allow for running on m1 Macs #2631 #2631 Thanks @fmoko and @evansdianga! For projects using the Case Reporting screen but don't have anything in reports.js but do have markup in reports.html, avoid crash due to empty file #2657 V2 import script fixes #2675 Allow HTML markup in option labels 2453 Reset grid values when grid is restarted # Mark last attempted automatically when grid is auto-stopped #2467 New Documentation \u00b6 Deleting Records Bullet points for Tangerine Development Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.18.0 ./start.sh v3.18.0 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.11 v3.17.12 \u00b6 Feature: Remove configurable characters from CSV output #2787 . This release also has bugfixes specific to the Class module, which now uses updated API's for form rendering. Feature for Class/Teach: Archive or enable a class. Issue: #2580 Bugfix for Class/Teach: Teach loses data and blocks app if Class form is not submited #2783 Bugfix for Class/Teach: App should return user to previous Curriculum when resuming app. Issue: #2648 Refactor Class to handle changes in tangy-form; Bug in CSV rendering for Tangerine Teach. Issue: #2635 v3.17.11 \u00b6 Added support for custom update scripts for each group. Add either a before-custom-updates.js or after-custom-updates.js to the root of your content depending on when you wish the script to run. Script needs to return a Promise. See Issue 2741 for script example. PR: #2742 Add support for filtering PII variables on Case Participant data and Event Form data in Synapse caches. List the variable names in your group's content folder reporting-config.json . For example: { \"pii\": [\"foo_variable\"] } . This config was previously stored in the groups database. Fixed bug that prevented rewind sync from working. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.11 ./start.sh v3.17.11 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.10 v3.17.10 \u00b6 Skip optimizing sync-queue, sync-conflicts, and tangy-form views after Sync Protocol 2 sync completes. Using T.case.load() in a form? This release fixes a bug where EventForm.formResponseId would be not set when submitting forms in cases where a form has loaded a different case and then the save case back again thus detaching the memory reference being previously set. Remove trailing whitespace from variables for mysql outputs to avoid illegal column names. Add response-variable-value API with support for returning jpeg and png base64 values as files. Refactor TANGY-SIGNATURE and TANGY-PHOTO-CAPTURE output in CSVs to be URLs of the image files. Creates work-around for deployments that are unable to use custom-scripts. Issue #2711 PR #2712 Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.10 ./start.sh v3.17.10 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.9 v3.17.9 \u00b6 New Features and Buffixes \u00b6 Prevent failed calls to T.case.save() in forms by avoiding any saves to a case when a form is active. PR , Issue Enable assigning multiple roles in forCaseRole in the eventDefinition #2694 - Cherry-picked commit 3e4938a0a80c57 only. Enable defining custom functions or valid JavaScript expressions that will be called when an event is opened and when an event is closed. On open and close events for case and case-events: #2702 Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.9 ./start.sh v3.17.9 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.8 v3.17.8 \u00b6 Fix use of initial batch size #2685 Created generate-form-json script that generates the form json for a group from its form.html file. Usage: docker exec tangerine generate-form-json group-uuid The script loops through a group's forms.json and creates a form.json file in each form directory, next to its forms.html. Before using this script, run npm install . Issue: #2686 The synapse module now uses the json from generate-form-json to exclude PII. Also, the synapse module takes substitution and pii fields to accommodate schema changes and pii fields not identified in forms. PR: #2697 Place these properties in the groups Couchdb: \"substitutions\" : { \"mnh_screening_and_enrollment_v2\" : \"mnh01_screening_and_enrollment\" }, \"pii\" : [ \"firstname\" , \"middlename\" , \"surname\" , \"mother_dob\" ] Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.8 ./start.sh v3.17.8 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.7 v3.17.7 \u00b6 fix CSV generation issue: #2681 Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.7 ./start.sh v3.17.7 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.6 v3.17.6 \u00b6 fix issue w/ empty replicationStatus?.userAgent Switched from just-snake-case to @queso/snake-case - better Typescript compatability. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.6 ./start.sh v3.17.6 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.5 v3.17.5 \u00b6 Bumps tangy-form to 4.23.3, editor to 4.23.3. Issue: 2620 Update date carousel to 5.2.1 with fix for clicking the today button. PR: #2677 Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.5 ./start.sh v3.17.5 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.4 v3.17.4 \u00b6 Enables support for reducing the number of documents processed in the changed feed when syncing using the 'changes_batch_size' property in app-config.json. This new setting will help sites that experience crashes when syncing or indexing documents. Using this setting will slow sync times. Default is 50. During recent tests, the following settings have been successful in syncing a location with over 12,700 docs that was experiencing crashes: \"batchSize\": 50 \"writeBatchSize\": 50 \"changes_batch_size\": 20 Please do note that these particular settings do make sync very slow - especially for initial device sync. - Removed selector from push sync - was causing a crash on large databases. Using a filter instead in the push syncOptions to exclude '_design' docs from being pushed from the client. - Adds \"Encryption Level\" column to the Devices Listing, which shows if the device is running 'OS' encryption or 'in-app' encryption. - 'OS' encryption: Encryption provided by the device operating system; typically this is File-based (Android 10) or Full-disk encryption (Android 5 - 9). - 'in-app' encryption: Database is encrypted by Tangerine. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.4 ./start.sh v3.17.4 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.3 v3.17.3 \u00b6 Automatically retry after failed sync. ( https://github.com/Tangerine-Community/Tangerine/pull/2663 ) Do not associate form response with Event Form if only opened and no data entered. Fix issue causing Android Tablets using OS level encryption to spontaneously start using in-app encryption. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.3 ./start.sh v3.17.3 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.2 v3.17.2 \u00b6 Add support for depending on Android Disk encryption as opposed to App Level encryption. Set turnOffAppLevelEncryption to true in client/app-config.json . Note that enabling this will not turn off App Level encryption for devices already installed, only new installations. Fix race condition data conflict on EventFormComponent that is triggered when opening and submitting a form quickly. Prevent data entry until Case is loaded to avoid conflicting Case save of a fast submit. Fix bug causing Device ID to not show up on About page on Devices. When syncing, push before pull to avoid having to analyze changes pulled down for push. Fix download links for archived APKs on Live channel. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.2 ./start.sh v3.17.2 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.1 v3.17.1 \u00b6 Add support for Form Versions when it hasn't been used before by defaulting the first entry in formVersions when a form version isn't defined on a Form Response. Fix issue causing Device Admin user log in to fail. Restore missing sectionDisable function in skip logic for forms. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Ensure git is initialized in all group folders. docker start couchdb docker start tangerine # Fetch the updates. git fetch origin git checkout v3.17.1 ./start.sh v3.17.1 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.0 v3.17.0 \u00b6 New Features and Fixes Device User Role access to Case Events and Event Forms #2598 Getting started with using Device User Roles Demo: Device User role based access to Event Forms Demo: Device user role based permissions for Case Events Deactivate Case Participant API #2594 Demo: https://youtu.be/Ulh-yCqfbFA Data Collector with a single click opens all pages of a completed form response #2596 skip() and unskip() functions are now available in tangy-form level on-change logic for skipping and unskipping sections, not inputs. Fix print form as table for some forms. ( https://github.com/Tangerine-Community/Tangerine/pull/2568 ) Update the group icon on server #2355 Add window.uuid() API #2595 Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Ensure git is initialized in all group folders. docker start couchdb docker start tangerine # Fetch the updates. git fetch origin git checkout v3.17.0 ./start.sh v3.17.0 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.16.4 v3.16.5 \u00b6 Fixes T_ARCHIVE_APKS_TO_DISK and/or T_ARCHIVE_PWAS_TO_DISK setting have no effect. Issue: #2608 Bug in CSV rendering for Tangerine Teach. Issue: #2635 new setting outputDisabledFieldsToCSV in groups doc Developer Interest There is now a content set for developing projects with the Class module enabled in content-sets/teach. Sets the following properties in app-config.json: \"homeUrl\": \"dashboard\" \"uploadUnlockedFormReponses\": true Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Ensure git is initialized in all group folders. docker start couchdb docker start tangerine docker exec tangerine sh -c \"cd /tangerine/groups && ls -q | xargs -i sh -c 'cd {} && git init && cd ..'\" # Fetch the updates. git fetch origin git checkout v3.16.5 # If you are enabling the new mysql module, follow the instructions in `docs/system-administrator/mysql-module.md` to update the config.sh file (steps 1 through 3) # If you do not wish APK and PWA archives to be saved, set T_ARCHIVE_APKS_TO_DISK and/or T_ARCHIVE_PWAS_TO_DISK to false. # Then return here before starting tangerine # Now you are ready to start the server. ./start.sh v3.16.5 docker exec tangerine push-all-groups-views # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.16.4 # If setting up mysql return to step 5 in `docs/system-administrator/mysql-module.md` v3.16.4 \u00b6 New Features Warning about data sync: Any site that upgraded to v3.16.2 is at risk of having records stay on the tablet unless they upgrade to v3.16.3 or v3.16.4. After upgrading to v3.16.4, go to the Online Sync feature and click the new 'Advanced Options' panel. There are two new options for sync - Comparison Sync and Rewind Sync. Comparison sync enables the Sync feature to compare all document id's on the local device with the server and uploads any missing documents. Rewind Sync resets the sync \"placeholder\" to the beginning, ensuring that all docs are synced. It doesn't actually re-upload all docs; it instead checks that all docs have been uploaded. It is more thorough than Comparison Sync. Both of the features are for special cases and should not be used routinely. Issue: #2623 There are two settings that can be configured for Comparison sync: - compareLimit (default: 150) - Document id's must be collected from both the tablet and server in order to calculate what documents need to be sync'd to the server. This setting limits the number of docs queried in each batch. - batchSize (default: 200) - Number of docs per batch when pushing documents to the server. This same configuration setting is used for normal sync, so please take care when making changes to it. This new \"Comparison\" option is very new and may have rough edges. In our experience, if the app crashes while using it, re-open the app and try again; chances are that it will work. If it consistently fails, lower the value for app-config.json's compareLimit property. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Ensure git is initialized in all group folders. docker start couchdb docker start tangerine docker exec tangerine sh -c \"cd /tangerine/groups && ls -q | xargs -i sh -c 'cd {} && git init && cd ..'\" # Fetch the updates. git fetch origin git checkout v3.16.4 # If you are enabling the new mysql module, follow the instructions in `docs/system-administrator/mysql-module.md` to update the config.sh file (steps 1 through 3) # If you do not wish APK and PWA archives to be saved, set T_ARCHIVE_APKS_TO_DISK and/or T_ARCHIVE_PWAS_TO_DISK to false. # Then return here before starting tangerine # Now you are ready to start the server. ./start.sh v3.16.3 docker exec tangerine push-all-groups-views # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.16.3 # If setting up mysql return to step 5 in `docs/system-administrator/mysql-module.md` v3.16.3 \u00b6 New Features Warning about data sync: Any site that upgraded to v3.16.2 is at risk of having records stay on the tablet unless they upgrade to v3.16.3. After upgrading to v3.16.3, run the new \"Push all docs to the server\" feature available from the Admin Configuration menu item. This feature resets push sync to the beginning, ensuring that all docs are pushed. It doesn't actually re-upload all docs; it instead checks that all docs have been uploaded. Added \"Push all docs to the server\" feature to the Admin Configuration menu item. Added Operating System and Browser Version to Device listing. Fixes - Data collected after first registering and after updates fails to upload. Issue: #2623 Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Ensure git is initialized in all group folders. docker start couchdb docker start tangerine docker exec tangerine sh -c \"cd /tangerine/groups && ls -q | xargs -i sh -c 'cd {} && git init && cd ..'\" # Fetch the updates. git fetch origin git checkout v3.16.3 # If you are enabling the new mysql module, follow the instructions in `docs/system-administrator/mysql-module.md` to update the config.sh file (steps 1 through 3) # If you do not wish APK and PWA archives to be saved, set T_ARCHIVE_APKS_TO_DISK and/or T_ARCHIVE_PWAS_TO_DISK to false. # Then return here before starting tangerine # Now you are ready to start the server. ./start.sh v3.16.3 docker exec tangerine push-all-groups-views # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.16.2 # If setting up mysql return to step 5 in `docs/system-administrator/mysql-module.md` v3.16.2 \u00b6 New Features Enables filtering of Case Event Schedule by Device's Assigned Location PR: #2591 Fixes - Enables editing of device description. Commit: #2613 Server upgrade instructions If you want to enable filtered Case Event Schedule by Device's Assigned Location, add filterCaseEventScheduleByDeviceAssignedLocation to your groups' app-config.json set to a value of true . Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Ensure git is initialized in all group folders. docker start couchdb docker start tangerine docker exec tangerine sh -c \"cd /tangerine/groups && ls -q | xargs -i sh -c 'cd {} && git init && cd ..'\" # Fetch the updates. git fetch origin git checkout v3.16.2 # If you are enabling the new mysql module, follow the instructions in `docs/system-administrator/mysql-module.md` to update the config.sh file (steps 1 through 3) # If you do not wish APK and PWA archives to be saved, set T_ARCHIVE_APKS_TO_DISK and/or T_ARCHIVE_PWAS_TO_DISK to false. # Then return here before starting tangerine # Now you are ready to start the server. ./start.sh v3.16.2 docker exec tangerine push-all-groups-views # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.16.1 # If setting up mysql return to step 5 in `docs/system-administrator/mysql-module.md` v3.16.1 \u00b6 New Features Improves sync stats and add \"Export Device List\" feature PR: #2610 Fixes - Fixes Editor form creation issue #2605 and form copy issue #2604 - Adds check for calculateLocalDocsForLocation before running update to index an index it depends upon. - Update tangy-form to 4.21.3, tangy-form-editor to 7.6.5 to fix dynamically set level tangy location not resuming correctly #202 Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Ensure git is initialized in all group folders. docker start couchdb docker start tangerine docker exec tangerine sh -c \"cd /tangerine/groups && ls -q | xargs -i sh -c 'cd {} && git init && cd ..'\" # Fetch the updates. git fetch origin git checkout v3.16.1 # If you are enabling the new mysql module, follow the instructions in `docs/system-administrator/mysql-module.md` to update the config.sh file (steps 1 through 3) # If you do not wish APK and PWA archives to be saved, set T_ARCHIVE_APKS_TO_DISK and/or T_ARCHIVE_PWAS_TO_DISK to false. # Then return here before starting tangerine # Now you are ready to start the server. ./start.sh v3.16.1 docker exec tangerine push-all-groups-views # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.16.0 # If setting up mysql return to step 5 in `docs/system-administrator/mysql-module.md` v3.16.0 \u00b6 New Features Warning about data sync: If you have implementations that have multiple tablets syncing from the same location, some docs may not be on all tablets due to issues with earlier versions of sync. This release resolves that particular issue and provides ways to ensure that all tablets share the same data. We have implemented several ways to rectify and understand potential data inconsistencies across tablets in the field: After updating the server to 3.16.0 and after updating and syncing the clients, the Device dashboard will now display the number of docs on each tablet (\"All Docs on Tablet\") and the number of docs according to the device's Location configuration (\"Form Responses on Tablet for Location\"). Depending on the Configure/Sync settings, the \"All Docs on Tablet\" count may be close, but not exactly the same, since not all forms may be synced to the tablets. The \"Form Responses on Tablet for Location\" count should be the same for all tablets that share the same location configuration. Please note that \"Form Responses on Tablet for Location\" count needs to be activated by adding \"calculateLocalDocsForLocation\": true to app-config.json; also note that it has not been widely tested and may be unstable. (If you activate this feature, you may also add \"findSelectorLimit\" to modify how many batches are used to calculate this value. Default is 200. Lower is safer but slower.) These data points may help in identifying data inconsistencies. Remember - only after updating and syncing the tablets, will these new doc counts be populated with data in the Devices listing. Making a note of the document counts per tablet will help establish a baseline. - Next step would be to run the new \"Force Full Sync\" feature, which is implemented in two ways: - If you add the new \"forceFullSync\" : true setting in the group's app-config.json, the client will perform a full sync upon the next update. Since this takes time and Internet bandwidth, you may wish to notify users before enabling this feature. - When logging in as \"admin\" user on the client tablet, a new menu item called \"Admin Configuration\" will be visible below the \"Settings\" item. This new item enables manual operation of the \"Force Full Sync\" feature. It is labeled \"Pull all docs from the server\" in the user interface. - You may adjust the settings for how many documents \"Force Full Sync\" downloads at a time by adjusting the initialBatchSize property in app-config.json. The default is 1000 documents per batch. This setting is also used when performing the initial load of documents on a tablet. - Tangerine Release Archives: Every Tangerine APK or PWA release is saved and tagged. If your site is configured for archives (which is the default), you may download previous Android releases. PR: #2567 - A \"Description\" field has been added to the Devices listing to faciliate identification of devices or groups of devices. - Beta Release Mysql module: Data sync'd to Tangerine can be output to a MySQL database. Warning: This should not yet be deployed on a production server; the code for this feature is still in development. We recommend creating a separate server for the Tangerine/MySQL installation and replicate data from the production server to the Tangerine server that would provide the MySQL service. Docs: docs/system-administrator/mysql-module.md PR: #2531 - Devices listing offers more information about the sync process, including version, errors, and sync duration. Fixes - Changes to the sync code should improve sync stability and speed. #2592 You may configure certain sync properties: - initialBatchSize = (default: 1000) Number of documents downloaded in the first sync when setting up a device. - batchSize (default: 200) - Number of documents downloaded upon each subsequent sync. - writeBatchSize = (default: 50) - Number of documents written to the tablet during each sync batch. - Updated tangy-form-editor to v7.6.4, which improves functionality of duplicate entire section . PR: #173 - Updates the Schedule View to use date-carousel 5.2.0 which provides unix timestamps instead of date strings. #2589 - Upgrade tangy-form to fix issue causing on-open of first items to not run when proposing changes in an Issue. - Deactivate App.checkStorageUsage if using Sync Protocol 2. This was not compatible and should not run. - Allow projects to disable GPS warming to save on battery with disableGpsWarming in app-config.json . - Add missing import of editor/custom-scripts.js when using editor so Data Dashboards can have imported JS files. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Ensure git is initialized in all group folders. docker start couchdb docker start tangerine docker exec tangerine sh -c \"cd /tangerine/groups && ls -q | xargs -i sh -c 'cd {} && git init && cd ..'\" # Fetch the updates. git fetch origin git checkout v3.16.0 # If you are enabling the new mysql module, follow the instructions in `docs/system-administrator/mysql-module.md` to update the config.sh file (steps 1 through 3) # If you do not wish APK and PWA archives to be saved, set T_ARCHIVE_APKS_TO_DISK and/or T_ARCHIVE_PWAS_TO_DISK to false. # Then return here before starting tangerine # Now you are ready to start the server. ./start.sh v3.16.0 docker exec tangerine push-all-groups-views # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.15.6 # If setting up mysql return to step 5 in `docs/system-administrator/mysql-module.md` v3.15.8 \u00b6 New Sync code reduces the number of network requests by disabling server checkpoints. It also supports three new app-config.json options to configure sync parameters that adjust data download size, how much data is written to the local database each batch, and initial data download: batchSize: Number of docs to pull from the server per batch. Increasing this setting will decrease the number of network requests to the server when doing a sync pull. Default: 200 writeBatchSize: How many docs to write to the database at a time. If the database crashes, decreasing this option could be helpful. Default: 50 useCachedDbDumps: Enables caching of the group database to a file for a single download to the client upon initial device setup. This is an experimental feature therefore it is not enabled by default. (Some server code is also currently disabled.) Those files are stored at data/groups/groupName/client/dbDumpFiles. At this point, you must delete the dbDumpFiles if you wish to update the data in the initial device load. 2560 Disable the v3.15.0 update from groups that use sync-protocol 1. Added 2021 to the report year. Added simple network statistics to the device replicationStatus, which is posted after every sync. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.15.8 # Now you are ready to start the server. ./start.sh v3.15.8 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.15.7 v3.15.7 \u00b6 New Features and Fixes - Fixes a bug in the CSV generation code that caused sections of rows in the CSV to output improperly. PR: #2558 - Adds a server config that allows the user to control the string used for variables that are undefined : T_REPORTING_MARK_UNDEFINED_WITH=\"UNDEFINED\" - The default value of the new config file is set to \"ORIGINAL_VALUE\" so existing Tangerine instances will not be effected. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. Please add the below line into your config.sh to preserve current behavior (as a workaround for #2564) T_REPORTING_MARK_UNDEFINED_WITH=\"\" cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.15.7 # Now you are ready to start the server. ./start.sh v3.15.7 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.15.6 v3.15.6 \u00b6 New Features and Fixes - New 'wakelock' feature for sync: When using the sync feature, the screen should not go to sleep or dim, enabling the sync process to proceed. This is especially useful during long sync processes. When you navigate to another page once Sync is complete, the wakeLock feature is disabled. - The Devices listing has a new option, \"View Sync Log\", which enables viewing status of the most recent replication, when available. - Added error messages when internet access drops during a sync. #2540 - Batch size for sync is configurable via pullSyncOptions and pushSyncOptions variable in a group's app-config.json. Default is 200. If the value is set too high, the application will crash. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.15.6 # Now you are ready to start the server. ./start.sh v3.15.6 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.15.5 v3.15.5 \u00b6 Fixes - In CSV output, if a section on a form is opened and then the later skipped, inputs on that skipped section will appear in CSV output as skipped. However, if the section is never opened, the inputs would show up in the CSV as blank values. This fix ensures that these remaining inputs are marked as skipped in CSV output. - Fix sync from breaking when syncing with a group with no data yet. - Improve messaging during sync by removing floating change counts and showing the total number of docs in the database after sync. Server upgrade instructions Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.15.5 # Now you are ready to start the server. ./start.sh v3.15.5 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.15.4 v3.15.4 \u00b6 Fixes - Sync: Sites with large datasets were crashing; therefore, we implemented a new sync function that syncs batches of documents to the server. PR: #2532 Server upgrade instructions # Fetch the updates. cd tangerine git fetch origin git checkout v3.15.4 # Now you are ready to start the server. ./start.sh v3.15.4 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.15.3 v3.15.3 \u00b6 Fixes - After a large sync in sync protocol 2, improve overall app performance by indexing database queries. Because this may cause a long sync for projects not using this, you can set indexViewsOnlyOnFirstSync in app-config.json to true if you want to allow existing tables to avoid this long sync to catch up on views. - Add missing custom-scripts.js and custom-styles.css files to Editor app. We also add editor and client ID's to the body tag of the two app respectively. - Reduce database merge conflicts by preventing form responses from saving after completed. Prior to this version, on two tablets (or on a tablet and the server) if you opened the same form response and opened an item to inspect, it would cause a save on both tablets resulting in an unnesessary merge conflict. - New T.case.getCaseHistory(caseId) function for getting the history of save for a Case. Returns an array of JSON patches in RFC6902 format. Open a Case and run await T.case.getCaseHistory() in the console and it will pick up on the context. - New T.case.getEventFormHistory(caseId, caseEventId, eventFormId) function for getting the history of save for a form response in a Case. Returns an array of JSON patches in RFC6902 format. Open a Case, a Case Event, then an Event Form and run await T.case.getEventFormHistory() in the console and it will pick up on the context. - New opt-in app-config.json setting attachHistoryToDocs for enabling upload all history of Case and Event Form edits on a Tablet up to the Server. Without this setting on, the server only sees the history starting from time of upload. Note this has an impact on upload size of at least doubling it when turned on. Important configuration notice - Set indexViewsOnlyOnFirstSync in app-config.json to true if you want to allow existing tables to avoid this long sync to catch up on views. Server upgrade instructions # Fetch the updates. cd tangerine git fetch origin git checkout v3.15.3 # Now you are ready to start the server. ./start.sh v3.15.3 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.15.2 v3.15.2 \u00b6 Fixes Rshiny module: Replaces hard-coded underscore separator with the configurable sep variable. Error when processing CSV's: 2517 Important configuration notice The v3.15.0 release included an update to the Editor Search feature #2416 that requires adding a searchSettings property to forms.json. In addition to running the upgrade script for v3.15.0; you must also make sure that all forms in a group's forms.json have searchSettings configured, especially the shouldIndex property. Examples are in the Case Module README \"Configuring Text Search\" section. Server upgrade instructions cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.15.2 # Now you are ready to start the server. ./start.sh v3.15.2 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.15.1 v3.15.1 \u00b6 Fixes Prevent opening of Event Forms on Editor when there is no corresponding Form Response available. Fix Issue type detection when deciding what is going to be in the 'current' tab. Update CSV output for signatures to be 'signature captured' and ''. Fix Issues view causing Issue search result to appear once per event such as comment or proposal. Integrate fixes in v3.14.6 including T.case.isIssueContext() API, and better API partity between being in an Event Form in a Case and being in an Event Form in an Issue. Server upgrade instructions # Fetch the updates. cd tangerine git fetch origin git checkout v3.15.1 # Now you are ready to start the server. ./start.sh v3.15.1 docker exec -it tangerine push-all-groups-views docker exec -it tangerine reporting-cache-clear # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.15.0 v3.15.0 \u00b6 New Features and fixes Editor User searches Cases by keyword #2416 - This feature enables searching by any of the variables assigned in searchSettings/variablesToIndex in forms.json. Transfer Participant between Cases #2419 . Find Participant UI: #2439 . Update to Content Set 2.1 adds a package.json and build step to pin lib versions and add a build step for custom-scripts. Added error message to Updates error alert. ccc1864 New \"Release Online Survey\" menu on Server allows you to release a single form for data collection online. Note the original \"Deploy -> Release\" menu item has been moved to \"Deploy -> Release Offline App\". Fixed issue where \"Tangy Gate\" form element could be added in Editor but would not appear on Tablets. Support for new \" \" element that brings a Partial Date style form element with support for the Ethiopian Calendar. If using Sync Protocol 2, the first sync when registering a Device is now faster in cases where there is a lot of data already collected. Also the blank User Profile created for the Admin user on a device is no longer uploaded resulting in less noise in the Device Users list. Important deprecation notice The groupName property, once used in app-config.json, is no longer supported in recent releases of Tangerine. The groupId property is used in its place. Groups that use groupName will not be able to sync; they must migrate to groupId. This issue affects groups using sync-protocol-1. #2447 When form responses are unlocked in a Data Issue, the on-submit hook no longer runs. If you need logic to run, use the new on-resubmit hook. If using Sync Protocol 2, the \"Auto Merge\" feature that tries to fix database conflicts is now off by default and database conflicts will not be logged as Issues. If you would like to keep it on, set \"autoMergeConflicts\": true in your group's client/app-config.json file. However be aware that turning this on will result in inconsistent results ( https://github.com/Tangerine-Community/Tangerine/issues/2484 ). Monitoring for database conflicts can now be done by monitoring the syncConflicts view via CouchDB Fauxton. Server upgrade instructions: # Fetch the updates. cd tangerine git fetch origin git checkout v3.15.0 # Now you are ready to start the server. ./start.sh v3.15.0 # Update the views - there are new views for Searches and Participant Transfers. docker exec -it tangerine reporting-cache-clear docker exec -it tangerine /tangerine/server/src/upgrade/v3.15.0.js # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.14.6 v3.14.6 \u00b6 Changes in v3.14.4 were abandoned, changes in v3.14.5 have been rolled into v3.15.0. The following are changes for v3.14.6. Improve first sync performance: On first sync, skip push but set the last push variable to whatever we left on after the first pull. Improve in-form API parity between context of a Case and context of an Issue proposal. Sets case context in more scenarious inside of Issue Form proposals. Prevent form crashes and unintentional logic by adding the new T.case.isIssueContext() API for detecting if in the Issue context in a form. Server upgrade instructions: # Fetch the updates. cd tangerine git fetch origin git checkout v3.14.6 # Now you are ready to start the server. ./start.sh v3.14.6 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.14.3 v3.14.3 \u00b6 Bugfix Auto-merged conflicts overwrite \"canonical\" change made on Editor server #2441 - Prevents tablets from overwriting documents from Editor in special cases. After modifying the case record, add canonicalTimestamp to the document: \"canonicalTimestamp\":1603854576785 New Features and fixes for all Tangerine Reduce number of unnecessary saves in Editor #2444 Improvements to Issues Listing #2398 Please update the group views (noted in the Server upgrade instructions below) in order to use the Issues Listing. Upgrades in the Developers' Interest Removed webpack from the Docker image. Custom apps should build their apps using their own webpack; the APK service will no longer perform that task. Server upgrade instructions: # Fetch the updates. cd tangerine git fetch origin git checkout v3.14.3 # Now you are ready to start the server. ./start.sh v3.14.3 # Update the views - there is a new view used for Issues. docker exec -it tangerine push-all-groups-views # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.14.2 v3.14.2 \u00b6 Bugfix Fixes file path issue when bundling custom scripts in APK's. Server upgrade instructions: # Fetch the updates. cd tangerine git fetch origin git checkout v3.14.2 # Now you are ready to start the server. ./start.sh v3.14.2 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.14.1 v3.14.1 \u00b6 This is identical to v3.14.0 but was released to fix a problem with tangerine-preview v3.14.0 on npm. v3.14.0 \u00b6 New Features and fixes for all Tangerine Usability Improvement for Device Registration : Added \"Number of devices to generate\" field to Device Registration. Submitting a single form to add multiple devices to a group should simplify large deployments. #2402 Important bugfix for sync issue in poor network situations : If you currently have an active 3.13 deployment, run the 3.14 update on client to make sure all data is sync'd to the server. #2399 Automatic conflict resolution on client : Basic support for automatic merges of conflicts in EventForms. #2272 Documentation for testing conflicts Form version support : Enables use of previous form versions for form display. #2365 Support for versioning is not yet implemented in the Editor; however, there is documentation on how to implement form versions manually. User Interface updates : The 4.19.0 tangy-form lib version features the following fixes: Required Field Asterisk (*) does not align with the question text #2363 Error Text and Warning Text have the same style - this is confusing for users #2364 Setting packageName in app-config.json causes app to crash : The docker-tangerine-base-image update to 3.7.0 improves Android and Cordova lib dependencies, and the release-apk code now rebuilds the Android code whenever an APK is built. #2366 New module for rshiny development : Adds option to csv module to change delimiter from '.' to '_' #2314 Documentation Update : Re-organization of some documentation and addition of missing image files. #2401 Upgrades in the Developers' Interest Upgraded docker-tangerine-base-image to v3.7.1 : Upgrade to Android API_LEVEL 30, Cordova 10, node:14.12.0-stretch. #1890 Caching cordova-android platform to avoid network issues when customizing packageName. #7 Important note for users of tangerine-preview There was a problem with v3.14.0 on npm; therefore, please use tangerine-preview v3.14.1. v3.13.1 \u00b6 Fix: Issues on Editor always ask us to rebase #2376 Fix: Issues screen will not load after upgrading from v3.10.0 to v3.13.0 #2378 Fix: Issues go missing after upgrading to v3.13.0 from v3.12.x #2377 Please be aware: this release was made in the release/v3.13.1-alt branch and to date has only been built as the v3.13.1-rc-2 image. Server upgrade instructions: # Fetch the updates. cd tangerine git fetch origin git checkout v3.13.1 # Now you are ready to start the server. ./start.sh v3.13.1 # Run upgrade docker exec -it tangerine /tangerine/server/src/upgrade/v3.13.1.js # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.13.0 v3.13.0 \u00b6 New Features and fixes for all Tangerine Download Location List as CSV : You can now download a location list as a CSV. If you prefer editing a Location List via something like Excel, this makes editing an existing location list easier, which can then be imported when done editing in Excel. Note: Advise careful use of this export feature until #2336 is fixed. #2107 Duplicate a Section :When editing a form, you can now easily duplicate an entire section with the \"duplicate section\" button. #2109 . Warning - this feature does not handle complex objects such as tangy checkbox groups well; be sure to check the code it generates. This issue will be addressed in the next 3.13 point release. Group Data Dashboard in Editor : \"Dashboard\" is now a menu item available in a Group under the Data menu. This link can be enabled by group role (disabled by default). When on the Dashboard page, it displays a customizable dashboard for that specific group. Customizing Dashboards currently requires HTML and Javascript knowledge but in the future we may build a configurator for Dashboards. More Menu Permissions in Editor :Add additional Editor permissions to completely cover menu level access in a group Automatic conflict resolution : After a sync pull on client, detects type of conflict and resolves it. View status of merges in the Issues feature. #1763 Fix extending session in Editor - When prompted to extend session shows up session is not really extended. #2266 New Features and Fixes for Case Module Client \"Issues\" feature : \"Issues\" previously could only be viewed using Editor. With this release, Issues can now be accessed from Client in a Case module enabled Group via the top level \"Issues\" tab. This tab can be disabled adding or modifying \"showIssues\": false, to app-config.json. Note that only issues created targeting the \"CLIENT\" context (See CaseService API documentation) will show up in the Client \"Issues\" tab. Easier searching on Client : Previously on Client when searching for \"Facility 8\" you would need to type exactly \"Facility 8\". Now search is case insensitive and you may type \"facility 8\" to match against \"Facility 8\". T.case.setEventWindow API fix : Previously when setting an Event window, the end time for the window was mistakenly ignored and set to the start time. This is now fixed. #2304 New Features for Sync Protocol 2 Module Export device sheets : When registering Devices, we now offer an option to print \"Device Sheets\". Device Sheets include the registration codes for a Device and also some human readable metadata. Each row can also be used as a label for each device that can be fastened to a device using affordable clear packing tape. #2269 Restore Backup on Android Tablet : Backups can now be restored. Restore is an option when first opening a freshly installed APK. #2127 Better support for working on the same Case on two devices : When working offline on the same Case on two Devices, after a sync, it may seem like the changes on one Tablet have gone missing for some time until the \"database conflicts\" are resolved using the CouchDB Futon interface on the server. Starting in v3.13.0 we'll start to employ algorithms for automatically merging to speed up the process of resolving these database conflicts. Notes for System Administrators After upgrade, you will no longer find group content directories in ./data/client/content/groups/ , they will be in ./data/groups/ . Inside each group's directory you will also find they have been split into a client and editor directory. All previous content will now be in the client directory while you may place content for the Group's Data Dashboard in the editor folder. Server upgrade instructions: This update changes the path to group content to /tangerine/groups/${groupId}/client . If your group is managing content via a Github/cron integration, you will need to change the path to content in its cron job. Change GROUP-UUID to your group id in the following command: cd /home/ubuntu/tangerine/data/groups/GROUP-UUID/client && GIT_SSH_COMMAND='ssh -i /root/.ssh/arc-forms-dev' git pull origin master && git add . && git commit -m 'auto-commit' && GIT_SSH_COMMAND='ssh -i /root/.ssh/arc-forms-dev' git push origin master The update: # Fetch the updates. cd tangerine git fetch origin git checkout v3.13.0 # Now you are ready to start the server. ./start.sh v3.13.0 # Run upgrade docker exec -it tangerine /tangerine/server/src/upgrade/v3.13.0.js # Add or modify `\"showIssues\": false,` to the group's app-config.json if you do not want to display the Issues tab in client. # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.12.0 v3.12.5 \u00b6 Fixed issue with black screen when moving from p2p tab to home v3.12.4 \u00b6 Fixed issue with QR code boundary boxes in tangy-form #158 . Bumped tangy-form v4.17.10 and tangy-form-editor to 7.2.5 v3.12.3 \u00b6 Fixed issue with mutually exclusive checkboxes in tangy-form #154 . Bumped tangy-form v4.17.9 and tangy-form-editor to 7.2.3 v3.12.2 \u00b6 When saving edits to a form, \"Show if\" logic has been written as tangy-if logic in the HTML. Form now on it will be written as show-if logic for consistency. tangy-if logic in has in the past in just showing/hiding an question on a form. It will now also reset the value if there is input and it is then hidden. In v3.12.0, caseService.getCurrentCaseEventId() was incorrectly removed. It has been added back, and an additional caseService.getCurrentEventFormId() function has been added for consistency. Fix Android 10 compatibility issue with P2P Sync mechanism causing tablets to crash. v3.12.1 \u00b6 Change behavior of show-if logic so that when a question hides, the value is reset. Adjust behavior of how Event Forms are added: If EventForm.autoPopulate is left undefined and required is true, then the form should be added. v3.12.0 \u00b6 New Features for Case Module Data Collector finds Event Forms are automatically created on Case Event creation and after adding a Participant #2147 [ Demo ] Data Collector has found a non required form has become required #2233 Demo Part 1: https://youtu.be/dnJk4LaGuQw Demo Part 2: https://youtu.be/I0JOZounZc4 Data Collector finds Case Event is automatically marked as complete #2235 [ Demo ] Data Collector sees indicator on Event Form when corresponding Form Response has not been synced to a device #2232 [ Demo ] Data Collector views a dedicated page for a Participant's Event Forms for a specific Case Event #2236 [ Demo ] Data Collector is redirected to custom route after Event Form is submitted #2237 [ Demo ] Fixes for Case Module Device User registering only sees user profiles they can associate with restricted by location the Device is assigned #2248 When all optional and incomplete forms are removed (no required forms in the event) from an event on the client the + button is not shown to re-add any of them #2113 Delete an incomplete form from a case does not refresh the screen #2114 Fixes for all of Tangerine Autostop is not triggered when marking the entire lineas incorrect #1869 Mark entire line of grid as incorrect cannot be undone #1651 Meta data print screen Prompt and Hint are not displayed for Radio Buttons (single type) #1748 Form Metadata view of Checkboxes with one option is missing #2239 New features for Sync Protocol 2 Restore encrypted backup on Device #2127 API Changes for Case Module caseEvent.status is now caseEvent.complete which has a value of true or false as opposed to the status strings. caseService.startEventForm(...) is now caseService.createEventForm(...) . caseService.deleteEventFormInstance(...) is now caseService.deleteEventForm(...) . caseService.getCaseEventFormsData(...) is now caseService.getEventFormData(...) . caseService.setCaseEventFormsData(...) is now caseService.setEventFormData(...) . Server upgrade instructions: # Fetch the updates. cd tangerine git fetch origin git checkout v3.12.0 # Now you are ready to start the server. ./start.sh v3.12.0 # Run upgrade docker exec -it tangerine reporting-cache-clear # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.11.0 Note that after running the upgrade script, your reporting caches may take some time to finish rebuilding. Android upgrade instructions: If you are upgrading an Android device that was installed with Tangerine v3.8.0 or greater, you will need to regenerate your APK and reinstall, otherwise you may use the over the air updater. v3.11.0 \u00b6 New Features in all Tangerine Device Manager installs many Tangerine APKs on a single device #2182 CSV output enhancements: Editor User indicates whether to include PII in CSV export #1771 User profile information available in CSV export #2081 Editor User exports CSV file that contains the group and form name #2108 New 'T' namespace for helper functions #2198 New Features in Tangerine with Case Module enabled Data Collector changes location of Case #2098 [ demo ] Data Collector views an alert #2020 [ demo ] Data Collector views custom report #2143 docs Developer notes Group permissions #2187 Server upgrade instructions: # Fetch the updates. cd tangerine git fetch origin git checkout v3.11.0 # Now you are ready to start the server. ./start.sh v3.11.0 # Run upgrade docker exec -it tangerine /tangerine/server/src/upgrade/v3.11.0.js Note that after running the upgrade script, your reporting caches may take some time to finish rebuilding. Android upgrade instructions: If your groups are using Sync Protocol 2 module, an APK reinstall is required. Release the APK and reinstall on all Android Devices. If your groups are not using Sync Protocol 2, you may upgrade Android tablets over the air using the usual release process. v3.10.0 \u00b6 New Features in all Tangerine Editor User updates own profile and/or password #2166 [ demo ] Editor User with appropriate permission manages site level permissions of users and edits details and password of user #2155 [ demo ] Editor User views question configuration by category (as opposed to long list) #2097 [ demo ] Server Admin creates group on command line with local or remote content set #2174 Demo: Server Admin creates group on command line from local or remote content set Demo: Server Admin creates group on command line from content set in a private repository on Github New Features in Tangerine with Case Module enabled Tangerine User views form response in alternative templates #2176 [ demo ] Data Manager manages Data Issues #1982 [ demo ] Data Manager rebases proposed changes in Issue #2179 [ demo ] Data Manager creates Data Issue #2144 [ demo ] Data Collector causes Issue to be created due to use of API in the form #2145 [ demo ] Data Collector causes Issue to be created due to discrepancy-if logic in form #2171 [ demo ] Synapse consumes structured outputs based on Case ER Diagram #2051 New features in Tangerine with Sync Protocol 2 Enabled Improve two-way sync efficiency in PouchDB by using doc_ids filter as opposed to mango query #2040 Developer notes Resolve problems with client compilation in Angular #2091 Upgrade instructions: # Fetch the updates. cd tangerine git fetch origin git checkout v3.10.0 # Now you are ready to start the server. ./start.sh v3.10.0 # Run upgrade docker exec -it tangerine /tangerine/server/src/upgrade/v3.10.0.js v3.9.1 \u00b6 Fixes Database views are missing when running tangerine-preview or npm start #2096 Event Schedule day view duplicates day event and show it in previous day as well #2103 According to date carousel, events appear off by one week #2094 Event Schedule templates are failing #2085 Reports form is not added to forms.json #2088 Events appear off by one day in Schedule List #2101 CouchDB port should be configurable in config.sh #2092 When opening the schedule view the first page is missing the header dates #2082 Data Collector unable to open an Event from the Event Schedule #2102 When editing a radio button options in editor, options should be in one column, not two #2090 v3.9.0 \u00b6 Features Set and get properties for Case Event Forms #2023 Data Manager reviews Cases PR Data Collector removes Event Form. PR Fixes Fix additional memory leaks in Case module causing tablets to slow down. PR Make getValue() function in Event Form List Item related templates less likely to crash. change Fixed incompatibilities with 2-way sync and P2P Sync. Fixed issue causing tablets to crash when syncing with a database with tens of thousands of records. Developer notes Editor and Clients upgraded to Angular 8. Changes Due to current limitations of two way sync, two changes have been made to the Device form in Tangerine Editor. First, changing a Device's assigned location and sync settings after the Device record has been claimed will no longer be allowed. Second, devices will now always be required to be assigned to the last level in your location hierarchy. Upgrade instructions: When you run the upgrade script, if you are using sync protocol 2 and have enabled, forms configured for 2 way sync will now be configured to use CouchDB sync to push documents up as opposed to \"custom sync\". # Fetch the updates. cd tangerine git fetch origin git checkout v3.9.0 # If you did not upgrade your config.sh in v3.8.1, migrate it now. # Move custom variables from config.sh_backup to config.sh. Note that T_ADMIN and T_PASS are no longer needed. mv config.sh config.sh_backup cp config.defaults.sh config.sh # To edit both files in vim you would run... vim -O config.sh config.sh_backup # Now you are ready to start the server. ./start.sh v3.9.0 # Run upgrade docker exec -it tangerine /tangerine/server/src/upgrade/v3.9.0.js v3.8.1 \u00b6 Client app performance improvements Improved caching of files. We are caching important configuration files for faster page loads (app-config.json, forms.json, location-list.json) and the Roboto font and have reduced redundant rendering calls. 1991 Loading spinner when opening an Event Form in a Case. #1992 Fixed a memory leak when viewing a Case which was causing tablets to crash if spending too much time on a Case screen. #2000 Radiobuttons now load faster on forms. Editor fixes Fixed an issue causing editor content region to be untouchable when window was narrow. #1940 Improved CSV output so it now contains Release ID, Device ID, and Build Channel on every row #349 Developer notes We focused on issues with slow performance on tablets when viewing forms. We are caching important configuration files (app-config.json, forms.json, location-list.json) and the Roboto font and have reduced redundant rendering calls. More information in the Globals doc . Server Admin notes We cleaned up config variables in config.sh , deprecated T_ADMIN and T_PASS #1986 New generate-cases command for load testing a large number of Cases based on your custom content in a group. #1993 New reset-all-devices command for reseting the server token and database keys for all devices. Note that after running this command you will need to reinstall on all devices and reregister with new QR codes. This command is useful if you are migrating a large amount of devices to a new group or a new server and you want to maintain Device ID consistency with the Device Serial numbers you are tracking. Upgrade instructions: # Fetch the updates. cd tangerine git fetch origin git checkout v3.8.1 # Now migrate custom variables from config.sh_backup to config.sh. Note that T_ADMIN and T_PASS are no longer needed. mv config.sh config.sh_backup cp config.defaults.sh config.sh # To edit both files in vim you would run... vim -O config.sh config.sh_backup # Now you are ready to start the server. ./start.sh v3.8.1 v3.8.0 \u00b6 v3.8.0 is a big and exciting release! To accomodate the long list of changes, we split up this round of release notes into sections: General, Sync Protocol 2 Module, and Case Module, and Developer notes. General \u00b6 The following are features and fixes that are coming to all Tangerine installs. With this release comes an improved Editor UI experience, a faster device setup process, new form features, and much more. Group tabs are now in 4 sections Breadcrumbs allows you to navigate back up deeply nested areas Editor User browses Group UI by nested categories (as opposed to flat list) #1880 Device Administrator is prompted to authorize permissions on first app load #1896 Data Collector defines password according to policy #1867 Data Collector views device info such as Device ID, Assigned Location, Server URL, Group Name, and Release Channel. #1834 Data Collector in checkboxes chooses \"none of the above\", then other options are unselected #1822 Editor distinguishes between inputs that are hidden and skipped #1800 Minor tweaks to the menu (now there is a single \"Sync\" item) and added tab bars to some pages for consistency. Sync Protocol 2 Module \u00b6 Sync Protocol 2 is a new module that can be enabled on a Tangerine installation that adds Device management, the ability for form responses to sync to the server and back down to tablets, the ablity for two tablets to sync form responses with each other offline, and much more. Manage which devices have access to sync, when they last synced, when they last updated and which version Define which form responses are synced up and back down to tablets Data Collector generates encrypted backup of Device #1909 Data Collector conducts a two-way sync with server only getting data from server relevant to their location #1755 Device sync by Location: Sync Protocol 2: Enables a \"Device Setup\" process on first boot of the client application. This requires you set up a \"Device\" record on the server. When setting up a Device record on the server, it will give you a QR code to use to scan from the tablet in order to receive it's device ID and token. Data Collector syncs to server with large dataset #1757 Data collector synchronizes data between devices using an Offline P2P mechanism #279 Editor User configures two-way sync for form responses from specific forms #1753 Editor revokes access to syncing with server for a lost Device #1894 Case Module \u00b6 Data Collector views Case Events in Schedule with Estimated Day, Scheduled Day, Window, and Occurred On Dates #1737 Data Collector creates (another) instance of a repeatable form for a specific participant in a specific event(8hrs) #1786 Data Collector views which Participant they are filling out a form for #1820 Data Collector searches for a Case in a large dataset #1893 Improvements to Case Home search - limit docs to 25 when no phrase is entered: #1871. Added rule to delay search in Case Home until at least two characters have been entered. Search results now sorted by date record updated. Lazy loading tabs in Case Home - this helps resolve some of the slowness in loading Case Home. Also disabled animations on tabs to remove jankiness. Developer Updates \u00b6 Re-enabled git config in Dockerfile - still having git networking error even when off corp network. Updated docker-tangerine-base-image to v3.4.0 New load testing doc. Added random name generation to the script that generates new cases - useful for load testing and checking how well search listing works. If using the 'case-mother' switch, record templates are pulled from your group. Upgrade instructions \u00b6 On the server, backup your data folder and then run the following commands. git fetch origin git checkout v3.8.0 ./start.sh v3.8.0 docker exec -it tangerine /tangerine/server/src/upgrade/v3.8.0.js Replace all ocurrences of localStorage.getItem('currentUser') with window.currentUser . v3.7.2 \u00b6 More fixes for upgrade process from v3.1.0. v3.7.1 \u00b6 Fix translations update script. Fix client update process when upgrading from v3.1.0. Upgrade instructions: On the server, backup your data folder and then run the following commands. git fetch origin git checkout v3.7.1 ./start.sh v3.7.1 docker exec tangerine translations-update v3.7.0 \u00b6 Fixes When editing forms, they will only save back to the server after clicking the top level \"save\" button. There is also now messaging around when the save either completes successfully or fails. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1645 On <tangy-timed> when using auto stop, return the property instead of the instead of the truthfulness of the value which is always false. PR: https://github.com/Tangerine-Community/tangy-form/pull/110 When uploadUnlockedFormReponses is set to true only incomplete forms are Synced up. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1725 In editor, modifying allowed pattern on text and number inputs does not work. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1770 Fix spacing between checkboxes in client Issue: https://github.com/Tangerine-Community/Tangerine/issues/1690 Fix click target and style for Case Event Form list Issue: https://github.com/Tangerine-Community/Tangerine/issues/1681 PR: https://github.com/Tangerine-Community/Tangerine/pull/1702 Fix Partial Date validation Issue: https://github.com/Tangerine-Community/Tangerine/issues/1683 PR: https://github.com/Tangerine-Community/tangy-form/pull/71 EF Touch changes <tangy-eftouch multi-select go-next-on-selection=\"2\"> should become <tangy-eftouch multi-select=\"2\" go-next-on-selection> . This allows for expanding functionality of being able to use multi-select without go-next-on-selection but still limit the number of choices the user can make minus the transition. no-corrections has been deprecated for new disable-after-selection attribute. When used with multi-select , the number of selections are still limited by the setting on multi-select , but changing selection is not allowed. The required attribute when used with multi-select will only require just one value selected. If you need form example 2 selections to be valid, you can combine required-all multi-select=\"2\" . We have an API change where we used to have TangyEftouch.value.selection was sometimes a string when not using multi-select and then when using multi-select , is was an array of strings. Now TangyEftouch.value.selection will always be an array of strings. Features When editing forms, the user will be warned of any duplicate variable names that exist in the form. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1793 Improve messaging when an APK update fails to download Issue: https://github.com/Tangerine-Community/Tangerine/issues/1743 PR: https://github.com/Tangerine-Community/Tangerine/commit/2ede9d3fb9d43dda234bfdcfc4849769b9b08e69 Data Collector sends SMS message from form Issue: https://github.com/Tangerine-Community/Tangerine/issues/1745 Data Collector views events in schedule with icons, estimated date info, and scheduled date info Issue: https://github.com/Tangerine-Community/Tangerine/issues/1686 Data Collector views Case Module screens in French Issue: https://github.com/Tangerine-Community/Tangerine/issues/1711 Data Collector confirms case when opened Issue: https://github.com/Tangerine-Community/Tangerine/issues/1695 PR: https://github.com/Tangerine-Community/Tangerine/pull/1741 Improved support for changing color scheme of client app using custom-styles.css , possible to have \"dark mode\". PR: https://github.com/Tangerine-Community/Tangerine/pull/1742 Data Collector shares all data on Device with other Users on the same Device. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1712 PR: https://github.com/Tangerine-Community/Tangerine/pull/1709 Data Collector finds Case Event status has changed to \"complete\" when all required forms are submitted. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1693 PR: https://github.com/Tangerine-Community/Tangerine/pull/1719 Data Collector finds all required Event Form instances in a Case Event are created upon opening the Case Event. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1691 PR: https://github.com/Tangerine-Community/Tangerine/pull/1718 Data Collector registers a Participant in a Case and views Event Forms grouped by Participant Issue: https://github.com/Tangerine-Community/Tangerine/issues/1692 PR : https://github.com/Tangerine-Community/Tangerine/pull/1723 Upgrade instructions: On the server, backup your data folder and then run the following commands. git fetch origin git checkout v3.7.0 ./start.sh v3.7.0 docker exec tangerine translations-update v3.6.5 \u00b6 Fix timed grid output to exclude item level variables in logstash output https://github.com/Tangerine-Community/Tangerine/pull/1806 Upgrade instructions: After the usual upgrade commands, also clear reporting caches with docker exec -it tangerine reporting-cache-clear . v3.6.4 \u00b6 Fix usage of T_CSV_MARK_DISABLED_OR_HIDDEN_WITH in some cases. v3.6.3 \u00b6 Allow disabled or hidden inputs output in CSV to be overridden using CSV_MARK_DISABLED_OR_HIDDEN_WITH in config.sh . The default value in config.defaults.sh is \"999\" which is what it has been for a few releases. When upgrading, do nothing if you want this to stay the same, otherwise use \"ORIGINAL_VALUE\" if you want to turn off the feature or set to your own custom value such as \"SKIPPED\" . v3.6.2 \u00b6 Fix import of location list from CSV https://github.com/Tangerine-Community/Tangerine/pull/1732/commits/05e57e8f1bb869dbd52b927d45fc223903e201db v3.6.1 \u00b6 Fix form routing for archived and active forms. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1722 PR: https://github.com/Tangerine-Community/Tangerine/pull/1724 Fix \"Mark entire line as incorrect in grids is not reflected in csv #1713\" Issue: https://github.com/Tangerine-Community/Tangerine/issues/1713 PR: https://github.com/Tangerine-Community/tangy-form/pull/103 v3.6.0 \u00b6 New Features Support for changing the order of forms. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1523 PR: https://github.com/Tangerine-Community/Tangerine/pull/1707 Support for archiving a form. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1526 PR: https://github.com/Tangerine-Community/Tangerine/pull/1675 Improvements and support on all inputs for error-text , hint-text , question-number , and content translations. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1655 PR: https://github.com/Tangerine-Community/tangy-form/pull/88 , https://github.com/Tangerine-Community/tangy-form/pull/86 Add support to <tangy-qr> for scanning data matrix codes. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1653 PR: https://github.com/Tangerine-Community/tangy-form/pull/87 New \"Capture Item at N Seconds\" feature for <tangy-timed> will prompt Data Collector to mark which item the child last read after a specific amount of time. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1586 PR: https://github.com/Tangerine-Community/tangy-form/pull/95 New goTo('itemID') helper function to navigate users to a specific item given some item level on-change logic. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1652 PR: https://github.com/Tangerine-Community/tangy-form/pull/92 New <tangy-signature> input for capturing signatures. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1656 PR: https://github.com/Tangerine-Community/tangy-form/pull/90 Visibility of labels and/or icons on item navigation now configurable with <tangy-form-item hide-nav-icons> and <tangy-form-item hide-nav-labels> . Issue: https://github.com/Tangerine-Community/Tangerine/issues/1682 PR: https://github.com/Tangerine-Community/tangy-form/pull/73 Fixes Fix Class tablets that are filling up their disk too fast. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1706 Fix metadata print screen options PR: https://github.com/Tangerine-Community/Tangerine/pull/1703 Issue: https://github.com/Tangerine-Community/Tangerine/issues/1670 , https://github.com/Tangerine-Community/Tangerine/issues/1671 Fix missing camera permission blocking APK installs form using QR or Photo Capture Issue: https://github.com/Tangerine-Community/Tangerine/issues/1646 , https://github.com/Tangerine-Community/Tangerine/issues/1578 Fix performance issues caused by needless TangyForm.on-change events from firing when they don't need to. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1656 PR: https://github.com/Tangerine-Community/tangy-form/pull/89 Fix data collector reviews completed fullscreen form Issue: https://github.com/Tangerine-Community/Tangerine/issues/1629 PR: https://github.com/Tangerine-Community/tangy-form/pull/75 <tangy-eftouch auto-progress> now distinguishes between going next on the time limit and going next on a number of selections. The API is now <tangy-eftouch go-next-on-selection=2> for going next on 2 selection and <tangy-eftouch go-next-on-time-limit> for going next on the time limit. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1597 PR: https://github.com/Tangerine-Community/tangy-form/pull/84 <tangy-eftouch> content is now more likely to fit above the fold, not overlap with content above it, be more consistent on smaller screens, and also adapt to screen size changes. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1591 , https://github.com/Tangerine-Community/Tangerine/issues/1587 PR: https://github.com/Tangerine-Community/tangy-form/pull/79 <tangy-eftouch> suffered from going to next item twice due to time limit and selection being made at in a close window. This is now fixed. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1596 PR: https://github.com/Tangerine-Community/tangy-form/pull/76 Fix Partial Date validation and for disabled attribute not reflecting Issue: https://github.com/Tangerine-Community/Tangerine/issues/1683 PR: https://github.com/Tangerine-Community/tangy-form/pull/71 Fix variable names in Editor to allow for only valid variable names. 2 or more characters, begin with alpha, no spaces, periods, allow _ no dash Issue: https://github.com/Tangerine-Community/Tangerine/issues/1566 , https://github.com/Tangerine-Community/Tangerine/issues/1558 , https://github.com/Tangerine-Community/Tangerine/issues/1461 PR: https://github.com/Tangerine-Community/tangy-form-editor/pull/77 Fix for Autostop for radio buttons - Issue: https://github.com/Tangerine-Community/Tangerine/issues/1519 PR's: https://github.com/Tangerine-Community/Tangerine/issues/1590 https://github.com/Tangerine-Community/tangy-form/pull/100 https://github.com/Tangerine-Community/tangy-form/pull/100 Experimental Features When using the experimental Case module, Editors can now program forms to trigger the creation of a \"Data Query\" when Data Collectors are entering data. Data queries are then shown later in a \"Data Queries\" tab where clarification on prior data entered is requested. PR: https://github.com/Tangerine-Community/Tangerine/pull/1661 Upgrade instructions: On the server, backup your data folder and then run the following commands. git fetch origin git checkout v3.6.0 ./start.sh v3.6.0 Now you may publish a release to your Devices and run the \"Check for Update\" on each Device. Note that if you are looking to use the QR Code scanner and you have been using Android Installation, you will need to reinstall the App on Devices and make sure to note the additional permissions installation instructions noted in the README.md file for enabling the App to have Camera Access. If using the Web Browser Installation, there is no need to reinstall the app for Camera access. v3.5.0 \u00b6 New Features Forms with fullscreen enabled now have a toggle button for the user to enable/disable fullscreen mode. Form designers may specify the number of taps in order for fullscreen to disable. https://github.com/Tangerine-Community/tangy-form/pull/51 , https://github.com/Tangerine-Community/tangy-form/pull/72 , https://github.com/Tangerine-Community/tangy-form-editor/pull/73 An inputs object keyed by input name is now available for use in valid-if statements. https://github.com/Tangerine-Community/tangy-form/pull/65 A new Partial Date item is available https://github.com/Tangerine-Community/tangy-form/pull/57 Translations updates. #1613 New custom-styles.css file which can be added by modifying a group's assets folder. You may define CSS classes and then utilize them in the editor by adding them under each widget's class attribute. New \"Copy form\" feature added to to Editor and more descriptive icon for adding a database record #1627 Fixes Helper functions for timed grids are now safer, will not crash if a grid was skipped and info is not availble. https://github.com/Tangerine-Community/tangy-form/pull/61 Print view for a form had a bug where only the first page was printable. This is now fixed so that all pages may be printed. https://github.com/Tangerine-Community/Tangerine/pull/1605 Fix tangy-select test regression and work on EFTouch transition sound plays only on auto-progress #137 API change in tangy-select - use of secondaryLabel is supported but deprecated; Use optionSelectLabel instead. #1602 Fix the display of uploaded docs #1609 Enable auto-stop for untimed grids #1522 Increased clickable target for forms list and visits tab #1628 Upgrade instructions: Backup your data folder and then run the following commands. git fetch origin git checkout v3.5.0 ./start.sh v3.5.0 docker exec -it tangerine /tangerine/server/src/upgrade/v3.5.0.js If any of your on-change logic looks into a form item's contents using tangyFormItemEl.shadowRoot.querySelector(...) or this.$.content.querySelector(...) , you must change it. The contents of the form can now be accessed at tangyFormItemEl.querySelector(...) . Also, the content element is no longer available. For example: // replace var el = this.$.content.querySelector('tangy-input[name=\\'classId\\']') //with var el = this.querySelector('tangy-input[name=\\'classId\\']') The advantage of moving this content out of the shadow DOM is that you can now style it directly from your app. v3.4.0 \u00b6 New Features New groups now ordered by creation date : Creating new groups will now order them by the date the were created in the group list. #1584 Configurable Web App Device Orientation : You can now specify the Web App orientation (portrait, landscape, or any) on device using the T_ORIENTATION variable in config.sh . Add T_ORIENTATION=\"any\" to config.sh to have more flexible orientations for PWA's. The options for T_ORIENTATION are at https://developer.mozilla.org/en-US/docs/Web/Manifest/orientation Media Library and Image support for Forms : Each group now has a media library tab where they can uplaod images which can then be utilized when inserting the new \"Image\" item on forms. #1138 New ACASI widget : The ACASI widget is braodly based on the EFTouch widget, but focused on a more static presentation of images and sounds. #56 Configurable font size in grids : You may now configure the font size in tangy-timed and tangy-untimed grids using the Option Font Size input. In tangy-form, it is exposed as option-font-size. Example of generated code: <tangy-timed required columns=\"3\" duration=80 name=\"class1_term2\" option-font-size=\"5\"> Auto-stop for tangy-radio-buttons : Add support for autostop in tangy-radio-buttons #49 . In Editor, set the Threshold to the number of incorrect answers: screenshots . Autostop is implemented by using the hideInputsUponThreshhold helper, which takes a tangy-form-item element and compares the number of correct radio button answers to the value in its incorrect-threshold attribute. Example of generated code: <tangy-form-item id=\"item1\" incorrect-threshold=\"2\"> New \"correct\" attribute for radio button options : A new \"correct\" attribute has been added to tangy-list-item to store the correct value. There is a \"Correct\" checkbox next to each option. Example of generated code: <tangy-radio-buttons name=\"fruit_selection2\" label=\"What is your favorite fruit?\"> <option name=\"tangerine\">Tangerine</option> <option name=\"cherry\" correct>Cherry</option> </tangy-radio-buttons> Fixes Critical Sync and \"data loss\" fix : Some variants of v3.3.x saw cases where data seemed to be lost on the tablet and sync no longer worked. After this release is deployed to the server, release for your groups and instruct all tablets to upgrade. The upgrade process may take many minutes depending on the amount of data stored on the tablet due to a schema update in the database. For an in depth look at what this update does, see the code here . Logstash Improvements #1516 User profiles were in a nested object, now they have been merged to be flat in the logstash output doc. See example here . If a form response uses a location element, it will now be extracted out into a top level \"geoip\" property whose value is an object with \"lat\" and \"lon\" properties. See example here . When new forms are created in the editor, they will no longer have a . character in their ID. This was causing some uneccessary and confusing logic in logstash config files. See PR here . EFTouch : A large number of fixes have been made for EFTouch. See recent issues here . Updated to tangy-form-editor ^5.18.0 for Change grid variables in CSV starting with variable_0 to variable_1 . A previous update to tangy-form to 3.15.1, tangy-form-editor to 5.17.0 to fixed Editing form level HTML requires two Save clicks Beta Features Two-way Sync : Allows for two-way sync of form responses. Can be configured to two way sync form responses for specific forms and also by geographic region defined in the user profile. See docs/feature-two-way-sync.md . and Add a tangy input inside a tangy box duplicates items , and enable Adjustable letter size for grids Case Module Add the \"case\" module to T_MODULES in config.sh and the default landing page for a group will be the cases search page and new \"Case Management Editor\" tab will appear in groups for creating and editing Case Definitions. #1517 Clientside search of Forms for Case Management Groups allows Cases to be found using the device camera to scan a QR code. See docs/case-management-group.md . Add event time and scheduling to Case Mangement Groups #1518 New layout for Case and Case Event pages. Upgrade instructions: Backup your data folder and then run the following commands. git fetch origin git checkout v3.4.0 ./start.sh v3.3.1 \u00b6 This release fixes a feature that made it into v3.3.0 but had a bug and was disabled. This release fixes that bug and makes it available. As an Editor user I want to be able to do an initial import of my location structure. #1117 v3.3.0 \u00b6 Features Assessor reviews high level case variables, AKA \"Case Manifest\" #1399 Assessor changes language setting to Russian #1402 Untimed Grid subtest #1366 Editor Style Upgrades (April 2019) #1421 Group Names can now have spaces and special characters #1424 Editor configures Timed Grid to show or hide labels on buttons #1432 Server Admin tunes the reporting delay between when an upload occurs and it shows up in reporting outputs #1441 CSV output for single checkboxes now show up as \"0\" and \"1\" as opposed to \"\" and \"on\" #1367 CSV output for single radiobuttons now show up as \"0\" and \"1\" as opposed to \"null\" and \"on\" #1433 You can now limit who can add/see sitewide users to only the USER1 account by setting T_USER1_MANAGED_SERVER_USERS to \"true\" in config.sh #1381 . Client now has an \"About\" page with details about what Tangerine is #1465 . Upgrade instructions: Backup your data folder and then run the following commands. git fetch origin git checkout v3.3.0 ./start.sh docker exec -it tangerine /tangerine/server/src/upgrade/v3.3.0.js v3.2.0 \u00b6 Features Assessor changes language of App #1315 Editor provides feedback given data entered earlier in the form #1384 Assessor starts new Case is immediately forwarded to first form #1362 Assessor finds Form and Event in Case has been disabled/enabled due to custom logic #1363 Assessor confirms participant info using data from another form #1385 Server Admin restarts machine to find containers have automatically come back up #1388 Server Admin sets up Tangerine outage alarm #1389 Developer Notes Ability to define database views on a per module basis in Client Angular #1419 Integrate test harness and TypeScript with server using NestJS #1413 Fix client tests, organize shared services and guards into the shared module, move client/app/ to client/ #1398 Upgrade instructions: git fetch origin git checkout v3.2.0 ./start.sh docker exec tangerine /tangerine/upgrades/v3.2.0.js - In each group's app-config.json , change \"direction\" to \"languageDirection\" . - If using a translation other than English, change in each group's app-config.json , change \"languageCode\" to the corresponding language code. Current codes other than en for English is JO_ar for Jordanian and KH_km for Khmer. v3.1.0 \u00b6 Features Item Editor UX Improvements #810 Assessor verifies correct location selected by reviewing metadata of location #1191 As an assessor I'd like to include a hint option to be displayed below the question text #1279 Grids: helper functions for grids #1183 Ability to mark an entire row as incorrect on grids #1333 Assessor's backed up form responses are archived when storage is filling up #1304 Assessor scans a QR Code into form #1309 All hidden inputs have reporting values of \"999\" #1349 Merge reporting output of radiobuttons into one column. Bug fixes Editor not properly logging users out resulting in getting stuck every 24 hours #1314 Min and Max for input number cannot be saved through the interface #1297 time on grids cannot be changes and is always 60 seconds #1301 Unclosed tags in html container can break form #1289 Tangy timed option values disappear #1302 Note that #1349 will bve optional in future releases and you may not want to upgrade until that time. Upgrade instructions: git fetch origin git checkout v3.1.0 ./start.sh docker exec tangerine reporting-cache-clear v3.0.0-beta13 \u00b6 Upgrade instructions from v3 betas \u00b6 git fetch origin git checkout v3.0.0 # Note the new T_UPLOAD_TOKEN variable which is a replacement for the old upload account variables. mv config.sh config.sh_backup cp config.defaults.sh config.sh vim config.sh ./start.sh docker exec tangerine push-all-groups-views docker exec tangerine reporting-cache-clear For existing groups, you need to edit their app-config.json files in the ./data/client/content/groups folders. Replace them with the following template and make sure to update variables such as groupName , uploadToken , and serverUrl . { \"listUsernamesOnLoginScreen\" : true , \"modules\" : [ ], \"groupName\" : \"pineapple\" , \"securityQuestionText\" : \"What is your year of birth?\" , \"hideProfile\" : false , \"direction\" : \"ltr\" , \"columnsOnVisitsTab\" : [], \"hashSecurityQuestionResponse\" : false , \"uploadUnlockedFormReponses\" : false , \"uploadToken\" : \"change this to match T_UPLOAD_TOKEN in config.sh\" , \"securityPolicy\" : [ \"password\" ], \"homeUrl\" : \"case-management\" , \"serverUrl\" : \"https://f571f419.ngrok.io/\" , \"centrallyManagedUserProfile\" : false , \"registrationRequiresServerUser\" : false } New features since v3.0.0-beta12 \u00b6 Server admin imports client archives into server #1166 After exporting data from clients, we now have an easy command line tool to import them. Place those exported files in ./data/archives folder and then run docker exec tangerine import-archives . Consumers of reporting API find user profile data appended to form responses #1147 New logstash module for installations that want to use logstash to migrate data to an Elastic Search instance. Enable by adding logstash to the list of modules in config.sh , then clear reporting caches docker exec -it tangerine bash; cd /tangerine/server/src/scripts; ./clear-all-reporting-cache.js; . You will find new <groupName>-logstash databases in CouchDB that you can configure logstash to consume. Upload Tokens instead of upload usernames and passwords. In your config.sh change T_UPLOAD_TOKEN to a secret phrase and then in existing groups add that to app-config.json as an \"uploadToken\" property and uploadUrl to serverUrl but without the username and password and upload/<groupName> . For example, \"uploadUrl\": \"http://uploader:password@foo.tangerinecentral.org/upload/foo\" would become \"serverUrl\":\"http://foo.tangerinecentral.org\", \"groupName\":\"foo\", \"uploadToken\":\"secret_foo_passphrase\" . If you not planning on updating clients right away, in config.sh set T_LEGACY=\"true\" to support the older upload API that those clients expect. When all clients are upgraded, set that variable back to false. Editor edits location list for group #982 @TODO Editor creates, edits, and deletes form responses on the server #1047 Editor exports CSV of a form for a month of their choosing #1143 Editor sees user profile form related columns joined to CSV of all forms #1142 On client, prevent users from editing their own profile. To impact new groups, change T_HIDE_PROFILE to \"true\" in config.sh . To modify existing groups, change \"hideProfile\" in group level app-config.json to true . Assessor registers on tablet, downloads form responses created on server #1129 On device registration, after user creates account, will force user to enter 6 character code that references online account. To impact new groups, change T_REGISTRATION_REQUIRES_SERVER_USER to \"true\" . To modify existing groups, change \"registrationRequiresServerUser\" in group level app-config.json to true . Editor updates client user profile on server, Assessor sees updated profile after next sync #1134 On client sync, will result in any changes made to a user profile on the server to be downloaded and reflected on the client. To impact new groups, change T_CENTRALLY_MANAGED_USER_PROFILE to \"true\" in config.sh . To modify existing groups, change \"centrallyManagedUserProfile\" in group level app-config.json to true . Editor views tangy-timed items_per_minute calculation in the CSV #1100 <tangy-location> can be filtered by entries in the profile by adding attribute <tangy-location filter-by-global> . In the editor when editing a <tangy-location> you will find a new option \"Filter by locations in the user profile?\" you can check. Advanced forms features (no GUI for these features) <tangy-input-group> can be used to create repeatable groups of inputs. See the demo here . Geofence for v3 #941 If you location list has latitude and longitude properties for each location, you can validate your <tangy-location> selection given a geofence in <tangy-gps> . See the screenshots here and a code example of how to build this in your form here . Upload incomplete form responses (important for Class module) To modify existing groups, set \"uploadUnlockedFormReponses\" to true in app-config.json . Server Admin clears reporting cache #1064 Server Admin runs script to update views in databases #962 Server Admin limits by site or by group the number of form responses uploaded end up in reporting outputs #1155 This feature brings two new settings to config.sh . Set T_PAID_MODE to \"site\" to limit on a sitewide level, use \"group\" to limit on a per group level. Set T_PAID_ALLOWANCE from \"umlimited\" to a specific number like \"1000\" to limit form responses that end up in reporting outputs to one thousand. This mechanism works by marking uploaded form responses as \"paid\". When you first upgrade to this release, none of your form responses will be marked as paid and will not end up in reporting outputs until they are marked as paid against the allowance. If you want to mark all current uploaded form responses as paid and only mark against their allowance for future uploads, set the allowance to unlimited and after the reporting caches have been built, set the allowance desired and run ./start.sh again. Optional Modules you can turn on and off in config.sh T_MODULES list. Note that if you are going to override the default T_MODULES list with an additional module such as class , don't forget to add modules such as csv if you still need them! Reporting outputs (inluding CSVs) include the information about the number of children a location has. #1174 Known issues \u00b6 Memory leak results in Error: spawn ENOMEM #886 On the server command line run crontab -e and then add the following entry to restart the program every 24 hours 0 0 * * * docker stop tangerine; docker start tangerine . 2.0.0 (pre-release) \u00b6 User Stories \u00b6 As a Tangerine Database admin, I want to control which users have the \"Manager\" role for creating new groups #218 As a Tangerine Editor User, I expect to see timestamps on CSVs down to the second #223 As a user, if I end up on a http:// URL I want to be redirected to the https:// version of that URL #98 Bugs \u00b6 New groups default Client tabs are set up for workflow, should be vanilla tangerine #230 When Tangerine is first installed, User1 does not have the required Manager role so groups cannot be created #229 School Location Subtest does not render after upgrading from Tangerine 0.4.x to v2.0.0 #189 If a group was upgraded from 0.x.x and does not have a media folder, APK generating fails #186 Deleting group does not set security correctly on resulting \"deleted\" database #227 Large CSVs fail to generate #221 When a new Workflow is created it is missing retrictToRole, reporting, and authenticityParameters #228 Ensure /var/log/couchdb exists so CouchDB does not crash #216 Technical \u00b6 Document how to use SSL with Tangerine #219 Things to add to .gitignore #185 Clean up build process so client does not need to compile twice #74 Upgrade directions \u00b6 This is the first release with upgrade scripts so you will need to run all upgrade scripts between the version you started at and this one. For example, if you are at Tangerine 0.4.6, then you must run... docker exec -it tangerine-container /tangerine-server/upgrades/v1.0.0.sh docker exec -it tangerine-container /tangerine-server/upgrades/v2.0.0.sh If you are at Tangerine 1.7.8, then you must run... docker exec -it tangerine-container /tangerine-server/upgrades/v2.0.0.sh v2.2.0 \u00b6 User Stories \u00b6 As a Site Owner I want to know how many results have been uploaded given arbitrary time period #457 Technical \u00b6 Refactor start.sh and config.defaults.sh to allow configurable ports and tag #456 Upgrade direcections \u00b6 docker exec -it tangerine-container /tangerine-server/upgrades/v2.2.0.sh","title":"What's new"},{"location":"whats-new/#whats-new","text":"","title":"What's new"},{"location":"whats-new/#v3192","text":"Fixes - Added process indicator when archiving, un-archiving, or deleting a case. Issue: #2974 - Add v3.19.2 update to recover if v3.19.0 search indexing failed Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.19.2 ./start.sh v3.19.2 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.19.1 # Perform additional upgrades. docker exec -it tangerine bash # This will index all database views in all groups. It may take many hours if # the project has a lot of data. wedge pre-warm-views --target $T_COUCHDB_ENDPOINT","title":"v3.19.2"},{"location":"whats-new/#v3191","text":"Fixes - Improved backup and restore file processing. Docs: Restoring from a Backup PR: #2910 - Added archive/unarchive Case functionality and permission for \"can delete\" #2954 Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.19.1 ./start.sh v3.19.1 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.19.0 # Perform additional upgrades. docker exec -it tangerine bash # This will index all database views in all groups. It may take many hours if # the project has a lot of data. wedge pre-warm-views --target $T_COUCHDB_ENDPOINT","title":"v3.19.1"},{"location":"whats-new/#v3190","text":"New Features Data Manager requests and downloads CSVs for multiple forms as a set. When logged into the server and in a group, you will now find a \"Download CSV Data Set\" menu item under \"Data\". From there you can view all of the CSV Data Sets you have generated in the past, the status of wether or not they have finished generating, a link to download them, and other meta data. Click the \"New Data Set\" button and you will be able to select any number of forms to generate CSVs for, data for all time or a specific month, and wether or not to exclude PII. This is especially useful for generating CSVs that take longer to generate than the automatic logout built into the server. You may request a CSV Data Set, log out, and then log back in later to check in on the status and download it. A Server Administrator can also configure cron with a generate-csv-data-set command to generate a data set on a daily, weekly, or monthly basis, handy for situations where you want CSVs to automatically generate on the weekend and then download them on Monday. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2768 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2777 ) Data Manager archives a Case to remove it from reporting output and Devices. This adds an \"archive\" button on Cases that flags all related Form Responses as archived and removes them from CSV output and Search on Devices. This uses the new T.case.archive() API which adds an 'archived' flag for those docs and saves a minimal version of the doc with enough data to be indexed on the server. Search on client and server CSV output are modified to filter archived docs. When viewing cases in Editor, displays \"Archived\" when viewing an archived case. When client syncs, it deletes any docs with the 'archived' flag and sets deletedArchivedDocs In the replicationStatus log. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2843 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2776 ) Devices Manager reconfigures claimed Device sync settings and selects multiple Sync Locations for a Device. Details: To change a Device's sync settings currently requires a reinstall of the app on the Device and setting up all the accounts again. This PR will allow system admins to change the sync settings for a Device which then triggers on next sync a Rewind Push, database delete, then a first pull with the new sync settings. Subsequent syncs then use the new sync settings. This PR also refactors the Create and Edit forms for Devices on the server so that multiple sync locations can be added. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2867 ) (PR: #2782 ) Device Manager estimates how large an initial sync will be given selected sync settings. When setting up sync settings for a Device, it is useful to know how many documents will need to be downloaded given which forms are configured for syncing down and the locations assigned. There is now a \"calculate down-sync size\" button at the bottom of Device edit/creation forms that when pressed will tally up the documents needing to be down synced given the device sync settings. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2845 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2818 ) Devices Manager monitors for Devices close to filling up disk space. Devices now report how much free space they have to the server after a sync. This can be monitored on the Deploy > Devices list. When a Device reports having less than 1GB free storage, a warning is shown on the Devices list. (Ticket: 2779 ) (PR: 2795 ) Server User views the version of Tangerine installed. Any user on the server can now view the version of Tangerine installed by going to Help menu in the left nav bar. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2846 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2794 ) Database Consumer accesses Tangerine MySQL databases via web browser. Users of Tangerine's MySQL database sometimes are not allowed to install tools such as MySQL Workbench on their work computers. This PR makes starting PHPmyAdmin (a mysql viewer) as a web service a configuration option in Tangerine so no one has to install software on their computer to access Tangerine MySQL. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2847 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2793 ) Data Collector creates Account on Device and associates with any User Profile in Group (ignoring Device assignment/sync settings). By default, when a Data Collector creates an Account on Device, they can only associate with User Profiles that are assigned to the same location as the Device's Assigned Location. Add \"disableDeviceUserFilteringByAssignment\":true to the app-config.json for the group and this restriction will be removed. Tablets will also sync all User Profiles, ignoring the Device's configured Sync Location(s). (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2848 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2792 ) Form Developer writes code that can access Case's related Location metadata without writing asynchronous code. When working synchronously in forms, we don't currently have access to the related Location Node data without loading the Location List async and using T.case.case.location to search the hierarchy for the node we want. This PR loads all related Location Nodes into memory at T.case.location when the context of a Case is set. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2849 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2791 ) Server Administrator configures substitutions for CSV output. This feature allows a Server Administrator to update the group's configuration in the app database to contains Regex string replacements for CSV output. This can be handy in situations where Data Analysts are having trouble parsing CSV data that contains line breaks and commas. An example configuration to remove line breaks and commas from data would be \"csvReplacementCharacters\": [{\"search\": \",\", \"replace\": \"|\"}, {\"search\": \"\\n\", \"replace\": \"___\"}] . (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2787 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2788 ) Server Administrator configures Tangerine to not auto-commit in groups' data directories to preserver manually managed git content repositories. When using git to manage group content in a git flow like manner, the automatic commit can result in unnintentional commits. System Administrators can now turn off this auto-commit by configuring Tangerine's config.sh with T_AUTO_COMMIT=\"false\" . If set to true also include the frequency T_AUTO_COMMIT_FREQUENCY=\"60000\" (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2614 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2748 ) Data Collector proposes change to a Form on a Case. The issues feature that has been available on the server is now optionally also available on Devices by \"allowCreationOfIssues\": true to client/app-config.json for the group you want this enabled. Most of the features of Issues you are familiar with from the server are there, except for merging proposals which is not allowed. Issues from Devices are uploaded to the server where proposals can be merged by a Data Manager. We also streamlined the Issue creation and proposal process by skipping the page to fill out an issue title/description, and then forward them directly to creating a proposal. To aid in issue titles/descriptions that make sense, Content Developers can now add templateIssueTitle and templateIssueDescription to Case Definition files. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2850 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2330 ) ( Demo Video ) Data Manager updates Issue Title and Issue Description Data Managers will now find a metadata tab on an Issue where they can update the Title, Description, and new \"Send to\" settings. (Issue: https://github.com/Tangerine-Community/Tangerine/issues/2851 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2330 ) Data Manager sends an Issue to all Devices in Sync Area or specific Device When create/configuring an Issue, Data Managers now have the option to send an Issue to a specific location in a Sync Area, or send it to a specific Device by Device ID. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2854 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2330 ) Forms Developer defines custom logic for Device's search of Cases and Forms In some cases there are situations where the standard variables for searching do not cover all things we want searched, or there is a compound field we want to be searched. Adding a client/custom-search.js file allows the Forms Developer to hook into the map function used to generate the search index. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2852 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2740 ) Data Manager views list of Issues related to Case When viewing a Case on the server, the first screen when opened will now show a list of related Issues. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2723 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2573 ) Form Developer uses API to override Device User based access to Event Forms on a per Case Event basis Currently we can configure in a Case Definition the operation permissions on all instances of an Event Form. This change allows a Form Developer to write logic that would control those permissions on a per Event Form basis by setting the same permissions property on the Event Form itself. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2624 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2660 ) Form Developer configures Devices to skip optimization of database views not in use on Device. Some projects relying heavily on a custom app will find they do not use all of the standard Tangerine database views, thus they can be skipped during the data optimization phase after a sync. In app-config.json , you can add a new doNotOptimize property with a value as an array of views to skip. To discover what views your app is indexing, see the console logs from a device during the optimization phase. You may discover some views you can add to doNotOptimize to speed up that optmization process. (Commit: https://github.com/Tangerine-Community/Tangerine/commit/4b8864470c1cad98e43152dd6bb3c91ee3e576a6 ) System Administrator batch imports all forms from a Tangerine v2 group into a Tangerine v3 group Tangerine v3 now has a script that will import all v2 group forms into a v3 group without having to do each form individually. (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2857 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2584 ) Fixes Issue created programatically in on-submit says we must rebase but no button to rebase #2785 Cases that have used the T.case.createIssue() API in forms to create Issues on the current form have recently found the resulting issues are broken. This is due to a change in when the Form Response is associated with the case (later than when T.case.createIssue() is called in a form's on-submit). To remedy this, we've added a new T.case.queueIssueForCreation(\"Some label\", \"Some comment\") API. If you are using T.case.createIssue(), immediately upgrade and replace its usage with T.case.queueIssueForCreation() . (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2785 ) (Example: https://github.com/Tangerine-Community/Tangerine/blob/next/content-sets/case-module/client/test-issues-created-programatically-on-client/form.html#L5 ) Using a simpler reverse sort for device status (PR: https://github.com/Tangerine-Community/Tangerine/pull/2775 ) Increase likelihood that migration of data to mysql will recover where it left off if server restarts. (PR: https://github.com/Tangerine-Community/Tangerine/pull/2773 ) From Case Definitions, the onCaseOpen and onCaseClose now also run in the server context. (PR: https://github.com/Tangerine-Community/Tangerine/pull/2696 ) \"openEvent is not defined\" when accessing a case in Editor (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2800 ) Synclog date/time header is incorrect and sort is broken (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2762 ) Synchronization UX Improvements - remove error state after retries when retry is successful (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2808 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2826 ) Fix missing 'form_' from id for v2 import (Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2856 ) (PR: https://github.com/Tangerine-Community/Tangerine/pull/2726 ) Minor tweak to tangerine-preview README (PR: https://github.com/Tangerine-Community/Tangerine/pull/2735 ) Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.19.0 ./start.sh v3.19.0 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.18.3 # Perform additional upgrades. docker exec -it tangerine bash push-all-groups-views update-down-sync-doc-count-by-location-id-index '*' # This will index all database views in all groups. It may take many hours if # the project has a lot of data. wedge pre-warm-views --target $T_COUCHDB_ENDPOINT","title":"v3.19.0"},{"location":"whats-new/#v3187","text":"Fixes Back-ported some fixes to the backup and restore feature from the v3.19.1 branch. Fixed issue with Teach where third subtask would not open correctly. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.18.7 ./start.sh v3.18.7 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.18.6","title":"v3.18.7"},{"location":"whats-new/#v3186","text":"Updates Updated tangy-form lib from 4.25.11 to 4.25.14 ( Changelog ), which provides: A fix for photo-capture so that it de-activates the camera when going to the next page or leaving a form. Implemented a new 'before-submit' event to tangy-form in order to listen to events before the 'submit' event is dispatched. A fix for User defined Cycle Sequences. Fixes Remove incorrect exception classes for changes processing #2883 PR: #2883 Issue: #2882 Added backup and restore feature for Tangerine databases using device encryption. Increase the appConfig.json parameter dbBackupSplitNumberFiles (default: 200) to speed up the backup/restore process if your database is large. You may also change that parameter in the Export Backup user interface. Updated docs: Restoring from a Backup PR: #2910 Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.18.6 ./start.sh v3.18.6 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.18.5","title":"v3.18.6"},{"location":"whats-new/#v3185","text":"Fixes Server admin can configure regex-based password policy for Editor. Instructions in the PR: #2858 Issue: #2844","title":"v3.18.5"},{"location":"whats-new/#v3184","text":"Fixes Backported a fix from the v3.19.0 branch for \"Save the lastSequence number after each change is processed in the tangerine-mysql connector\" Issue #2772 Address crashes when importing data using the mysql module #2820 cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.18.4 ./start.sh v3.18.4 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.18.3","title":"v3.18.4"},{"location":"whats-new/#v3183","text":"Fixes Important If your site uses csvReplacementCharacters to support search and replace configuration for CSV output, which was released v3.18.2, you must change the configuration string. See issue #2804 for information about the new schema. Backported a fix from the v3.19.0 branch for \"Issue created programmatically in on-submit says we must rebase but no button to rebase #2785\" Description: Cases that have used the T.case.createIssue() API in forms to create Issues on the current form have recently found the resulting issues are broken. This is due to a change in when the Form Response is associated with the case (later than when T.case.createIssue() is called in a form's on-submit). To remedy this, we've added a new T.case.queueIssueForCreation(\"Some label\", \"Some comment\") API. If you are using T.case.createIssue(), immediately upgrade and replace its usage with T.case.queueIssueForCreation() . Ticket: https://github.com/Tangerine-Community/Tangerine/issues/2785 Example: https://github.com/Tangerine-Community/Tangerine/blob/next/content-sets/case-module/client/test-issues-created-programatically-on-client/form.html#L5","title":"v3.18.3"},{"location":"whats-new/#v3182","text":"Feature: Editor User downloads CSVs for multiple forms as a set Issue: #2768 PR: #2777 Feature: Remove configurable characters from CSV output #2787 . Documentation updates for backup/restore and fixes to image paths Fix default user profile so it doesn't assume use of roles or location Disabled \"Print form backup\" in Editor Improvements to display of \"Print metadata\" in Editor Update and fix for Cycle Sequences to enable numbering of sequences starting from 1. PR's: #231 , #269 Bump tangy-form to 4.25.11 and tangy-form-editor to 7.8.8.","title":"v3.18.2"},{"location":"whats-new/#v3181","text":"Fix backup when using os encryption and sync protocol 2 and cordova. (PR: #2767 ) Fix creating of new Device Users when using Sync Protocol 2. (PR: #2769 ) Fix default user profile form for Sync Protocol 1 users. We should not assume they are using roles or location.","title":"v3.18.1"},{"location":"whats-new/#v3180","text":"","title":"v3.18.0"},{"location":"whats-new/#new-features","text":"Enable configurable image capture in client #2695 Makes image capture work with a max size attribute - PR: #218 Add photo capture widget #203 Serve base64 image data as image files #2706 PR: #2725 Add Cycle sequences 1603 Sort by lastModified in the client case search #2692 Enable assigning multiple roles in forCaseRole in the eventFormDefinition #2694 Enable defining custom functions or valid JavaScript expressions that will be called when an event is opened and when an event is closed. On open and close events for case and case-events: #2696 Teach-specific strings in Russian for default content-set #2676 Uploads status such as app version when updating the app #2756","title":"New Features"},{"location":"whats-new/#bugfixes","text":"Initialize git in content repository before running git commands #2667 Only show the links to historical releases when T_ARCHIVE_PWAS_TO_DISK and T_ARCHIVE_APKS_TO_DISK in the config.sh are set to true #2608 Fix form breaking when form name has single quote #2489 Add print options to archived forms #1987 Fix Grid having negative values #2294 Fix to allow for running on m1 Macs #2631 #2631 Thanks @fmoko and @evansdianga! For projects using the Case Reporting screen but don't have anything in reports.js but do have markup in reports.html, avoid crash due to empty file #2657 V2 import script fixes #2675 Allow HTML markup in option labels 2453 Reset grid values when grid is restarted # Mark last attempted automatically when grid is auto-stopped #2467","title":"Bugfixes"},{"location":"whats-new/#new-documentation","text":"Deleting Records Bullet points for Tangerine Development Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.18.0 ./start.sh v3.18.0 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.11","title":"New Documentation"},{"location":"whats-new/#v31712","text":"Feature: Remove configurable characters from CSV output #2787 . This release also has bugfixes specific to the Class module, which now uses updated API's for form rendering. Feature for Class/Teach: Archive or enable a class. Issue: #2580 Bugfix for Class/Teach: Teach loses data and blocks app if Class form is not submited #2783 Bugfix for Class/Teach: App should return user to previous Curriculum when resuming app. Issue: #2648 Refactor Class to handle changes in tangy-form; Bug in CSV rendering for Tangerine Teach. Issue: #2635","title":"v3.17.12"},{"location":"whats-new/#v31711","text":"Added support for custom update scripts for each group. Add either a before-custom-updates.js or after-custom-updates.js to the root of your content depending on when you wish the script to run. Script needs to return a Promise. See Issue 2741 for script example. PR: #2742 Add support for filtering PII variables on Case Participant data and Event Form data in Synapse caches. List the variable names in your group's content folder reporting-config.json . For example: { \"pii\": [\"foo_variable\"] } . This config was previously stored in the groups database. Fixed bug that prevented rewind sync from working. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.11 ./start.sh v3.17.11 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.10","title":"v3.17.11"},{"location":"whats-new/#v31710","text":"Skip optimizing sync-queue, sync-conflicts, and tangy-form views after Sync Protocol 2 sync completes. Using T.case.load() in a form? This release fixes a bug where EventForm.formResponseId would be not set when submitting forms in cases where a form has loaded a different case and then the save case back again thus detaching the memory reference being previously set. Remove trailing whitespace from variables for mysql outputs to avoid illegal column names. Add response-variable-value API with support for returning jpeg and png base64 values as files. Refactor TANGY-SIGNATURE and TANGY-PHOTO-CAPTURE output in CSVs to be URLs of the image files. Creates work-around for deployments that are unable to use custom-scripts. Issue #2711 PR #2712 Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.10 ./start.sh v3.17.10 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.9","title":"v3.17.10"},{"location":"whats-new/#v3179","text":"","title":"v3.17.9"},{"location":"whats-new/#new-features-and-buffixes","text":"Prevent failed calls to T.case.save() in forms by avoiding any saves to a case when a form is active. PR , Issue Enable assigning multiple roles in forCaseRole in the eventDefinition #2694 - Cherry-picked commit 3e4938a0a80c57 only. Enable defining custom functions or valid JavaScript expressions that will be called when an event is opened and when an event is closed. On open and close events for case and case-events: #2702 Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.9 ./start.sh v3.17.9 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.8","title":"New Features and Buffixes"},{"location":"whats-new/#v3178","text":"Fix use of initial batch size #2685 Created generate-form-json script that generates the form json for a group from its form.html file. Usage: docker exec tangerine generate-form-json group-uuid The script loops through a group's forms.json and creates a form.json file in each form directory, next to its forms.html. Before using this script, run npm install . Issue: #2686 The synapse module now uses the json from generate-form-json to exclude PII. Also, the synapse module takes substitution and pii fields to accommodate schema changes and pii fields not identified in forms. PR: #2697 Place these properties in the groups Couchdb: \"substitutions\" : { \"mnh_screening_and_enrollment_v2\" : \"mnh01_screening_and_enrollment\" }, \"pii\" : [ \"firstname\" , \"middlename\" , \"surname\" , \"mother_dob\" ] Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.8 ./start.sh v3.17.8 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.7","title":"v3.17.8"},{"location":"whats-new/#v3177","text":"fix CSV generation issue: #2681 Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.7 ./start.sh v3.17.7 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.6","title":"v3.17.7"},{"location":"whats-new/#v3176","text":"fix issue w/ empty replicationStatus?.userAgent Switched from just-snake-case to @queso/snake-case - better Typescript compatability. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.6 ./start.sh v3.17.6 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.5","title":"v3.17.6"},{"location":"whats-new/#v3175","text":"Bumps tangy-form to 4.23.3, editor to 4.23.3. Issue: 2620 Update date carousel to 5.2.1 with fix for clicking the today button. PR: #2677 Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.5 ./start.sh v3.17.5 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.4","title":"v3.17.5"},{"location":"whats-new/#v3174","text":"Enables support for reducing the number of documents processed in the changed feed when syncing using the 'changes_batch_size' property in app-config.json. This new setting will help sites that experience crashes when syncing or indexing documents. Using this setting will slow sync times. Default is 50. During recent tests, the following settings have been successful in syncing a location with over 12,700 docs that was experiencing crashes: \"batchSize\": 50 \"writeBatchSize\": 50 \"changes_batch_size\": 20 Please do note that these particular settings do make sync very slow - especially for initial device sync. - Removed selector from push sync - was causing a crash on large databases. Using a filter instead in the push syncOptions to exclude '_design' docs from being pushed from the client. - Adds \"Encryption Level\" column to the Devices Listing, which shows if the device is running 'OS' encryption or 'in-app' encryption. - 'OS' encryption: Encryption provided by the device operating system; typically this is File-based (Android 10) or Full-disk encryption (Android 5 - 9). - 'in-app' encryption: Database is encrypted by Tangerine. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.4 ./start.sh v3.17.4 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.3","title":"v3.17.4"},{"location":"whats-new/#v3173","text":"Automatically retry after failed sync. ( https://github.com/Tangerine-Community/Tangerine/pull/2663 ) Do not associate form response with Event Form if only opened and no data entered. Fix issue causing Android Tablets using OS level encryption to spontaneously start using in-app encryption. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.3 ./start.sh v3.17.3 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.2","title":"v3.17.3"},{"location":"whats-new/#v3172","text":"Add support for depending on Android Disk encryption as opposed to App Level encryption. Set turnOffAppLevelEncryption to true in client/app-config.json . Note that enabling this will not turn off App Level encryption for devices already installed, only new installations. Fix race condition data conflict on EventFormComponent that is triggered when opening and submitting a form quickly. Prevent data entry until Case is loaded to avoid conflicting Case save of a fast submit. Fix bug causing Device ID to not show up on About page on Devices. When syncing, push before pull to avoid having to analyze changes pulled down for push. Fix download links for archived APKs on Live channel. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.17.2 ./start.sh v3.17.2 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.1","title":"v3.17.2"},{"location":"whats-new/#v3171","text":"Add support for Form Versions when it hasn't been used before by defaulting the first entry in formVersions when a form version isn't defined on a Form Response. Fix issue causing Device Admin user log in to fail. Restore missing sectionDisable function in skip logic for forms. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Ensure git is initialized in all group folders. docker start couchdb docker start tangerine # Fetch the updates. git fetch origin git checkout v3.17.1 ./start.sh v3.17.1 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.17.0","title":"v3.17.1"},{"location":"whats-new/#v3170","text":"New Features and Fixes Device User Role access to Case Events and Event Forms #2598 Getting started with using Device User Roles Demo: Device User role based access to Event Forms Demo: Device user role based permissions for Case Events Deactivate Case Participant API #2594 Demo: https://youtu.be/Ulh-yCqfbFA Data Collector with a single click opens all pages of a completed form response #2596 skip() and unskip() functions are now available in tangy-form level on-change logic for skipping and unskipping sections, not inputs. Fix print form as table for some forms. ( https://github.com/Tangerine-Community/Tangerine/pull/2568 ) Update the group icon on server #2355 Add window.uuid() API #2595 Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Ensure git is initialized in all group folders. docker start couchdb docker start tangerine # Fetch the updates. git fetch origin git checkout v3.17.0 ./start.sh v3.17.0 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.16.4","title":"v3.17.0"},{"location":"whats-new/#v3165","text":"Fixes T_ARCHIVE_APKS_TO_DISK and/or T_ARCHIVE_PWAS_TO_DISK setting have no effect. Issue: #2608 Bug in CSV rendering for Tangerine Teach. Issue: #2635 new setting outputDisabledFieldsToCSV in groups doc Developer Interest There is now a content set for developing projects with the Class module enabled in content-sets/teach. Sets the following properties in app-config.json: \"homeUrl\": \"dashboard\" \"uploadUnlockedFormReponses\": true Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Ensure git is initialized in all group folders. docker start couchdb docker start tangerine docker exec tangerine sh -c \"cd /tangerine/groups && ls -q | xargs -i sh -c 'cd {} && git init && cd ..'\" # Fetch the updates. git fetch origin git checkout v3.16.5 # If you are enabling the new mysql module, follow the instructions in `docs/system-administrator/mysql-module.md` to update the config.sh file (steps 1 through 3) # If you do not wish APK and PWA archives to be saved, set T_ARCHIVE_APKS_TO_DISK and/or T_ARCHIVE_PWAS_TO_DISK to false. # Then return here before starting tangerine # Now you are ready to start the server. ./start.sh v3.16.5 docker exec tangerine push-all-groups-views # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.16.4 # If setting up mysql return to step 5 in `docs/system-administrator/mysql-module.md`","title":"v3.16.5"},{"location":"whats-new/#v3164","text":"New Features Warning about data sync: Any site that upgraded to v3.16.2 is at risk of having records stay on the tablet unless they upgrade to v3.16.3 or v3.16.4. After upgrading to v3.16.4, go to the Online Sync feature and click the new 'Advanced Options' panel. There are two new options for sync - Comparison Sync and Rewind Sync. Comparison sync enables the Sync feature to compare all document id's on the local device with the server and uploads any missing documents. Rewind Sync resets the sync \"placeholder\" to the beginning, ensuring that all docs are synced. It doesn't actually re-upload all docs; it instead checks that all docs have been uploaded. It is more thorough than Comparison Sync. Both of the features are for special cases and should not be used routinely. Issue: #2623 There are two settings that can be configured for Comparison sync: - compareLimit (default: 150) - Document id's must be collected from both the tablet and server in order to calculate what documents need to be sync'd to the server. This setting limits the number of docs queried in each batch. - batchSize (default: 200) - Number of docs per batch when pushing documents to the server. This same configuration setting is used for normal sync, so please take care when making changes to it. This new \"Comparison\" option is very new and may have rough edges. In our experience, if the app crashes while using it, re-open the app and try again; chances are that it will work. If it consistently fails, lower the value for app-config.json's compareLimit property. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Ensure git is initialized in all group folders. docker start couchdb docker start tangerine docker exec tangerine sh -c \"cd /tangerine/groups && ls -q | xargs -i sh -c 'cd {} && git init && cd ..'\" # Fetch the updates. git fetch origin git checkout v3.16.4 # If you are enabling the new mysql module, follow the instructions in `docs/system-administrator/mysql-module.md` to update the config.sh file (steps 1 through 3) # If you do not wish APK and PWA archives to be saved, set T_ARCHIVE_APKS_TO_DISK and/or T_ARCHIVE_PWAS_TO_DISK to false. # Then return here before starting tangerine # Now you are ready to start the server. ./start.sh v3.16.3 docker exec tangerine push-all-groups-views # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.16.3 # If setting up mysql return to step 5 in `docs/system-administrator/mysql-module.md`","title":"v3.16.4"},{"location":"whats-new/#v3163","text":"New Features Warning about data sync: Any site that upgraded to v3.16.2 is at risk of having records stay on the tablet unless they upgrade to v3.16.3. After upgrading to v3.16.3, run the new \"Push all docs to the server\" feature available from the Admin Configuration menu item. This feature resets push sync to the beginning, ensuring that all docs are pushed. It doesn't actually re-upload all docs; it instead checks that all docs have been uploaded. Added \"Push all docs to the server\" feature to the Admin Configuration menu item. Added Operating System and Browser Version to Device listing. Fixes - Data collected after first registering and after updates fails to upload. Issue: #2623 Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Ensure git is initialized in all group folders. docker start couchdb docker start tangerine docker exec tangerine sh -c \"cd /tangerine/groups && ls -q | xargs -i sh -c 'cd {} && git init && cd ..'\" # Fetch the updates. git fetch origin git checkout v3.16.3 # If you are enabling the new mysql module, follow the instructions in `docs/system-administrator/mysql-module.md` to update the config.sh file (steps 1 through 3) # If you do not wish APK and PWA archives to be saved, set T_ARCHIVE_APKS_TO_DISK and/or T_ARCHIVE_PWAS_TO_DISK to false. # Then return here before starting tangerine # Now you are ready to start the server. ./start.sh v3.16.3 docker exec tangerine push-all-groups-views # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.16.2 # If setting up mysql return to step 5 in `docs/system-administrator/mysql-module.md`","title":"v3.16.3"},{"location":"whats-new/#v3162","text":"New Features Enables filtering of Case Event Schedule by Device's Assigned Location PR: #2591 Fixes - Enables editing of device description. Commit: #2613 Server upgrade instructions If you want to enable filtered Case Event Schedule by Device's Assigned Location, add filterCaseEventScheduleByDeviceAssignedLocation to your groups' app-config.json set to a value of true . Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Ensure git is initialized in all group folders. docker start couchdb docker start tangerine docker exec tangerine sh -c \"cd /tangerine/groups && ls -q | xargs -i sh -c 'cd {} && git init && cd ..'\" # Fetch the updates. git fetch origin git checkout v3.16.2 # If you are enabling the new mysql module, follow the instructions in `docs/system-administrator/mysql-module.md` to update the config.sh file (steps 1 through 3) # If you do not wish APK and PWA archives to be saved, set T_ARCHIVE_APKS_TO_DISK and/or T_ARCHIVE_PWAS_TO_DISK to false. # Then return here before starting tangerine # Now you are ready to start the server. ./start.sh v3.16.2 docker exec tangerine push-all-groups-views # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.16.1 # If setting up mysql return to step 5 in `docs/system-administrator/mysql-module.md`","title":"v3.16.2"},{"location":"whats-new/#v3161","text":"New Features Improves sync stats and add \"Export Device List\" feature PR: #2610 Fixes - Fixes Editor form creation issue #2605 and form copy issue #2604 - Adds check for calculateLocalDocsForLocation before running update to index an index it depends upon. - Update tangy-form to 4.21.3, tangy-form-editor to 7.6.5 to fix dynamically set level tangy location not resuming correctly #202 Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Ensure git is initialized in all group folders. docker start couchdb docker start tangerine docker exec tangerine sh -c \"cd /tangerine/groups && ls -q | xargs -i sh -c 'cd {} && git init && cd ..'\" # Fetch the updates. git fetch origin git checkout v3.16.1 # If you are enabling the new mysql module, follow the instructions in `docs/system-administrator/mysql-module.md` to update the config.sh file (steps 1 through 3) # If you do not wish APK and PWA archives to be saved, set T_ARCHIVE_APKS_TO_DISK and/or T_ARCHIVE_PWAS_TO_DISK to false. # Then return here before starting tangerine # Now you are ready to start the server. ./start.sh v3.16.1 docker exec tangerine push-all-groups-views # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.16.0 # If setting up mysql return to step 5 in `docs/system-administrator/mysql-module.md`","title":"v3.16.1"},{"location":"whats-new/#v3160","text":"New Features Warning about data sync: If you have implementations that have multiple tablets syncing from the same location, some docs may not be on all tablets due to issues with earlier versions of sync. This release resolves that particular issue and provides ways to ensure that all tablets share the same data. We have implemented several ways to rectify and understand potential data inconsistencies across tablets in the field: After updating the server to 3.16.0 and after updating and syncing the clients, the Device dashboard will now display the number of docs on each tablet (\"All Docs on Tablet\") and the number of docs according to the device's Location configuration (\"Form Responses on Tablet for Location\"). Depending on the Configure/Sync settings, the \"All Docs on Tablet\" count may be close, but not exactly the same, since not all forms may be synced to the tablets. The \"Form Responses on Tablet for Location\" count should be the same for all tablets that share the same location configuration. Please note that \"Form Responses on Tablet for Location\" count needs to be activated by adding \"calculateLocalDocsForLocation\": true to app-config.json; also note that it has not been widely tested and may be unstable. (If you activate this feature, you may also add \"findSelectorLimit\" to modify how many batches are used to calculate this value. Default is 200. Lower is safer but slower.) These data points may help in identifying data inconsistencies. Remember - only after updating and syncing the tablets, will these new doc counts be populated with data in the Devices listing. Making a note of the document counts per tablet will help establish a baseline. - Next step would be to run the new \"Force Full Sync\" feature, which is implemented in two ways: - If you add the new \"forceFullSync\" : true setting in the group's app-config.json, the client will perform a full sync upon the next update. Since this takes time and Internet bandwidth, you may wish to notify users before enabling this feature. - When logging in as \"admin\" user on the client tablet, a new menu item called \"Admin Configuration\" will be visible below the \"Settings\" item. This new item enables manual operation of the \"Force Full Sync\" feature. It is labeled \"Pull all docs from the server\" in the user interface. - You may adjust the settings for how many documents \"Force Full Sync\" downloads at a time by adjusting the initialBatchSize property in app-config.json. The default is 1000 documents per batch. This setting is also used when performing the initial load of documents on a tablet. - Tangerine Release Archives: Every Tangerine APK or PWA release is saved and tagged. If your site is configured for archives (which is the default), you may download previous Android releases. PR: #2567 - A \"Description\" field has been added to the Devices listing to faciliate identification of devices or groups of devices. - Beta Release Mysql module: Data sync'd to Tangerine can be output to a MySQL database. Warning: This should not yet be deployed on a production server; the code for this feature is still in development. We recommend creating a separate server for the Tangerine/MySQL installation and replicate data from the production server to the Tangerine server that would provide the MySQL service. Docs: docs/system-administrator/mysql-module.md PR: #2531 - Devices listing offers more information about the sync process, including version, errors, and sync duration. Fixes - Changes to the sync code should improve sync stability and speed. #2592 You may configure certain sync properties: - initialBatchSize = (default: 1000) Number of documents downloaded in the first sync when setting up a device. - batchSize (default: 200) - Number of documents downloaded upon each subsequent sync. - writeBatchSize = (default: 50) - Number of documents written to the tablet during each sync batch. - Updated tangy-form-editor to v7.6.4, which improves functionality of duplicate entire section . PR: #173 - Updates the Schedule View to use date-carousel 5.2.0 which provides unix timestamps instead of date strings. #2589 - Upgrade tangy-form to fix issue causing on-open of first items to not run when proposing changes in an Issue. - Deactivate App.checkStorageUsage if using Sync Protocol 2. This was not compatible and should not run. - Allow projects to disable GPS warming to save on battery with disableGpsWarming in app-config.json . - Add missing import of editor/custom-scripts.js when using editor so Data Dashboards can have imported JS files. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Ensure git is initialized in all group folders. docker start couchdb docker start tangerine docker exec tangerine sh -c \"cd /tangerine/groups && ls -q | xargs -i sh -c 'cd {} && git init && cd ..'\" # Fetch the updates. git fetch origin git checkout v3.16.0 # If you are enabling the new mysql module, follow the instructions in `docs/system-administrator/mysql-module.md` to update the config.sh file (steps 1 through 3) # If you do not wish APK and PWA archives to be saved, set T_ARCHIVE_APKS_TO_DISK and/or T_ARCHIVE_PWAS_TO_DISK to false. # Then return here before starting tangerine # Now you are ready to start the server. ./start.sh v3.16.0 docker exec tangerine push-all-groups-views # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.15.6 # If setting up mysql return to step 5 in `docs/system-administrator/mysql-module.md`","title":"v3.16.0"},{"location":"whats-new/#v3158","text":"New Sync code reduces the number of network requests by disabling server checkpoints. It also supports three new app-config.json options to configure sync parameters that adjust data download size, how much data is written to the local database each batch, and initial data download: batchSize: Number of docs to pull from the server per batch. Increasing this setting will decrease the number of network requests to the server when doing a sync pull. Default: 200 writeBatchSize: How many docs to write to the database at a time. If the database crashes, decreasing this option could be helpful. Default: 50 useCachedDbDumps: Enables caching of the group database to a file for a single download to the client upon initial device setup. This is an experimental feature therefore it is not enabled by default. (Some server code is also currently disabled.) Those files are stored at data/groups/groupName/client/dbDumpFiles. At this point, you must delete the dbDumpFiles if you wish to update the data in the initial device load. 2560 Disable the v3.15.0 update from groups that use sync-protocol 1. Added 2021 to the report year. Added simple network statistics to the device replicationStatus, which is posted after every sync. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.15.8 # Now you are ready to start the server. ./start.sh v3.15.8 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.15.7","title":"v3.15.8"},{"location":"whats-new/#v3157","text":"New Features and Fixes - Fixes a bug in the CSV generation code that caused sections of rows in the CSV to output improperly. PR: #2558 - Adds a server config that allows the user to control the string used for variables that are undefined : T_REPORTING_MARK_UNDEFINED_WITH=\"UNDEFINED\" - The default value of the new config file is set to \"ORIGINAL_VALUE\" so existing Tangerine instances will not be effected. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. Please add the below line into your config.sh to preserve current behavior (as a workaround for #2564) T_REPORTING_MARK_UNDEFINED_WITH=\"\" cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.15.7 # Now you are ready to start the server. ./start.sh v3.15.7 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.15.6","title":"v3.15.7"},{"location":"whats-new/#v3156","text":"New Features and Fixes - New 'wakelock' feature for sync: When using the sync feature, the screen should not go to sleep or dim, enabling the sync process to proceed. This is especially useful during long sync processes. When you navigate to another page once Sync is complete, the wakeLock feature is disabled. - The Devices listing has a new option, \"View Sync Log\", which enables viewing status of the most recent replication, when available. - Added error messages when internet access drops during a sync. #2540 - Batch size for sync is configurable via pullSyncOptions and pushSyncOptions variable in a group's app-config.json. Default is 200. If the value is set too high, the application will crash. Server upgrade instructions Reminder: Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.15.6 # Now you are ready to start the server. ./start.sh v3.15.6 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.15.5","title":"v3.15.6"},{"location":"whats-new/#v3155","text":"Fixes - In CSV output, if a section on a form is opened and then the later skipped, inputs on that skipped section will appear in CSV output as skipped. However, if the section is never opened, the inputs would show up in the CSV as blank values. This fix ensures that these remaining inputs are marked as skipped in CSV output. - Fix sync from breaking when syncing with a group with no data yet. - Improve messaging during sync by removing floating change counts and showing the total number of docs in the database after sync. Server upgrade instructions Consider using the Tangerine Upgrade Checklist for making sure you test the upgrade safely. cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.15.5 # Now you are ready to start the server. ./start.sh v3.15.5 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.15.4","title":"v3.15.5"},{"location":"whats-new/#v3154","text":"Fixes - Sync: Sites with large datasets were crashing; therefore, we implemented a new sync function that syncs batches of documents to the server. PR: #2532 Server upgrade instructions # Fetch the updates. cd tangerine git fetch origin git checkout v3.15.4 # Now you are ready to start the server. ./start.sh v3.15.4 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.15.3","title":"v3.15.4"},{"location":"whats-new/#v3153","text":"Fixes - After a large sync in sync protocol 2, improve overall app performance by indexing database queries. Because this may cause a long sync for projects not using this, you can set indexViewsOnlyOnFirstSync in app-config.json to true if you want to allow existing tables to avoid this long sync to catch up on views. - Add missing custom-scripts.js and custom-styles.css files to Editor app. We also add editor and client ID's to the body tag of the two app respectively. - Reduce database merge conflicts by preventing form responses from saving after completed. Prior to this version, on two tablets (or on a tablet and the server) if you opened the same form response and opened an item to inspect, it would cause a save on both tablets resulting in an unnesessary merge conflict. - New T.case.getCaseHistory(caseId) function for getting the history of save for a Case. Returns an array of JSON patches in RFC6902 format. Open a Case and run await T.case.getCaseHistory() in the console and it will pick up on the context. - New T.case.getEventFormHistory(caseId, caseEventId, eventFormId) function for getting the history of save for a form response in a Case. Returns an array of JSON patches in RFC6902 format. Open a Case, a Case Event, then an Event Form and run await T.case.getEventFormHistory() in the console and it will pick up on the context. - New opt-in app-config.json setting attachHistoryToDocs for enabling upload all history of Case and Event Form edits on a Tablet up to the Server. Without this setting on, the server only sees the history starting from time of upload. Note this has an impact on upload size of at least doubling it when turned on. Important configuration notice - Set indexViewsOnlyOnFirstSync in app-config.json to true if you want to allow existing tables to avoid this long sync to catch up on views. Server upgrade instructions # Fetch the updates. cd tangerine git fetch origin git checkout v3.15.3 # Now you are ready to start the server. ./start.sh v3.15.3 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.15.2","title":"v3.15.3"},{"location":"whats-new/#v3152","text":"Fixes Rshiny module: Replaces hard-coded underscore separator with the configurable sep variable. Error when processing CSV's: 2517 Important configuration notice The v3.15.0 release included an update to the Editor Search feature #2416 that requires adding a searchSettings property to forms.json. In addition to running the upgrade script for v3.15.0; you must also make sure that all forms in a group's forms.json have searchSettings configured, especially the shouldIndex property. Examples are in the Case Module README \"Configuring Text Search\" section. Server upgrade instructions cd tangerine # Check the size of the data folder. du -sh data # Check disk for free space. Ensure there is at least 10GB + size of the data folder amount of free space in order to perform the upgrade. df -h # Turn off tangerine and database. docker stop tangerine couchdb # Create a backup of the data folder. cp -r data ../data-backup-$(date \"+%F-%T\") # Fetch the updates. git fetch origin git checkout v3.15.2 # Now you are ready to start the server. ./start.sh v3.15.2 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.15.1","title":"v3.15.2"},{"location":"whats-new/#v3151","text":"Fixes Prevent opening of Event Forms on Editor when there is no corresponding Form Response available. Fix Issue type detection when deciding what is going to be in the 'current' tab. Update CSV output for signatures to be 'signature captured' and ''. Fix Issues view causing Issue search result to appear once per event such as comment or proposal. Integrate fixes in v3.14.6 including T.case.isIssueContext() API, and better API partity between being in an Event Form in a Case and being in an Event Form in an Issue. Server upgrade instructions # Fetch the updates. cd tangerine git fetch origin git checkout v3.15.1 # Now you are ready to start the server. ./start.sh v3.15.1 docker exec -it tangerine push-all-groups-views docker exec -it tangerine reporting-cache-clear # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.15.0","title":"v3.15.1"},{"location":"whats-new/#v3150","text":"New Features and fixes Editor User searches Cases by keyword #2416 - This feature enables searching by any of the variables assigned in searchSettings/variablesToIndex in forms.json. Transfer Participant between Cases #2419 . Find Participant UI: #2439 . Update to Content Set 2.1 adds a package.json and build step to pin lib versions and add a build step for custom-scripts. Added error message to Updates error alert. ccc1864 New \"Release Online Survey\" menu on Server allows you to release a single form for data collection online. Note the original \"Deploy -> Release\" menu item has been moved to \"Deploy -> Release Offline App\". Fixed issue where \"Tangy Gate\" form element could be added in Editor but would not appear on Tablets. Support for new \" \" element that brings a Partial Date style form element with support for the Ethiopian Calendar. If using Sync Protocol 2, the first sync when registering a Device is now faster in cases where there is a lot of data already collected. Also the blank User Profile created for the Admin user on a device is no longer uploaded resulting in less noise in the Device Users list. Important deprecation notice The groupName property, once used in app-config.json, is no longer supported in recent releases of Tangerine. The groupId property is used in its place. Groups that use groupName will not be able to sync; they must migrate to groupId. This issue affects groups using sync-protocol-1. #2447 When form responses are unlocked in a Data Issue, the on-submit hook no longer runs. If you need logic to run, use the new on-resubmit hook. If using Sync Protocol 2, the \"Auto Merge\" feature that tries to fix database conflicts is now off by default and database conflicts will not be logged as Issues. If you would like to keep it on, set \"autoMergeConflicts\": true in your group's client/app-config.json file. However be aware that turning this on will result in inconsistent results ( https://github.com/Tangerine-Community/Tangerine/issues/2484 ). Monitoring for database conflicts can now be done by monitoring the syncConflicts view via CouchDB Fauxton. Server upgrade instructions: # Fetch the updates. cd tangerine git fetch origin git checkout v3.15.0 # Now you are ready to start the server. ./start.sh v3.15.0 # Update the views - there are new views for Searches and Participant Transfers. docker exec -it tangerine reporting-cache-clear docker exec -it tangerine /tangerine/server/src/upgrade/v3.15.0.js # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.14.6","title":"v3.15.0"},{"location":"whats-new/#v3146","text":"Changes in v3.14.4 were abandoned, changes in v3.14.5 have been rolled into v3.15.0. The following are changes for v3.14.6. Improve first sync performance: On first sync, skip push but set the last push variable to whatever we left on after the first pull. Improve in-form API parity between context of a Case and context of an Issue proposal. Sets case context in more scenarious inside of Issue Form proposals. Prevent form crashes and unintentional logic by adding the new T.case.isIssueContext() API for detecting if in the Issue context in a form. Server upgrade instructions: # Fetch the updates. cd tangerine git fetch origin git checkout v3.14.6 # Now you are ready to start the server. ./start.sh v3.14.6 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.14.3","title":"v3.14.6"},{"location":"whats-new/#v3143","text":"Bugfix Auto-merged conflicts overwrite \"canonical\" change made on Editor server #2441 - Prevents tablets from overwriting documents from Editor in special cases. After modifying the case record, add canonicalTimestamp to the document: \"canonicalTimestamp\":1603854576785 New Features and fixes for all Tangerine Reduce number of unnecessary saves in Editor #2444 Improvements to Issues Listing #2398 Please update the group views (noted in the Server upgrade instructions below) in order to use the Issues Listing. Upgrades in the Developers' Interest Removed webpack from the Docker image. Custom apps should build their apps using their own webpack; the APK service will no longer perform that task. Server upgrade instructions: # Fetch the updates. cd tangerine git fetch origin git checkout v3.14.3 # Now you are ready to start the server. ./start.sh v3.14.3 # Update the views - there is a new view used for Issues. docker exec -it tangerine push-all-groups-views # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.14.2","title":"v3.14.3"},{"location":"whats-new/#v3142","text":"Bugfix Fixes file path issue when bundling custom scripts in APK's. Server upgrade instructions: # Fetch the updates. cd tangerine git fetch origin git checkout v3.14.2 # Now you are ready to start the server. ./start.sh v3.14.2 # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.14.1","title":"v3.14.2"},{"location":"whats-new/#v3141","text":"This is identical to v3.14.0 but was released to fix a problem with tangerine-preview v3.14.0 on npm.","title":"v3.14.1"},{"location":"whats-new/#v3140","text":"New Features and fixes for all Tangerine Usability Improvement for Device Registration : Added \"Number of devices to generate\" field to Device Registration. Submitting a single form to add multiple devices to a group should simplify large deployments. #2402 Important bugfix for sync issue in poor network situations : If you currently have an active 3.13 deployment, run the 3.14 update on client to make sure all data is sync'd to the server. #2399 Automatic conflict resolution on client : Basic support for automatic merges of conflicts in EventForms. #2272 Documentation for testing conflicts Form version support : Enables use of previous form versions for form display. #2365 Support for versioning is not yet implemented in the Editor; however, there is documentation on how to implement form versions manually. User Interface updates : The 4.19.0 tangy-form lib version features the following fixes: Required Field Asterisk (*) does not align with the question text #2363 Error Text and Warning Text have the same style - this is confusing for users #2364 Setting packageName in app-config.json causes app to crash : The docker-tangerine-base-image update to 3.7.0 improves Android and Cordova lib dependencies, and the release-apk code now rebuilds the Android code whenever an APK is built. #2366 New module for rshiny development : Adds option to csv module to change delimiter from '.' to '_' #2314 Documentation Update : Re-organization of some documentation and addition of missing image files. #2401 Upgrades in the Developers' Interest Upgraded docker-tangerine-base-image to v3.7.1 : Upgrade to Android API_LEVEL 30, Cordova 10, node:14.12.0-stretch. #1890 Caching cordova-android platform to avoid network issues when customizing packageName. #7 Important note for users of tangerine-preview There was a problem with v3.14.0 on npm; therefore, please use tangerine-preview v3.14.1.","title":"v3.14.0"},{"location":"whats-new/#v3131","text":"Fix: Issues on Editor always ask us to rebase #2376 Fix: Issues screen will not load after upgrading from v3.10.0 to v3.13.0 #2378 Fix: Issues go missing after upgrading to v3.13.0 from v3.12.x #2377 Please be aware: this release was made in the release/v3.13.1-alt branch and to date has only been built as the v3.13.1-rc-2 image. Server upgrade instructions: # Fetch the updates. cd tangerine git fetch origin git checkout v3.13.1 # Now you are ready to start the server. ./start.sh v3.13.1 # Run upgrade docker exec -it tangerine /tangerine/server/src/upgrade/v3.13.1.js # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.13.0","title":"v3.13.1"},{"location":"whats-new/#v3130","text":"New Features and fixes for all Tangerine Download Location List as CSV : You can now download a location list as a CSV. If you prefer editing a Location List via something like Excel, this makes editing an existing location list easier, which can then be imported when done editing in Excel. Note: Advise careful use of this export feature until #2336 is fixed. #2107 Duplicate a Section :When editing a form, you can now easily duplicate an entire section with the \"duplicate section\" button. #2109 . Warning - this feature does not handle complex objects such as tangy checkbox groups well; be sure to check the code it generates. This issue will be addressed in the next 3.13 point release. Group Data Dashboard in Editor : \"Dashboard\" is now a menu item available in a Group under the Data menu. This link can be enabled by group role (disabled by default). When on the Dashboard page, it displays a customizable dashboard for that specific group. Customizing Dashboards currently requires HTML and Javascript knowledge but in the future we may build a configurator for Dashboards. More Menu Permissions in Editor :Add additional Editor permissions to completely cover menu level access in a group Automatic conflict resolution : After a sync pull on client, detects type of conflict and resolves it. View status of merges in the Issues feature. #1763 Fix extending session in Editor - When prompted to extend session shows up session is not really extended. #2266 New Features and Fixes for Case Module Client \"Issues\" feature : \"Issues\" previously could only be viewed using Editor. With this release, Issues can now be accessed from Client in a Case module enabled Group via the top level \"Issues\" tab. This tab can be disabled adding or modifying \"showIssues\": false, to app-config.json. Note that only issues created targeting the \"CLIENT\" context (See CaseService API documentation) will show up in the Client \"Issues\" tab. Easier searching on Client : Previously on Client when searching for \"Facility 8\" you would need to type exactly \"Facility 8\". Now search is case insensitive and you may type \"facility 8\" to match against \"Facility 8\". T.case.setEventWindow API fix : Previously when setting an Event window, the end time for the window was mistakenly ignored and set to the start time. This is now fixed. #2304 New Features for Sync Protocol 2 Module Export device sheets : When registering Devices, we now offer an option to print \"Device Sheets\". Device Sheets include the registration codes for a Device and also some human readable metadata. Each row can also be used as a label for each device that can be fastened to a device using affordable clear packing tape. #2269 Restore Backup on Android Tablet : Backups can now be restored. Restore is an option when first opening a freshly installed APK. #2127 Better support for working on the same Case on two devices : When working offline on the same Case on two Devices, after a sync, it may seem like the changes on one Tablet have gone missing for some time until the \"database conflicts\" are resolved using the CouchDB Futon interface on the server. Starting in v3.13.0 we'll start to employ algorithms for automatically merging to speed up the process of resolving these database conflicts. Notes for System Administrators After upgrade, you will no longer find group content directories in ./data/client/content/groups/ , they will be in ./data/groups/ . Inside each group's directory you will also find they have been split into a client and editor directory. All previous content will now be in the client directory while you may place content for the Group's Data Dashboard in the editor folder. Server upgrade instructions: This update changes the path to group content to /tangerine/groups/${groupId}/client . If your group is managing content via a Github/cron integration, you will need to change the path to content in its cron job. Change GROUP-UUID to your group id in the following command: cd /home/ubuntu/tangerine/data/groups/GROUP-UUID/client && GIT_SSH_COMMAND='ssh -i /root/.ssh/arc-forms-dev' git pull origin master && git add . && git commit -m 'auto-commit' && GIT_SSH_COMMAND='ssh -i /root/.ssh/arc-forms-dev' git push origin master The update: # Fetch the updates. cd tangerine git fetch origin git checkout v3.13.0 # Now you are ready to start the server. ./start.sh v3.13.0 # Run upgrade docker exec -it tangerine /tangerine/server/src/upgrade/v3.13.0.js # Add or modify `\"showIssues\": false,` to the group's app-config.json if you do not want to display the Issues tab in client. # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.12.0","title":"v3.13.0"},{"location":"whats-new/#v3125","text":"Fixed issue with black screen when moving from p2p tab to home","title":"v3.12.5"},{"location":"whats-new/#v3124","text":"Fixed issue with QR code boundary boxes in tangy-form #158 . Bumped tangy-form v4.17.10 and tangy-form-editor to 7.2.5","title":"v3.12.4"},{"location":"whats-new/#v3123","text":"Fixed issue with mutually exclusive checkboxes in tangy-form #154 . Bumped tangy-form v4.17.9 and tangy-form-editor to 7.2.3","title":"v3.12.3"},{"location":"whats-new/#v3122","text":"When saving edits to a form, \"Show if\" logic has been written as tangy-if logic in the HTML. Form now on it will be written as show-if logic for consistency. tangy-if logic in has in the past in just showing/hiding an question on a form. It will now also reset the value if there is input and it is then hidden. In v3.12.0, caseService.getCurrentCaseEventId() was incorrectly removed. It has been added back, and an additional caseService.getCurrentEventFormId() function has been added for consistency. Fix Android 10 compatibility issue with P2P Sync mechanism causing tablets to crash.","title":"v3.12.2"},{"location":"whats-new/#v3121","text":"Change behavior of show-if logic so that when a question hides, the value is reset. Adjust behavior of how Event Forms are added: If EventForm.autoPopulate is left undefined and required is true, then the form should be added.","title":"v3.12.1"},{"location":"whats-new/#v3120","text":"New Features for Case Module Data Collector finds Event Forms are automatically created on Case Event creation and after adding a Participant #2147 [ Demo ] Data Collector has found a non required form has become required #2233 Demo Part 1: https://youtu.be/dnJk4LaGuQw Demo Part 2: https://youtu.be/I0JOZounZc4 Data Collector finds Case Event is automatically marked as complete #2235 [ Demo ] Data Collector sees indicator on Event Form when corresponding Form Response has not been synced to a device #2232 [ Demo ] Data Collector views a dedicated page for a Participant's Event Forms for a specific Case Event #2236 [ Demo ] Data Collector is redirected to custom route after Event Form is submitted #2237 [ Demo ] Fixes for Case Module Device User registering only sees user profiles they can associate with restricted by location the Device is assigned #2248 When all optional and incomplete forms are removed (no required forms in the event) from an event on the client the + button is not shown to re-add any of them #2113 Delete an incomplete form from a case does not refresh the screen #2114 Fixes for all of Tangerine Autostop is not triggered when marking the entire lineas incorrect #1869 Mark entire line of grid as incorrect cannot be undone #1651 Meta data print screen Prompt and Hint are not displayed for Radio Buttons (single type) #1748 Form Metadata view of Checkboxes with one option is missing #2239 New features for Sync Protocol 2 Restore encrypted backup on Device #2127 API Changes for Case Module caseEvent.status is now caseEvent.complete which has a value of true or false as opposed to the status strings. caseService.startEventForm(...) is now caseService.createEventForm(...) . caseService.deleteEventFormInstance(...) is now caseService.deleteEventForm(...) . caseService.getCaseEventFormsData(...) is now caseService.getEventFormData(...) . caseService.setCaseEventFormsData(...) is now caseService.setEventFormData(...) . Server upgrade instructions: # Fetch the updates. cd tangerine git fetch origin git checkout v3.12.0 # Now you are ready to start the server. ./start.sh v3.12.0 # Run upgrade docker exec -it tangerine reporting-cache-clear # Remove Tangerine's previous version Docker Image. docker rmi tangerine/tangerine:v3.11.0 Note that after running the upgrade script, your reporting caches may take some time to finish rebuilding. Android upgrade instructions: If you are upgrading an Android device that was installed with Tangerine v3.8.0 or greater, you will need to regenerate your APK and reinstall, otherwise you may use the over the air updater.","title":"v3.12.0"},{"location":"whats-new/#v3110","text":"New Features in all Tangerine Device Manager installs many Tangerine APKs on a single device #2182 CSV output enhancements: Editor User indicates whether to include PII in CSV export #1771 User profile information available in CSV export #2081 Editor User exports CSV file that contains the group and form name #2108 New 'T' namespace for helper functions #2198 New Features in Tangerine with Case Module enabled Data Collector changes location of Case #2098 [ demo ] Data Collector views an alert #2020 [ demo ] Data Collector views custom report #2143 docs Developer notes Group permissions #2187 Server upgrade instructions: # Fetch the updates. cd tangerine git fetch origin git checkout v3.11.0 # Now you are ready to start the server. ./start.sh v3.11.0 # Run upgrade docker exec -it tangerine /tangerine/server/src/upgrade/v3.11.0.js Note that after running the upgrade script, your reporting caches may take some time to finish rebuilding. Android upgrade instructions: If your groups are using Sync Protocol 2 module, an APK reinstall is required. Release the APK and reinstall on all Android Devices. If your groups are not using Sync Protocol 2, you may upgrade Android tablets over the air using the usual release process.","title":"v3.11.0"},{"location":"whats-new/#v3100","text":"New Features in all Tangerine Editor User updates own profile and/or password #2166 [ demo ] Editor User with appropriate permission manages site level permissions of users and edits details and password of user #2155 [ demo ] Editor User views question configuration by category (as opposed to long list) #2097 [ demo ] Server Admin creates group on command line with local or remote content set #2174 Demo: Server Admin creates group on command line from local or remote content set Demo: Server Admin creates group on command line from content set in a private repository on Github New Features in Tangerine with Case Module enabled Tangerine User views form response in alternative templates #2176 [ demo ] Data Manager manages Data Issues #1982 [ demo ] Data Manager rebases proposed changes in Issue #2179 [ demo ] Data Manager creates Data Issue #2144 [ demo ] Data Collector causes Issue to be created due to use of API in the form #2145 [ demo ] Data Collector causes Issue to be created due to discrepancy-if logic in form #2171 [ demo ] Synapse consumes structured outputs based on Case ER Diagram #2051 New features in Tangerine with Sync Protocol 2 Enabled Improve two-way sync efficiency in PouchDB by using doc_ids filter as opposed to mango query #2040 Developer notes Resolve problems with client compilation in Angular #2091 Upgrade instructions: # Fetch the updates. cd tangerine git fetch origin git checkout v3.10.0 # Now you are ready to start the server. ./start.sh v3.10.0 # Run upgrade docker exec -it tangerine /tangerine/server/src/upgrade/v3.10.0.js","title":"v3.10.0"},{"location":"whats-new/#v391","text":"Fixes Database views are missing when running tangerine-preview or npm start #2096 Event Schedule day view duplicates day event and show it in previous day as well #2103 According to date carousel, events appear off by one week #2094 Event Schedule templates are failing #2085 Reports form is not added to forms.json #2088 Events appear off by one day in Schedule List #2101 CouchDB port should be configurable in config.sh #2092 When opening the schedule view the first page is missing the header dates #2082 Data Collector unable to open an Event from the Event Schedule #2102 When editing a radio button options in editor, options should be in one column, not two #2090","title":"v3.9.1"},{"location":"whats-new/#v390","text":"Features Set and get properties for Case Event Forms #2023 Data Manager reviews Cases PR Data Collector removes Event Form. PR Fixes Fix additional memory leaks in Case module causing tablets to slow down. PR Make getValue() function in Event Form List Item related templates less likely to crash. change Fixed incompatibilities with 2-way sync and P2P Sync. Fixed issue causing tablets to crash when syncing with a database with tens of thousands of records. Developer notes Editor and Clients upgraded to Angular 8. Changes Due to current limitations of two way sync, two changes have been made to the Device form in Tangerine Editor. First, changing a Device's assigned location and sync settings after the Device record has been claimed will no longer be allowed. Second, devices will now always be required to be assigned to the last level in your location hierarchy. Upgrade instructions: When you run the upgrade script, if you are using sync protocol 2 and have enabled, forms configured for 2 way sync will now be configured to use CouchDB sync to push documents up as opposed to \"custom sync\". # Fetch the updates. cd tangerine git fetch origin git checkout v3.9.0 # If you did not upgrade your config.sh in v3.8.1, migrate it now. # Move custom variables from config.sh_backup to config.sh. Note that T_ADMIN and T_PASS are no longer needed. mv config.sh config.sh_backup cp config.defaults.sh config.sh # To edit both files in vim you would run... vim -O config.sh config.sh_backup # Now you are ready to start the server. ./start.sh v3.9.0 # Run upgrade docker exec -it tangerine /tangerine/server/src/upgrade/v3.9.0.js","title":"v3.9.0"},{"location":"whats-new/#v381","text":"Client app performance improvements Improved caching of files. We are caching important configuration files for faster page loads (app-config.json, forms.json, location-list.json) and the Roboto font and have reduced redundant rendering calls. 1991 Loading spinner when opening an Event Form in a Case. #1992 Fixed a memory leak when viewing a Case which was causing tablets to crash if spending too much time on a Case screen. #2000 Radiobuttons now load faster on forms. Editor fixes Fixed an issue causing editor content region to be untouchable when window was narrow. #1940 Improved CSV output so it now contains Release ID, Device ID, and Build Channel on every row #349 Developer notes We focused on issues with slow performance on tablets when viewing forms. We are caching important configuration files (app-config.json, forms.json, location-list.json) and the Roboto font and have reduced redundant rendering calls. More information in the Globals doc . Server Admin notes We cleaned up config variables in config.sh , deprecated T_ADMIN and T_PASS #1986 New generate-cases command for load testing a large number of Cases based on your custom content in a group. #1993 New reset-all-devices command for reseting the server token and database keys for all devices. Note that after running this command you will need to reinstall on all devices and reregister with new QR codes. This command is useful if you are migrating a large amount of devices to a new group or a new server and you want to maintain Device ID consistency with the Device Serial numbers you are tracking. Upgrade instructions: # Fetch the updates. cd tangerine git fetch origin git checkout v3.8.1 # Now migrate custom variables from config.sh_backup to config.sh. Note that T_ADMIN and T_PASS are no longer needed. mv config.sh config.sh_backup cp config.defaults.sh config.sh # To edit both files in vim you would run... vim -O config.sh config.sh_backup # Now you are ready to start the server. ./start.sh v3.8.1","title":"v3.8.1"},{"location":"whats-new/#v380","text":"v3.8.0 is a big and exciting release! To accomodate the long list of changes, we split up this round of release notes into sections: General, Sync Protocol 2 Module, and Case Module, and Developer notes.","title":"v3.8.0"},{"location":"whats-new/#general","text":"The following are features and fixes that are coming to all Tangerine installs. With this release comes an improved Editor UI experience, a faster device setup process, new form features, and much more. Group tabs are now in 4 sections Breadcrumbs allows you to navigate back up deeply nested areas Editor User browses Group UI by nested categories (as opposed to flat list) #1880 Device Administrator is prompted to authorize permissions on first app load #1896 Data Collector defines password according to policy #1867 Data Collector views device info such as Device ID, Assigned Location, Server URL, Group Name, and Release Channel. #1834 Data Collector in checkboxes chooses \"none of the above\", then other options are unselected #1822 Editor distinguishes between inputs that are hidden and skipped #1800 Minor tweaks to the menu (now there is a single \"Sync\" item) and added tab bars to some pages for consistency.","title":"General"},{"location":"whats-new/#sync-protocol-2-module","text":"Sync Protocol 2 is a new module that can be enabled on a Tangerine installation that adds Device management, the ability for form responses to sync to the server and back down to tablets, the ablity for two tablets to sync form responses with each other offline, and much more. Manage which devices have access to sync, when they last synced, when they last updated and which version Define which form responses are synced up and back down to tablets Data Collector generates encrypted backup of Device #1909 Data Collector conducts a two-way sync with server only getting data from server relevant to their location #1755 Device sync by Location: Sync Protocol 2: Enables a \"Device Setup\" process on first boot of the client application. This requires you set up a \"Device\" record on the server. When setting up a Device record on the server, it will give you a QR code to use to scan from the tablet in order to receive it's device ID and token. Data Collector syncs to server with large dataset #1757 Data collector synchronizes data between devices using an Offline P2P mechanism #279 Editor User configures two-way sync for form responses from specific forms #1753 Editor revokes access to syncing with server for a lost Device #1894","title":"Sync Protocol 2 Module"},{"location":"whats-new/#case-module","text":"Data Collector views Case Events in Schedule with Estimated Day, Scheduled Day, Window, and Occurred On Dates #1737 Data Collector creates (another) instance of a repeatable form for a specific participant in a specific event(8hrs) #1786 Data Collector views which Participant they are filling out a form for #1820 Data Collector searches for a Case in a large dataset #1893 Improvements to Case Home search - limit docs to 25 when no phrase is entered: #1871. Added rule to delay search in Case Home until at least two characters have been entered. Search results now sorted by date record updated. Lazy loading tabs in Case Home - this helps resolve some of the slowness in loading Case Home. Also disabled animations on tabs to remove jankiness.","title":"Case Module"},{"location":"whats-new/#developer-updates","text":"Re-enabled git config in Dockerfile - still having git networking error even when off corp network. Updated docker-tangerine-base-image to v3.4.0 New load testing doc. Added random name generation to the script that generates new cases - useful for load testing and checking how well search listing works. If using the 'case-mother' switch, record templates are pulled from your group.","title":"Developer Updates"},{"location":"whats-new/#upgrade-instructions","text":"On the server, backup your data folder and then run the following commands. git fetch origin git checkout v3.8.0 ./start.sh v3.8.0 docker exec -it tangerine /tangerine/server/src/upgrade/v3.8.0.js Replace all ocurrences of localStorage.getItem('currentUser') with window.currentUser .","title":"Upgrade instructions"},{"location":"whats-new/#v372","text":"More fixes for upgrade process from v3.1.0.","title":"v3.7.2"},{"location":"whats-new/#v371","text":"Fix translations update script. Fix client update process when upgrading from v3.1.0. Upgrade instructions: On the server, backup your data folder and then run the following commands. git fetch origin git checkout v3.7.1 ./start.sh v3.7.1 docker exec tangerine translations-update","title":"v3.7.1"},{"location":"whats-new/#v370","text":"Fixes When editing forms, they will only save back to the server after clicking the top level \"save\" button. There is also now messaging around when the save either completes successfully or fails. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1645 On <tangy-timed> when using auto stop, return the property instead of the instead of the truthfulness of the value which is always false. PR: https://github.com/Tangerine-Community/tangy-form/pull/110 When uploadUnlockedFormReponses is set to true only incomplete forms are Synced up. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1725 In editor, modifying allowed pattern on text and number inputs does not work. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1770 Fix spacing between checkboxes in client Issue: https://github.com/Tangerine-Community/Tangerine/issues/1690 Fix click target and style for Case Event Form list Issue: https://github.com/Tangerine-Community/Tangerine/issues/1681 PR: https://github.com/Tangerine-Community/Tangerine/pull/1702 Fix Partial Date validation Issue: https://github.com/Tangerine-Community/Tangerine/issues/1683 PR: https://github.com/Tangerine-Community/tangy-form/pull/71 EF Touch changes <tangy-eftouch multi-select go-next-on-selection=\"2\"> should become <tangy-eftouch multi-select=\"2\" go-next-on-selection> . This allows for expanding functionality of being able to use multi-select without go-next-on-selection but still limit the number of choices the user can make minus the transition. no-corrections has been deprecated for new disable-after-selection attribute. When used with multi-select , the number of selections are still limited by the setting on multi-select , but changing selection is not allowed. The required attribute when used with multi-select will only require just one value selected. If you need form example 2 selections to be valid, you can combine required-all multi-select=\"2\" . We have an API change where we used to have TangyEftouch.value.selection was sometimes a string when not using multi-select and then when using multi-select , is was an array of strings. Now TangyEftouch.value.selection will always be an array of strings. Features When editing forms, the user will be warned of any duplicate variable names that exist in the form. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1793 Improve messaging when an APK update fails to download Issue: https://github.com/Tangerine-Community/Tangerine/issues/1743 PR: https://github.com/Tangerine-Community/Tangerine/commit/2ede9d3fb9d43dda234bfdcfc4849769b9b08e69 Data Collector sends SMS message from form Issue: https://github.com/Tangerine-Community/Tangerine/issues/1745 Data Collector views events in schedule with icons, estimated date info, and scheduled date info Issue: https://github.com/Tangerine-Community/Tangerine/issues/1686 Data Collector views Case Module screens in French Issue: https://github.com/Tangerine-Community/Tangerine/issues/1711 Data Collector confirms case when opened Issue: https://github.com/Tangerine-Community/Tangerine/issues/1695 PR: https://github.com/Tangerine-Community/Tangerine/pull/1741 Improved support for changing color scheme of client app using custom-styles.css , possible to have \"dark mode\". PR: https://github.com/Tangerine-Community/Tangerine/pull/1742 Data Collector shares all data on Device with other Users on the same Device. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1712 PR: https://github.com/Tangerine-Community/Tangerine/pull/1709 Data Collector finds Case Event status has changed to \"complete\" when all required forms are submitted. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1693 PR: https://github.com/Tangerine-Community/Tangerine/pull/1719 Data Collector finds all required Event Form instances in a Case Event are created upon opening the Case Event. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1691 PR: https://github.com/Tangerine-Community/Tangerine/pull/1718 Data Collector registers a Participant in a Case and views Event Forms grouped by Participant Issue: https://github.com/Tangerine-Community/Tangerine/issues/1692 PR : https://github.com/Tangerine-Community/Tangerine/pull/1723 Upgrade instructions: On the server, backup your data folder and then run the following commands. git fetch origin git checkout v3.7.0 ./start.sh v3.7.0 docker exec tangerine translations-update","title":"v3.7.0"},{"location":"whats-new/#v365","text":"Fix timed grid output to exclude item level variables in logstash output https://github.com/Tangerine-Community/Tangerine/pull/1806 Upgrade instructions: After the usual upgrade commands, also clear reporting caches with docker exec -it tangerine reporting-cache-clear .","title":"v3.6.5"},{"location":"whats-new/#v364","text":"Fix usage of T_CSV_MARK_DISABLED_OR_HIDDEN_WITH in some cases.","title":"v3.6.4"},{"location":"whats-new/#v363","text":"Allow disabled or hidden inputs output in CSV to be overridden using CSV_MARK_DISABLED_OR_HIDDEN_WITH in config.sh . The default value in config.defaults.sh is \"999\" which is what it has been for a few releases. When upgrading, do nothing if you want this to stay the same, otherwise use \"ORIGINAL_VALUE\" if you want to turn off the feature or set to your own custom value such as \"SKIPPED\" .","title":"v3.6.3"},{"location":"whats-new/#v362","text":"Fix import of location list from CSV https://github.com/Tangerine-Community/Tangerine/pull/1732/commits/05e57e8f1bb869dbd52b927d45fc223903e201db","title":"v3.6.2"},{"location":"whats-new/#v361","text":"Fix form routing for archived and active forms. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1722 PR: https://github.com/Tangerine-Community/Tangerine/pull/1724 Fix \"Mark entire line as incorrect in grids is not reflected in csv #1713\" Issue: https://github.com/Tangerine-Community/Tangerine/issues/1713 PR: https://github.com/Tangerine-Community/tangy-form/pull/103","title":"v3.6.1"},{"location":"whats-new/#v360","text":"New Features Support for changing the order of forms. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1523 PR: https://github.com/Tangerine-Community/Tangerine/pull/1707 Support for archiving a form. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1526 PR: https://github.com/Tangerine-Community/Tangerine/pull/1675 Improvements and support on all inputs for error-text , hint-text , question-number , and content translations. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1655 PR: https://github.com/Tangerine-Community/tangy-form/pull/88 , https://github.com/Tangerine-Community/tangy-form/pull/86 Add support to <tangy-qr> for scanning data matrix codes. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1653 PR: https://github.com/Tangerine-Community/tangy-form/pull/87 New \"Capture Item at N Seconds\" feature for <tangy-timed> will prompt Data Collector to mark which item the child last read after a specific amount of time. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1586 PR: https://github.com/Tangerine-Community/tangy-form/pull/95 New goTo('itemID') helper function to navigate users to a specific item given some item level on-change logic. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1652 PR: https://github.com/Tangerine-Community/tangy-form/pull/92 New <tangy-signature> input for capturing signatures. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1656 PR: https://github.com/Tangerine-Community/tangy-form/pull/90 Visibility of labels and/or icons on item navigation now configurable with <tangy-form-item hide-nav-icons> and <tangy-form-item hide-nav-labels> . Issue: https://github.com/Tangerine-Community/Tangerine/issues/1682 PR: https://github.com/Tangerine-Community/tangy-form/pull/73 Fixes Fix Class tablets that are filling up their disk too fast. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1706 Fix metadata print screen options PR: https://github.com/Tangerine-Community/Tangerine/pull/1703 Issue: https://github.com/Tangerine-Community/Tangerine/issues/1670 , https://github.com/Tangerine-Community/Tangerine/issues/1671 Fix missing camera permission blocking APK installs form using QR or Photo Capture Issue: https://github.com/Tangerine-Community/Tangerine/issues/1646 , https://github.com/Tangerine-Community/Tangerine/issues/1578 Fix performance issues caused by needless TangyForm.on-change events from firing when they don't need to. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1656 PR: https://github.com/Tangerine-Community/tangy-form/pull/89 Fix data collector reviews completed fullscreen form Issue: https://github.com/Tangerine-Community/Tangerine/issues/1629 PR: https://github.com/Tangerine-Community/tangy-form/pull/75 <tangy-eftouch auto-progress> now distinguishes between going next on the time limit and going next on a number of selections. The API is now <tangy-eftouch go-next-on-selection=2> for going next on 2 selection and <tangy-eftouch go-next-on-time-limit> for going next on the time limit. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1597 PR: https://github.com/Tangerine-Community/tangy-form/pull/84 <tangy-eftouch> content is now more likely to fit above the fold, not overlap with content above it, be more consistent on smaller screens, and also adapt to screen size changes. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1591 , https://github.com/Tangerine-Community/Tangerine/issues/1587 PR: https://github.com/Tangerine-Community/tangy-form/pull/79 <tangy-eftouch> suffered from going to next item twice due to time limit and selection being made at in a close window. This is now fixed. Issue: https://github.com/Tangerine-Community/Tangerine/issues/1596 PR: https://github.com/Tangerine-Community/tangy-form/pull/76 Fix Partial Date validation and for disabled attribute not reflecting Issue: https://github.com/Tangerine-Community/Tangerine/issues/1683 PR: https://github.com/Tangerine-Community/tangy-form/pull/71 Fix variable names in Editor to allow for only valid variable names. 2 or more characters, begin with alpha, no spaces, periods, allow _ no dash Issue: https://github.com/Tangerine-Community/Tangerine/issues/1566 , https://github.com/Tangerine-Community/Tangerine/issues/1558 , https://github.com/Tangerine-Community/Tangerine/issues/1461 PR: https://github.com/Tangerine-Community/tangy-form-editor/pull/77 Fix for Autostop for radio buttons - Issue: https://github.com/Tangerine-Community/Tangerine/issues/1519 PR's: https://github.com/Tangerine-Community/Tangerine/issues/1590 https://github.com/Tangerine-Community/tangy-form/pull/100 https://github.com/Tangerine-Community/tangy-form/pull/100 Experimental Features When using the experimental Case module, Editors can now program forms to trigger the creation of a \"Data Query\" when Data Collectors are entering data. Data queries are then shown later in a \"Data Queries\" tab where clarification on prior data entered is requested. PR: https://github.com/Tangerine-Community/Tangerine/pull/1661 Upgrade instructions: On the server, backup your data folder and then run the following commands. git fetch origin git checkout v3.6.0 ./start.sh v3.6.0 Now you may publish a release to your Devices and run the \"Check for Update\" on each Device. Note that if you are looking to use the QR Code scanner and you have been using Android Installation, you will need to reinstall the App on Devices and make sure to note the additional permissions installation instructions noted in the README.md file for enabling the App to have Camera Access. If using the Web Browser Installation, there is no need to reinstall the app for Camera access.","title":"v3.6.0"},{"location":"whats-new/#v350","text":"New Features Forms with fullscreen enabled now have a toggle button for the user to enable/disable fullscreen mode. Form designers may specify the number of taps in order for fullscreen to disable. https://github.com/Tangerine-Community/tangy-form/pull/51 , https://github.com/Tangerine-Community/tangy-form/pull/72 , https://github.com/Tangerine-Community/tangy-form-editor/pull/73 An inputs object keyed by input name is now available for use in valid-if statements. https://github.com/Tangerine-Community/tangy-form/pull/65 A new Partial Date item is available https://github.com/Tangerine-Community/tangy-form/pull/57 Translations updates. #1613 New custom-styles.css file which can be added by modifying a group's assets folder. You may define CSS classes and then utilize them in the editor by adding them under each widget's class attribute. New \"Copy form\" feature added to to Editor and more descriptive icon for adding a database record #1627 Fixes Helper functions for timed grids are now safer, will not crash if a grid was skipped and info is not availble. https://github.com/Tangerine-Community/tangy-form/pull/61 Print view for a form had a bug where only the first page was printable. This is now fixed so that all pages may be printed. https://github.com/Tangerine-Community/Tangerine/pull/1605 Fix tangy-select test regression and work on EFTouch transition sound plays only on auto-progress #137 API change in tangy-select - use of secondaryLabel is supported but deprecated; Use optionSelectLabel instead. #1602 Fix the display of uploaded docs #1609 Enable auto-stop for untimed grids #1522 Increased clickable target for forms list and visits tab #1628 Upgrade instructions: Backup your data folder and then run the following commands. git fetch origin git checkout v3.5.0 ./start.sh v3.5.0 docker exec -it tangerine /tangerine/server/src/upgrade/v3.5.0.js If any of your on-change logic looks into a form item's contents using tangyFormItemEl.shadowRoot.querySelector(...) or this.$.content.querySelector(...) , you must change it. The contents of the form can now be accessed at tangyFormItemEl.querySelector(...) . Also, the content element is no longer available. For example: // replace var el = this.$.content.querySelector('tangy-input[name=\\'classId\\']') //with var el = this.querySelector('tangy-input[name=\\'classId\\']') The advantage of moving this content out of the shadow DOM is that you can now style it directly from your app.","title":"v3.5.0"},{"location":"whats-new/#v340","text":"New Features New groups now ordered by creation date : Creating new groups will now order them by the date the were created in the group list. #1584 Configurable Web App Device Orientation : You can now specify the Web App orientation (portrait, landscape, or any) on device using the T_ORIENTATION variable in config.sh . Add T_ORIENTATION=\"any\" to config.sh to have more flexible orientations for PWA's. The options for T_ORIENTATION are at https://developer.mozilla.org/en-US/docs/Web/Manifest/orientation Media Library and Image support for Forms : Each group now has a media library tab where they can uplaod images which can then be utilized when inserting the new \"Image\" item on forms. #1138 New ACASI widget : The ACASI widget is braodly based on the EFTouch widget, but focused on a more static presentation of images and sounds. #56 Configurable font size in grids : You may now configure the font size in tangy-timed and tangy-untimed grids using the Option Font Size input. In tangy-form, it is exposed as option-font-size. Example of generated code: <tangy-timed required columns=\"3\" duration=80 name=\"class1_term2\" option-font-size=\"5\"> Auto-stop for tangy-radio-buttons : Add support for autostop in tangy-radio-buttons #49 . In Editor, set the Threshold to the number of incorrect answers: screenshots . Autostop is implemented by using the hideInputsUponThreshhold helper, which takes a tangy-form-item element and compares the number of correct radio button answers to the value in its incorrect-threshold attribute. Example of generated code: <tangy-form-item id=\"item1\" incorrect-threshold=\"2\"> New \"correct\" attribute for radio button options : A new \"correct\" attribute has been added to tangy-list-item to store the correct value. There is a \"Correct\" checkbox next to each option. Example of generated code: <tangy-radio-buttons name=\"fruit_selection2\" label=\"What is your favorite fruit?\"> <option name=\"tangerine\">Tangerine</option> <option name=\"cherry\" correct>Cherry</option> </tangy-radio-buttons> Fixes Critical Sync and \"data loss\" fix : Some variants of v3.3.x saw cases where data seemed to be lost on the tablet and sync no longer worked. After this release is deployed to the server, release for your groups and instruct all tablets to upgrade. The upgrade process may take many minutes depending on the amount of data stored on the tablet due to a schema update in the database. For an in depth look at what this update does, see the code here . Logstash Improvements #1516 User profiles were in a nested object, now they have been merged to be flat in the logstash output doc. See example here . If a form response uses a location element, it will now be extracted out into a top level \"geoip\" property whose value is an object with \"lat\" and \"lon\" properties. See example here . When new forms are created in the editor, they will no longer have a . character in their ID. This was causing some uneccessary and confusing logic in logstash config files. See PR here . EFTouch : A large number of fixes have been made for EFTouch. See recent issues here . Updated to tangy-form-editor ^5.18.0 for Change grid variables in CSV starting with variable_0 to variable_1 . A previous update to tangy-form to 3.15.1, tangy-form-editor to 5.17.0 to fixed Editing form level HTML requires two Save clicks Beta Features Two-way Sync : Allows for two-way sync of form responses. Can be configured to two way sync form responses for specific forms and also by geographic region defined in the user profile. See docs/feature-two-way-sync.md . and Add a tangy input inside a tangy box duplicates items , and enable Adjustable letter size for grids Case Module Add the \"case\" module to T_MODULES in config.sh and the default landing page for a group will be the cases search page and new \"Case Management Editor\" tab will appear in groups for creating and editing Case Definitions. #1517 Clientside search of Forms for Case Management Groups allows Cases to be found using the device camera to scan a QR code. See docs/case-management-group.md . Add event time and scheduling to Case Mangement Groups #1518 New layout for Case and Case Event pages. Upgrade instructions: Backup your data folder and then run the following commands. git fetch origin git checkout v3.4.0 ./start.sh","title":"v3.4.0"},{"location":"whats-new/#v331","text":"This release fixes a feature that made it into v3.3.0 but had a bug and was disabled. This release fixes that bug and makes it available. As an Editor user I want to be able to do an initial import of my location structure. #1117","title":"v3.3.1"},{"location":"whats-new/#v330","text":"Features Assessor reviews high level case variables, AKA \"Case Manifest\" #1399 Assessor changes language setting to Russian #1402 Untimed Grid subtest #1366 Editor Style Upgrades (April 2019) #1421 Group Names can now have spaces and special characters #1424 Editor configures Timed Grid to show or hide labels on buttons #1432 Server Admin tunes the reporting delay between when an upload occurs and it shows up in reporting outputs #1441 CSV output for single checkboxes now show up as \"0\" and \"1\" as opposed to \"\" and \"on\" #1367 CSV output for single radiobuttons now show up as \"0\" and \"1\" as opposed to \"null\" and \"on\" #1433 You can now limit who can add/see sitewide users to only the USER1 account by setting T_USER1_MANAGED_SERVER_USERS to \"true\" in config.sh #1381 . Client now has an \"About\" page with details about what Tangerine is #1465 . Upgrade instructions: Backup your data folder and then run the following commands. git fetch origin git checkout v3.3.0 ./start.sh docker exec -it tangerine /tangerine/server/src/upgrade/v3.3.0.js","title":"v3.3.0"},{"location":"whats-new/#v320","text":"Features Assessor changes language of App #1315 Editor provides feedback given data entered earlier in the form #1384 Assessor starts new Case is immediately forwarded to first form #1362 Assessor finds Form and Event in Case has been disabled/enabled due to custom logic #1363 Assessor confirms participant info using data from another form #1385 Server Admin restarts machine to find containers have automatically come back up #1388 Server Admin sets up Tangerine outage alarm #1389 Developer Notes Ability to define database views on a per module basis in Client Angular #1419 Integrate test harness and TypeScript with server using NestJS #1413 Fix client tests, organize shared services and guards into the shared module, move client/app/ to client/ #1398 Upgrade instructions: git fetch origin git checkout v3.2.0 ./start.sh docker exec tangerine /tangerine/upgrades/v3.2.0.js - In each group's app-config.json , change \"direction\" to \"languageDirection\" . - If using a translation other than English, change in each group's app-config.json , change \"languageCode\" to the corresponding language code. Current codes other than en for English is JO_ar for Jordanian and KH_km for Khmer.","title":"v3.2.0"},{"location":"whats-new/#v310","text":"Features Item Editor UX Improvements #810 Assessor verifies correct location selected by reviewing metadata of location #1191 As an assessor I'd like to include a hint option to be displayed below the question text #1279 Grids: helper functions for grids #1183 Ability to mark an entire row as incorrect on grids #1333 Assessor's backed up form responses are archived when storage is filling up #1304 Assessor scans a QR Code into form #1309 All hidden inputs have reporting values of \"999\" #1349 Merge reporting output of radiobuttons into one column. Bug fixes Editor not properly logging users out resulting in getting stuck every 24 hours #1314 Min and Max for input number cannot be saved through the interface #1297 time on grids cannot be changes and is always 60 seconds #1301 Unclosed tags in html container can break form #1289 Tangy timed option values disappear #1302 Note that #1349 will bve optional in future releases and you may not want to upgrade until that time. Upgrade instructions: git fetch origin git checkout v3.1.0 ./start.sh docker exec tangerine reporting-cache-clear","title":"v3.1.0"},{"location":"whats-new/#v300-beta13","text":"","title":"v3.0.0-beta13"},{"location":"whats-new/#upgrade-instructions-from-v3-betas","text":"git fetch origin git checkout v3.0.0 # Note the new T_UPLOAD_TOKEN variable which is a replacement for the old upload account variables. mv config.sh config.sh_backup cp config.defaults.sh config.sh vim config.sh ./start.sh docker exec tangerine push-all-groups-views docker exec tangerine reporting-cache-clear For existing groups, you need to edit their app-config.json files in the ./data/client/content/groups folders. Replace them with the following template and make sure to update variables such as groupName , uploadToken , and serverUrl . { \"listUsernamesOnLoginScreen\" : true , \"modules\" : [ ], \"groupName\" : \"pineapple\" , \"securityQuestionText\" : \"What is your year of birth?\" , \"hideProfile\" : false , \"direction\" : \"ltr\" , \"columnsOnVisitsTab\" : [], \"hashSecurityQuestionResponse\" : false , \"uploadUnlockedFormReponses\" : false , \"uploadToken\" : \"change this to match T_UPLOAD_TOKEN in config.sh\" , \"securityPolicy\" : [ \"password\" ], \"homeUrl\" : \"case-management\" , \"serverUrl\" : \"https://f571f419.ngrok.io/\" , \"centrallyManagedUserProfile\" : false , \"registrationRequiresServerUser\" : false }","title":"Upgrade instructions from v3 betas"},{"location":"whats-new/#new-features-since-v300-beta12","text":"Server admin imports client archives into server #1166 After exporting data from clients, we now have an easy command line tool to import them. Place those exported files in ./data/archives folder and then run docker exec tangerine import-archives . Consumers of reporting API find user profile data appended to form responses #1147 New logstash module for installations that want to use logstash to migrate data to an Elastic Search instance. Enable by adding logstash to the list of modules in config.sh , then clear reporting caches docker exec -it tangerine bash; cd /tangerine/server/src/scripts; ./clear-all-reporting-cache.js; . You will find new <groupName>-logstash databases in CouchDB that you can configure logstash to consume. Upload Tokens instead of upload usernames and passwords. In your config.sh change T_UPLOAD_TOKEN to a secret phrase and then in existing groups add that to app-config.json as an \"uploadToken\" property and uploadUrl to serverUrl but without the username and password and upload/<groupName> . For example, \"uploadUrl\": \"http://uploader:password@foo.tangerinecentral.org/upload/foo\" would become \"serverUrl\":\"http://foo.tangerinecentral.org\", \"groupName\":\"foo\", \"uploadToken\":\"secret_foo_passphrase\" . If you not planning on updating clients right away, in config.sh set T_LEGACY=\"true\" to support the older upload API that those clients expect. When all clients are upgraded, set that variable back to false. Editor edits location list for group #982 @TODO Editor creates, edits, and deletes form responses on the server #1047 Editor exports CSV of a form for a month of their choosing #1143 Editor sees user profile form related columns joined to CSV of all forms #1142 On client, prevent users from editing their own profile. To impact new groups, change T_HIDE_PROFILE to \"true\" in config.sh . To modify existing groups, change \"hideProfile\" in group level app-config.json to true . Assessor registers on tablet, downloads form responses created on server #1129 On device registration, after user creates account, will force user to enter 6 character code that references online account. To impact new groups, change T_REGISTRATION_REQUIRES_SERVER_USER to \"true\" . To modify existing groups, change \"registrationRequiresServerUser\" in group level app-config.json to true . Editor updates client user profile on server, Assessor sees updated profile after next sync #1134 On client sync, will result in any changes made to a user profile on the server to be downloaded and reflected on the client. To impact new groups, change T_CENTRALLY_MANAGED_USER_PROFILE to \"true\" in config.sh . To modify existing groups, change \"centrallyManagedUserProfile\" in group level app-config.json to true . Editor views tangy-timed items_per_minute calculation in the CSV #1100 <tangy-location> can be filtered by entries in the profile by adding attribute <tangy-location filter-by-global> . In the editor when editing a <tangy-location> you will find a new option \"Filter by locations in the user profile?\" you can check. Advanced forms features (no GUI for these features) <tangy-input-group> can be used to create repeatable groups of inputs. See the demo here . Geofence for v3 #941 If you location list has latitude and longitude properties for each location, you can validate your <tangy-location> selection given a geofence in <tangy-gps> . See the screenshots here and a code example of how to build this in your form here . Upload incomplete form responses (important for Class module) To modify existing groups, set \"uploadUnlockedFormReponses\" to true in app-config.json . Server Admin clears reporting cache #1064 Server Admin runs script to update views in databases #962 Server Admin limits by site or by group the number of form responses uploaded end up in reporting outputs #1155 This feature brings two new settings to config.sh . Set T_PAID_MODE to \"site\" to limit on a sitewide level, use \"group\" to limit on a per group level. Set T_PAID_ALLOWANCE from \"umlimited\" to a specific number like \"1000\" to limit form responses that end up in reporting outputs to one thousand. This mechanism works by marking uploaded form responses as \"paid\". When you first upgrade to this release, none of your form responses will be marked as paid and will not end up in reporting outputs until they are marked as paid against the allowance. If you want to mark all current uploaded form responses as paid and only mark against their allowance for future uploads, set the allowance to unlimited and after the reporting caches have been built, set the allowance desired and run ./start.sh again. Optional Modules you can turn on and off in config.sh T_MODULES list. Note that if you are going to override the default T_MODULES list with an additional module such as class , don't forget to add modules such as csv if you still need them! Reporting outputs (inluding CSVs) include the information about the number of children a location has. #1174","title":"New features since v3.0.0-beta12"},{"location":"whats-new/#known-issues","text":"Memory leak results in Error: spawn ENOMEM #886 On the server command line run crontab -e and then add the following entry to restart the program every 24 hours 0 0 * * * docker stop tangerine; docker start tangerine .","title":"Known issues"},{"location":"whats-new/#200-pre-release","text":"","title":"2.0.0 (pre-release)"},{"location":"whats-new/#user-stories","text":"As a Tangerine Database admin, I want to control which users have the \"Manager\" role for creating new groups #218 As a Tangerine Editor User, I expect to see timestamps on CSVs down to the second #223 As a user, if I end up on a http:// URL I want to be redirected to the https:// version of that URL #98","title":"User Stories"},{"location":"whats-new/#bugs","text":"New groups default Client tabs are set up for workflow, should be vanilla tangerine #230 When Tangerine is first installed, User1 does not have the required Manager role so groups cannot be created #229 School Location Subtest does not render after upgrading from Tangerine 0.4.x to v2.0.0 #189 If a group was upgraded from 0.x.x and does not have a media folder, APK generating fails #186 Deleting group does not set security correctly on resulting \"deleted\" database #227 Large CSVs fail to generate #221 When a new Workflow is created it is missing retrictToRole, reporting, and authenticityParameters #228 Ensure /var/log/couchdb exists so CouchDB does not crash #216","title":"Bugs"},{"location":"whats-new/#technical","text":"Document how to use SSL with Tangerine #219 Things to add to .gitignore #185 Clean up build process so client does not need to compile twice #74","title":"Technical"},{"location":"whats-new/#upgrade-directions","text":"This is the first release with upgrade scripts so you will need to run all upgrade scripts between the version you started at and this one. For example, if you are at Tangerine 0.4.6, then you must run... docker exec -it tangerine-container /tangerine-server/upgrades/v1.0.0.sh docker exec -it tangerine-container /tangerine-server/upgrades/v2.0.0.sh If you are at Tangerine 1.7.8, then you must run... docker exec -it tangerine-container /tangerine-server/upgrades/v2.0.0.sh","title":"Upgrade directions"},{"location":"whats-new/#v220","text":"","title":"v2.2.0"},{"location":"whats-new/#user-stories_1","text":"As a Site Owner I want to know how many results have been uploaded given arbitrary time period #457","title":"User Stories"},{"location":"whats-new/#technical_1","text":"Refactor start.sh and config.defaults.sh to allow configurable ports and tag #456","title":"Technical"},{"location":"whats-new/#upgrade-direcections","text":"docker exec -it tangerine-container /tangerine-server/upgrades/v2.2.0.sh","title":"Upgrade direcections"},{"location":"artwork/icons/","text":"Icons for v3 \u00b6 Gimp source and examples of icons are in the icon-source directory adjacent to this file.","title":"Icons for v3"},{"location":"artwork/icons/#icons-for-v3","text":"Gimp source and examples of icons are in the icon-source directory adjacent to this file.","title":"Icons for v3"},{"location":"data-collector/","text":"Data Collector Guide \u00b6 Using P2P Sync for Offline Data Transfer More coming soon!","title":"Data Collector Guide"},{"location":"data-collector/#data-collector-guide","text":"Using P2P Sync for Offline Data Transfer More coming soon!","title":"Data Collector Guide"},{"location":"data-collector/backups/","text":"Backups \u00b6 Ask user to go to Export Data and press \"Export Data for all Users\". It will display an alert after each database backup is saved. The backup files will be saved in the Android/data/org.rti.tangerine/files directory. Use Android File transfer tool to transfer the files. Save all of the database backup files.","title":"Backups"},{"location":"data-collector/backups/#backups","text":"Ask user to go to Export Data and press \"Export Data for all Users\". It will display an alert after each database backup is saved. The backup files will be saved in the Android/data/org.rti.tangerine/files directory. Use Android File transfer tool to transfer the files. Save all of the database backup files.","title":"Backups"},{"location":"data-collector/data-collector-overview/","text":"Tangerine Data Collection \u00b6 Deploying Tangerine for Offline Data Collection Check for Tangerine Updates Data Collection Data Synchronization Quality Management \u00b6 Forms Data Security Forms Review and Release Process General Data Quality Rules","title":"Tangerine Data Collection"},{"location":"data-collector/data-collector-overview/#tangerine-data-collection","text":"Deploying Tangerine for Offline Data Collection Check for Tangerine Updates Data Collection Data Synchronization","title":"Tangerine Data Collection"},{"location":"data-collector/data-collector-overview/#quality-management","text":"Forms Data Security Forms Review and Release Process General Data Quality Rules","title":"Quality Management"},{"location":"data-collector/data-collector/","text":"Data collection on Device \u00b6 Select the instrument to use, and follow the prompts, sections, and items on the screen, as generated in the instrument/form editor. To select an answer option, just tab on it. Warning Different to all other inputs, where the user/assessor selects the applicable / correct response which will then be marked in blue, in grids, the user has to select all INCORRECT items (they will turn blue). Answer the rest of the questions as they are presented to you. Resuming Instrument \u00b6 Should an administration be interrupted, or to be completed at a later stage, navigate to \" Visits \" on the top of the tablet screen. Warning You have to have a location section and location list loaded for your instrument to be able to access the resume feature in Tangerine. Make up a location list, even if it only has one column header entry and one item underneath (e.g. column A header is \"site\", row 2 entry is \"test site\". Without a location list loaded, you will not have a \"Visits\" tab on the tablet from which to resume the instrument. Select the appropriate location and date (as applicable) from the menu. Tangerine will automatically return the user to the last, incomplete section/page of the instrument. You can return from the \"Visits\" page to the main screen by hitting the Tangerine icon.","title":"Data collector"},{"location":"data-collector/data-collector/#data-collection-on-device","text":"Select the instrument to use, and follow the prompts, sections, and items on the screen, as generated in the instrument/form editor. To select an answer option, just tab on it. Warning Different to all other inputs, where the user/assessor selects the applicable / correct response which will then be marked in blue, in grids, the user has to select all INCORRECT items (they will turn blue). Answer the rest of the questions as they are presented to you.","title":"Data collection on Device"},{"location":"data-collector/data-collector/#resuming-instrument","text":"Should an administration be interrupted, or to be completed at a later stage, navigate to \" Visits \" on the top of the tablet screen. Warning You have to have a location section and location list loaded for your instrument to be able to access the resume feature in Tangerine. Make up a location list, even if it only has one column header entry and one item underneath (e.g. column A header is \"site\", row 2 entry is \"test site\". Without a location list loaded, you will not have a \"Visits\" tab on the tablet from which to resume the instrument. Select the appropriate location and date (as applicable) from the menu. Tangerine will automatically return the user to the last, incomplete section/page of the instrument. You can return from the \"Visits\" page to the main screen by hitting the Tangerine icon.","title":"Resuming Instrument"},{"location":"data-collector/data-sync/","text":"Data Synchronization \u00b6 Whenever possible during data collection, recommend that users / assessors to sync their data to the tablet by navigating to the profile menu, and select \" Sync \". The Sync screen provides an overview of the data upload/sync status to date, including the number of responses not yet uploaded as shown below. Once the sync is complete, Tangerine will show \" 100% \" for the field \" Percentage uploaded \".","title":"Data sync"},{"location":"data-collector/data-sync/#data-synchronization","text":"Whenever possible during data collection, recommend that users / assessors to sync their data to the tablet by navigating to the profile menu, and select \" Sync \". The Sync screen provides an overview of the data upload/sync status to date, including the number of responses not yet uploaded as shown below. Once the sync is complete, Tangerine will show \" 100% \" for the field \" Percentage uploaded \".","title":"Data Synchronization"},{"location":"data-collector/deployment/","text":"Deploying Tangerine for Offline (or Online) Data Collection \u00b6 Once the user is done creating the instruments/forms the next step is to deploy the instrument to an Android device for data collection. To release your instruments or instrument updates, select the \"Release\" tab in the top menu of the main group page. Upon selecting \"Release\", you will see the screen below. Tangerine offers two deployment types, test release and live release: Test Release -- This release option (\"release to QA\") is recommended for testing the instruments. When you make changes and updates to the instruments and release your changes as \"Test Release\", tablets that have the \"real\" version of Tangerine installed will NOT receive this update. HOWEVER, any data synced from the tablet devices even in a \"Test Release\" deployment goes into the main database (thus mark your tests clearly as \"TESTS\" to facilitate data cleaning. Live Release -- When instruments/forms are final, or instrument edits have been tested, use this release option (\"release to production\"). In this case, tablets that are already collecting data, or have the group's apk installed, will received an update request when connecting to the Internet the next time. All data collected from this release will also be added to the main database. Tangerine also offers two deployment /installation strategies, Android installation or web browser installation: Android Installation . This is the standard deployment package where an actual apk file can be generated on the computer, downloaded, and then copied over to a mobile device via a USB cable and installed. This method of deployment is suitable in slow network environment or when the apk is large. Web Browser Installation . This deployment strategy requires an Internet connection on the tablet for the Tangerine to be installed. Once installed, the app can work again offline. This method is suitable in places of good connectivity. NOTE : We recommend thoroughly testing your instruments and its data output before releasing them! To test your instrument use the Test Release mode. Using standard installation \u00b6 Android Installation \u00b6 This deployment strategy creates an APK file which can be installed on an Android tablet or smartphone. Click on Android Installation Test Release/Live Release as shown in the screen above. Wait. Once Tangerine has compiled the apk, click on \"Download your APK here\", as shown below. This will download an apk file into your computer's downloads folder. Warning Every time an instrument/form is changed, added, or deleted from the group, it is necessary to create a release and alert each tablet user to use the \"Check for Update\" option in order to update their application. Web Browser Installation \u00b6 This deployment strategy creates a link/URL to a \"progressive web app\" (PWA) for direct installation from the web to the Android tablet or smartphone. Click on Web Browser Installation Test Release/Live Release. Wait. Once Tangerine has compiled the PWA, it will show an installation URL like in the screen below. Use this URL from the Chrome browser on the tablet to install the PWA on the tablet devices. You can also copy the URL and open a new browser tab with this URL on your computer to test your instruments online. The browser window may require you to confirm that you want to apply the updates. After \" Click here to proceed \", Tangerine will show an online data collection version of your instruments with a similar look and function as on a tablet/smartphone. Warning Every time an instrument/form is changed, added, or deleted from the group, it is necessary to release the apk/pwa again, but NO NEW INSTALLATION is necessary on the tablets. Instead, instruct Tangerine tablet users to connect their tablets, select their profile page (3 vertical white dots on top right of tablet screen). Select \" Check for Update \" and proceed to install the update. Warning This update approach will not only apply any instrument/form edits, new forms, or form deletions, but also any updates to the Tangerine application made in the meantime and applied to your group (if any). Using Device Setup Installation \u00b6 Installation \u00b6 Tangerine offers two deployment /installation strategies, Android installation or web browser installation: Android Installation. This is the standard deployment package where an actual apk file can be generated on the computer, downloaded, and then copied over to a mobile device via a USB cable and installed. This method of deployment is suitable in slow network environment or when the apk is large. Web Browser Installation. This deployment strategy requires an Internet connection on the tablet for the Tangerine to be installed. Once installed, the app can work again offline. This method is suitable in places of good connectivity. This method of installation can also be used for installing app on your Chrome browser on a PC or laptop For both of the installation models you will need a Registration Code (QR Code) or a device ID and Token. If you don't have this information you will not be able to install the application on your device. We recommend that the initial device setup is done by a responsible person at the site. This can be someone who will handle queries regarding Tangerine or an IT staff. Each device registration requires that an admin user is create on that device. This admin user is the one that can authorize the registration of a user account. This is to make sure that your data can only be accessed by authorized personnel and no untheorized accounts exist on the tablet. Installation on a tablet/phone \u00b6 Copy the apk file to the tablet and open it. Follow the installation prompts until you receive a message that the app has been installed. Locate the Tangerine app in the application drawer and click it. Warning Note that you must be online on the tablet to do the initial installation. The first step is to select the language for the user interface Select the language and click Submit Now enter the administration password for this tablet. You may wish to use the same admin password for all tables at your site. This same password will be required each time a user is registering to use the app on this device. Select Yes if you have a device code or No if you are going to insert a device ID and Token for the registration. Insert the ID and Token or click the Scan icon to scan the registration QR code. Click Submit when done. The next screen will show you some information for this device. If it is correct select Yes, if the scanned device code and ID correspond to a different device select No and start over with the correct device code. On the next screen you will see some synchronization information. The app at this moment is contacting the server and obtaining users assigned to your device location. If you have already collected data on another tablet for this location, this data will also be pulled. Click Next and then go to the Registration tap. Ask your administrator to enter the admin password and enter your user information below. Click submit when ready. If you are an administrator handing off the tablet to a user, enter your password and ask the user to enter their username and password. Here the Year of Birth can be used by the user to reset their password in case they forgot it. On the next screen you will see a dropdown of all users for this location. Select the one that corresponds to you and click Submit. You will now see a screen similar to the one below where you can start working Installation in your Chrome browser \u00b6 Tangerine can be installed and used offline in the Chrome browser. To do this we follow similar installation instructions as above. Warning You must be online on to do the initial installation.** The first step is to follow the link for Browser installation that has been given to you or copied directly after it's generation in the backend. Copy the link and paste it in the Chrome's address bar. You will see a screen indicating that the app is being installed. After a successful installation you will receive a confirmation screen like the one below. Do not click the link to proceed . Click the + icon beside the address bar to install Tangerine in your browser. A popup will open to give you the option to install the app. Click Install Depending on your browser setup, you may be asked to create a shortcut on your desktop or in your program folder or the browser may close automatically and offer you the link for Tangerine to open. If you see the link click it If you cannot find it type this into the address bar of your browser: [chrome://apps/]{.underline} Warning Always start Tangerine from the application icon and not from the URL address. Only one Tangerine instllation per browser profile is allowed. Click the Tangerine app to start the application. Select the language and click Submit Now enter the administration password for this tablet. You may wish to use the same admin password for all tables at your site. This same password will be required each time a user is registering to use the app on this device. Select Yes if you have a device code or No if you are going to insert a device ID and Token for the registration. Insert the ID and Token or click the Scan icon to scan the registration QR code. If your PC or laptop doesn't have a camera that can be used to scan the barcode, you'd have to type in the ID and Token Click Submit when done. The next screen will show you some information for this device. If it is correct select Yes, if the scanned device code and ID correspond to a different device select No and start over with the correct device code. On the next screen you will see some synchronization information. The app at this moment is contacting the server and obtaining users assigned to your device location. If you have already collected data on another tablet for this location, this data will also be pulled. Click Next and then go to the Registration tap. Ask your administrator to enter the admin password and enter your user information below. Click submit when ready. If you are an administrator handing off the tablet to a user, enter your password and ask the user to enter their username and password. Here the Year of Birth can be used by the user to reset their password in case they forgot it. On the next screen you will see a dropdown of all users for this location. Select the one that corresponds to you and click Submit. You will now see a screen similar to the one below where you can start working Synchronization \u00b6 User setup \u00b6 Follow to below steps to prepare the Tangerine backend to allow installation of your app on the user device or Chrome browser. The menu items used during setup can be found under the Deploy link in the left side navigation menu. Click the Device Users section to create a new tablet user profile. On this screen you will see a listing of all users already created. At the bottom left of the screen there is a'+' icon which allows you to add a new device user profile. Click the + icon to create a user profile on the server Fill in all information required in the profile and click Submit You will see that next to the Submit button a blue check marks appears indicating that the profile was saved Repeat the above steps for all users Device setup \u00b6 Now we have to create the 'virtual' devices that will be associated with a real device or browser upon installation. The devices that you create represent a real user device. Each virtual device can be associated with a real tablet only once. After being claimed the device cannot be reused (unless reset and the app re-installed). Each device requires that we assign it to a particular location. This assigned location is automatically attached to each form collected from the tablet. We can also control the synchronization level. This level will indicate to Tangerine what records should be kept in sync across tablets. If you select to synchronize on a top level, all tablets will contain all records collected over all of the facilities in under this top level. It may be better to choose to synchronize only at the bottom level. The device listing go to Deploy->Devices Here, if you have some devices already created you will see a full listing with some other information The device listing gives you: The ID of the device The assigned location Whether this device has already been used in an installation or not. A checkmark under Claimed indicates that it has been used. Registered on gives you the date this device was first registered The last synchronization date for this device Updated on is the date this device was last updated Version is the version of the application this device is running Under options you will have access to a menu allowing you to Edit, Reset, Delete, get The QR registration code for a device. Create a new device by going to Deploy->Devices Click the + icon at the bottom of the page Note that you have the ID and Token listed here (can also be access by clicking Edit for a particular device on the device listing screen) In cases where the QR code cannot be sent to the site for installation you can also use the ID and Token to install Tangerine. Select the location this device is assigned to Select the synchronization level Select the actual site to be used for synchronization. Be careful here not to assign the device to one location and select a different one for synchronization. Click Submit The device now shows up on the of the list and you can get the QR code for it by clicking the Options menu and selecting Registration Code Repeat the above steps for all devices that you need to use on your project. NOTE: you may wish to store the device ID and Token in a file for safe keeping. Such a sample file can be found here . Put the device ID and the Token in the corresponding columns and the QR code will be generated for you. Keep in mind that his worksheet functions correctly only on Google Drive. You can also print this file and distribute the installation codes on paper. Device modification \u00b6 It may happen that you want to modify a device that is already in use. Although you will be able to do that in the interface, this modification is not pushed to the actual tablet. The way to go here is to apply the modification reset the device, and send the new Registration Code or ID and Token to the admin to reinstall the application. Make sure that before re-installing the app all data is synchronized. NOTE: You can edit all devices that have not been claimed yet. To Edit a device, click the Edit button in the Options menu. Apply any modifications and click Submit To Delete a device , click the Delete button in the Options menu. Keep in mind that any device that you delete will disallow this device from synchronization or updates. Use this option if you have had one of your devices stolen or lost. To Reset a device, click the Reset button in the options menu. This action will disallow the device from receiving updates or synchronizing data. Use this option, if one of your staff members leaves and will no longer use this device. Make sure data is synchronized before you reset the device.","title":"Deployment"},{"location":"data-collector/deployment/#deploying-tangerine-for-offline-or-online-data-collection","text":"Once the user is done creating the instruments/forms the next step is to deploy the instrument to an Android device for data collection. To release your instruments or instrument updates, select the \"Release\" tab in the top menu of the main group page. Upon selecting \"Release\", you will see the screen below. Tangerine offers two deployment types, test release and live release: Test Release -- This release option (\"release to QA\") is recommended for testing the instruments. When you make changes and updates to the instruments and release your changes as \"Test Release\", tablets that have the \"real\" version of Tangerine installed will NOT receive this update. HOWEVER, any data synced from the tablet devices even in a \"Test Release\" deployment goes into the main database (thus mark your tests clearly as \"TESTS\" to facilitate data cleaning. Live Release -- When instruments/forms are final, or instrument edits have been tested, use this release option (\"release to production\"). In this case, tablets that are already collecting data, or have the group's apk installed, will received an update request when connecting to the Internet the next time. All data collected from this release will also be added to the main database. Tangerine also offers two deployment /installation strategies, Android installation or web browser installation: Android Installation . This is the standard deployment package where an actual apk file can be generated on the computer, downloaded, and then copied over to a mobile device via a USB cable and installed. This method of deployment is suitable in slow network environment or when the apk is large. Web Browser Installation . This deployment strategy requires an Internet connection on the tablet for the Tangerine to be installed. Once installed, the app can work again offline. This method is suitable in places of good connectivity. NOTE : We recommend thoroughly testing your instruments and its data output before releasing them! To test your instrument use the Test Release mode.","title":"Deploying Tangerine for Offline (or Online) Data Collection"},{"location":"data-collector/deployment/#using-standard-installation","text":"","title":"Using standard installation"},{"location":"data-collector/deployment/#android-installation","text":"This deployment strategy creates an APK file which can be installed on an Android tablet or smartphone. Click on Android Installation Test Release/Live Release as shown in the screen above. Wait. Once Tangerine has compiled the apk, click on \"Download your APK here\", as shown below. This will download an apk file into your computer's downloads folder. Warning Every time an instrument/form is changed, added, or deleted from the group, it is necessary to create a release and alert each tablet user to use the \"Check for Update\" option in order to update their application.","title":"Android Installation"},{"location":"data-collector/deployment/#web-browser-installation","text":"This deployment strategy creates a link/URL to a \"progressive web app\" (PWA) for direct installation from the web to the Android tablet or smartphone. Click on Web Browser Installation Test Release/Live Release. Wait. Once Tangerine has compiled the PWA, it will show an installation URL like in the screen below. Use this URL from the Chrome browser on the tablet to install the PWA on the tablet devices. You can also copy the URL and open a new browser tab with this URL on your computer to test your instruments online. The browser window may require you to confirm that you want to apply the updates. After \" Click here to proceed \", Tangerine will show an online data collection version of your instruments with a similar look and function as on a tablet/smartphone. Warning Every time an instrument/form is changed, added, or deleted from the group, it is necessary to release the apk/pwa again, but NO NEW INSTALLATION is necessary on the tablets. Instead, instruct Tangerine tablet users to connect their tablets, select their profile page (3 vertical white dots on top right of tablet screen). Select \" Check for Update \" and proceed to install the update. Warning This update approach will not only apply any instrument/form edits, new forms, or form deletions, but also any updates to the Tangerine application made in the meantime and applied to your group (if any).","title":"Web Browser Installation"},{"location":"data-collector/deployment/#using-device-setup-installation","text":"","title":"Using Device Setup Installation"},{"location":"data-collector/deployment/#installation","text":"Tangerine offers two deployment /installation strategies, Android installation or web browser installation: Android Installation. This is the standard deployment package where an actual apk file can be generated on the computer, downloaded, and then copied over to a mobile device via a USB cable and installed. This method of deployment is suitable in slow network environment or when the apk is large. Web Browser Installation. This deployment strategy requires an Internet connection on the tablet for the Tangerine to be installed. Once installed, the app can work again offline. This method is suitable in places of good connectivity. This method of installation can also be used for installing app on your Chrome browser on a PC or laptop For both of the installation models you will need a Registration Code (QR Code) or a device ID and Token. If you don't have this information you will not be able to install the application on your device. We recommend that the initial device setup is done by a responsible person at the site. This can be someone who will handle queries regarding Tangerine or an IT staff. Each device registration requires that an admin user is create on that device. This admin user is the one that can authorize the registration of a user account. This is to make sure that your data can only be accessed by authorized personnel and no untheorized accounts exist on the tablet.","title":"Installation"},{"location":"data-collector/deployment/#installation-on-a-tabletphone","text":"Copy the apk file to the tablet and open it. Follow the installation prompts until you receive a message that the app has been installed. Locate the Tangerine app in the application drawer and click it. Warning Note that you must be online on the tablet to do the initial installation. The first step is to select the language for the user interface Select the language and click Submit Now enter the administration password for this tablet. You may wish to use the same admin password for all tables at your site. This same password will be required each time a user is registering to use the app on this device. Select Yes if you have a device code or No if you are going to insert a device ID and Token for the registration. Insert the ID and Token or click the Scan icon to scan the registration QR code. Click Submit when done. The next screen will show you some information for this device. If it is correct select Yes, if the scanned device code and ID correspond to a different device select No and start over with the correct device code. On the next screen you will see some synchronization information. The app at this moment is contacting the server and obtaining users assigned to your device location. If you have already collected data on another tablet for this location, this data will also be pulled. Click Next and then go to the Registration tap. Ask your administrator to enter the admin password and enter your user information below. Click submit when ready. If you are an administrator handing off the tablet to a user, enter your password and ask the user to enter their username and password. Here the Year of Birth can be used by the user to reset their password in case they forgot it. On the next screen you will see a dropdown of all users for this location. Select the one that corresponds to you and click Submit. You will now see a screen similar to the one below where you can start working","title":"Installation on a tablet/phone"},{"location":"data-collector/deployment/#installation-in-your-chrome-browser","text":"Tangerine can be installed and used offline in the Chrome browser. To do this we follow similar installation instructions as above. Warning You must be online on to do the initial installation.** The first step is to follow the link for Browser installation that has been given to you or copied directly after it's generation in the backend. Copy the link and paste it in the Chrome's address bar. You will see a screen indicating that the app is being installed. After a successful installation you will receive a confirmation screen like the one below. Do not click the link to proceed . Click the + icon beside the address bar to install Tangerine in your browser. A popup will open to give you the option to install the app. Click Install Depending on your browser setup, you may be asked to create a shortcut on your desktop or in your program folder or the browser may close automatically and offer you the link for Tangerine to open. If you see the link click it If you cannot find it type this into the address bar of your browser: [chrome://apps/]{.underline} Warning Always start Tangerine from the application icon and not from the URL address. Only one Tangerine instllation per browser profile is allowed. Click the Tangerine app to start the application. Select the language and click Submit Now enter the administration password for this tablet. You may wish to use the same admin password for all tables at your site. This same password will be required each time a user is registering to use the app on this device. Select Yes if you have a device code or No if you are going to insert a device ID and Token for the registration. Insert the ID and Token or click the Scan icon to scan the registration QR code. If your PC or laptop doesn't have a camera that can be used to scan the barcode, you'd have to type in the ID and Token Click Submit when done. The next screen will show you some information for this device. If it is correct select Yes, if the scanned device code and ID correspond to a different device select No and start over with the correct device code. On the next screen you will see some synchronization information. The app at this moment is contacting the server and obtaining users assigned to your device location. If you have already collected data on another tablet for this location, this data will also be pulled. Click Next and then go to the Registration tap. Ask your administrator to enter the admin password and enter your user information below. Click submit when ready. If you are an administrator handing off the tablet to a user, enter your password and ask the user to enter their username and password. Here the Year of Birth can be used by the user to reset their password in case they forgot it. On the next screen you will see a dropdown of all users for this location. Select the one that corresponds to you and click Submit. You will now see a screen similar to the one below where you can start working","title":"Installation in your Chrome browser"},{"location":"data-collector/deployment/#synchronization","text":"","title":"Synchronization"},{"location":"data-collector/deployment/#user-setup","text":"Follow to below steps to prepare the Tangerine backend to allow installation of your app on the user device or Chrome browser. The menu items used during setup can be found under the Deploy link in the left side navigation menu. Click the Device Users section to create a new tablet user profile. On this screen you will see a listing of all users already created. At the bottom left of the screen there is a'+' icon which allows you to add a new device user profile. Click the + icon to create a user profile on the server Fill in all information required in the profile and click Submit You will see that next to the Submit button a blue check marks appears indicating that the profile was saved Repeat the above steps for all users","title":"User setup"},{"location":"data-collector/deployment/#device-setup","text":"Now we have to create the 'virtual' devices that will be associated with a real device or browser upon installation. The devices that you create represent a real user device. Each virtual device can be associated with a real tablet only once. After being claimed the device cannot be reused (unless reset and the app re-installed). Each device requires that we assign it to a particular location. This assigned location is automatically attached to each form collected from the tablet. We can also control the synchronization level. This level will indicate to Tangerine what records should be kept in sync across tablets. If you select to synchronize on a top level, all tablets will contain all records collected over all of the facilities in under this top level. It may be better to choose to synchronize only at the bottom level. The device listing go to Deploy->Devices Here, if you have some devices already created you will see a full listing with some other information The device listing gives you: The ID of the device The assigned location Whether this device has already been used in an installation or not. A checkmark under Claimed indicates that it has been used. Registered on gives you the date this device was first registered The last synchronization date for this device Updated on is the date this device was last updated Version is the version of the application this device is running Under options you will have access to a menu allowing you to Edit, Reset, Delete, get The QR registration code for a device. Create a new device by going to Deploy->Devices Click the + icon at the bottom of the page Note that you have the ID and Token listed here (can also be access by clicking Edit for a particular device on the device listing screen) In cases where the QR code cannot be sent to the site for installation you can also use the ID and Token to install Tangerine. Select the location this device is assigned to Select the synchronization level Select the actual site to be used for synchronization. Be careful here not to assign the device to one location and select a different one for synchronization. Click Submit The device now shows up on the of the list and you can get the QR code for it by clicking the Options menu and selecting Registration Code Repeat the above steps for all devices that you need to use on your project. NOTE: you may wish to store the device ID and Token in a file for safe keeping. Such a sample file can be found here . Put the device ID and the Token in the corresponding columns and the QR code will be generated for you. Keep in mind that his worksheet functions correctly only on Google Drive. You can also print this file and distribute the installation codes on paper.","title":"Device setup"},{"location":"data-collector/deployment/#device-modification","text":"It may happen that you want to modify a device that is already in use. Although you will be able to do that in the interface, this modification is not pushed to the actual tablet. The way to go here is to apply the modification reset the device, and send the new Registration Code or ID and Token to the admin to reinstall the application. Make sure that before re-installing the app all data is synchronized. NOTE: You can edit all devices that have not been claimed yet. To Edit a device, click the Edit button in the Options menu. Apply any modifications and click Submit To Delete a device , click the Delete button in the Options menu. Keep in mind that any device that you delete will disallow this device from synchronization or updates. Use this option if you have had one of your devices stolen or lost. To Reset a device, click the Reset button in the options menu. This action will disallow the device from receiving updates or synchronizing data. Use this option, if one of your staff members leaves and will no longer use this device. Make sure data is synchronized before you reset the device.","title":"Device modification"},{"location":"data-collector/update/","text":"Update \u00b6 Instruct the Tangerine tablet users to connect their tablets, select their profile page (3 vertical white dots on top right of tablet screen). Note: Ask the tablet user to always Sync their data before they do an update. Select \" Check for Update \" and proceed to install the update. Warning This update approach will not only apply any instrument/form edits, new forms, or form deletions, but also any updates to the Tangerine application made in the meantime and applied to your group (if any).","title":"Update"},{"location":"data-collector/update/#update","text":"Instruct the Tangerine tablet users to connect their tablets, select their profile page (3 vertical white dots on top right of tablet screen). Note: Ask the tablet user to always Sync their data before they do an update. Select \" Check for Update \" and proceed to install the update. Warning This update approach will not only apply any instrument/form edits, new forms, or form deletions, but also any updates to the Tangerine application made in the meantime and applied to your group (if any).","title":"Update"},{"location":"data-collector/p2p/p2p-sync/","text":"Using P2P Sync for Offline Data Transfer \u00b6 Use the P2P sync feature to transfer data between two or more tablets without an Internet connection. Note: The tablets must be running Android 8 (Oreo) to use this function. In the following example, your tablet will be syncing data from your tablet to two other peers' tablets running Tangerine. The goal is to have the same data on all tablets. At the end of the process, data will be transferred from your tablet to the Internet. Accessing the P2P feature: \u00b6 Each peer should select Sync from the menu. Click the P2P Sync tab. Discovery \u00b6 Gather in a circle with your peers. You and your peers should click the Discovery button. It does not matter who clicks first. Endpoints \u00b6 After a short time - a minute of two, the screen will show the device name, a list of available endpoints, and information about the data transfers in the Log. In the screenshot, your device name is highlighted in green (89678). The list of available endpoints - your peers' tablet names - is highlighted in red. A log of diagnostic information is highlighted in blue. (Please note that the endpoint names are randomly generated. The names you see when using this feature will be different.) Syncing to an Endpoint \u00b6 At this point in the process, your peers don't need to push any buttons; they only need to monitor the sync process for errors. Your tablet will be called the \"master\" tablet because it is controlling the sync operations. Once the \"master\" tablet has collected all of the data from the tablets, it can be connected to the Internet and upload all of this data to the server. Ask your peers which one has the tab at the top of the endpoints list marked \"35747 - Pending\". Upon identifying that peer, ask them to pay attention to the screen. Now you may click \"35747 - Pending\" to initiate the data transfer. Notice how the endpoint button you click turns a darker shade of grey to indicate that it has been pressed. Your tablet will send its data to your peer's tablet and then your peer's tablet will send its data back to your tablet, as well as the data you just sent. It's a little redundant, but this is part of reaching \"eventual consistency\" for all of the tablets. Notice that more data is added to the Log as the connection is made between the tablets and data transfer is initiated: When the data transfer is complete, the endpoint list updates to show that you are ready to sync the next device (\"Done! Sync next device.\"). Ask your peer if they received any error messages; if not, it is safe to proceed to the next peer's tablet. Ask the peer who has the tablet marked \"29726\" to be ready. Click the endpoint marked \"29726: Pending\". When the data transfer is complete, the endpoint list updates to show that you are ready to sync the next device (\"Done! Sync next device.\"). Ask your peer if they received any error messages. If none, great! Since you're at the end of the endpoints list, you are done with this first part. Do it again! \u00b6 When you synced data from your \"master\" tablet to the second tablet, it received data from the first tablet, which was transferred to the \"master\" when it was sync'd. But the first tablet still needs to receive data from the second tablet. So, you will need to repeat this whole process, starting from the first tablet (35747) and then to the second (29726). (You actually don't need to sync again the final device sync'd in the process (29726), but it is easier to explain this process as a simple round-robin.) It may be useful to confirm that any records created on other tablets has indeed been transferred. English: French: As mentioned earlier, once the sync process is complete (and you've done it twice), you may conect the \"master\" to the Internet and transfer data to the server. Tips \u00b6 Each time you visit the P2P page, your device name will change. It is a randomly generated number. Errors are highlighted in pink. It is fine to ignore the error marked \"State set to CONNECTED but already in that state\".","title":"Using P2P Sync for Offline Data Transfer"},{"location":"data-collector/p2p/p2p-sync/#using-p2p-sync-for-offline-data-transfer","text":"Use the P2P sync feature to transfer data between two or more tablets without an Internet connection. Note: The tablets must be running Android 8 (Oreo) to use this function. In the following example, your tablet will be syncing data from your tablet to two other peers' tablets running Tangerine. The goal is to have the same data on all tablets. At the end of the process, data will be transferred from your tablet to the Internet.","title":"Using P2P Sync for Offline Data Transfer"},{"location":"data-collector/p2p/p2p-sync/#accessing-the-p2p-feature","text":"Each peer should select Sync from the menu. Click the P2P Sync tab.","title":"Accessing the P2P feature:"},{"location":"data-collector/p2p/p2p-sync/#discovery","text":"Gather in a circle with your peers. You and your peers should click the Discovery button. It does not matter who clicks first.","title":"Discovery"},{"location":"data-collector/p2p/p2p-sync/#endpoints","text":"After a short time - a minute of two, the screen will show the device name, a list of available endpoints, and information about the data transfers in the Log. In the screenshot, your device name is highlighted in green (89678). The list of available endpoints - your peers' tablet names - is highlighted in red. A log of diagnostic information is highlighted in blue. (Please note that the endpoint names are randomly generated. The names you see when using this feature will be different.)","title":"Endpoints"},{"location":"data-collector/p2p/p2p-sync/#syncing-to-an-endpoint","text":"At this point in the process, your peers don't need to push any buttons; they only need to monitor the sync process for errors. Your tablet will be called the \"master\" tablet because it is controlling the sync operations. Once the \"master\" tablet has collected all of the data from the tablets, it can be connected to the Internet and upload all of this data to the server. Ask your peers which one has the tab at the top of the endpoints list marked \"35747 - Pending\". Upon identifying that peer, ask them to pay attention to the screen. Now you may click \"35747 - Pending\" to initiate the data transfer. Notice how the endpoint button you click turns a darker shade of grey to indicate that it has been pressed. Your tablet will send its data to your peer's tablet and then your peer's tablet will send its data back to your tablet, as well as the data you just sent. It's a little redundant, but this is part of reaching \"eventual consistency\" for all of the tablets. Notice that more data is added to the Log as the connection is made between the tablets and data transfer is initiated: When the data transfer is complete, the endpoint list updates to show that you are ready to sync the next device (\"Done! Sync next device.\"). Ask your peer if they received any error messages; if not, it is safe to proceed to the next peer's tablet. Ask the peer who has the tablet marked \"29726\" to be ready. Click the endpoint marked \"29726: Pending\". When the data transfer is complete, the endpoint list updates to show that you are ready to sync the next device (\"Done! Sync next device.\"). Ask your peer if they received any error messages. If none, great! Since you're at the end of the endpoints list, you are done with this first part.","title":"Syncing to an Endpoint"},{"location":"data-collector/p2p/p2p-sync/#do-it-again","text":"When you synced data from your \"master\" tablet to the second tablet, it received data from the first tablet, which was transferred to the \"master\" when it was sync'd. But the first tablet still needs to receive data from the second tablet. So, you will need to repeat this whole process, starting from the first tablet (35747) and then to the second (29726). (You actually don't need to sync again the final device sync'd in the process (29726), but it is easier to explain this process as a simple round-robin.) It may be useful to confirm that any records created on other tablets has indeed been transferred. English: French: As mentioned earlier, once the sync process is complete (and you've done it twice), you may conect the \"master\" to the Internet and transfer data to the server.","title":"Do it again!"},{"location":"data-collector/p2p/p2p-sync/#tips","text":"Each time you visit the P2P page, your device name will change. It is a randomly generated number. Errors are highlighted in pink. It is fine to ignore the error marked \"State set to CONNECTED but already in that state\".","title":"Tips"},{"location":"data-manager/","text":"Data Manager \u00b6","title":"Data Manager"},{"location":"data-manager/#data-manager","text":"","title":"Data Manager"},{"location":"data-manager/data-structure/","text":"Data Structure \u00b6 A Case is a Document in a CouchDB database. A Case consists of 4 other Entities: CaseEvent, EventForm, and Participant. A Case is described by its CaseDefinition. A CaseDefinition also contains CaseEvetnDefinition(s) that describe what CaseEvents can exist in a Case, EventFormDefinition(s) that define what EventForms can exist in what CaseEvents, and Roles that describe what kind of Participants can exist in a Case. Lastly, all EventForms relate to separate FormResponse Documents in the database. FormResponse Schema \u00b6 CaseDefinition Schema \u00b6 { // A unique string that will be used to refer to the CaseDefinition. \"id\" : \"case-type-1\" , // An ID of a Form listed in forms.json that will be used to store Case level variables. \"formId\" : \"case-type-1-manifest\" , ... } Case Schema \u00b6 { // A UUID generated by Tangerine to refer to the Case internal to Tangerine. Useful if Study IDs have collisions. \"id\" : \"00673b47-8452-4b4c-9597-5a56fe8a059c\" , // Because every Case is also a FormResponse, a Case includes top level form info you would find on a FormResponse. \"form\" : { // The ID of the FormResponse this Case relates to. Shoudl be the same as the related CaseDefinition's formId. \"id\" : \"case-type-1-manifest\" , ... }, // The related CaseDefinition's id property. \"caseDefinitionId\" : \"case-type-1\" , ... } CaseEventDefinition Schema \u00b6 CaseEvent Schema \u00b6 EventFormDefinition Schema \u00b6 EventForm Schema \u00b6","title":"Data Structure"},{"location":"data-manager/data-structure/#data-structure","text":"A Case is a Document in a CouchDB database. A Case consists of 4 other Entities: CaseEvent, EventForm, and Participant. A Case is described by its CaseDefinition. A CaseDefinition also contains CaseEvetnDefinition(s) that describe what CaseEvents can exist in a Case, EventFormDefinition(s) that define what EventForms can exist in what CaseEvents, and Roles that describe what kind of Participants can exist in a Case. Lastly, all EventForms relate to separate FormResponse Documents in the database.","title":"Data Structure"},{"location":"data-manager/data-structure/#formresponse-schema","text":"","title":"FormResponse Schema"},{"location":"data-manager/data-structure/#casedefinition-schema","text":"{ // A unique string that will be used to refer to the CaseDefinition. \"id\" : \"case-type-1\" , // An ID of a Form listed in forms.json that will be used to store Case level variables. \"formId\" : \"case-type-1-manifest\" , ... }","title":"CaseDefinition Schema"},{"location":"data-manager/data-structure/#case-schema","text":"{ // A UUID generated by Tangerine to refer to the Case internal to Tangerine. Useful if Study IDs have collisions. \"id\" : \"00673b47-8452-4b4c-9597-5a56fe8a059c\" , // Because every Case is also a FormResponse, a Case includes top level form info you would find on a FormResponse. \"form\" : { // The ID of the FormResponse this Case relates to. Shoudl be the same as the related CaseDefinition's formId. \"id\" : \"case-type-1-manifest\" , ... }, // The related CaseDefinition's id property. \"caseDefinitionId\" : \"case-type-1\" , ... }","title":"Case Schema"},{"location":"data-manager/data-structure/#caseeventdefinition-schema","text":"","title":"CaseEventDefinition Schema"},{"location":"data-manager/data-structure/#caseevent-schema","text":"","title":"CaseEvent Schema"},{"location":"data-manager/data-structure/#eventformdefinition-schema","text":"","title":"EventFormDefinition Schema"},{"location":"data-manager/data-structure/#eventform-schema","text":"","title":"EventForm Schema"},{"location":"data-manager/on-device-data-corrections/","text":"On Device Data Corrections using Issues \u00b6 Enable \"Allow Creation of Issues\" in your App Config for Devices and Data Collectors will be able to propose changes to data that has already been submitted. After the Data Collector syncs, Data Managers may view those proposals in the Issues UI in their corresponding group, then comment or choose to merge the issue. Note that Data Collectors on Devices are not shown the \"Merge\" button on Issues, thus is up to the Data Manager to review and merge any proposals for data corrections in Issues. Video Demo of configuration and usage Configuration \u00b6 To enable Devices to create Issues, add \"allowCreationOfIssues\": true to the group's client/app-config.json and release to Devices. To allow Devices to see Issues that have been created on the Device or been synced down to the Device, add \"showIssues\": true to the group's client/app-config.json and release to Devices. To template out the resulting Issue title and descriptions, add templateIssueTitle and templateIssueDescription to Case Definitions. Example template for Issue Title: Issue for ${caseService.getVariable('study_id')} (${caseService.getVariable('firstname')} ${caseService.getVariable('surname')}, ${caseService.getVariable('village')}) by ${userId}","title":"On Device Data Corrections using Issues"},{"location":"data-manager/on-device-data-corrections/#on-device-data-corrections-using-issues","text":"Enable \"Allow Creation of Issues\" in your App Config for Devices and Data Collectors will be able to propose changes to data that has already been submitted. After the Data Collector syncs, Data Managers may view those proposals in the Issues UI in their corresponding group, then comment or choose to merge the issue. Note that Data Collectors on Devices are not shown the \"Merge\" button on Issues, thus is up to the Data Manager to review and merge any proposals for data corrections in Issues. Video Demo of configuration and usage","title":"On Device Data Corrections using Issues"},{"location":"data-manager/on-device-data-corrections/#configuration","text":"To enable Devices to create Issues, add \"allowCreationOfIssues\": true to the group's client/app-config.json and release to Devices. To allow Devices to see Issues that have been created on the Device or been synced down to the Device, add \"showIssues\": true to the group's client/app-config.json and release to Devices. To template out the resulting Issue title and descriptions, add templateIssueTitle and templateIssueDescription to Case Definitions. Example template for Issue Title: Issue for ${caseService.getVariable('study_id')} (${caseService.getVariable('firstname')} ${caseService.getVariable('surname')}, ${caseService.getVariable('village')}) by ${userId}","title":"Configuration"},{"location":"developer/","text":"Developer Guide Contents \u00b6 Bullet points for Tangerine Development i18n-translation.md modules.md tangerine-dev-tutorial-notes.md Application design \u00b6 Bootstrapping Tangerine Viewing Forms and Form Data Supporting custom elements Tangerine Globals How Tangerine code is generated Debugging \u00b6 Creating Clean Development Content debugging-reporting.md debugging_node_apps.md Managing Deployments \u00b6 Upgrades Installing Multiple Tangerine apps on the same tablet Deleting Records Testing \u00b6 Load Testing Testing conflicts Developing Cordova Plugins \u00b6 cordova-plugin-development.md Tangerine Class Projects \u00b6 class-docs.md class-deletions.md Troubleshooting \u00b6 Docker Network Issues","title":"Developer Guide Contents"},{"location":"developer/#developer-guide-contents","text":"Bullet points for Tangerine Development i18n-translation.md modules.md tangerine-dev-tutorial-notes.md","title":"Developer Guide Contents"},{"location":"developer/#application-design","text":"Bootstrapping Tangerine Viewing Forms and Form Data Supporting custom elements Tangerine Globals How Tangerine code is generated","title":"Application design"},{"location":"developer/#debugging","text":"Creating Clean Development Content debugging-reporting.md debugging_node_apps.md","title":"Debugging"},{"location":"developer/#managing-deployments","text":"Upgrades Installing Multiple Tangerine apps on the same tablet Deleting Records","title":"Managing Deployments"},{"location":"developer/#testing","text":"Load Testing Testing conflicts","title":"Testing"},{"location":"developer/#developing-cordova-plugins","text":"cordova-plugin-development.md","title":"Developing Cordova Plugins"},{"location":"developer/#tangerine-class-projects","text":"class-docs.md class-deletions.md","title":"Tangerine Class Projects"},{"location":"developer/#troubleshooting","text":"Docker Network Issues","title":"Troubleshooting"},{"location":"developer/bootstrapping-tangerine/","text":"Bootstrapping Tangerine \u00b6 During a recent Angular 8 upgrade process, we had to change how Tangerine initializes. If Tangerine is running inside a Cordova app, it must wait until the 'deviceReady' event is emitted. Our earlier method of doing this in main.ts is no longer possible; therefore, we are intercepting the Service initialization process by using APP_INITIALIZER to pause the app while Cordova loads. Here is the relevant comit . For more information, view the Predefined tokens and multiple provider section in the Angular documentation.","title":"Bootstrapping Tangerine"},{"location":"developer/bootstrapping-tangerine/#bootstrapping-tangerine","text":"During a recent Angular 8 upgrade process, we had to change how Tangerine initializes. If Tangerine is running inside a Cordova app, it must wait until the 'deviceReady' event is emitted. Our earlier method of doing this in main.ts is no longer possible; therefore, we are intercepting the Service initialization process by using APP_INITIALIZER to pause the app while Cordova loads. Here is the relevant comit . For more information, view the Predefined tokens and multiple provider section in the Angular documentation.","title":"Bootstrapping Tangerine"},{"location":"developer/class-deletions/","text":"Deletions in Tangerine \u00b6 We're archiving records instead of deleting them in Tangerine by setting archive:true on the root of the doc and filtering queries by && !archive . Please note that vanilla Tangerine uses the archived flag.' For most queries, you simply must simply append && !archive to the query in order to ensure your views filter for the archive flag. Sample view that filters by archive: responsesByClassIdCurriculumId: { map: function (doc) { if (doc.hasOwnProperty('collection') && doc.collection === 'TangyFormResponse' && !doc.archive) { if (doc.hasOwnProperty('metadata') && doc.metadata.studentRegistrationDoc.classId) { // console.log(\"matching: \" + doc.metadata.studentRegistrationDoc.classId) emit([doc.metadata.studentRegistrationDoc.classId, doc.form.id], true); } } }.toString() }, Sample function to archive some records: async archiveStudent(column) { let studentId = column.id console.log(\"Archiving student:\" + studentId) let deleteConfirmed = confirm(_TRANSLATE(\"Delete this student?\")); if (deleteConfirmed) { try { let responses = await this.classViewService.getResponsesByStudentId(studentId) for (const response of responses as any[] ) { response.doc.archive = true; let lastModified = Date.now(); response.doc.lastModified = lastModified const archiveResult = await this.classViewService.saveResponse(response.doc) console.log(\"archiveResult: \" + archiveResult) } let result = await this.dashboardService.archiveStudentRegistration(studentId) console.log(\"result: \" + result) } catch (e) { console.log(\"Error deleting student: \" + e) return false; } } }","title":"Deletions in Tangerine"},{"location":"developer/class-deletions/#deletions-in-tangerine","text":"We're archiving records instead of deleting them in Tangerine by setting archive:true on the root of the doc and filtering queries by && !archive . Please note that vanilla Tangerine uses the archived flag.' For most queries, you simply must simply append && !archive to the query in order to ensure your views filter for the archive flag. Sample view that filters by archive: responsesByClassIdCurriculumId: { map: function (doc) { if (doc.hasOwnProperty('collection') && doc.collection === 'TangyFormResponse' && !doc.archive) { if (doc.hasOwnProperty('metadata') && doc.metadata.studentRegistrationDoc.classId) { // console.log(\"matching: \" + doc.metadata.studentRegistrationDoc.classId) emit([doc.metadata.studentRegistrationDoc.classId, doc.form.id], true); } } }.toString() }, Sample function to archive some records: async archiveStudent(column) { let studentId = column.id console.log(\"Archiving student:\" + studentId) let deleteConfirmed = confirm(_TRANSLATE(\"Delete this student?\")); if (deleteConfirmed) { try { let responses = await this.classViewService.getResponsesByStudentId(studentId) for (const response of responses as any[] ) { response.doc.archive = true; let lastModified = Date.now(); response.doc.lastModified = lastModified const archiveResult = await this.classViewService.saveResponse(response.doc) console.log(\"archiveResult: \" + archiveResult) } let result = await this.dashboardService.archiveStudentRegistration(studentId) console.log(\"result: \" + result) } catch (e) { console.log(\"Error deleting student: \" + e) return false; } } }","title":"Deletions in Tangerine"},{"location":"developer/class-docs/","text":"Getting Started \u00b6 How to get data out of a TangyFormResponse \u00b6 const studentRegistrationDoc = await dashboardService.getResponse(this.studentId); const srInputs = this.getInputValues(studentRegistrationDoc); getInputValues(doc) { let inputs = doc.items.reduce((acc, item) => [...acc, ...item.inputs], []) let obj = {} for (const el of inputs) { var attrs = inputs.attributes; for(let i = inputs.length - 1; i >= 0; i--) { obj[inputs[i].name] = inputs[i].value; } } console.log(\"obj: \" + JSON.stringify(obj)) return obj; }","title":"Getting Started"},{"location":"developer/class-docs/#getting-started","text":"","title":"Getting Started"},{"location":"developer/class-docs/#how-to-get-data-out-of-a-tangyformresponse","text":"const studentRegistrationDoc = await dashboardService.getResponse(this.studentId); const srInputs = this.getInputValues(studentRegistrationDoc); getInputValues(doc) { let inputs = doc.items.reduce((acc, item) => [...acc, ...item.inputs], []) let obj = {} for (const el of inputs) { var attrs = inputs.attributes; for(let i = inputs.length - 1; i >= 0; i--) { obj[inputs[i].name] = inputs[i].value; } } console.log(\"obj: \" + JSON.stringify(obj)) return obj; }","title":"How to get data out of a TangyFormResponse"},{"location":"developer/cordova-plugin-development/","text":"Cordova plugin development \u00b6 Getting started \u00b6 It is a lot easier to build a cordova plugin for Tangerine using a generic Cordova project instead of developing directly in Tangerine, because in Tangerine access to the actual client Cordova code is hidden away in /tangerine/client/builds/apk. So first use the cordova cli to generate a new project. Refreshing your new plugin in your Cordova project \u00b6 After making modifications to the plugin, rm and add the plugin and the cordova android platform before building. cordova plugin rm cordova - plugin - nearby - connections cordova platform rm android cordova platform add android @ 8 cordova plugin add .. / .. / Tangerine - Community / cordova - plugin - nearby - connections cordova build android Updating the cordova plugin inside Tangerine \u00b6 After your done the bulk of your Cordova development, you will need to modify the docker-tangerine-base-image to include the new plugin. After updating the base image, don't forget to update the Dockerfile. Sometimes you may need to view an update to the plugin but you don't want to go to the trouble of updating the base image. It is possible to work on the plugin code and then refresh the code in Tangerine. First you will need to share the source code with your docker instance Add the following to develop.sh: --volume $(pwd)/../cordova-plugin-nearby-connections:/tangerine/client/cordova-plugin-nearby-connections \\ Once your container has started, docker exec into it, and run the following: cd / tangerine / client / builds / apk cordova plugin rm cordova - plugin - nearby - connections cordova plugin add .. / .. / cordova - plugin - nearby - connections -- save Sometimes cordova can have issues with cleaning the build; here's a way to make sure you have the updated code: cd / tangerine / client / builds / apk cordova plugin rm cordova - plugin - nearby - connections cordova platform rm android cordova platform add android @ 8 cordova plugin add .. / .. / cordova - plugin - nearby - connections -- save cordova build android Updating Angular client code used in the APK \u00b6 IF you're developing Cordova plugins for Tangerine and make changes to the Angular client code that is displayed in the apk, you will need to refresh the apk build. Run the following code: cd / tangerine / client && \\ rm - rf builds / apk / www / shell && \\ rm - rf builds / pwa / release - uuid / app && \\ cp - r dev builds / apk / www / shell && \\ cp - r pwa - tools / updater - app / build / default builds / pwa && \\ cp - r dev builds / pwa / release - uuid / app Then generate the apk. To check if it worked, you can search for the new code in these files: vi builds / apk / www / shell / main . js vi builds / pwa / release - uuid / app / main . js T0 uninstall and re-install the apk: adb uninstall org . rti . tangerine adb install qa / apks / group - long - uuisd / platforms / android / app / build / outputs / apk / debug / app - debug . apk","title":"Cordova plugin development"},{"location":"developer/cordova-plugin-development/#cordova-plugin-development","text":"","title":"Cordova plugin development"},{"location":"developer/cordova-plugin-development/#getting-started","text":"It is a lot easier to build a cordova plugin for Tangerine using a generic Cordova project instead of developing directly in Tangerine, because in Tangerine access to the actual client Cordova code is hidden away in /tangerine/client/builds/apk. So first use the cordova cli to generate a new project.","title":"Getting started"},{"location":"developer/cordova-plugin-development/#refreshing-your-new-plugin-in-your-cordova-project","text":"After making modifications to the plugin, rm and add the plugin and the cordova android platform before building. cordova plugin rm cordova - plugin - nearby - connections cordova platform rm android cordova platform add android @ 8 cordova plugin add .. / .. / Tangerine - Community / cordova - plugin - nearby - connections cordova build android","title":"Refreshing your new plugin in your Cordova project"},{"location":"developer/cordova-plugin-development/#updating-the-cordova-plugin-inside-tangerine","text":"After your done the bulk of your Cordova development, you will need to modify the docker-tangerine-base-image to include the new plugin. After updating the base image, don't forget to update the Dockerfile. Sometimes you may need to view an update to the plugin but you don't want to go to the trouble of updating the base image. It is possible to work on the plugin code and then refresh the code in Tangerine. First you will need to share the source code with your docker instance Add the following to develop.sh: --volume $(pwd)/../cordova-plugin-nearby-connections:/tangerine/client/cordova-plugin-nearby-connections \\ Once your container has started, docker exec into it, and run the following: cd / tangerine / client / builds / apk cordova plugin rm cordova - plugin - nearby - connections cordova plugin add .. / .. / cordova - plugin - nearby - connections -- save Sometimes cordova can have issues with cleaning the build; here's a way to make sure you have the updated code: cd / tangerine / client / builds / apk cordova plugin rm cordova - plugin - nearby - connections cordova platform rm android cordova platform add android @ 8 cordova plugin add .. / .. / cordova - plugin - nearby - connections -- save cordova build android","title":"Updating the cordova plugin inside Tangerine"},{"location":"developer/cordova-plugin-development/#updating-angular-client-code-used-in-the-apk","text":"IF you're developing Cordova plugins for Tangerine and make changes to the Angular client code that is displayed in the apk, you will need to refresh the apk build. Run the following code: cd / tangerine / client && \\ rm - rf builds / apk / www / shell && \\ rm - rf builds / pwa / release - uuid / app && \\ cp - r dev builds / apk / www / shell && \\ cp - r pwa - tools / updater - app / build / default builds / pwa && \\ cp - r dev builds / pwa / release - uuid / app Then generate the apk. To check if it worked, you can search for the new code in these files: vi builds / apk / www / shell / main . js vi builds / pwa / release - uuid / app / main . js T0 uninstall and re-install the apk: adb uninstall org . rti . tangerine adb install qa / apks / group - long - uuisd / platforms / android / app / build / outputs / apk / debug / app - debug . apk","title":"Updating Angular client code used in the APK"},{"location":"developer/creating-clean-dev-content/","text":"Creating Clean Development Content \u00b6 If you are trying to fix an issue, it is helpful to begin development using content that is known to support common Tangerine features. This can be more reliable than using a project's content because that content may have missing forms that create bugs that have nothing to do with the issue you are trying to resolve. The create-group command to the rescue! The following command downloads a content set known to support common Tangerine features and is used for load-testing. Notice that it is a github repo; therefore, you may clone it and modify at will. docker exec tangerine create-group \"New Group C\" https://github.com/rjsteinert/tangerine-content-set-test.git There is also support for creating a group using local content from the content-sets directory' in the Tangerine repository. Currently, there is support for creating a case-module: docker exec tangerine create-group \"New Group D\" case-module You may also configure how inputs are populated by custom functions; see the Case generation section in the Load testing doc . If you add --help to the create-group command you may see other options as well. docker exec tangerine create-group --help To see more examples, check out the demo video from the v3.10.0 release.","title":"Creating clean dev content"},{"location":"developer/creating-clean-dev-content/#creating-clean-development-content","text":"If you are trying to fix an issue, it is helpful to begin development using content that is known to support common Tangerine features. This can be more reliable than using a project's content because that content may have missing forms that create bugs that have nothing to do with the issue you are trying to resolve. The create-group command to the rescue! The following command downloads a content set known to support common Tangerine features and is used for load-testing. Notice that it is a github repo; therefore, you may clone it and modify at will. docker exec tangerine create-group \"New Group C\" https://github.com/rjsteinert/tangerine-content-set-test.git There is also support for creating a group using local content from the content-sets directory' in the Tangerine repository. Currently, there is support for creating a case-module: docker exec tangerine create-group \"New Group D\" case-module You may also configure how inputs are populated by custom functions; see the Case generation section in the Load testing doc . If you add --help to the create-group command you may see other options as well. docker exec tangerine create-group --help To see more examples, check out the demo video from the v3.10.0 release.","title":"Creating Clean Development Content"},{"location":"developer/debugging-reporting/","text":"Debugging the Reporting Cache process \u00b6 Summary of steps: Turn on reporting modules in config.sh . Run develop.sh. Create a group. Generate data. Stop the keep alive for reporting worker by commenting out this.keepAliveReportingWorker() in server/src/app.service.ts . Enter the container on command line with docker exec -it tangerine bash . Clear reporting cache with command reporting-cache-clear . Run a batch with debugger enabled by running command node --inspect-brk=0.0.0.0:9228 $(which reporting-worker-batch) . Latch onto debugging session using Chrome inspect. You may need to click \"configure\" and add localhost:9228 to \"Target discovery settings\". Instructions \u00b6 Configure your project to use the CSV and Logstash modules: T_MODULES=\"['csv', 'logstash']\" Start the development environment... ./develop.sh Create a group called foo in the GUI. Then open ./server/src/app.service.ts and comment out the call to this.keepAliveReportingWorker() . It's important to do these two things in this order otherwise the group could be disconnected from reporting. \"exec\" into the container and note how foo has been added to the /reporting-worker-state.json file. docker exec -it tangerine bash cat /reporting-worker-state.json Seed the foo group with 100 form responses. docker exec tangerine generate-uploads 100 foo Clear the cache ```shell script docker exec tangerine reporting-cache-clear If you get the error message 'Waiting for current reporting worker to stop...', you must exec into the container and remove the semaphore: ```shell script rm /reporting-worker-running and then run reporting-cache-clear again. Start the reporting-worker-batch.js batch process manually and check for errors ```shell script node --inspect-brk=0.0.0.0:9228 $(which reporting-worker-batch) In Chrome, go to `chrome://inspect`, click `Configure...`, and add `127.0.0.1:9228` as an entry in \"Target discovery settings\". ## Debugging Demo https://www.youtube.com/watch?v=AToUBoApw8E&feature=youtu.be Now manually trigger a batch. After the command finishes, verify the batch by checking `http://localhost:5984/_utils/#database/foo-reporting/_all_docs`. node --inspect-brk=0.0.0.0:9228 $(which reporting-worker-batch) There will be only 15 docs in your reporting db because that is the batch size. Although Tangerine in develop.sh mode runs node in a debugger process, you must launch a separate node process to debug the batch reporting worker. If no errors occurred, copy the temporary state to the current state. cp /reporting-worker-state.json_tmp /reporting-worker-state.json Keep repeating to continue processing... cat /reporting-worker-state.json | /tangerine/serversrc/scripts/reporting-worker-batch.js | tee /reporting-worker-state.json_tmp cp /reporting-worker-state.json_tmp /reporting-worker-state.json If you would like to debug, add the `--inspect-brk=0.0.0.0:9227` option to the `run-worker.js` command. cat /reporting-worker-state.json | node --inspect-brk=0.0.0.0:9227 /tangerine/server/src/scripts/reporting-worker-batch.js | tee /reporting-worker-state.json_tmp When you run that command, it will wait on the first line of the script for a debugger to connect to it. In Chrome, go to `chrome://inspect`, click `Configure...`, and add `127.0.0.1:9227` as an entry in \"Target discovery settings\". Now back to the `chrome://inspect` page and you will find under the `Remote Target #127.0.0.1` group, a new target has been discovered called `/tangerine/server/reporting/run-worker.js`. Click `inspect` and now you should be able to set breakpoints and walk through the code. You may not be able to set breakpoints in all files so use \"step into\" and the `debugger` keyword to get the debugger to the focus you want. If you want to keep the cache worker running, use watch. watch -n 1 \"cat /reporting-worker-state.json | node /tangerine/server/reporting/run-worker.js | tee /.reporting-worker-state.json | json_pp && cp /.reporting-worker-state.json /reporting-worker-state.json\" If you need to clear a reporting cache, don't simply delete the reporting db. Use reporting-cache-clear You typically need to remove the semaphore before running reporting-cache-clear, especially if there was a crash rm /reporting-worker-running ## A typical report debugging workflow: Remember to setup config.sh properly! (Make sure T_MODULES=\"['csv','logstash']\") Comment out keepAliveReportingWorker in /server/src/app.service.ts. Remember to add `127.0.0.1:9228` as an entry in \"Target discovery settings\" in chrome://inspect/#devices You may need to add `debugger` before the line of code you wish to debug. docker exec into your container docker exec -it tangerine bash Then you'll typically need to rm the reporting-worker-running - it keeps reporting-cache-clear from running if a previous debug session crashed. rm /reporting-worker-running reporting-cache-clear node --inspect-brk=0.0.0.0:9228 $(which reporting-worker-batch) Switch back to Chrome, open `chrome://inspect`. The debugger will be the session that looks like this: Target /usr/local/bin/reporting-worker-batch file:///tangerine/server/src/scripts/reporting-worker-batch.js Inspect ``` When it launches, it will wait on the first line of the script for a debugger to connect to it. Click F8 to run. If all is right and good in this world, it will stop at your debugger statement. When the batch has completed, your debugger window will close.","title":"Debugging reporting"},{"location":"developer/debugging-reporting/#debugging-the-reporting-cache-process","text":"Summary of steps: Turn on reporting modules in config.sh . Run develop.sh. Create a group. Generate data. Stop the keep alive for reporting worker by commenting out this.keepAliveReportingWorker() in server/src/app.service.ts . Enter the container on command line with docker exec -it tangerine bash . Clear reporting cache with command reporting-cache-clear . Run a batch with debugger enabled by running command node --inspect-brk=0.0.0.0:9228 $(which reporting-worker-batch) . Latch onto debugging session using Chrome inspect. You may need to click \"configure\" and add localhost:9228 to \"Target discovery settings\".","title":"Debugging the Reporting Cache process"},{"location":"developer/debugging-reporting/#instructions","text":"Configure your project to use the CSV and Logstash modules: T_MODULES=\"['csv', 'logstash']\" Start the development environment... ./develop.sh Create a group called foo in the GUI. Then open ./server/src/app.service.ts and comment out the call to this.keepAliveReportingWorker() . It's important to do these two things in this order otherwise the group could be disconnected from reporting. \"exec\" into the container and note how foo has been added to the /reporting-worker-state.json file. docker exec -it tangerine bash cat /reporting-worker-state.json Seed the foo group with 100 form responses. docker exec tangerine generate-uploads 100 foo Clear the cache ```shell script docker exec tangerine reporting-cache-clear If you get the error message 'Waiting for current reporting worker to stop...', you must exec into the container and remove the semaphore: ```shell script rm /reporting-worker-running and then run reporting-cache-clear again. Start the reporting-worker-batch.js batch process manually and check for errors ```shell script node --inspect-brk=0.0.0.0:9228 $(which reporting-worker-batch) In Chrome, go to `chrome://inspect`, click `Configure...`, and add `127.0.0.1:9228` as an entry in \"Target discovery settings\". ## Debugging Demo https://www.youtube.com/watch?v=AToUBoApw8E&feature=youtu.be Now manually trigger a batch. After the command finishes, verify the batch by checking `http://localhost:5984/_utils/#database/foo-reporting/_all_docs`. node --inspect-brk=0.0.0.0:9228 $(which reporting-worker-batch) There will be only 15 docs in your reporting db because that is the batch size. Although Tangerine in develop.sh mode runs node in a debugger process, you must launch a separate node process to debug the batch reporting worker. If no errors occurred, copy the temporary state to the current state. cp /reporting-worker-state.json_tmp /reporting-worker-state.json Keep repeating to continue processing... cat /reporting-worker-state.json | /tangerine/serversrc/scripts/reporting-worker-batch.js | tee /reporting-worker-state.json_tmp cp /reporting-worker-state.json_tmp /reporting-worker-state.json If you would like to debug, add the `--inspect-brk=0.0.0.0:9227` option to the `run-worker.js` command. cat /reporting-worker-state.json | node --inspect-brk=0.0.0.0:9227 /tangerine/server/src/scripts/reporting-worker-batch.js | tee /reporting-worker-state.json_tmp When you run that command, it will wait on the first line of the script for a debugger to connect to it. In Chrome, go to `chrome://inspect`, click `Configure...`, and add `127.0.0.1:9227` as an entry in \"Target discovery settings\". Now back to the `chrome://inspect` page and you will find under the `Remote Target #127.0.0.1` group, a new target has been discovered called `/tangerine/server/reporting/run-worker.js`. Click `inspect` and now you should be able to set breakpoints and walk through the code. You may not be able to set breakpoints in all files so use \"step into\" and the `debugger` keyword to get the debugger to the focus you want. If you want to keep the cache worker running, use watch. watch -n 1 \"cat /reporting-worker-state.json | node /tangerine/server/reporting/run-worker.js | tee /.reporting-worker-state.json | json_pp && cp /.reporting-worker-state.json /reporting-worker-state.json\" If you need to clear a reporting cache, don't simply delete the reporting db. Use reporting-cache-clear You typically need to remove the semaphore before running reporting-cache-clear, especially if there was a crash rm /reporting-worker-running ## A typical report debugging workflow: Remember to setup config.sh properly! (Make sure T_MODULES=\"['csv','logstash']\") Comment out keepAliveReportingWorker in /server/src/app.service.ts. Remember to add `127.0.0.1:9228` as an entry in \"Target discovery settings\" in chrome://inspect/#devices You may need to add `debugger` before the line of code you wish to debug. docker exec into your container docker exec -it tangerine bash Then you'll typically need to rm the reporting-worker-running - it keeps reporting-cache-clear from running if a previous debug session crashed. rm /reporting-worker-running reporting-cache-clear node --inspect-brk=0.0.0.0:9228 $(which reporting-worker-batch) Switch back to Chrome, open `chrome://inspect`. The debugger will be the session that looks like this: Target /usr/local/bin/reporting-worker-batch file:///tangerine/server/src/scripts/reporting-worker-batch.js Inspect ``` When it launches, it will wait on the first line of the script for a debugger to connect to it. Click F8 to run. If all is right and good in this world, it will stop at your debugger statement. When the batch has completed, your debugger window will close.","title":"Instructions"},{"location":"developer/debugging_node_apps/","text":"In develop.sh, the port 9229 should be opend. docker run \\ -d \\ --name tangerine-container \\ -p 80:80 -p 5984:5984 -p 9229:9229 \\ --env \"DEBUG=1\" \\ --env \"NODE_ENV=development\" \\ etc... Add the folloiwng to your node process: --inspect=[::]:9229 index.js for example, reporting/shart.sh: nodemon --inspect=[::]:9229 index.js using the leh* db for testing workflow csv generation http://localhost/app/group-leh_wi_lan_pilot_2018/index.html#assessments","title":"Debugging node apps"},{"location":"developer/deletion-strategy/","text":"Deletion Strategy \u00b6 Introduction: \u00b6 To delete a case in Editor, click the \"Trashcan\" button to the right of the case ID in the \"breadcrumbs\" area at the top of the case document. This adds archived:true to the case document as well as all eventForm responses for the case. The client search index code filters out docs with the archived:true flag. Once you start using this deletion feature, create an update using the following code: await window [ 'T' ]. search . createIndex () await userDb . query ( 'search' , { limit : 1 }) This code will rebuild the index on client in order to return the correct results when running a search on a tablet that already has data collected on it. Deleting a record in Tangerine manually on the server \u00b6 When using this manual method, deletions on the client do not follow deletions on the server. Open the document in Fauxton. Click the \"Delete\" button on the right hand side of the header to delete. This will create a bare-bones document that includes the _deleted\" flag. By default, deleted docs are not included in replication; however, there is a way to query them (see below). Testing deletions \u00b6 When you open a new case on client, don't enter any data, but click next. The app does create a case and it can be sync'd. Although the case does not display in the case home search results on client, this record does get output on the server via CSV export. When you use the Delete button in Fauxton, it removes all data except for this tombstone: { \"_id\" : \"6c27f5c8-6e08-4245-ae57-cef7d63099de\" , \"_rev\" : \"2-28819102bb2ec0e3390f28d94467212a\" , \"_deleted\" : true } When the client syncs, it does not get this new rev. Viewing deletions: \u00b6 curl -X POST -H \"content-Type: application/json\" \"http://admin:password@localhost:5984/group-2627a0a7-852a-4f51-9d5d-b7ae53130976/_changes?filter=_selector\" -d '{\"selector\": {\"_deleted\": true}}' response: { \"results\" : [ { \"seq\" : \"16-g1AAAAIBeJyVz0sOgjAQBuABjI-FZ9AjUJpaXMlNtC8CBNuFutab6E30JnqTWh4J0UQDm5nkz8yXmRIAplkgYa6NNlIl2mTmcCxd7DPgC2ttkQVsvHfBhIRrgST5Hv6xzpeu8k0reLWgMBacx32FpBK2reDXAltRRGLcV9hVwvlDEDiKKev7hR65ChfXHHLtFIIICzkdpNwa5d4pVDIs0mG3PBrlWSlQK5HCKUJIwuykpUpzreRf4dUItmBe8QYjK50u\" , \"id\" : \"6c27f5c8-6e08-4245-ae57-cef7d63099de\" , \"changes\" : [ { \"rev\" : \"2-28819102bb2ec0e3390f28d94467212a\" } ], \"deleted\" : true } ], \"last_seq\" : \"20-g1AAAAIfeJyV0F0OgjAMAOAp_j54Bj0CY5mDJ7mJbusIEtwe1Ge9id5Eb6I3wTFIiBoNvLRJ035pmyOEJqkHaKaNNqBibVKzP-S23OdIzIuiyFKPj3a2MKZ-JDHQz-Yf42Jho1jVQs8JihApRNhWiEthXQt9J_AlwzQkbYVNKZzeBEmCkPG2V-iBjehsk0UujUIx5b5gnZRrpdwahQEnMum2y71SHqWCnBIokmCMAU2PGlSy1Qr-Cs9KcD8ZOiEBSUX09dXsBf6mphA\" , \"pending\" : 0 } To get deleted doc, use the rev: http://localhost:5984/group-2627a0a7-852a-4f51-9d5d-b7ae53130976/6c27f5c8-6e08-4245-ae57-cef7d63099de?rev=2-28819102bb2ec0e3390f28d94467212a How to create deletions on client \u00b6 Potential steps: - Use the _changes example above to get a list of deleted docs on the server. - Process the results and use the pouchdb remove function on each doc/rev. Restoring deleted documents \u00b6 Using couchdb-wedge \u00b6 Using the restore-deleted-doc command from couchdb-wedge, we can give it a URL, db, and docId to restore. npm install -g couchdb-wedge wedge restore-deleted-doc --url http://username:password@source-server.com:5984 --db my-db --docId 1234 Using curl \u00b6 Get the revs for the deleted doc: curl -H 'Accept: application/json' 'http://server:5984/group-uuid-devices/6013f414-6401-4903-b0f9-fb862779cc3f?revs=true&open_revs=all' Command returns: { \"_id\" : \"6013f414-6401-4903-b0f9-fb862779cc3f\" , \"_rev\" : \"4-46fb2d064595bb6b2068b20450f2a3f9\" , \"_deleted\" : true , \"_revisions\" : { \"start\" : 4 , \"ids\" : [ \"46fb2d064595bb6b2068b20450f2a3f9\" , \"59e68396a5b632f62e3ab3930dda3d45\" , \"09463546fcf1177408821fccada40269\" , \"e3af953eab52ed5f3d56c9f57fdeb2f9\" ] } } Get the previous rev id by subtracting 1 from the _revisions.start property and appending the value of the second element in the _revisions.id array: Result should be 3-59e68396a5b632f62e3ab3930dda3d45 Now query the server for that _rev: http://server/group-uuid-devices/6013f414-6401-4903-b0f9-fb862779cc3f?rev=3-59e68396a5b632f62e3ab3930dda3d45 To overwrite the old deleted entry you have to post or put back the document with the correct id and the latest revision number (not the pre delete revision number, but the revision number the document has now it has been deleted). An easier way to do this is to use the COPY command: curl -X COPY \"server:5984/group-uuid-devices/6013f414-6401-4903-b0f9-fb862779cc3f?rev=3-59e68396a5b632f62e3ab3930dda3d45\" -H \"Destination: 6013f414-6401-4903-b0f9-fb862779cc3f\"","title":"Deletion Strategy"},{"location":"developer/deletion-strategy/#deletion-strategy","text":"","title":"Deletion Strategy"},{"location":"developer/deletion-strategy/#introduction","text":"To delete a case in Editor, click the \"Trashcan\" button to the right of the case ID in the \"breadcrumbs\" area at the top of the case document. This adds archived:true to the case document as well as all eventForm responses for the case. The client search index code filters out docs with the archived:true flag. Once you start using this deletion feature, create an update using the following code: await window [ 'T' ]. search . createIndex () await userDb . query ( 'search' , { limit : 1 }) This code will rebuild the index on client in order to return the correct results when running a search on a tablet that already has data collected on it.","title":"Introduction:"},{"location":"developer/deletion-strategy/#deleting-a-record-in-tangerine-manually-on-the-server","text":"When using this manual method, deletions on the client do not follow deletions on the server. Open the document in Fauxton. Click the \"Delete\" button on the right hand side of the header to delete. This will create a bare-bones document that includes the _deleted\" flag. By default, deleted docs are not included in replication; however, there is a way to query them (see below).","title":"Deleting a record in Tangerine manually on the server"},{"location":"developer/deletion-strategy/#testing-deletions","text":"When you open a new case on client, don't enter any data, but click next. The app does create a case and it can be sync'd. Although the case does not display in the case home search results on client, this record does get output on the server via CSV export. When you use the Delete button in Fauxton, it removes all data except for this tombstone: { \"_id\" : \"6c27f5c8-6e08-4245-ae57-cef7d63099de\" , \"_rev\" : \"2-28819102bb2ec0e3390f28d94467212a\" , \"_deleted\" : true } When the client syncs, it does not get this new rev.","title":"Testing deletions"},{"location":"developer/deletion-strategy/#viewing-deletions","text":"curl -X POST -H \"content-Type: application/json\" \"http://admin:password@localhost:5984/group-2627a0a7-852a-4f51-9d5d-b7ae53130976/_changes?filter=_selector\" -d '{\"selector\": {\"_deleted\": true}}' response: { \"results\" : [ { \"seq\" : \"16-g1AAAAIBeJyVz0sOgjAQBuABjI-FZ9AjUJpaXMlNtC8CBNuFutab6E30JnqTWh4J0UQDm5nkz8yXmRIAplkgYa6NNlIl2mTmcCxd7DPgC2ttkQVsvHfBhIRrgST5Hv6xzpeu8k0reLWgMBacx32FpBK2reDXAltRRGLcV9hVwvlDEDiKKev7hR65ChfXHHLtFIIICzkdpNwa5d4pVDIs0mG3PBrlWSlQK5HCKUJIwuykpUpzreRf4dUItmBe8QYjK50u\" , \"id\" : \"6c27f5c8-6e08-4245-ae57-cef7d63099de\" , \"changes\" : [ { \"rev\" : \"2-28819102bb2ec0e3390f28d94467212a\" } ], \"deleted\" : true } ], \"last_seq\" : \"20-g1AAAAIfeJyV0F0OgjAMAOAp_j54Bj0CY5mDJ7mJbusIEtwe1Ge9id5Eb6I3wTFIiBoNvLRJ035pmyOEJqkHaKaNNqBibVKzP-S23OdIzIuiyFKPj3a2MKZ-JDHQz-Yf42Jho1jVQs8JihApRNhWiEthXQt9J_AlwzQkbYVNKZzeBEmCkPG2V-iBjehsk0UujUIx5b5gnZRrpdwahQEnMum2y71SHqWCnBIokmCMAU2PGlSy1Qr-Cs9KcD8ZOiEBSUX09dXsBf6mphA\" , \"pending\" : 0 } To get deleted doc, use the rev: http://localhost:5984/group-2627a0a7-852a-4f51-9d5d-b7ae53130976/6c27f5c8-6e08-4245-ae57-cef7d63099de?rev=2-28819102bb2ec0e3390f28d94467212a","title":"Viewing deletions:"},{"location":"developer/deletion-strategy/#how-to-create-deletions-on-client","text":"Potential steps: - Use the _changes example above to get a list of deleted docs on the server. - Process the results and use the pouchdb remove function on each doc/rev.","title":"How to create deletions on client"},{"location":"developer/deletion-strategy/#restoring-deleted-documents","text":"","title":"Restoring deleted documents"},{"location":"developer/deletion-strategy/#using-couchdb-wedge","text":"Using the restore-deleted-doc command from couchdb-wedge, we can give it a URL, db, and docId to restore. npm install -g couchdb-wedge wedge restore-deleted-doc --url http://username:password@source-server.com:5984 --db my-db --docId 1234","title":"Using couchdb-wedge"},{"location":"developer/deletion-strategy/#using-curl","text":"Get the revs for the deleted doc: curl -H 'Accept: application/json' 'http://server:5984/group-uuid-devices/6013f414-6401-4903-b0f9-fb862779cc3f?revs=true&open_revs=all' Command returns: { \"_id\" : \"6013f414-6401-4903-b0f9-fb862779cc3f\" , \"_rev\" : \"4-46fb2d064595bb6b2068b20450f2a3f9\" , \"_deleted\" : true , \"_revisions\" : { \"start\" : 4 , \"ids\" : [ \"46fb2d064595bb6b2068b20450f2a3f9\" , \"59e68396a5b632f62e3ab3930dda3d45\" , \"09463546fcf1177408821fccada40269\" , \"e3af953eab52ed5f3d56c9f57fdeb2f9\" ] } } Get the previous rev id by subtracting 1 from the _revisions.start property and appending the value of the second element in the _revisions.id array: Result should be 3-59e68396a5b632f62e3ab3930dda3d45 Now query the server for that _rev: http://server/group-uuid-devices/6013f414-6401-4903-b0f9-fb862779cc3f?rev=3-59e68396a5b632f62e3ab3930dda3d45 To overwrite the old deleted entry you have to post or put back the document with the correct id and the latest revision number (not the pre delete revision number, but the revision number the document has now it has been deleted). An easier way to do this is to use the COPY command: curl -X COPY \"server:5984/group-uuid-devices/6013f414-6401-4903-b0f9-fb862779cc3f?rev=3-59e68396a5b632f62e3ab3930dda3d45\" -H \"Destination: 6013f414-6401-4903-b0f9-fb862779cc3f\"","title":"Using curl"},{"location":"developer/development-bullet-points/","text":"Bullet points for Tangerine Development \u00b6 Here are my steps when developing for Tangerine: - Launch ngrok.io to provide https in front of the app. - Check settings in config.sh: o T_HOST_NAME='SOME-NAME.ngrok.io' \u2013 this is critical for sync to work. I don\u2019t think PWA\u2019s work w/ IP addresses - must have a domain name. o T_MODULES=\"['csv','sync-protocol-2, case']\" - Launch Tangerine in developer mode: ./develop.sh - Once it is up, drop to console and do the following to get a docker console: docker exec -it tangerine bash - Create a new group: docker exec tangerine create-group \"New Group D\" case-module - Here is a doc on creating a basic case module group which users sync protocol 2, which has the bi-directional syncing/user mgmt.: https://docs.tangerinecentral.org/developer/creating-clean-dev-content/ - Create a tablet user at Deploy -> Device Users - While you\u2019re in there, go to Deploy -> Devices and create a device. - Go to your Tangerine instance using the URL you configured in T_HOST_NAME. Go to the new group you just created and release a PWA: o Go to \u201cRelease Offline App\u201d. In Web Browser Installation, select \u201cGenerate Test Release\u201d. o Click \u201c Release PWA\u201d button. Copy the url it displays once it has generated the PWA. It should generate the PWA using the T_HOST_NAME. - In Chrome, enter a new Profile (makes life easier when testing\u2026) and paste the URL for the PWA. - In the Device Setup , choose \u201cno\u201d for the Device QR code to scan\u201d. Switch to your Tangerine app, go to Deploy -> Devices and edit the device you created earlier and copy the device ID and Token. - Once it is setup, login w/ admin or the user you created. - To generate cases, look at the Case generation page: https://docs.tangerinecentral.org/developer/load-testing/ o Don\u2019t worry about the substitutions part, just crank out some cases, substituting your group name (something like group-98e646c1-77e5-45ef-8a19-31501c2142a3) for GROUP-UUID below: o docker exec tangerine generate-cases 10 GROUP-UUID o After generating cases, sync! Troubleshooting \u00b6 If you have problems, check the app-config. File in the group you created. It is at tangerine/data/groups/group-4de0b30c-1c90-4efd-8dcf-e83527109038/client/app-config.json. In the group I setup on the server: \"serverUrl\": https://project.server.org/ PWA\u2019s won\u2019t work for that because I no longer have a load balancer setup nor DNS pointing to that instance. So if things are flaky on the groups you generate, this is a good thing to check. Also check the config.sh for the T_HOST_NAME as noted above. To confirm your config.sh settings are correct, your group\u2019s app-config.json should have: \"syncProtocol\":\"2\",\" \"homeUrl\":\"case-home\", \"serverUrl\": https://SERVER.nkgrok.io/","title":"Bullet points for Tangerine Development"},{"location":"developer/development-bullet-points/#bullet-points-for-tangerine-development","text":"Here are my steps when developing for Tangerine: - Launch ngrok.io to provide https in front of the app. - Check settings in config.sh: o T_HOST_NAME='SOME-NAME.ngrok.io' \u2013 this is critical for sync to work. I don\u2019t think PWA\u2019s work w/ IP addresses - must have a domain name. o T_MODULES=\"['csv','sync-protocol-2, case']\" - Launch Tangerine in developer mode: ./develop.sh - Once it is up, drop to console and do the following to get a docker console: docker exec -it tangerine bash - Create a new group: docker exec tangerine create-group \"New Group D\" case-module - Here is a doc on creating a basic case module group which users sync protocol 2, which has the bi-directional syncing/user mgmt.: https://docs.tangerinecentral.org/developer/creating-clean-dev-content/ - Create a tablet user at Deploy -> Device Users - While you\u2019re in there, go to Deploy -> Devices and create a device. - Go to your Tangerine instance using the URL you configured in T_HOST_NAME. Go to the new group you just created and release a PWA: o Go to \u201cRelease Offline App\u201d. In Web Browser Installation, select \u201cGenerate Test Release\u201d. o Click \u201c Release PWA\u201d button. Copy the url it displays once it has generated the PWA. It should generate the PWA using the T_HOST_NAME. - In Chrome, enter a new Profile (makes life easier when testing\u2026) and paste the URL for the PWA. - In the Device Setup , choose \u201cno\u201d for the Device QR code to scan\u201d. Switch to your Tangerine app, go to Deploy -> Devices and edit the device you created earlier and copy the device ID and Token. - Once it is setup, login w/ admin or the user you created. - To generate cases, look at the Case generation page: https://docs.tangerinecentral.org/developer/load-testing/ o Don\u2019t worry about the substitutions part, just crank out some cases, substituting your group name (something like group-98e646c1-77e5-45ef-8a19-31501c2142a3) for GROUP-UUID below: o docker exec tangerine generate-cases 10 GROUP-UUID o After generating cases, sync!","title":"Bullet points for Tangerine Development"},{"location":"developer/development-bullet-points/#troubleshooting","text":"If you have problems, check the app-config. File in the group you created. It is at tangerine/data/groups/group-4de0b30c-1c90-4efd-8dcf-e83527109038/client/app-config.json. In the group I setup on the server: \"serverUrl\": https://project.server.org/ PWA\u2019s won\u2019t work for that because I no longer have a load balancer setup nor DNS pointing to that instance. So if things are flaky on the groups you generate, this is a good thing to check. Also check the config.sh for the T_HOST_NAME as noted above. To confirm your config.sh settings are correct, your group\u2019s app-config.json should have: \"syncProtocol\":\"2\",\" \"homeUrl\":\"case-home\", \"serverUrl\": https://SERVER.nkgrok.io/","title":"Troubleshooting"},{"location":"developer/docker-network-issues/","text":"Docker Network Issues \u00b6 Overview \u00b6 If you develop behind a corporate firewall, you may run into issues when building Tangerine from the Dockerfile relating to network access to file resources. Why would this happen? - Your corporate network may use the same ports as the virtual private network that docker creates. - Your local DNS may may configured to use an internal corporate DNS which causes resolution problems when offline. If you experience these problems, add the following switches to your docker config file: \"default-address-pools\" : [ { \"base\" : \"172.80.0.0/16\" , \"size\" : 24 }, { \"base\" : \"172.90.0.0/16\" , \"size\" : 24 } ], \"dns\" : [ \"75.75.75.75\" , \"8.8.8.8\" ] Background \u00b6 Networking \u00b6 Error: bower polymer#^2.0.0 ECMDERR Failed to execute \"git ls-remote --tags --heads https://github.com/Polymer/polymer.git\", exit code of #128 fatal: unable to access 'https://github.com/Polymer/polymer.git/': gnutls_handshake() failed: The TLS connection was non-properly terminated. Additional error details: fatal: unable to access 'https://github.com/Polymer/polymer.git/': gnutls_handshake() failed: The TLS connection was non-properly terminated. Quoting correspondence with a colleague: \"Docker creates bridge networks on the set of ranges 172.[17-31].0.0/16 (and some others) by default. If a server had a Docker network on 172.19.0.0/16, it could receive traffic from the VPN, but it would send its response to the bridge network, where it wouldn\u2019t go anywhere.\" Fortunately, we can change the default address pools for Docker networks by changing the configuration for the Docker daemon: https://github.com/moby/moby/pull/36396 I\u2019m setting ours to the default address example in that pull request:\" \"default-address-pools\" : [ { \"base\" : \"172.80.0.0/16\" , \"size\" : 24 }, { \"base\" : \"172.90.0.0/16\" , \"size\" : 24 } ] DNS \u00b6 Error: request to https://registry.npmjs.org/@vaadin/vaadin-usage-statistics/-/vaadin-usage-statistics-2.1.0.tgz failed, reason: getaddrinfo EAI_AGAIN registry.npmjs.org registry.npmjs.org:443 I think this is where I found this solution: https://github.com/npm/npm/issues/16661 So, I needed to configure the docker DNS config. The first item is my local ISP (Comcast_ DNS server, the second is Google\u2019s.) \"dns\": [ \"75.75.75.75\", \"8.8.8.8\" ] Change them to your needs. Anyway, the good news is that with both the default-address-pools and dns properties in my docker config, my build works both connected and disconnected to the RTI VPN.","title":"Docker Network Issues"},{"location":"developer/docker-network-issues/#docker-network-issues","text":"","title":"Docker Network Issues"},{"location":"developer/docker-network-issues/#overview","text":"If you develop behind a corporate firewall, you may run into issues when building Tangerine from the Dockerfile relating to network access to file resources. Why would this happen? - Your corporate network may use the same ports as the virtual private network that docker creates. - Your local DNS may may configured to use an internal corporate DNS which causes resolution problems when offline. If you experience these problems, add the following switches to your docker config file: \"default-address-pools\" : [ { \"base\" : \"172.80.0.0/16\" , \"size\" : 24 }, { \"base\" : \"172.90.0.0/16\" , \"size\" : 24 } ], \"dns\" : [ \"75.75.75.75\" , \"8.8.8.8\" ]","title":"Overview"},{"location":"developer/docker-network-issues/#background","text":"","title":"Background"},{"location":"developer/docker-network-issues/#networking","text":"Error: bower polymer#^2.0.0 ECMDERR Failed to execute \"git ls-remote --tags --heads https://github.com/Polymer/polymer.git\", exit code of #128 fatal: unable to access 'https://github.com/Polymer/polymer.git/': gnutls_handshake() failed: The TLS connection was non-properly terminated. Additional error details: fatal: unable to access 'https://github.com/Polymer/polymer.git/': gnutls_handshake() failed: The TLS connection was non-properly terminated. Quoting correspondence with a colleague: \"Docker creates bridge networks on the set of ranges 172.[17-31].0.0/16 (and some others) by default. If a server had a Docker network on 172.19.0.0/16, it could receive traffic from the VPN, but it would send its response to the bridge network, where it wouldn\u2019t go anywhere.\" Fortunately, we can change the default address pools for Docker networks by changing the configuration for the Docker daemon: https://github.com/moby/moby/pull/36396 I\u2019m setting ours to the default address example in that pull request:\" \"default-address-pools\" : [ { \"base\" : \"172.80.0.0/16\" , \"size\" : 24 }, { \"base\" : \"172.90.0.0/16\" , \"size\" : 24 } ]","title":"Networking"},{"location":"developer/docker-network-issues/#dns","text":"Error: request to https://registry.npmjs.org/@vaadin/vaadin-usage-statistics/-/vaadin-usage-statistics-2.1.0.tgz failed, reason: getaddrinfo EAI_AGAIN registry.npmjs.org registry.npmjs.org:443 I think this is where I found this solution: https://github.com/npm/npm/issues/16661 So, I needed to configure the docker DNS config. The first item is my local ISP (Comcast_ DNS server, the second is Google\u2019s.) \"dns\": [ \"75.75.75.75\", \"8.8.8.8\" ] Change them to your needs. Anyway, the good news is that with both the default-address-pools and dns properties in my docker config, my build works both connected and disconnected to the RTI VPN.","title":"DNS"},{"location":"developer/how-tangerine-is-built/","text":"How Tangerine code is generated \u00b6 When the develop.sh script is run, the Dockerfile builds tangerine into dist/tangerine-client and copies the built code into builds/apk/www/shell and builds/pwa/release-uuid/app. Building files \u00b6 When Dockerfile is complete, it runs entrypoint-development.sh and watches for changes, sending its output to the dev directory: ./node_modules/.bin/ng build --watch --poll 100 --base-href ./ --output-path ./dev Copy files \u00b6 If you need to make an apk using the updated code, run the following script: cd / tangerine / client && \\ rm - rf builds / apk / www / shell && \\ rm - rf builds / pwa / release - uuid / app && \\ cp - r dev builds / apk / www / shell && \\ cp - r pwa - tools / updater - app / build / default builds / pwa && \\ cp - r dev builds / pwa / release - uuid / app Potential workflow after updating a lib \u00b6 In this workflow, you're testing changes to a library such as tangy-form. Make these changes inside the container in the node_modules directory for your library. Run ./node_modules/.bin/ng build --base-href ./ --output-path ./dev inside the client dir in the container. It will rebuild all of the libs. (Note that each time you run the ng build script above it removes the dev directory before building. This may cause problems when you try to list files in that directory. Do a cd .. & cd dev & ls -ls and all will be good.) Next, run the script in the \"Copy files\" section to copy these generated build files to the correct location. If this part of the chain is working, then check the output of the file copy process. If all is good, release a new APK from the Tangerine UI. Tips \u00b6 The release-apk.sh script shows the steps when building an APK.","title":"How Tangerine code is generated"},{"location":"developer/how-tangerine-is-built/#how-tangerine-code-is-generated","text":"When the develop.sh script is run, the Dockerfile builds tangerine into dist/tangerine-client and copies the built code into builds/apk/www/shell and builds/pwa/release-uuid/app.","title":"How Tangerine code is generated"},{"location":"developer/how-tangerine-is-built/#building-files","text":"When Dockerfile is complete, it runs entrypoint-development.sh and watches for changes, sending its output to the dev directory: ./node_modules/.bin/ng build --watch --poll 100 --base-href ./ --output-path ./dev","title":"Building files"},{"location":"developer/how-tangerine-is-built/#copy-files","text":"If you need to make an apk using the updated code, run the following script: cd / tangerine / client && \\ rm - rf builds / apk / www / shell && \\ rm - rf builds / pwa / release - uuid / app && \\ cp - r dev builds / apk / www / shell && \\ cp - r pwa - tools / updater - app / build / default builds / pwa && \\ cp - r dev builds / pwa / release - uuid / app","title":"Copy files"},{"location":"developer/how-tangerine-is-built/#potential-workflow-after-updating-a-lib","text":"In this workflow, you're testing changes to a library such as tangy-form. Make these changes inside the container in the node_modules directory for your library. Run ./node_modules/.bin/ng build --base-href ./ --output-path ./dev inside the client dir in the container. It will rebuild all of the libs. (Note that each time you run the ng build script above it removes the dev directory before building. This may cause problems when you try to list files in that directory. Do a cd .. & cd dev & ls -ls and all will be good.) Next, run the script in the \"Copy files\" section to copy these generated build files to the correct location. If this part of the chain is working, then check the output of the file copy process. If all is good, release a new APK from the Tangerine UI.","title":"Potential workflow after updating a lib"},{"location":"developer/how-tangerine-is-built/#tips","text":"The release-apk.sh script shows the steps when building an APK.","title":"Tips"},{"location":"developer/i18n-translation/","text":"i18n/Translation \u00b6 In Tangerine there are two kinds of translations, content translations and application translations. Content translations are embedded in form content by Editor Users using <t-lang> tags, while application translations are embedded in application level code using the t function in Web Components, _TRANSLATE function in an Angular TS file, or translate pipe in Angular component templates. Content Translations \u00b6 Translations for specific languages are embedded in content, thus portable and specific to that content. The <t-lang> component ( https://github.com/ICTatRTI/translation-web-component ) is used to detect the language assigned to the HTML doc. In the following example, the label on the hello input will be \"Hello\" if English is set as the language, \"Bonjour\" if French is selected as the language. <tangy-input name=\"hello\" label=\" <t-lang en>Hello</t-lang> <t-lang fr>Bonjour</t-lang> \" > </tangy-input> Application Translations \u00b6 In application code, instead of placing inline translations, a centrally managed JSON file is sourced for replacing strings. At ./client/default-assets/translation.fr.json you will find the JSON file use for translations when the French language is selected. { \"Accuracy\": \"Pr\u00e9cision\", \"Accuracy Level\": \"Niveau de pr\u00e9cision\", \"Add New User\": \"Ajouter un nouvel utilisateur\", \"Add User to Group\": \"Ajouter un utilisateur \u00e0 un groupe\", ... } You'll also find the Russian translation at ./client/default-assets/translation.ru.json . { \"Accuracy\": \"\u0410\u043a\u043a\u0443\u0440\u0430\u0442\u043d\u043e\u0441\u0442\u044c\", \"Accuracy Level\": \"\u0423\u0440\u043e\u0432\u0435\u043d\u044c \u0430\u043a\u043a\u0443\u0440\u0430\u0442\u043d\u043e\u0441\u0442\u0438\", \"Add New User\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043d\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\", \"Add User to Group\": \"Add User to Group\", ... } And many more. Each file defines an object where the keys are what to replace in the application and the values are what to replace strings with for that language. Depending on where in the application the string is, there are different techniques for exposing a string to translation. In Web Components libraries such as <tangy-form> and <tangy-form-editor> , they use a special t function. Translating strings in template literals looks like... this.shadowRoot.innerHTML = ` <h1> ${t('Hello')} </h1> ... ` Often times Polymer templates are used which won't let you embed functions. In that case, in connectedCallback a this.t object is assembled and then used in the Polymer template. connectedCallback() { super.connectedCallback() this.t = { hello: t(\"Hello\") } } template() { return html` [[t.hello]] ` } In Angular Components, the translate pipe is available in templates and _TRANSLATE function for translating in TS files outside of templates. <h1> {{'Hello'|translate}} </h1> const helloString = _TRANSLATE('Hello') Other notes \u00b6 Mat-pagination needs a special service to enable use of translation.json - see class/_services/mat-pagination-intl.service.ts Right to left languages (RTL) \u00b6 Mat-menu does not support RTL out of the box, but it's simple to get it working: add dir=\"rtl\" to its enclosing element. <span dir=\"rtl\">&nbsp;&nbsp;&nbsp; <button mat-button [matMenuTriggerFor]=\"reportsMenu\" class=\"mat-button\">{{'Select Report'|translate}}</button> <mat-menu #reportsMenu=\"matMenu\"> <button mat-menu-item [matMenuTriggerFor]=\"groupingMenu\">Class grouping</button> </mat-menu> <mat-menu #groupingMenu=\"matMenu\"> <button mat-menu-item *ngFor=\"let item of formList\" routerLink=\"/reports/{{item.id}}/{{item.classId}}\">{{item.title}}</button> </mat-menu> </span> mat-table also needs some twekas to work - Css: .mat-column-Name { padding-right:5px; } th.mat-header-cell { text-align: right; }","title":"i18n/Translation"},{"location":"developer/i18n-translation/#i18ntranslation","text":"In Tangerine there are two kinds of translations, content translations and application translations. Content translations are embedded in form content by Editor Users using <t-lang> tags, while application translations are embedded in application level code using the t function in Web Components, _TRANSLATE function in an Angular TS file, or translate pipe in Angular component templates.","title":"i18n/Translation"},{"location":"developer/i18n-translation/#content-translations","text":"Translations for specific languages are embedded in content, thus portable and specific to that content. The <t-lang> component ( https://github.com/ICTatRTI/translation-web-component ) is used to detect the language assigned to the HTML doc. In the following example, the label on the hello input will be \"Hello\" if English is set as the language, \"Bonjour\" if French is selected as the language. <tangy-input name=\"hello\" label=\" <t-lang en>Hello</t-lang> <t-lang fr>Bonjour</t-lang> \" > </tangy-input>","title":"Content Translations"},{"location":"developer/i18n-translation/#application-translations","text":"In application code, instead of placing inline translations, a centrally managed JSON file is sourced for replacing strings. At ./client/default-assets/translation.fr.json you will find the JSON file use for translations when the French language is selected. { \"Accuracy\": \"Pr\u00e9cision\", \"Accuracy Level\": \"Niveau de pr\u00e9cision\", \"Add New User\": \"Ajouter un nouvel utilisateur\", \"Add User to Group\": \"Ajouter un utilisateur \u00e0 un groupe\", ... } You'll also find the Russian translation at ./client/default-assets/translation.ru.json . { \"Accuracy\": \"\u0410\u043a\u043a\u0443\u0440\u0430\u0442\u043d\u043e\u0441\u0442\u044c\", \"Accuracy Level\": \"\u0423\u0440\u043e\u0432\u0435\u043d\u044c \u0430\u043a\u043a\u0443\u0440\u0430\u0442\u043d\u043e\u0441\u0442\u0438\", \"Add New User\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043d\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\", \"Add User to Group\": \"Add User to Group\", ... } And many more. Each file defines an object where the keys are what to replace in the application and the values are what to replace strings with for that language. Depending on where in the application the string is, there are different techniques for exposing a string to translation. In Web Components libraries such as <tangy-form> and <tangy-form-editor> , they use a special t function. Translating strings in template literals looks like... this.shadowRoot.innerHTML = ` <h1> ${t('Hello')} </h1> ... ` Often times Polymer templates are used which won't let you embed functions. In that case, in connectedCallback a this.t object is assembled and then used in the Polymer template. connectedCallback() { super.connectedCallback() this.t = { hello: t(\"Hello\") } } template() { return html` [[t.hello]] ` } In Angular Components, the translate pipe is available in templates and _TRANSLATE function for translating in TS files outside of templates. <h1> {{'Hello'|translate}} </h1> const helloString = _TRANSLATE('Hello')","title":"Application Translations"},{"location":"developer/i18n-translation/#other-notes","text":"Mat-pagination needs a special service to enable use of translation.json - see class/_services/mat-pagination-intl.service.ts","title":"Other notes"},{"location":"developer/i18n-translation/#right-to-left-languages-rtl","text":"Mat-menu does not support RTL out of the box, but it's simple to get it working: add dir=\"rtl\" to its enclosing element. <span dir=\"rtl\">&nbsp;&nbsp;&nbsp; <button mat-button [matMenuTriggerFor]=\"reportsMenu\" class=\"mat-button\">{{'Select Report'|translate}}</button> <mat-menu #reportsMenu=\"matMenu\"> <button mat-menu-item [matMenuTriggerFor]=\"groupingMenu\">Class grouping</button> </mat-menu> <mat-menu #groupingMenu=\"matMenu\"> <button mat-menu-item *ngFor=\"let item of formList\" routerLink=\"/reports/{{item.id}}/{{item.classId}}\">{{item.title}}</button> </mat-menu> </span> mat-table also needs some twekas to work - Css: .mat-column-Name { padding-right:5px; } th.mat-header-cell { text-align: right; }","title":"Right to left languages (RTL)"},{"location":"developer/install-multiple-apks-config/","text":"Installing Multiple Tangerine apps on the same tablet \u00b6 To install more than one Tangerine app on a tablet, you must configure the packageName and appName properties in the group's app-config.json. \"packageName\" : \"org.rti.tangerine.custom\" , \"appName\" : \"Custom\" Using these properties would create an APK with the package name org.rti.tangerine.custom. The icon to launch the app would display \"Custom\". When uninstalling the app, you would use the updated package name: shell script adb uninstall org.rti.tangerine.custom If you don't add these properties, the defaults are: - PACKAGENAME = \"org.rti.tangerine\" - APPNAME = \"Tangerine\"","title":"Installing Multiple Tangerine apps on the same tablet"},{"location":"developer/install-multiple-apks-config/#installing-multiple-tangerine-apps-on-the-same-tablet","text":"To install more than one Tangerine app on a tablet, you must configure the packageName and appName properties in the group's app-config.json. \"packageName\" : \"org.rti.tangerine.custom\" , \"appName\" : \"Custom\" Using these properties would create an APK with the package name org.rti.tangerine.custom. The icon to launch the app would display \"Custom\". When uninstalling the app, you would use the updated package name: shell script adb uninstall org.rti.tangerine.custom If you don't add these properties, the defaults are: - PACKAGENAME = \"org.rti.tangerine\" - APPNAME = \"Tangerine\"","title":"Installing Multiple Tangerine apps on the same tablet"},{"location":"developer/load-testing/","text":"Load testing \u00b6 Client-side testing \u00b6 Generate a PWA. Go to any case record and enter the following in the js console: this . caseService . generateCases ( 1 ) You may change the number of cases generated. It uses the current case as a template for the generated cases. TODO: Use the case-export.json in the group. You can check how many docs are in the db with: this . userService . getSharedDBDocCount () Select \"Sync Online\" to test syncing a large recordset. Server-side generation \u00b6 One may populate a vanilla Tangerine instance with records using the cli: docker exec tangerine generate-uploads 500 group-uuid 2000 100 That command generates 500 sets (each of which has 2 records) in batches of 100, posted every 2000 ms. Each doc are generated from templates in server/src/scripts/generate-uploads. Add the 'class' switch to the end of that command will generate a studentRegistrationDoc in addition to the other 2 docs. (Read server/src/scripts/generate-uploads/bin.js for more details.) You may need to modify the templates to suit the docs you wish to generate. Case generation \u00b6 You may create a group for testing using the create-group command. See the creating clean dev conntent doc for more information. There is a case-module option that creates generic case forms. You may also use your own custom group forms. Case generation uses a case-export.json file placed in the group directory as the template for record generation. To create this json file, generate a PWA and create a new case. While viewing the case, open the javascript console and use the copy(await this.caseService.export()) command to copy the json. Then paste this data into a case-export.json file. Please note that some groups, such as those created by the case-module mentioned earlier, already have a case-export.json file; however, you may be testing for different scenarios so feel free to create your own. Create or modify the custom-generators.js file if you have different variable substitutions. This file exports: - customGenerators: An object that has custom functions you may define - customSubstitutions: An array of substitutions. Here is an example of substitutions: const substitutions = [ { \"type\" : \"caseDoc\" }, { \"type\" : \"demoDoc\" , \"formId\" : \"registration-role-1\" , \"substitutions\" : { \"first_name\" : { \"functionName\" : \"firstname\" , \"runOnce\" : \"perCase\" }, \"last_name\" : { \"functionName\" : \"surname\" , \"runOnce\" : \"perCase\" }, \"consent\" : { \"functionName\" : \"yes_no\" , \"runOnce\" : false } } } ] In this example, there are two files that can have variable substitution: - caseDoc - This is the case manifest, which has the doc.type === 'case'. No substitutions are listed for this doc. - demoDoc - This is the demographics form that corresponds to the formId, which is \"registration-role-1\" in the example. Since the current case-module example does not have any substitutions happening in the caseDoc inputs, there are no entries for substitutions in it. The demoDoc does have substitutions. The substitutions are key/value pairs. The substitutions key is the variable name of the input you wish to substitute, and the substitutions value is an object that may declare several properties: - functionName: how the function is called - runOnce: if the function is executed when the script is initialized per case, or when each doc is generated. the pre-built randomised field you wish to substitute. In this example, first_name is being populated by the firstname function, which is run when each case is generated. Case generation also performs other types of randomization. Here are some examples: - firstname: Randomises a female first name - surname: Randomizes a last name - tangerineModifiedOn: Today's date, offet by the running tally of docs being generated. The time is similarly offset. - day: day part of tangerineModifiedOn, padded with 0 if needed. - month: month part of tangerineModifiedOn, padded with 0 if needed. - year: year part of tangerineModifiedOn. - date: year + '-' + month + '-' + day; - participant_id: Random number under 1000000. - participantUuid: A UUID. Before generating cases, create a device registration in order to properly generate a location property in the generated docs. When setting location, case generation uses the first doc in the group's devices database. If you don't have one, sync won't work properly. Case generation will fail if there are no device registrations. To generate cases, use the following docker command: docker exec tangerine generate-cases 1 group-uuid This would generate one case. Change the number to generate more. Clean things up \u00b6 To delete all generated records (but keep the views), use bulkdelete .","title":"Load testing"},{"location":"developer/load-testing/#load-testing","text":"","title":"Load testing"},{"location":"developer/load-testing/#client-side-testing","text":"Generate a PWA. Go to any case record and enter the following in the js console: this . caseService . generateCases ( 1 ) You may change the number of cases generated. It uses the current case as a template for the generated cases. TODO: Use the case-export.json in the group. You can check how many docs are in the db with: this . userService . getSharedDBDocCount () Select \"Sync Online\" to test syncing a large recordset.","title":"Client-side testing"},{"location":"developer/load-testing/#server-side-generation","text":"One may populate a vanilla Tangerine instance with records using the cli: docker exec tangerine generate-uploads 500 group-uuid 2000 100 That command generates 500 sets (each of which has 2 records) in batches of 100, posted every 2000 ms. Each doc are generated from templates in server/src/scripts/generate-uploads. Add the 'class' switch to the end of that command will generate a studentRegistrationDoc in addition to the other 2 docs. (Read server/src/scripts/generate-uploads/bin.js for more details.) You may need to modify the templates to suit the docs you wish to generate.","title":"Server-side generation"},{"location":"developer/load-testing/#case-generation","text":"You may create a group for testing using the create-group command. See the creating clean dev conntent doc for more information. There is a case-module option that creates generic case forms. You may also use your own custom group forms. Case generation uses a case-export.json file placed in the group directory as the template for record generation. To create this json file, generate a PWA and create a new case. While viewing the case, open the javascript console and use the copy(await this.caseService.export()) command to copy the json. Then paste this data into a case-export.json file. Please note that some groups, such as those created by the case-module mentioned earlier, already have a case-export.json file; however, you may be testing for different scenarios so feel free to create your own. Create or modify the custom-generators.js file if you have different variable substitutions. This file exports: - customGenerators: An object that has custom functions you may define - customSubstitutions: An array of substitutions. Here is an example of substitutions: const substitutions = [ { \"type\" : \"caseDoc\" }, { \"type\" : \"demoDoc\" , \"formId\" : \"registration-role-1\" , \"substitutions\" : { \"first_name\" : { \"functionName\" : \"firstname\" , \"runOnce\" : \"perCase\" }, \"last_name\" : { \"functionName\" : \"surname\" , \"runOnce\" : \"perCase\" }, \"consent\" : { \"functionName\" : \"yes_no\" , \"runOnce\" : false } } } ] In this example, there are two files that can have variable substitution: - caseDoc - This is the case manifest, which has the doc.type === 'case'. No substitutions are listed for this doc. - demoDoc - This is the demographics form that corresponds to the formId, which is \"registration-role-1\" in the example. Since the current case-module example does not have any substitutions happening in the caseDoc inputs, there are no entries for substitutions in it. The demoDoc does have substitutions. The substitutions are key/value pairs. The substitutions key is the variable name of the input you wish to substitute, and the substitutions value is an object that may declare several properties: - functionName: how the function is called - runOnce: if the function is executed when the script is initialized per case, or when each doc is generated. the pre-built randomised field you wish to substitute. In this example, first_name is being populated by the firstname function, which is run when each case is generated. Case generation also performs other types of randomization. Here are some examples: - firstname: Randomises a female first name - surname: Randomizes a last name - tangerineModifiedOn: Today's date, offet by the running tally of docs being generated. The time is similarly offset. - day: day part of tangerineModifiedOn, padded with 0 if needed. - month: month part of tangerineModifiedOn, padded with 0 if needed. - year: year part of tangerineModifiedOn. - date: year + '-' + month + '-' + day; - participant_id: Random number under 1000000. - participantUuid: A UUID. Before generating cases, create a device registration in order to properly generate a location property in the generated docs. When setting location, case generation uses the first doc in the group's devices database. If you don't have one, sync won't work properly. Case generation will fail if there are no device registrations. To generate cases, use the following docker command: docker exec tangerine generate-cases 1 group-uuid This would generate one case. Change the number to generate more.","title":"Case generation"},{"location":"developer/load-testing/#clean-things-up","text":"To delete all generated records (but keep the views), use bulkdelete .","title":"Clean things up"},{"location":"developer/modules/","text":"Tangy Modules \u00b6 Modules provide additional features to Tangerine, such as: - automatically add forms to the client when a new group is created (via groupNew hook) - data transformation for reporting (via flatFormResponse hook) Modules: - Class Steps to add a module - Create an index.js file inside server/src/modules/moduleName using the sample below as a guide. - Implement any relevant hooks. Available hooks: - flatFormResponse - groupNew - declareAppRoutes - clearReportingCache - reportingOutputs - Forms that need to be copied over to the client should be placed in server/src/modules/moduleName. Activating modules \u00b6 Add the module name to T_MODULES in config.sh. When a new group is created, the modules listed in T_MODULES will be added to the new group's app-config.json. T_MODULES=\"['csv','sync-protocol-2','synapse','case']\" If you need to add a module to an existing group, modify the modules property in app-config.json/ \"modules\" : [ \"csv\" ], Example module index.js \u00b6 This example from the class module implements the flatFormResponse and groupNew hooks: ``` const clog = require('tangy-log').clog const fs = require('fs-extra') module.exports = { hooks: { flatFormResponse: function(data) { return new Promise((resolve, reject) => { debugger; let formResponse = data.formResponse let flatFormResponse = data.flatFormResponse if (formResponse.metadata && formResponse.metadata.studentRegistrationDoc && formResponse.metadata.studentRegistrationDoc.classId) { let studentRegistrationDoc = formResponse.metadata.studentRegistrationDoc flatFormResponse[ sr_classId ] = studentRegistrationDoc.classId; flatFormResponse[ sr_student_name ] = studentRegistrationDoc.student_name; flatFormResponse[ sr_student_id ] = studentRegistrationDoc.id; flatFormResponse[ sr_age ] = studentRegistrationDoc.age; flatFormResponse[ sr_gender ] = studentRegistrationDoc.gender; } resolve({flatFormResponse, formResponse}) }) }, groupNew: function(data) { return new Promise(async (resolve, reject) => { const {groupName, appConfig} = data clog(\"Setting homeUrl to dashboard and uploadUnlockedFormReponses to true.\") appConfig.homeUrl = \"dashboard\" appConfig.uploadUnlockedFormReponses = true // copy the class forms try { await fs.copy('/tangerine/server/src/modules/class/', /tangerine/client/content/groups/${groupName} ) clog(\"Copied class module forms.\") } catch (err) { console.error(err) } resolve(data) }) }, } } ``` This code will be automatically run when the TangyModules (server/src/modules/index.js) is run. Hooks \u00b6 Example: const data = await tangyModules.hook('groupNew', {groupName, appConfig})","title":"Tangy Modules"},{"location":"developer/modules/#tangy-modules","text":"Modules provide additional features to Tangerine, such as: - automatically add forms to the client when a new group is created (via groupNew hook) - data transformation for reporting (via flatFormResponse hook) Modules: - Class Steps to add a module - Create an index.js file inside server/src/modules/moduleName using the sample below as a guide. - Implement any relevant hooks. Available hooks: - flatFormResponse - groupNew - declareAppRoutes - clearReportingCache - reportingOutputs - Forms that need to be copied over to the client should be placed in server/src/modules/moduleName.","title":"Tangy Modules"},{"location":"developer/modules/#activating-modules","text":"Add the module name to T_MODULES in config.sh. When a new group is created, the modules listed in T_MODULES will be added to the new group's app-config.json. T_MODULES=\"['csv','sync-protocol-2','synapse','case']\" If you need to add a module to an existing group, modify the modules property in app-config.json/ \"modules\" : [ \"csv\" ],","title":"Activating modules"},{"location":"developer/modules/#example-module-indexjs","text":"This example from the class module implements the flatFormResponse and groupNew hooks: ``` const clog = require('tangy-log').clog const fs = require('fs-extra') module.exports = { hooks: { flatFormResponse: function(data) { return new Promise((resolve, reject) => { debugger; let formResponse = data.formResponse let flatFormResponse = data.flatFormResponse if (formResponse.metadata && formResponse.metadata.studentRegistrationDoc && formResponse.metadata.studentRegistrationDoc.classId) { let studentRegistrationDoc = formResponse.metadata.studentRegistrationDoc flatFormResponse[ sr_classId ] = studentRegistrationDoc.classId; flatFormResponse[ sr_student_name ] = studentRegistrationDoc.student_name; flatFormResponse[ sr_student_id ] = studentRegistrationDoc.id; flatFormResponse[ sr_age ] = studentRegistrationDoc.age; flatFormResponse[ sr_gender ] = studentRegistrationDoc.gender; } resolve({flatFormResponse, formResponse}) }) }, groupNew: function(data) { return new Promise(async (resolve, reject) => { const {groupName, appConfig} = data clog(\"Setting homeUrl to dashboard and uploadUnlockedFormReponses to true.\") appConfig.homeUrl = \"dashboard\" appConfig.uploadUnlockedFormReponses = true // copy the class forms try { await fs.copy('/tangerine/server/src/modules/class/', /tangerine/client/content/groups/${groupName} ) clog(\"Copied class module forms.\") } catch (err) { console.error(err) } resolve(data) }) }, } } ``` This code will be automatically run when the TangyModules (server/src/modules/index.js) is run.","title":"Example module index.js"},{"location":"developer/modules/#hooks","text":"Example: const data = await tangyModules.hook('groupNew', {groupName, appConfig})","title":"Hooks"},{"location":"developer/reporting-mango-tips/","text":"Tips for making queries for Reports using Mango \u00b6 Mango is a query language available to Couchdb based upon MongoDB. General info about Mango: \u00b6 https://pouchdb.com/guides/mango-queries.html https://docs.couchdb.org/en/stable/api/database/find.html https://github.com/cloudant/mango Some things to watch out for: \u00b6 Sorting \u00b6 Add the key you're sorting upon - in the following case, it is tangerineModifiedOn - to the index: await createIndex({ index: { fields: [ 'type', 'status', 'tangerineModifiedOn' ] } }) $or and $ne \u00b6 Mango abandons the indexes and does live queries, which can cause the query to fail. For $ne you can do a partial filter to improve performance. Here is a good discussion of the issue w/ these Mango expressions: https://stackoverflow.com/a/41897093 Here is an example of this issue in Tangerine: #2367 Example lifted from the Couch doc on Partial Indexes: To improve response times, we can create an index which excludes documents where \"status\": { \"$ne\": \"archived\" } at index time using the \"partial_filter_selector\" field: { \"index\": { \"partial_filter_selector\": { \"status\": { \"$ne\": \"Open\" } }, \"fields\": [\"type\", \"status\", \"tangerineModifiedOn\"] }, \"ddoc\" : \"type-not-open\", \"type\" : \"json\" }","title":"Tips for making queries for Reports using Mango"},{"location":"developer/reporting-mango-tips/#tips-for-making-queries-for-reports-using-mango","text":"Mango is a query language available to Couchdb based upon MongoDB.","title":"Tips for making queries for Reports using Mango"},{"location":"developer/reporting-mango-tips/#general-info-about-mango","text":"https://pouchdb.com/guides/mango-queries.html https://docs.couchdb.org/en/stable/api/database/find.html https://github.com/cloudant/mango","title":"General info about Mango:"},{"location":"developer/reporting-mango-tips/#some-things-to-watch-out-for","text":"","title":"Some things to watch out for:"},{"location":"developer/reporting-mango-tips/#sorting","text":"Add the key you're sorting upon - in the following case, it is tangerineModifiedOn - to the index: await createIndex({ index: { fields: [ 'type', 'status', 'tangerineModifiedOn' ] } })","title":"Sorting"},{"location":"developer/reporting-mango-tips/#or-and-ne","text":"Mango abandons the indexes and does live queries, which can cause the query to fail. For $ne you can do a partial filter to improve performance. Here is a good discussion of the issue w/ these Mango expressions: https://stackoverflow.com/a/41897093 Here is an example of this issue in Tangerine: #2367 Example lifted from the Couch doc on Partial Indexes: To improve response times, we can create an index which excludes documents where \"status\": { \"$ne\": \"archived\" } at index time using the \"partial_filter_selector\" field: { \"index\": { \"partial_filter_selector\": { \"status\": { \"$ne\": \"Open\" } }, \"fields\": [\"type\", \"status\", \"tangerineModifiedOn\"] }, \"ddoc\" : \"type-not-open\", \"type\" : \"json\" }","title":"$or and $ne"},{"location":"developer/supporting-custom-elements/","text":"Supporting custom elements and external libs \u00b6 Adding new elements \u00b6 To add a new custom element or to add support for new polymer or other web components, you must make them accessible to Angular: - add to package.json - import into polyfills You also need to add CUSTOM_ELEMENTS_SCHEMA to your module to support custom tags in your templates: schemas : [ CUSTOM_ELEMENTS_SCHEMA ], Manual imports \u00b6 Some libs need to be imported manually because they are not available as ES6 modules. Add the lib using a script tag - < script src = \"./libs/plotly-latest.min.js\" ></ script > and then add to angular.json: \"assets\" : [ \"src/libs/plotly-latest.min.js\" ] Resolving incompatibilities \u00b6 The \"skipLibCheck\": true switch in tscondig.json will causes type checking of declaration files (files with extension .d.ts) to be skipped. ( Stack Overflow discussion ) If you run into an error such as ERROR in node_modules/tangy-form/tangy-form-response-model.d.ts:18:17 - error TS1039: Initializers are not allowed in ambient contexts. this switch may be useful to getting the app to compile. We decided to not use it - simply removing it worked fine - but if it's a choice between the app compiling or not, it's worth using.","title":"Supporting custom elements and external libs"},{"location":"developer/supporting-custom-elements/#supporting-custom-elements-and-external-libs","text":"","title":"Supporting custom elements and external libs"},{"location":"developer/supporting-custom-elements/#adding-new-elements","text":"To add a new custom element or to add support for new polymer or other web components, you must make them accessible to Angular: - add to package.json - import into polyfills You also need to add CUSTOM_ELEMENTS_SCHEMA to your module to support custom tags in your templates: schemas : [ CUSTOM_ELEMENTS_SCHEMA ],","title":"Adding new elements"},{"location":"developer/supporting-custom-elements/#manual-imports","text":"Some libs need to be imported manually because they are not available as ES6 modules. Add the lib using a script tag - < script src = \"./libs/plotly-latest.min.js\" ></ script > and then add to angular.json: \"assets\" : [ \"src/libs/plotly-latest.min.js\" ]","title":"Manual imports"},{"location":"developer/supporting-custom-elements/#resolving-incompatibilities","text":"The \"skipLibCheck\": true switch in tscondig.json will causes type checking of declaration files (files with extension .d.ts) to be skipped. ( Stack Overflow discussion ) If you run into an error such as ERROR in node_modules/tangy-form/tangy-form-response-model.d.ts:18:17 - error TS1039: Initializers are not allowed in ambient contexts. this switch may be useful to getting the app to compile. We decided to not use it - simply removing it worked fine - but if it's a choice between the app compiling or not, it's worth using.","title":"Resolving incompatibilities"},{"location":"developer/tangerine-dev-tutorial-notes/","text":"Commands \u00b6 Create group and generate case(es) \u00b6 docker exec tangerine create-group \"CM-1\" case -module docker exec tangerine generate-cases 1 group-09a2a880-1317-4cbf-b944-0fd059fa7007 Open docker shell \u00b6 docker exec -it tangerine bash Refresh code \u00b6 Run this inside tangerine docker shell cd /tangerine/client && rm -rf builds/apk/www/shell && rm -rf builds/pwa/release-uuid/app && cp -r dev builds/apk/www/shell && cp -r pwa-tools/updater-app/build/default builds/pwa && cp -r dev builds/pwa/release-uuid/app ADB commands \u00b6 adb devices adb install data/client/releases/prod/apks/group-09a2a880-1317-4cbf-b944-0fd059fa7007/platforms/android//app/build/outputs/apk/debug/app-debug.apk adb uninstall org.rti.tangerine","title":"Commands"},{"location":"developer/tangerine-dev-tutorial-notes/#commands","text":"","title":"Commands"},{"location":"developer/tangerine-dev-tutorial-notes/#create-group-and-generate-casees","text":"docker exec tangerine create-group \"CM-1\" case -module docker exec tangerine generate-cases 1 group-09a2a880-1317-4cbf-b944-0fd059fa7007","title":"Create group and generate case(es)"},{"location":"developer/tangerine-dev-tutorial-notes/#open-docker-shell","text":"docker exec -it tangerine bash","title":"Open docker shell"},{"location":"developer/tangerine-dev-tutorial-notes/#refresh-code","text":"Run this inside tangerine docker shell cd /tangerine/client && rm -rf builds/apk/www/shell && rm -rf builds/pwa/release-uuid/app && cp -r dev builds/apk/www/shell && cp -r pwa-tools/updater-app/build/default builds/pwa && cp -r dev builds/pwa/release-uuid/app","title":"Refresh code"},{"location":"developer/tangerine-dev-tutorial-notes/#adb-commands","text":"adb devices adb install data/client/releases/prod/apks/group-09a2a880-1317-4cbf-b944-0fd059fa7007/platforms/android//app/build/outputs/apk/debug/app-debug.apk adb uninstall org.rti.tangerine","title":"ADB commands"},{"location":"developer/tangerine-globals/","text":"Globals in Tangerine \u00b6 Globals in memory \u00b6 In-memory globals won't survive refreshing the browser. We are caching important configuration files (app-config.json, forms.json, location-list.json) to avoid having to keep fetching those docs from the db. Use the following code to take advantage of this caching: - await this.appConfigService.getLocationList(); - await this.tangyFormsInfoService.getFormsInfo(); - await this.appConfigService.getAppConfig; - await this.tangyFormService.getFormMarkup(this.eventFormDefinition.formId); CaseDefinitionsService also has implements of caseDefinitions, but that is not exposed publicly. More info in this PR: https://github.com/Tangerine-Community/Tangerine/pull/1991 Globals that are stored in a database \u00b6 Database variables will persist after page refreshes or app reboots. Use VariableService. Stores data in 'tangerine-variables' pouchdb as a key/value pair. The key is the _id in the doc. The value can be a string, JSON object, or any other data type that can be persisted in a pouchdb. await this . variableService . set ( 'tangerine-device-is-registered' , true ) await this . variableService . get ( 'tangerine-device-is-registered' ) Widely-used Configuration Variables \u00b6 Server \u00b6 They are not globals, but they are mighty useful. The TangerineConfigService provides variables set in config.sh. Expose it in your constructor: private readonly configService : TangerineConfigService , And then you may use it: const userOneUsername = this . configService . config (). userOneUsername Client \u00b6 Use await this.appConfigService.getAppConfig; to fetch app-config.json settings in client.","title":"Globals in Tangerine"},{"location":"developer/tangerine-globals/#globals-in-tangerine","text":"","title":"Globals in Tangerine"},{"location":"developer/tangerine-globals/#globals-in-memory","text":"In-memory globals won't survive refreshing the browser. We are caching important configuration files (app-config.json, forms.json, location-list.json) to avoid having to keep fetching those docs from the db. Use the following code to take advantage of this caching: - await this.appConfigService.getLocationList(); - await this.tangyFormsInfoService.getFormsInfo(); - await this.appConfigService.getAppConfig; - await this.tangyFormService.getFormMarkup(this.eventFormDefinition.formId); CaseDefinitionsService also has implements of caseDefinitions, but that is not exposed publicly. More info in this PR: https://github.com/Tangerine-Community/Tangerine/pull/1991","title":"Globals in memory"},{"location":"developer/tangerine-globals/#globals-that-are-stored-in-a-database","text":"Database variables will persist after page refreshes or app reboots. Use VariableService. Stores data in 'tangerine-variables' pouchdb as a key/value pair. The key is the _id in the doc. The value can be a string, JSON object, or any other data type that can be persisted in a pouchdb. await this . variableService . set ( 'tangerine-device-is-registered' , true ) await this . variableService . get ( 'tangerine-device-is-registered' )","title":"Globals that are stored in a database"},{"location":"developer/tangerine-globals/#widely-used-configuration-variables","text":"","title":"Widely-used Configuration Variables"},{"location":"developer/tangerine-globals/#server","text":"They are not globals, but they are mighty useful. The TangerineConfigService provides variables set in config.sh. Expose it in your constructor: private readonly configService : TangerineConfigService , And then you may use it: const userOneUsername = this . configService . config (). userOneUsername","title":"Server"},{"location":"developer/tangerine-globals/#client","text":"Use await this.appConfigService.getAppConfig; to fetch app-config.json settings in client.","title":"Client"},{"location":"developer/testing-conflicts/","text":"Conflicts \u00b6 The goal is to follow the CRDT (conflict-free replicated data type) pattern in resolving conflicts. When the app tries to merge two conflicting records, how should it sync the conflicting values: which value should win? The afore-mentioned Wikipedia page offers some guidance: \"As an example, a one-way Boolean event flag is a trivial CRDT: one bit, with a value of true or false. True means some particular event has occurred at least once. False means the event has not occurred. Once set to true, the flag cannot be set back to false. (An event, having occurred, cannot un-occur.) The resolution method is \"true wins\": when merging a replica where the flag is true (that replica has observed the event), and another one where the flag is false (that replica hasn't observed the event), the resolved result is true \u2014 the event has been observed.\" We have not yet reached this level of conflict resolution. We have first started with comparing data from Event Forms, detecting some basic conflicts such as missing formResponseId , complete , or required properties or detecting if there is a new event form and then merging according to rules specific to each difference. In general, the event form conflicts are resolved by adding the missing property or form. For metadata that are in conflict, the most recent metadata is merged (wins). There is also a check for new events. Unit tests are available that test the conflicts mentioned above. You can also create scenarios on a tablet. Testing Conflicts on a tablet \u00b6 Tips \u00b6 After each scenario, it is useful to run Sync to make sure that no more docs need to be sync'd: Status: Complete Pulled from the server: 0 Pushed to the server: 0 Supported Scenarios \u00b6 DiffType: EventForm - Tablet 1 opens but doesn't complete Event Form, Tablet 2 opens and completes Event Form \u00b6 Steps Setup: - Create a new case with pwa1. Fill out \"Registration for Role 1\" - enter '0' for \"How many participant of type Role 2 would you like to enroll in this case?\", submit. Create a New Event of type \"An Event with an event form you can delete\". Sync. - In PWA2, sync. Create a divergence: - In PWA1, open the form and exit (don't submit form). This should create a diverging tree in the revisions. - In PWA2, Enter the case you just synced. Enter the event of type \"An Event with an event form you can delete\" and complete the form in \"An Event with an Event Form you can delete.\" Sync. Syncing to create the conflict: - In PWA1, Sync. This should create a conflict. Note that Sync status displays \"Conflicts detected.\" This conflict is resolved on the client and sync'd to the server. - Check data/issues on server. There should be a new issue, which should display the following: Merged: true DiffTypes: (1) DIFF_TYPE__METADATA - In PWA2, sync. This should NOT create a conflict. - Check to see that data is identical on both PWA's. DiffType: Event - Tablet 1 creates an new Event and Tablet 2 creates a new Event \u00b6 Steps Setup: - Create a new case with PWA1. Fill out \"Registration for Role 1\" - enter '0' for \"How many participant of type Role 2 would you like to enroll in this case?\", submit. Sync - In PWA2, sync. Enter the case you just synced. Create a New Event of type \"An Event with an event form you can delete\" and complete the form in \"An Event with an Event Form you can delete.\" Sync. Create a divergence: - In PWA1, enter the same case (don't sync yet) and create a New Event of type \"An Event with an event form you can delete\". Complete the form in \"An Event with an Event Form you can delete.\" Syncing to create the conflict: - In PWA1, sync. This should create a conflict. Note that Sync status displays \"Conflicts detected.\" This conflict is resolved on the client and sync'd to the server. - Check data/issues on server. There should be a new issue, which should display the following: Merged: true DiffTypes: (1) DIFF_TYPE__EVENT (1) DIFF_TYPE__EVENT_FORM (1) DIFF_TYPE__METADATA Check the case on PWA1. There should be 2 instances of \"An Event with an Event Form you can delete\" - one from PWA1, and another from PWA2. In PWA2, sync. This should create a conflict. Note that Sync status displays \"Conflicts detected.\" This conflict is resolved on the client and sync'd to the server. Check data/issues on server. There should be a new issue, which should display the following: Merged: true DiffTypes: (1) DIFF_TYPE__EVENT (1) DIFF_TYPE__EVENT_FORM (1) DIFF_TYPE__METADATA Check the case on PWA2. There should be 2 instances of \"An Event with an Event Form you can delete\" - one from PWA1, and another from PWA2. DiffType: EventForm - Tablet 1 creates a new Event Form and Tablet 2 makes some other change \u00b6 Steps Setup: - Create a new case with PWA1. Fill out \"Registration for Role 1\" - enter '0' for \"How many participant of type Role 2 would you like to enroll in this case?\", submit. Create a New Event of type \"An Event with an event form you can delete\".\" Open that new event but do not click on the form \"An Event Form you can delete\". Sync. - In PWA2, sync. Enter the case you just synced. View the \"Registration for Role 1\" form. Sync. Create a divergence: - In PWA1, Enter the same case (don't sync yet) and enter a New Event of type \"An Event with an event form you can delete\". Complete the form in \"An Event with an Event Form you can delete.\" Syncing to create the conflict: - In PWA1, sync. This should create a conflict. Note that Sync status displays \"Conflicts detected.\" This conflict is resolved on the client and sync'd to the server. - Check data/issues on server. There should be a new issue, which should display the following: Merged: true DiffTypes: (1) DIFF_TYPE__METADATA - In PWA2, sync. This should create a conflict. Note that Sync status displays \"Conflicts detected.\" This conflict is resolved on the client and sync'd to the server. - Check data/issues on server. There should be a new issue, which should display the following: Merged: true DiffTypes: (1) DIFF_TYPE__METADATA - Check the case on PWA2. There should be 1 instances of \"An Event with an Event Form you can delete\" - with the form completed from PWA1 DiffType: Metadata - Change location on Tablet 1 and Tablet 2 \u00b6 Steps: - In PWA1, pull up the case you just created. Submit a \"Change Location of Case\" form, setting it for Facility 1. Don't Sync. - In PWA2, pull up the same case. Submit a \"Change Location of Case\" form, setting it for Facility 2. Sync. - In PWA1, sync. Note the error displayed: Status: Error 4 docs synced; 0 pending; ERROR: \"Document update conflict\" Sync again. Note that Sync status displays \"Conflicts detected.\" This conflict is resolved on the client and sync'd to the server. In PWA1, pull up the case. Note that there are two \"Change location of case\" forms, one for Facility 1 and another for Facility 2. In the js console, enter T.case._case.location.facility . It should display \"K0xhy1Su\". In PWA2, sync. Note the error displayed: Status: Error 4 docs synced; 0 pending; ERROR: \"Document update conflict\" Sync again. Note that Sync status displays \"Conflicts detected.\" This conflict is resolved on the client and sync'd to the server. In PWA2, pull up the case. Note that there are two \"Change location of case\" forms, one for Facility 1 and another for Facility 2. In the js console, enter T.case._case.location.facility . It should display \"K0xhy1Su\". DiffType: Metadata - Modify Case variables on Tablet 1 and Tablet 2 \u00b6 TODO: Create a form in the Case Module that uses setVariable and getVariable function Scenarios not yet supported \u00b6 DiffType: EventForm - Tablet 1 removes an Event Form and Tablet 2 makes some other change \u00b6 DiffType: EventForm - Tablet 1 makes an Event Form required and Tablet 2 makes some other change \u00b6 DiffType: EventForm - Tablet 1 makes adds an Event Form variable and Tablet 2 makes some other change \u00b6 DiffType: EventForm - Tablet 1 makes modifies existing Event Form variable and Tablet 2 makes some other change \u00b6 DiffType: EventForm - Tablet 1 makes modifies existing Event Form variable and Tablet 2 modifies the same Event Form variable with same value \u00b6 DiffType: EventForm - Tablet 1 makes modifies existing Event Form variable and Tablet 2 modifies the same Event Form variable with different value \u00b6 Exploring unexpected sync conflicts \u00b6 DiffType: Metadata - Two cases view the same case but make no modification \u00b6 A metadata conflict is easy to create: whenever a case is viewed, its metadata is modified. Steps: - launch 2 PWA's with the group, based on the case module - docker exec tangerine create-group \"Test Auto-merge 1\" case-module - consider editing the \"Registration for Role 1\" \"Registration\" section by changing the QR code into an input, just to make testing easier. - Create a new case with pwa1. Fill out \"Registration for Role 1\" - enter '0' for \"How many participant of type Role 2 would you like to enroll in this case?\", submit, and sync. - in PWA2, sync, and open the new case. Create a New Event of type \"An Event with an event form you can delete\" . Go into the event and form and submit the \"An Event Form you can delete\" form. Sync. Notice that so far, no new conflicts have been created. - In PWA1, sync. Note that Sync status displays \"Conflicts detected.\" Check data/issues on server - should be type (1) DIFF_TYPE__METADATA. Merged: true. - In PWA2, sync. Note that Sync status displays \"Pulled from the server: 1\". DiffType: EventForm - data conflict 1 - Don't touch the event \u00b6 So far, this has not made a conflict for me... Steps: - Create a new case with pwa1. Fill out \"Registration for Role 1\" - enter '0' for \"How many participant of type Role 2 would you like to enroll in this case?\", submit. On the same case, create a New Event of type \"An Event with an event form you can delete\". Don't view that event or enter data in its form. Sync. - In PWA2, sync. Enter the case you just synced and complete the form in \"An Event with an Event Form you can delete.\" Sync. - In PWA1, sync. The new form does not appear. Do a hard refresh. The new form should now appear in the case. Sync. - In PWA2, sync. Conflicts arise. Or not. Check data/issues on server - should be type (1) DIFF_TYPE__METADATA. Merged: true. There is a 50/50 chance this record won't have a conflict... DiffType: EventForm - data conflict 2 - Touch the event \u00b6 So far, this has not made a conflict for me... Steps: - Create a new case with pwa1. Fill out \"Registration for Role 1\" - enter '0' for \"How many participant of type Role 2 would you like to enroll in this case?\", submit. On the same case, create a New Event of type \"An Event with an event form you can delete\". View the event, but don't view the form. Sync. - In PWA2, sync. Enter the case you just synced and complete the form in \"An Event with an Event Form you can delete.\" Sync. - In PWA1, sync. The new form does not appear. Do a hard refresh. The new form should now appear in the case. Sync. - In PWA2, sync. Conflicts arise. Or not. Check data/issues on server - should be type (1) DIFF_TYPE__METADATA. Merged: true. There is a 50/50 chance this record won't have a conflict... DiffType: EventForm - data conflict 3 - Open but don't save the form \u00b6 Steps: - Create a new case with pwa1. Fill out \"Registration for Role 1\" - enter '0' for \"How many participant of type Role 2 would you like to enroll in this case?\", submit. On the same case, create a New Event of type \"An Event with an event form you can delete\". View the event, then view the form, but don't submit it. Sync. - In PWA2, sync. Enter the case you just synced and complete the form in \"An Event with an Event Form you can delete.\" Sync. - In PWA1, sync. The new form does not appear. Do a hard refresh. The new form should now appear in the case. Sync. - In PWA2, sync. Conflicts arise. Or not. Check data/issues on server - should be type (1) DIFF_TYPE__METADATA. Merged: true. There is a 50/50 chance this record won't have a conflict... - So far, this has not made a conflict for me...","title":"Conflicts"},{"location":"developer/testing-conflicts/#conflicts","text":"The goal is to follow the CRDT (conflict-free replicated data type) pattern in resolving conflicts. When the app tries to merge two conflicting records, how should it sync the conflicting values: which value should win? The afore-mentioned Wikipedia page offers some guidance: \"As an example, a one-way Boolean event flag is a trivial CRDT: one bit, with a value of true or false. True means some particular event has occurred at least once. False means the event has not occurred. Once set to true, the flag cannot be set back to false. (An event, having occurred, cannot un-occur.) The resolution method is \"true wins\": when merging a replica where the flag is true (that replica has observed the event), and another one where the flag is false (that replica hasn't observed the event), the resolved result is true \u2014 the event has been observed.\" We have not yet reached this level of conflict resolution. We have first started with comparing data from Event Forms, detecting some basic conflicts such as missing formResponseId , complete , or required properties or detecting if there is a new event form and then merging according to rules specific to each difference. In general, the event form conflicts are resolved by adding the missing property or form. For metadata that are in conflict, the most recent metadata is merged (wins). There is also a check for new events. Unit tests are available that test the conflicts mentioned above. You can also create scenarios on a tablet.","title":"Conflicts"},{"location":"developer/testing-conflicts/#testing-conflicts-on-a-tablet","text":"","title":"Testing Conflicts on a tablet"},{"location":"developer/testing-conflicts/#tips","text":"After each scenario, it is useful to run Sync to make sure that no more docs need to be sync'd: Status: Complete Pulled from the server: 0 Pushed to the server: 0","title":"Tips"},{"location":"developer/testing-conflicts/#supported-scenarios","text":"","title":"Supported Scenarios"},{"location":"developer/testing-conflicts/#difftype-eventform-tablet-1-opens-but-doesnt-complete-event-form-tablet-2-opens-and-completes-event-form","text":"Steps Setup: - Create a new case with pwa1. Fill out \"Registration for Role 1\" - enter '0' for \"How many participant of type Role 2 would you like to enroll in this case?\", submit. Create a New Event of type \"An Event with an event form you can delete\". Sync. - In PWA2, sync. Create a divergence: - In PWA1, open the form and exit (don't submit form). This should create a diverging tree in the revisions. - In PWA2, Enter the case you just synced. Enter the event of type \"An Event with an event form you can delete\" and complete the form in \"An Event with an Event Form you can delete.\" Sync. Syncing to create the conflict: - In PWA1, Sync. This should create a conflict. Note that Sync status displays \"Conflicts detected.\" This conflict is resolved on the client and sync'd to the server. - Check data/issues on server. There should be a new issue, which should display the following: Merged: true DiffTypes: (1) DIFF_TYPE__METADATA - In PWA2, sync. This should NOT create a conflict. - Check to see that data is identical on both PWA's.","title":"DiffType: EventForm - Tablet 1 opens but doesn't complete Event Form, Tablet 2 opens and completes Event Form"},{"location":"developer/testing-conflicts/#difftype-event-tablet-1-creates-an-new-event-and-tablet-2-creates-a-new-event","text":"Steps Setup: - Create a new case with PWA1. Fill out \"Registration for Role 1\" - enter '0' for \"How many participant of type Role 2 would you like to enroll in this case?\", submit. Sync - In PWA2, sync. Enter the case you just synced. Create a New Event of type \"An Event with an event form you can delete\" and complete the form in \"An Event with an Event Form you can delete.\" Sync. Create a divergence: - In PWA1, enter the same case (don't sync yet) and create a New Event of type \"An Event with an event form you can delete\". Complete the form in \"An Event with an Event Form you can delete.\" Syncing to create the conflict: - In PWA1, sync. This should create a conflict. Note that Sync status displays \"Conflicts detected.\" This conflict is resolved on the client and sync'd to the server. - Check data/issues on server. There should be a new issue, which should display the following: Merged: true DiffTypes: (1) DIFF_TYPE__EVENT (1) DIFF_TYPE__EVENT_FORM (1) DIFF_TYPE__METADATA Check the case on PWA1. There should be 2 instances of \"An Event with an Event Form you can delete\" - one from PWA1, and another from PWA2. In PWA2, sync. This should create a conflict. Note that Sync status displays \"Conflicts detected.\" This conflict is resolved on the client and sync'd to the server. Check data/issues on server. There should be a new issue, which should display the following: Merged: true DiffTypes: (1) DIFF_TYPE__EVENT (1) DIFF_TYPE__EVENT_FORM (1) DIFF_TYPE__METADATA Check the case on PWA2. There should be 2 instances of \"An Event with an Event Form you can delete\" - one from PWA1, and another from PWA2.","title":"DiffType: Event - Tablet 1 creates an new Event and Tablet 2 creates a new Event"},{"location":"developer/testing-conflicts/#difftype-eventform-tablet-1-creates-a-new-event-form-and-tablet-2-makes-some-other-change","text":"Steps Setup: - Create a new case with PWA1. Fill out \"Registration for Role 1\" - enter '0' for \"How many participant of type Role 2 would you like to enroll in this case?\", submit. Create a New Event of type \"An Event with an event form you can delete\".\" Open that new event but do not click on the form \"An Event Form you can delete\". Sync. - In PWA2, sync. Enter the case you just synced. View the \"Registration for Role 1\" form. Sync. Create a divergence: - In PWA1, Enter the same case (don't sync yet) and enter a New Event of type \"An Event with an event form you can delete\". Complete the form in \"An Event with an Event Form you can delete.\" Syncing to create the conflict: - In PWA1, sync. This should create a conflict. Note that Sync status displays \"Conflicts detected.\" This conflict is resolved on the client and sync'd to the server. - Check data/issues on server. There should be a new issue, which should display the following: Merged: true DiffTypes: (1) DIFF_TYPE__METADATA - In PWA2, sync. This should create a conflict. Note that Sync status displays \"Conflicts detected.\" This conflict is resolved on the client and sync'd to the server. - Check data/issues on server. There should be a new issue, which should display the following: Merged: true DiffTypes: (1) DIFF_TYPE__METADATA - Check the case on PWA2. There should be 1 instances of \"An Event with an Event Form you can delete\" - with the form completed from PWA1","title":"DiffType: EventForm - Tablet 1 creates a new Event Form and Tablet 2 makes some other change"},{"location":"developer/testing-conflicts/#difftype-metadata-change-location-on-tablet-1-and-tablet-2","text":"Steps: - In PWA1, pull up the case you just created. Submit a \"Change Location of Case\" form, setting it for Facility 1. Don't Sync. - In PWA2, pull up the same case. Submit a \"Change Location of Case\" form, setting it for Facility 2. Sync. - In PWA1, sync. Note the error displayed: Status: Error 4 docs synced; 0 pending; ERROR: \"Document update conflict\" Sync again. Note that Sync status displays \"Conflicts detected.\" This conflict is resolved on the client and sync'd to the server. In PWA1, pull up the case. Note that there are two \"Change location of case\" forms, one for Facility 1 and another for Facility 2. In the js console, enter T.case._case.location.facility . It should display \"K0xhy1Su\". In PWA2, sync. Note the error displayed: Status: Error 4 docs synced; 0 pending; ERROR: \"Document update conflict\" Sync again. Note that Sync status displays \"Conflicts detected.\" This conflict is resolved on the client and sync'd to the server. In PWA2, pull up the case. Note that there are two \"Change location of case\" forms, one for Facility 1 and another for Facility 2. In the js console, enter T.case._case.location.facility . It should display \"K0xhy1Su\".","title":"DiffType: Metadata - Change location on Tablet 1 and Tablet 2"},{"location":"developer/testing-conflicts/#difftype-metadata-modify-case-variables-on-tablet-1-and-tablet-2","text":"TODO: Create a form in the Case Module that uses setVariable and getVariable function","title":"DiffType: Metadata - Modify Case variables on Tablet 1 and Tablet 2"},{"location":"developer/testing-conflicts/#scenarios-not-yet-supported","text":"","title":"Scenarios not yet supported"},{"location":"developer/testing-conflicts/#difftype-eventform-tablet-1-removes-an-event-form-and-tablet-2-makes-some-other-change","text":"","title":"DiffType: EventForm - Tablet 1 removes an Event Form and Tablet 2 makes some other change"},{"location":"developer/testing-conflicts/#difftype-eventform-tablet-1-makes-an-event-form-required-and-tablet-2-makes-some-other-change","text":"","title":"DiffType: EventForm - Tablet 1 makes an Event Form required and Tablet 2 makes some other change"},{"location":"developer/testing-conflicts/#difftype-eventform-tablet-1-makes-adds-an-event-form-variable-and-tablet-2-makes-some-other-change","text":"","title":"DiffType: EventForm - Tablet 1 makes adds an Event Form variable and Tablet 2 makes some other change"},{"location":"developer/testing-conflicts/#difftype-eventform-tablet-1-makes-modifies-existing-event-form-variable-and-tablet-2-makes-some-other-change","text":"","title":"DiffType: EventForm - Tablet 1 makes modifies existing Event Form variable and Tablet 2 makes some other change"},{"location":"developer/testing-conflicts/#difftype-eventform-tablet-1-makes-modifies-existing-event-form-variable-and-tablet-2-modifies-the-same-event-form-variable-with-same-value","text":"","title":"DiffType: EventForm - Tablet 1 makes modifies existing Event Form variable and Tablet 2 modifies the same Event Form variable with same value"},{"location":"developer/testing-conflicts/#difftype-eventform-tablet-1-makes-modifies-existing-event-form-variable-and-tablet-2-modifies-the-same-event-form-variable-with-different-value","text":"","title":"DiffType: EventForm - Tablet 1 makes modifies existing Event Form variable and Tablet 2 modifies the same Event Form variable with different value"},{"location":"developer/testing-conflicts/#exploring-unexpected-sync-conflicts","text":"","title":"Exploring unexpected sync conflicts"},{"location":"developer/testing-conflicts/#difftype-metadata-two-cases-view-the-same-case-but-make-no-modification","text":"A metadata conflict is easy to create: whenever a case is viewed, its metadata is modified. Steps: - launch 2 PWA's with the group, based on the case module - docker exec tangerine create-group \"Test Auto-merge 1\" case-module - consider editing the \"Registration for Role 1\" \"Registration\" section by changing the QR code into an input, just to make testing easier. - Create a new case with pwa1. Fill out \"Registration for Role 1\" - enter '0' for \"How many participant of type Role 2 would you like to enroll in this case?\", submit, and sync. - in PWA2, sync, and open the new case. Create a New Event of type \"An Event with an event form you can delete\" . Go into the event and form and submit the \"An Event Form you can delete\" form. Sync. Notice that so far, no new conflicts have been created. - In PWA1, sync. Note that Sync status displays \"Conflicts detected.\" Check data/issues on server - should be type (1) DIFF_TYPE__METADATA. Merged: true. - In PWA2, sync. Note that Sync status displays \"Pulled from the server: 1\".","title":"DiffType: Metadata - Two cases view the same case but make no modification"},{"location":"developer/testing-conflicts/#difftype-eventform-data-conflict-1-dont-touch-the-event","text":"So far, this has not made a conflict for me... Steps: - Create a new case with pwa1. Fill out \"Registration for Role 1\" - enter '0' for \"How many participant of type Role 2 would you like to enroll in this case?\", submit. On the same case, create a New Event of type \"An Event with an event form you can delete\". Don't view that event or enter data in its form. Sync. - In PWA2, sync. Enter the case you just synced and complete the form in \"An Event with an Event Form you can delete.\" Sync. - In PWA1, sync. The new form does not appear. Do a hard refresh. The new form should now appear in the case. Sync. - In PWA2, sync. Conflicts arise. Or not. Check data/issues on server - should be type (1) DIFF_TYPE__METADATA. Merged: true. There is a 50/50 chance this record won't have a conflict...","title":"DiffType: EventForm - data conflict 1 - Don't touch the event"},{"location":"developer/testing-conflicts/#difftype-eventform-data-conflict-2-touch-the-event","text":"So far, this has not made a conflict for me... Steps: - Create a new case with pwa1. Fill out \"Registration for Role 1\" - enter '0' for \"How many participant of type Role 2 would you like to enroll in this case?\", submit. On the same case, create a New Event of type \"An Event with an event form you can delete\". View the event, but don't view the form. Sync. - In PWA2, sync. Enter the case you just synced and complete the form in \"An Event with an Event Form you can delete.\" Sync. - In PWA1, sync. The new form does not appear. Do a hard refresh. The new form should now appear in the case. Sync. - In PWA2, sync. Conflicts arise. Or not. Check data/issues on server - should be type (1) DIFF_TYPE__METADATA. Merged: true. There is a 50/50 chance this record won't have a conflict...","title":"DiffType: EventForm - data conflict 2 - Touch the event"},{"location":"developer/testing-conflicts/#difftype-eventform-data-conflict-3-open-but-dont-save-the-form","text":"Steps: - Create a new case with pwa1. Fill out \"Registration for Role 1\" - enter '0' for \"How many participant of type Role 2 would you like to enroll in this case?\", submit. On the same case, create a New Event of type \"An Event with an event form you can delete\". View the event, then view the form, but don't submit it. Sync. - In PWA2, sync. Enter the case you just synced and complete the form in \"An Event with an Event Form you can delete.\" Sync. - In PWA1, sync. The new form does not appear. Do a hard refresh. The new form should now appear in the case. Sync. - In PWA2, sync. Conflicts arise. Or not. Check data/issues on server - should be type (1) DIFF_TYPE__METADATA. Merged: true. There is a 50/50 chance this record won't have a conflict... - So far, this has not made a conflict for me...","title":"DiffType: EventForm - data conflict 3 - Open but don't save the form"},{"location":"developer/upgrades/","text":"Upgrades \u00b6 Implementing Upgrades \u00b6 There are two ways to implement upgrades to Tangerine configuration or databases that cannot be automatically upgraded: - via a shell script, runnable via docker exec -it tangerine /tangerine/server/src/upgrade/v3.9.0.js - adding to the updates.ts array. This will run automatically when the client app starts if a new version was deployed. Upgrading a server \u00b6 You must run each version's server image before running its upgrade. for example, if you are upgrading from v3.6.4 to v3.13.0, follow these steps: git clone https://github.com/Tangerine-Community/Tangerine.git cd Tangerine git fetch origin git checkout v3.6.4 cp config.defaults.sh config.sh # configure T_HOST_NAME, T_PROTOCOL (https), and T_MODULES (csv) ./start.sh v3.6.4 docker exec -it tangerine reporting-cache-clear git checkout v3.7.1 ./start.sh v3.7.1 docker exec tangerine translations-update git checkout v3.8.0 ./start.sh v3.8.0 docker exec -it tangerine /tangerine/server/src/upgrade/v3.8.0.js git checkout v3.8.1 mv config.sh config.sh_backup cp config.defaults.sh config.sh # To edit both files in vim you would run... vim -O config.sh config.sh_backup # No upgrade script for this relese. git checkout v3.9.0 ./start.sh v3.9.0 docker exec -it tangerine /tangerine/server/src/upgrade/v3.9.0.js git checkout v3.10.0 ./start.sh v3.10.0 docker exec -it tangerine /tangerine/server/src/upgrade/v3.10.0.js git checkout v3.11.0 ./start.sh v3.11.0 docker exec -it tangerine /tangerine/server/src/upgrade/v3.11.0.js # There was a bug in 3.11.0 that causes a blank screen in earlier APK's # It is resolved in v3.12. git checkout v3.12.0 ./start.sh v3.12.0 # Run upgrade docker exec -it tangerine reporting-cache-clear git checkout v3.13.0 ./start.sh v3.13.0 docker exec -it tangerine reporting-cache-clear docker exec -it tangerine /tangerine/server/src/upgrade/v3.13.0.js # Remove previous Tangerine version's Docker images. docker rmi tangerine/tangerine:v3.6.4 docker rmi tangerine/tangerine:v3.8.0 docker rmi tangerine/tangerine:v3.8.1 docker rmi tangerine/tangerine:v3.9.0 docker rmi tangerine/tangerine:v3.10.0 docker rmi tangerine/tangerine:v3.11.0 docker rmi tangerine/tangerine:v3.13.0 Limits to Upgrades \u00b6 Read the instructions in the CHANGELOG.md. If testing a pre-v3.8 APK, it will fail to run on v3.8 or higher due to lack of newer Cordova plugins. Update tips \u00b6 Be aware that sync-protocol 2 uses a shared database; therefore, you don't want to do the same update whenever a different user logs in. The requiresViewsRefresh property will update All Default User Docs, which may place too much load on the tablet when it re-indexes those views. The following code checks for that scenario and show how to update a single view: { requiresViewsUpdate: false, script: async (userDb, appConfig, userService: UserService) => { // syncProtocol uses a single shared db for all users. Update only once. if (appConfig.syncProtocol === '2' && localStorage.getItem('ran-update-v3.9.0')) return console.log('Updating to v3.9.0...') await userDb.put(TangyFormsDocs[0]) await userDb.query('responsesUnLockedAndNotUploaded') localStorage.setItem('ran-update-v3.9.0', 'true') }","title":"Upgrades"},{"location":"developer/upgrades/#upgrades","text":"","title":"Upgrades"},{"location":"developer/upgrades/#implementing-upgrades","text":"There are two ways to implement upgrades to Tangerine configuration or databases that cannot be automatically upgraded: - via a shell script, runnable via docker exec -it tangerine /tangerine/server/src/upgrade/v3.9.0.js - adding to the updates.ts array. This will run automatically when the client app starts if a new version was deployed.","title":"Implementing Upgrades"},{"location":"developer/upgrades/#upgrading-a-server","text":"You must run each version's server image before running its upgrade. for example, if you are upgrading from v3.6.4 to v3.13.0, follow these steps: git clone https://github.com/Tangerine-Community/Tangerine.git cd Tangerine git fetch origin git checkout v3.6.4 cp config.defaults.sh config.sh # configure T_HOST_NAME, T_PROTOCOL (https), and T_MODULES (csv) ./start.sh v3.6.4 docker exec -it tangerine reporting-cache-clear git checkout v3.7.1 ./start.sh v3.7.1 docker exec tangerine translations-update git checkout v3.8.0 ./start.sh v3.8.0 docker exec -it tangerine /tangerine/server/src/upgrade/v3.8.0.js git checkout v3.8.1 mv config.sh config.sh_backup cp config.defaults.sh config.sh # To edit both files in vim you would run... vim -O config.sh config.sh_backup # No upgrade script for this relese. git checkout v3.9.0 ./start.sh v3.9.0 docker exec -it tangerine /tangerine/server/src/upgrade/v3.9.0.js git checkout v3.10.0 ./start.sh v3.10.0 docker exec -it tangerine /tangerine/server/src/upgrade/v3.10.0.js git checkout v3.11.0 ./start.sh v3.11.0 docker exec -it tangerine /tangerine/server/src/upgrade/v3.11.0.js # There was a bug in 3.11.0 that causes a blank screen in earlier APK's # It is resolved in v3.12. git checkout v3.12.0 ./start.sh v3.12.0 # Run upgrade docker exec -it tangerine reporting-cache-clear git checkout v3.13.0 ./start.sh v3.13.0 docker exec -it tangerine reporting-cache-clear docker exec -it tangerine /tangerine/server/src/upgrade/v3.13.0.js # Remove previous Tangerine version's Docker images. docker rmi tangerine/tangerine:v3.6.4 docker rmi tangerine/tangerine:v3.8.0 docker rmi tangerine/tangerine:v3.8.1 docker rmi tangerine/tangerine:v3.9.0 docker rmi tangerine/tangerine:v3.10.0 docker rmi tangerine/tangerine:v3.11.0 docker rmi tangerine/tangerine:v3.13.0","title":"Upgrading a server"},{"location":"developer/upgrades/#limits-to-upgrades","text":"Read the instructions in the CHANGELOG.md. If testing a pre-v3.8 APK, it will fail to run on v3.8 or higher due to lack of newer Cordova plugins.","title":"Limits to Upgrades"},{"location":"developer/upgrades/#update-tips","text":"Be aware that sync-protocol 2 uses a shared database; therefore, you don't want to do the same update whenever a different user logs in. The requiresViewsRefresh property will update All Default User Docs, which may place too much load on the tablet when it re-indexes those views. The following code checks for that scenario and show how to update a single view: { requiresViewsUpdate: false, script: async (userDb, appConfig, userService: UserService) => { // syncProtocol uses a single shared db for all users. Update only once. if (appConfig.syncProtocol === '2' && localStorage.getItem('ran-update-v3.9.0')) return console.log('Updating to v3.9.0...') await userDb.put(TangyFormsDocs[0]) await userDb.query('responsesUnLockedAndNotUploaded') localStorage.setItem('ran-update-v3.9.0', 'true') }","title":"Update tips"},{"location":"developer/viewing-forms-and-data/","text":"Viewing Forms and Form Data \u00b6 Use TangyFormService to retrieve form definitions and response data. The revision is used to get the correct version of the form. this . formResponse = await this . tangyFormService . getResponse ( this . eventForm . formResponseId ) const tangyFormMarkup = await this . tangyFormService . getFormMarkup ( this . eventFormDefinition . formId , this . formResponse . formVersionId ) But there are other ways of getting data out of Tangerine. First you need to see where you are getting data from. Mapping of components to forms \u00b6 EventFormListItemComponent - listing of forms in an event CaseEventListItemComponent - listing of events (such as Followup ANC Visits) in a case. Helper functions already in components \u00b6 In the component for a list, helper functions may already expose the properties you need to populate a template. In EventFormListItemComponent, notice the variable exposed: const response = await this . formService . getResponse ( this . eventForm . formResponseId ) const getValue = ( variableName ) => { // more code inside getValue(); }, {}) // snip const caseInstance = this . case const caseDefinition = this . caseDefinition const caseEventDefinition = this . caseEventDefinition const caseEvent = this . caseEvent const eventForm = this . eventForm const eventFormDefinition = this . eventFormDefinition const formatDate = ( unixTimeInMilliseconds , format ) => moment ( new Date ( unixTimeInMilliseconds )). format ( format ) const TRANSLATE = _TRANSLATE eval ( `this.renderedTemplateListItemIcon = this.caseDefinition.templateEventFormListItemIcon ? \\` ${ this . caseDefinition . templateEventFormListItemIcon } \\` : \\` ${ this . defaultTemplateListItemIcon } \\`` ) eval ( `this.renderedTemplateListItemPrimary = this.caseDefinition.templateEventFormListItemPrimary ? \\` ${ this . caseDefinition . templateEventFormListItemPrimary } \\` : \\` ${ this . defaultTemplateListItemPrimary } \\`` ) eval ( `this.renderedTemplateListItemSecondary = this.caseDefinition.templateEventFormListItemSecondary ? \\` ${ this . caseDefinition . v } \\` : \\` ${ this . defaultTemplateListItemSecondary } \\`` ) If there is not a response for a form, response will be false; therefore, if you do a getValue() in your template, be sure to test if response is true. If you wish to display the startDatetime in your template, note that is is part of the response object - it is returned as response.startDatetime. In other cases - for values inside the form - use getValue(variableName) - but test if response is true first! Also, remember that the variableName is one of the id's in the inputs array, which is inside each item in the items array. Testing your templates \u00b6 Here's an easy way to test your template code: in the js console, use the copy() function to copy the value for your template: copy ( this . caseDefinition . templateEventFormListItemSecondary ) Then add the fields or functions you need. In this case, I'm adding a getValue: `<t-lang en>Status</t-lang><t-lang fr>Statut</t-lang>: ${ ! eventForm . complete ? '<t-lang en>Incomplete</t-lang><t-lang fr>Incompl\u00e8te</t-lang>' : '<t-lang en>Complete</t-lang><t-lang fr>Achev\u00e9e</t-lang>' } ${ response ? `Version: ${ getValue ( \"content_release_version\" ) } ` : '' } ` Output: \"<t-lang en>Status</t-lang><t-lang fr>Statut</t-lang>: <t-lang en>Complete</t-lang><t-lang fr>Achev\u00e9e</t-lang> Start date: 3/13/2020, 11:25:19 AM\" Note that I was testing for existence of response, and also nesting templates to show the \"Version\" text if there was a value for content_release_version. Another example: <t-lang en>Status</t-lang><t-lang fr>Statut</t-lang>: ${!eventForm.complete ? '<t-lang en>Incomplete</t-lang><t-lang fr>Incompl\u00e8te</t-lang>' : '<t-lang en>Complete</t-lang><t-lang fr>Achev\u00e9e</t-lang>'} ${response ? Start date: ${response.startDatetime} : ''} debugging templates \u00b6 To make the dev tool stop on a breakpoint in a Case Definition's template, add the following debugger statement to the content of the template. $ {(()=>{ debugger })()} When that template loads, the Chrome devtools will pause and you can inspect local variables/functions available and try running them in the console. Note that different templates will have different helper functions and variables available.","title":"Viewing Forms and Form Data"},{"location":"developer/viewing-forms-and-data/#viewing-forms-and-form-data","text":"Use TangyFormService to retrieve form definitions and response data. The revision is used to get the correct version of the form. this . formResponse = await this . tangyFormService . getResponse ( this . eventForm . formResponseId ) const tangyFormMarkup = await this . tangyFormService . getFormMarkup ( this . eventFormDefinition . formId , this . formResponse . formVersionId ) But there are other ways of getting data out of Tangerine. First you need to see where you are getting data from.","title":"Viewing Forms and Form Data"},{"location":"developer/viewing-forms-and-data/#mapping-of-components-to-forms","text":"EventFormListItemComponent - listing of forms in an event CaseEventListItemComponent - listing of events (such as Followup ANC Visits) in a case.","title":"Mapping of components to forms"},{"location":"developer/viewing-forms-and-data/#helper-functions-already-in-components","text":"In the component for a list, helper functions may already expose the properties you need to populate a template. In EventFormListItemComponent, notice the variable exposed: const response = await this . formService . getResponse ( this . eventForm . formResponseId ) const getValue = ( variableName ) => { // more code inside getValue(); }, {}) // snip const caseInstance = this . case const caseDefinition = this . caseDefinition const caseEventDefinition = this . caseEventDefinition const caseEvent = this . caseEvent const eventForm = this . eventForm const eventFormDefinition = this . eventFormDefinition const formatDate = ( unixTimeInMilliseconds , format ) => moment ( new Date ( unixTimeInMilliseconds )). format ( format ) const TRANSLATE = _TRANSLATE eval ( `this.renderedTemplateListItemIcon = this.caseDefinition.templateEventFormListItemIcon ? \\` ${ this . caseDefinition . templateEventFormListItemIcon } \\` : \\` ${ this . defaultTemplateListItemIcon } \\`` ) eval ( `this.renderedTemplateListItemPrimary = this.caseDefinition.templateEventFormListItemPrimary ? \\` ${ this . caseDefinition . templateEventFormListItemPrimary } \\` : \\` ${ this . defaultTemplateListItemPrimary } \\`` ) eval ( `this.renderedTemplateListItemSecondary = this.caseDefinition.templateEventFormListItemSecondary ? \\` ${ this . caseDefinition . v } \\` : \\` ${ this . defaultTemplateListItemSecondary } \\`` ) If there is not a response for a form, response will be false; therefore, if you do a getValue() in your template, be sure to test if response is true. If you wish to display the startDatetime in your template, note that is is part of the response object - it is returned as response.startDatetime. In other cases - for values inside the form - use getValue(variableName) - but test if response is true first! Also, remember that the variableName is one of the id's in the inputs array, which is inside each item in the items array.","title":"Helper functions already in components"},{"location":"developer/viewing-forms-and-data/#testing-your-templates","text":"Here's an easy way to test your template code: in the js console, use the copy() function to copy the value for your template: copy ( this . caseDefinition . templateEventFormListItemSecondary ) Then add the fields or functions you need. In this case, I'm adding a getValue: `<t-lang en>Status</t-lang><t-lang fr>Statut</t-lang>: ${ ! eventForm . complete ? '<t-lang en>Incomplete</t-lang><t-lang fr>Incompl\u00e8te</t-lang>' : '<t-lang en>Complete</t-lang><t-lang fr>Achev\u00e9e</t-lang>' } ${ response ? `Version: ${ getValue ( \"content_release_version\" ) } ` : '' } ` Output: \"<t-lang en>Status</t-lang><t-lang fr>Statut</t-lang>: <t-lang en>Complete</t-lang><t-lang fr>Achev\u00e9e</t-lang> Start date: 3/13/2020, 11:25:19 AM\" Note that I was testing for existence of response, and also nesting templates to show the \"Version\" text if there was a value for content_release_version. Another example: <t-lang en>Status</t-lang><t-lang fr>Statut</t-lang>: ${!eventForm.complete ? '<t-lang en>Incomplete</t-lang><t-lang fr>Incompl\u00e8te</t-lang>' : '<t-lang en>Complete</t-lang><t-lang fr>Achev\u00e9e</t-lang>'} ${response ? Start date: ${response.startDatetime} : ''}","title":"Testing your templates"},{"location":"developer/viewing-forms-and-data/#debugging-templates","text":"To make the dev tool stop on a breakpoint in a Case Definition's template, add the following debugger statement to the content of the template. $ {(()=>{ debugger })()} When that template loads, the Chrome devtools will pause and you can inspect local variables/functions available and try running them in the console. Note that different templates will have different helper functions and variables available.","title":"debugging templates"},{"location":"editor/","text":"Editor Quick Links \u00b6 Form Development Guides \u00b6 Tangerine Form Developer's Cookbook Local Content Development with Tangerine Preview Configuration Guide The Tangerine Preview tool for advanced users writing forms in HTML and using Git for version control Form Versions Case Module \u00b6 Case Management Data Model Case Module Cookbook Configuring Case functionality Custom Case Reports","title":"Editor Quick Links"},{"location":"editor/#editor-quick-links","text":"","title":"Editor Quick Links"},{"location":"editor/#form-development-guides","text":"Tangerine Form Developer's Cookbook Local Content Development with Tangerine Preview Configuration Guide The Tangerine Preview tool for advanced users writing forms in HTML and using Git for version control Form Versions","title":"Form Development Guides"},{"location":"editor/#case-module","text":"Case Management Data Model Case Module Cookbook Configuring Case functionality Custom Case Reports","title":"Case Module"},{"location":"editor/content-sets/","text":"Content Sets \u00b6 Content Sets are groups of forms and configuration you can use as a template for new groups. Anatomy of a Content Set \u00b6 Version 1 (< Tangerine v3.13.0) \u00b6 In the root directory of a v1 Content Set, you will find the following: - ./app-config.json_example (required) - ./forms.json (required) Version 2 (> Tangerine v3.13.0) \u00b6 Starting in Tangerine v3.13.0, the second iteration of Content Sets was launched. In the root directory of a v2 Content Set, you will find the following: ./client/ (required): The folder containing content that will be deployed to Tablets. ./client/app-config.defaults.json (required): Defaults to use for app-config.json . For example, a Case Module enabled group would have a \"homeUrl\" property with a value of \"case-home\" . ./client/forms.json (required) ./editor/ (required): A folder containing assets pertanent to how Editor behaves. ./editor/index.html (required): The file loaded when displaying the Dashboard in a group's Editor. ./README.md (suggested) ./docs/ (suggested) Version 2.1 (>= Tangerine 3.15.0) \u00b6 Starting in Tangerine v3.13.0, content sets gained a package.json and build step. The package.json specifies the required libs and scripts for the content set. If the content set uses custom scripts, these scripts are compiled by the included webpack. Note that .gitignore ignores the compiled code - client/custom-scripts.js - to avoid conflicts. To install the 2.1 content set - instead of npm install, run npm run install-server . Be sure to update any cron jobs to include the new build commands if they are using content set 2.1: git pull npm rn install-server npm build If using Content set 2, this build process is not necessary. However, it is an advantage for cs2 users to upgrade to be able to pin the webpack version in packagejson and also to not have the huge custom-scripts file. Creating a new Content Set \u00b6 Importing a Content Set into Tangerine \u00b6 New group set: - git clone tangerine starter repo - Modify content as needed - Push to Git - On server instance, setup GH deploy key by navigating to your Repository on Github and click on Settings -> Deploy keys -> Add deploy key and paste your Docker instances /root/.ssh/id_rsa.pub in the key contents, enable \"Allow write access\" and save. Run docker exec tangerine create-group \"New Group A\" https://github.com/id/tangerine-content.git using the cli - Add crontab entry that uses the non-pub key to do the pull, npm run install-server, npm run build.","title":"Content sets"},{"location":"editor/content-sets/#content-sets","text":"Content Sets are groups of forms and configuration you can use as a template for new groups.","title":"Content Sets"},{"location":"editor/content-sets/#anatomy-of-a-content-set","text":"","title":"Anatomy of a Content Set"},{"location":"editor/content-sets/#version-1-tangerine-v3130","text":"In the root directory of a v1 Content Set, you will find the following: - ./app-config.json_example (required) - ./forms.json (required)","title":"Version 1 (&lt; Tangerine v3.13.0)"},{"location":"editor/content-sets/#version-2-tangerine-v3130","text":"Starting in Tangerine v3.13.0, the second iteration of Content Sets was launched. In the root directory of a v2 Content Set, you will find the following: ./client/ (required): The folder containing content that will be deployed to Tablets. ./client/app-config.defaults.json (required): Defaults to use for app-config.json . For example, a Case Module enabled group would have a \"homeUrl\" property with a value of \"case-home\" . ./client/forms.json (required) ./editor/ (required): A folder containing assets pertanent to how Editor behaves. ./editor/index.html (required): The file loaded when displaying the Dashboard in a group's Editor. ./README.md (suggested) ./docs/ (suggested)","title":"Version 2 (&gt; Tangerine v3.13.0)"},{"location":"editor/content-sets/#version-21-tangerine-3150","text":"Starting in Tangerine v3.13.0, content sets gained a package.json and build step. The package.json specifies the required libs and scripts for the content set. If the content set uses custom scripts, these scripts are compiled by the included webpack. Note that .gitignore ignores the compiled code - client/custom-scripts.js - to avoid conflicts. To install the 2.1 content set - instead of npm install, run npm run install-server . Be sure to update any cron jobs to include the new build commands if they are using content set 2.1: git pull npm rn install-server npm build If using Content set 2, this build process is not necessary. However, it is an advantage for cs2 users to upgrade to be able to pin the webpack version in packagejson and also to not have the huge custom-scripts file.","title":"Version 2.1 (&gt;= Tangerine 3.15.0)"},{"location":"editor/content-sets/#creating-a-new-content-set","text":"","title":"Creating a new Content Set"},{"location":"editor/content-sets/#importing-a-content-set-into-tangerine","text":"New group set: - git clone tangerine starter repo - Modify content as needed - Push to Git - On server instance, setup GH deploy key by navigating to your Repository on Github and click on Settings -> Deploy keys -> Add deploy key and paste your Docker instances /root/.ssh/id_rsa.pub in the key contents, enable \"Allow write access\" and save. Run docker exec tangerine create-group \"New Group A\" https://github.com/id/tangerine-content.git using the cli - Add crontab entry that uses the non-pub key to do the pull, npm run install-server, npm run build.","title":"Importing a Content Set into Tangerine"},{"location":"editor/form-versions/","text":"Form Versions \u00b6 Throughout the lifetime of a form, many versions of a form may be deployed. When reviewing form responses collected on a past version of a form, it's important to open that form response using the version of the form it was collected on. When filling out a form response, it helps to think of the form response as a clear plastic sheet that you are writing on over the paper copy of the form. If the questions on that underlying physical form are removed, moved, or new questions are added, the clear plastic sheet you filled out previous form responses on no longer overlays correctly on the updated paper copy of that form. The consequence of not using Form Versions on a form that changes over time is that when reviewing past data, if 1a question was removed in a future version of a form, it will appear that data collected in the past are now missing that data. There are other scenarios where a form version should be created which we will cover in later sections, but first a simple example. Example \u00b6 First Release \u00b6 forms.json : [ { \"id\" : \"form-x\" , \"title\" : \"Form X\" , \"src\" : \"./assets/form-x/form.html\" , } ] ./assets/form-x/form.html : < tangy-form id = \"form-x\" title = \"Form X\" > < tangy-input label = \"Question A\" name = \"a\" ></ tangy-input > < tangy-input label = \"Question B\" name = \"b\" ></ tangy-input > </ tangy-form > Second Release \u00b6 { \"id\" : \"form-x\" , \"title\" : \"Form X\" , \"src\" : \"./assets/form-x/form.html\" , \"formVersionId\" : \"2\" , \"formVersions\" : [ { \"id\" : \"1\" , \"src\" : \"./assets/form-x/1.html\" }, { \"id\" : \"2\" , \"src\" : \"./assets/form-x/2.html\" } ] } ./assets/form-x/form.html : < tangy-form id = \"form-x\" title = \"Form X\" > < tangy-input label = \"Question A\" name = \"a\" ></ tangy-input > </ tangy-form > ./assets/form-x/1.html : < tangy-form id = \"form-x\" title = \"Form X\" > < tangy-input label = \"Question A\" name = \"a\" ></ tangy-input > < tangy-input label = \"Question B\" name = \"b\" ></ tangy-input > </ tangy-form > ./assets/form-x/2.html : < tangy-form id = \"form-x\" title = \"Form X\" > < tangy-input label = \"Question A\" name = \"a\" ></ tangy-input > </ tangy-form > Third Release \u00b6 { \"id\" : \"form-x\" , \"title\" : \"Form X\" , \"src\" : \"./assets/form-x/form.html\" , \"formVersionId\" : \"3\" , \"formVersions\" : [ { \"id\" : \"1\" , \"src\" : \"./assets/form-x/1.html\" }, { \"id\" : \"2\" , \"src\" : \"./assets/form-x/2.html\" }, { \"id\" : \"3\" , \"src\" : \"./assets/form-x/3.html\" } ] } ./assets/form-x/form.html : < tangy-form id = \"form-x\" title = \"Form X\" > < tangy-input label = \"Question A\" name = \"a\" ></ tangy-input > < tangy-input label = \"Question C\" name = \"c\" ></ tangy-input > </ tangy-form > ./assets/form-x/1.html : < tangy-form id = \"form-x\" title = \"Form X\" > < tangy-input label = \"Question A\" name = \"a\" ></ tangy-input > < tangy-input label = \"Question B\" name = \"b\" ></ tangy-input > </ tangy-form > ./assets/form-x/2.html : < tangy-form id = \"form-x\" title = \"Form X\" > < tangy-input label = \"Question A\" name = \"a\" ></ tangy-input > </ tangy-form > ./assets/form-x/3.html : < tangy-form id = \"form-x\" title = \"Form X\" > < tangy-input label = \"Question A\" name = \"a\" ></ tangy-input > < tangy-input label = \"Question C\" name = \"c\" ></ tangy-input > </ tangy-form > When should I create a new Form Version? \u00b6 Situations when a new Form Version should be created include: New question Removed question Options for a question added or removed. New page Removed page Reordered pages Situations when a new Form Version can be skipped: 1. Label of a question has changed. 2. Variable marked as required. Future Tooling proposals \u00b6 Proposals for tools to help in managing form versions: Linter idea - cli that checks if 2 form versions share the same path - makes sure there are no duplicate revision src paths. Check for dupes in formVersion.id and formVersion.src. start new dir in tangerine dir called cli - this would be the first subcommand of a new cli. This is different from the server cli. tangerine-preview is another command that could be integrated into this new cli. Example - generate-new-form creates the scaffolding for a new form and could implement/facilitate the revisions feature. Version incrementor - used for releases Proposed Testing version support: What are the different use-cases that the software must implement to fully support versions? The following list will list each case and the correct source for the form: Using the tangerine-preview app and must use the most recent version: formInfo.src Viewing a record created in a legacy group with no formVersionId and no formVersions: formInfo.src viewing a record created in a legacy group with no formVersionId but does have formVersions using the legacyOriginal flag: legacyVersion.src viewing a record created in a legacy group with no formVersionId but does have formVersions without legacyOriginal flag: lawd have mercy! formInfo.src viewing a record created in a new group using formVersionId and has formVersions: formVersion.src viewing a record created in a new group using formVersionId and does not have formVersions : formInfo.src","title":"Form Versions"},{"location":"editor/form-versions/#form-versions","text":"Throughout the lifetime of a form, many versions of a form may be deployed. When reviewing form responses collected on a past version of a form, it's important to open that form response using the version of the form it was collected on. When filling out a form response, it helps to think of the form response as a clear plastic sheet that you are writing on over the paper copy of the form. If the questions on that underlying physical form are removed, moved, or new questions are added, the clear plastic sheet you filled out previous form responses on no longer overlays correctly on the updated paper copy of that form. The consequence of not using Form Versions on a form that changes over time is that when reviewing past data, if 1a question was removed in a future version of a form, it will appear that data collected in the past are now missing that data. There are other scenarios where a form version should be created which we will cover in later sections, but first a simple example.","title":"Form Versions"},{"location":"editor/form-versions/#example","text":"","title":"Example"},{"location":"editor/form-versions/#first-release","text":"forms.json : [ { \"id\" : \"form-x\" , \"title\" : \"Form X\" , \"src\" : \"./assets/form-x/form.html\" , } ] ./assets/form-x/form.html : < tangy-form id = \"form-x\" title = \"Form X\" > < tangy-input label = \"Question A\" name = \"a\" ></ tangy-input > < tangy-input label = \"Question B\" name = \"b\" ></ tangy-input > </ tangy-form >","title":"First Release"},{"location":"editor/form-versions/#second-release","text":"{ \"id\" : \"form-x\" , \"title\" : \"Form X\" , \"src\" : \"./assets/form-x/form.html\" , \"formVersionId\" : \"2\" , \"formVersions\" : [ { \"id\" : \"1\" , \"src\" : \"./assets/form-x/1.html\" }, { \"id\" : \"2\" , \"src\" : \"./assets/form-x/2.html\" } ] } ./assets/form-x/form.html : < tangy-form id = \"form-x\" title = \"Form X\" > < tangy-input label = \"Question A\" name = \"a\" ></ tangy-input > </ tangy-form > ./assets/form-x/1.html : < tangy-form id = \"form-x\" title = \"Form X\" > < tangy-input label = \"Question A\" name = \"a\" ></ tangy-input > < tangy-input label = \"Question B\" name = \"b\" ></ tangy-input > </ tangy-form > ./assets/form-x/2.html : < tangy-form id = \"form-x\" title = \"Form X\" > < tangy-input label = \"Question A\" name = \"a\" ></ tangy-input > </ tangy-form >","title":"Second Release"},{"location":"editor/form-versions/#third-release","text":"{ \"id\" : \"form-x\" , \"title\" : \"Form X\" , \"src\" : \"./assets/form-x/form.html\" , \"formVersionId\" : \"3\" , \"formVersions\" : [ { \"id\" : \"1\" , \"src\" : \"./assets/form-x/1.html\" }, { \"id\" : \"2\" , \"src\" : \"./assets/form-x/2.html\" }, { \"id\" : \"3\" , \"src\" : \"./assets/form-x/3.html\" } ] } ./assets/form-x/form.html : < tangy-form id = \"form-x\" title = \"Form X\" > < tangy-input label = \"Question A\" name = \"a\" ></ tangy-input > < tangy-input label = \"Question C\" name = \"c\" ></ tangy-input > </ tangy-form > ./assets/form-x/1.html : < tangy-form id = \"form-x\" title = \"Form X\" > < tangy-input label = \"Question A\" name = \"a\" ></ tangy-input > < tangy-input label = \"Question B\" name = \"b\" ></ tangy-input > </ tangy-form > ./assets/form-x/2.html : < tangy-form id = \"form-x\" title = \"Form X\" > < tangy-input label = \"Question A\" name = \"a\" ></ tangy-input > </ tangy-form > ./assets/form-x/3.html : < tangy-form id = \"form-x\" title = \"Form X\" > < tangy-input label = \"Question A\" name = \"a\" ></ tangy-input > < tangy-input label = \"Question C\" name = \"c\" ></ tangy-input > </ tangy-form >","title":"Third Release"},{"location":"editor/form-versions/#when-should-i-create-a-new-form-version","text":"Situations when a new Form Version should be created include: New question Removed question Options for a question added or removed. New page Removed page Reordered pages Situations when a new Form Version can be skipped: 1. Label of a question has changed. 2. Variable marked as required.","title":"When should I create a new Form Version?"},{"location":"editor/form-versions/#future-tooling-proposals","text":"Proposals for tools to help in managing form versions: Linter idea - cli that checks if 2 form versions share the same path - makes sure there are no duplicate revision src paths. Check for dupes in formVersion.id and formVersion.src. start new dir in tangerine dir called cli - this would be the first subcommand of a new cli. This is different from the server cli. tangerine-preview is another command that could be integrated into this new cli. Example - generate-new-form creates the scaffolding for a new form and could implement/facilitate the revisions feature. Version incrementor - used for releases Proposed Testing version support: What are the different use-cases that the software must implement to fully support versions? The following list will list each case and the correct source for the form: Using the tangerine-preview app and must use the most recent version: formInfo.src Viewing a record created in a legacy group with no formVersionId and no formVersions: formInfo.src viewing a record created in a legacy group with no formVersionId but does have formVersions using the legacyOriginal flag: legacyVersion.src viewing a record created in a legacy group with no formVersionId but does have formVersions without legacyOriginal flag: lawd have mercy! formInfo.src viewing a record created in a new group using formVersionId and has formVersions: formVersion.src viewing a record created in a new group using formVersionId and does not have formVersions : formInfo.src","title":"Future Tooling proposals"},{"location":"editor/translations/","text":"Translations \u00b6 There are two types of translations in Tangerine, Application Translations and Content Translations. Applications Translations are translations on Tangerine User Interface such as the \"next\" button on a form, or the \"Sync\" menu item in the top level tablet menu. Content Translations are the translations on forms such as the \"label\" and \"hint text\" of a question. The method of providing translations are different for the two. Content Translations \u00b6 Translations for specific languages are embedded in content, thus portable and specific to that content. The <t-lang> component ( https://github.com/ICTatRTI/translation-web-component ) is used to detect the language assigned to the HTML doc. In the following example, the label on the hello input will be \"Hello\" if English is set as the language, \"Bonjour\" if French is selected as the language. <tangy-input name=\"hello\" label=\" <t-lang en>Hello</t-lang> <t-lang fr>Bonjour</t-lang> \" > </tangy-input> Application Translations \u00b6 By default, when you create a new Group in Tangerine, a set of default Application Translations are provided. Currently that includes English, French, Jordanian, Khmer, and Russian. When deploying, these languages are selectable on a per tablet basis under the Tangerine Settings menu. If you would like to add or modify translations for your group, currently we would recommend setting up your group with a Github Integration to allow editing of the content of your group's content. In your group's content folder you will find two types of files, the list of translations in translations.json , and then a file per translation such as translation.fr.json for French, translations.ru.json for Russian, etc. By adding to, or removing, or modifying entries in translations.json , this will modify what translations are available for a tablet user to select in settings. See the default translations.json file here and find the other default translation files here .","title":"Translations"},{"location":"editor/translations/#translations","text":"There are two types of translations in Tangerine, Application Translations and Content Translations. Applications Translations are translations on Tangerine User Interface such as the \"next\" button on a form, or the \"Sync\" menu item in the top level tablet menu. Content Translations are the translations on forms such as the \"label\" and \"hint text\" of a question. The method of providing translations are different for the two.","title":"Translations"},{"location":"editor/translations/#content-translations","text":"Translations for specific languages are embedded in content, thus portable and specific to that content. The <t-lang> component ( https://github.com/ICTatRTI/translation-web-component ) is used to detect the language assigned to the HTML doc. In the following example, the label on the hello input will be \"Hello\" if English is set as the language, \"Bonjour\" if French is selected as the language. <tangy-input name=\"hello\" label=\" <t-lang en>Hello</t-lang> <t-lang fr>Bonjour</t-lang> \" > </tangy-input>","title":"Content Translations"},{"location":"editor/translations/#application-translations","text":"By default, when you create a new Group in Tangerine, a set of default Application Translations are provided. Currently that includes English, French, Jordanian, Khmer, and Russian. When deploying, these languages are selectable on a per tablet basis under the Tangerine Settings menu. If you would like to add or modify translations for your group, currently we would recommend setting up your group with a Github Integration to allow editing of the content of your group's content. In your group's content folder you will find two types of files, the list of translations in translations.json , and then a file per translation such as translation.fr.json for French, translations.ru.json for Russian, etc. By adding to, or removing, or modifying entries in translations.json , this will modify what translations are available for a tablet user to select in settings. See the default translations.json file here and find the other default translation files here .","title":"Application Translations"},{"location":"editor/advanced-form-programming/","text":"Overview \u00b6 Tangerine contains an extremely extensible foundational framework that allows the form developer to highly customize the core functionality, actions, and progression. The following section provides guidance and common examples for extending Tangerine. TODO: INSERT TABLE OF CONTENTS FOR THIS SECTION AND HIGH-LEVEL OVERVIEW","title":"Overview"},{"location":"editor/advanced-form-programming/#overview","text":"Tangerine contains an extremely extensible foundational framework that allows the form developer to highly customize the core functionality, actions, and progression. The following section provides guidance and common examples for extending Tangerine. TODO: INSERT TABLE OF CONTENTS FOR THIS SECTION AND HIGH-LEVEL OVERVIEW","title":"Overview"},{"location":"editor/advanced-form-programming/globals/","text":"Global Variables \u00b6 Tangerine-specific variables are available in the T global variable. These are exposed in app.component.ts. Example: this.window.T = { form: { Get: Get }, router, http, user: userService, lockBox: lockBoxService, syncing: syncingService, syncCouchdbService: syncCouchdbService, sync: syncService, appConfig: appConfigService, update: updateService, search: searchService, device: deviceService, tangyFormsInfo: tangyFormsInfoService, tangyForms: tangyFormService, formTypes: formTypesService, case: caseService, cases: casesService, caseDefinition: caseDefinitionsService, languages: languagesService, variable: variableService, classForm: classFormService, classDashboard: dashboardService, translate: window['t'] } Additional T properties may be added in other parts of the Tangerine codebase. Usage \u00b6 Examples of T global usage are throughout these docs, but here are a few: To load and query the client database with options to get a specific revision: const db = await T.user.getUserDatabase() db.get('foo',{rev:'4-uuid', latest:false}) When writing queries or organizing the javascript logic to fetch the results, use the globally-exposed T.form.Get function to get the value of inputs; this will save you from having to wrote deeply nested code ( doc.items[0].inputs[3].value[0].value ) T.form.Get(doc, 'consent') // 3 ingredients are needed to set an Event Variable. const eventId = '123' const variableName = 'foo' const variableValue = 'bar' // Set Event Variable. T . case . setVariable ( ` ${ eventId } - ${ variableName } ` , variableValue ) // Get Event Variable. const shouldBeValueOfBar = T . case . getVariable ( ` ${ eventId } - ${ variableName } ` ) There is an older document, Tangerine globals , that describes some of the functions that are now attached to the T global.","title":"Global Variables"},{"location":"editor/advanced-form-programming/globals/#global-variables","text":"Tangerine-specific variables are available in the T global variable. These are exposed in app.component.ts. Example: this.window.T = { form: { Get: Get }, router, http, user: userService, lockBox: lockBoxService, syncing: syncingService, syncCouchdbService: syncCouchdbService, sync: syncService, appConfig: appConfigService, update: updateService, search: searchService, device: deviceService, tangyFormsInfo: tangyFormsInfoService, tangyForms: tangyFormService, formTypes: formTypesService, case: caseService, cases: casesService, caseDefinition: caseDefinitionsService, languages: languagesService, variable: variableService, classForm: classFormService, classDashboard: dashboardService, translate: window['t'] } Additional T properties may be added in other parts of the Tangerine codebase.","title":"Global Variables"},{"location":"editor/advanced-form-programming/globals/#usage","text":"Examples of T global usage are throughout these docs, but here are a few: To load and query the client database with options to get a specific revision: const db = await T.user.getUserDatabase() db.get('foo',{rev:'4-uuid', latest:false}) When writing queries or organizing the javascript logic to fetch the results, use the globally-exposed T.form.Get function to get the value of inputs; this will save you from having to wrote deeply nested code ( doc.items[0].inputs[3].value[0].value ) T.form.Get(doc, 'consent') // 3 ingredients are needed to set an Event Variable. const eventId = '123' const variableName = 'foo' const variableValue = 'bar' // Set Event Variable. T . case . setVariable ( ` ${ eventId } - ${ variableName } ` , variableValue ) // Get Event Variable. const shouldBeValueOfBar = T . case . getVariable ( ` ${ eventId } - ${ variableName } ` ) There is an older document, Tangerine globals , that describes some of the functions that are now attached to the T global.","title":"Usage"},{"location":"editor/advanced-form-programming/local-content-development/","text":"Local content development with Tangerine Preview \u00b6 Tangerine Preview is a command line tool for previewing the Tangerine content you are working on your local computer. It work on Windows, Mac, and Linux. Install \u00b6 Before you install tangerine-preview , make sure to install node.js . If you are on macOS, you will need to set permissions to allow for global installs by running the following command. sudo chown -R `whoami` /usr/local/lib/node_modules For all platforms, open a command line terminal and run Tangerine Preview install command. npm install -g tangerine-preview Preview your content \u00b6 Open a command prompt, change directory to your content that you would like to preview, then run the tangerine-preview command. cd your-project tangerine-preview Lastly, open Google Chrome to http://localhost:3000 As you make content changes, they will be synced to the app. Reload your web browser and you'll see the changes. Update tangerine-preview \u00b6 When new releases come out for tangerine, tangerine-preview will also be updated. To update, open a command prompt and run the install command again. npm install -g tangerine-preview Check your currently install version \u00b6 npm list -g tangerine-preview Set up VS Code with Syntax Highlighting for on-open , on-change , etc. \u00b6 Ideally we would have a VS Code plugin for you to install. Until then, this is our workaround. If you are interested in helping with the development of a VS Code plugin, feel free to reach out to us via the issue queue. Step 1 \u00b6 Open Visual Studio configuration file. If you have the VS Code CLI installed, run the following in a terminal. code /Applications/Visual\\ Studio\\ Code.app/Contents/Resources/app/extensions/html/syntaxes/html.tmLanguage.json Step 2 \u00b6 Find on(s(c and replace with on-open|on-change|on-submit|skip-if|hide-if|dont-skip-if|disable-if|valid-if|discrepancy-if|warn-if|on(s(c . Step 3 \u00b6 Restart Visual Studio.","title":"Local content development"},{"location":"editor/advanced-form-programming/local-content-development/#local-content-development-with-tangerine-preview","text":"Tangerine Preview is a command line tool for previewing the Tangerine content you are working on your local computer. It work on Windows, Mac, and Linux.","title":"Local content development with Tangerine Preview"},{"location":"editor/advanced-form-programming/local-content-development/#install","text":"Before you install tangerine-preview , make sure to install node.js . If you are on macOS, you will need to set permissions to allow for global installs by running the following command. sudo chown -R `whoami` /usr/local/lib/node_modules For all platforms, open a command line terminal and run Tangerine Preview install command. npm install -g tangerine-preview","title":"Install"},{"location":"editor/advanced-form-programming/local-content-development/#preview-your-content","text":"Open a command prompt, change directory to your content that you would like to preview, then run the tangerine-preview command. cd your-project tangerine-preview Lastly, open Google Chrome to http://localhost:3000 As you make content changes, they will be synced to the app. Reload your web browser and you'll see the changes.","title":"Preview your content"},{"location":"editor/advanced-form-programming/local-content-development/#update-tangerine-preview","text":"When new releases come out for tangerine, tangerine-preview will also be updated. To update, open a command prompt and run the install command again. npm install -g tangerine-preview","title":"Update tangerine-preview"},{"location":"editor/advanced-form-programming/local-content-development/#check-your-currently-install-version","text":"npm list -g tangerine-preview","title":"Check your currently install version"},{"location":"editor/advanced-form-programming/local-content-development/#set-up-vs-code-with-syntax-highlighting-for-on-open-on-change-etc","text":"Ideally we would have a VS Code plugin for you to install. Until then, this is our workaround. If you are interested in helping with the development of a VS Code plugin, feel free to reach out to us via the issue queue.","title":"Set up VS Code with Syntax Highlighting for on-open, on-change, etc."},{"location":"editor/advanced-form-programming/local-content-development/#step-1","text":"Open Visual Studio configuration file. If you have the VS Code CLI installed, run the following in a terminal. code /Applications/Visual\\ Studio\\ Code.app/Contents/Resources/app/extensions/html/syntaxes/html.tmLanguage.json","title":"Step 1"},{"location":"editor/advanced-form-programming/local-content-development/#step-2","text":"Find on(s(c and replace with on-open|on-change|on-submit|skip-if|hide-if|dont-skip-if|disable-if|valid-if|discrepancy-if|warn-if|on(s(c .","title":"Step 2"},{"location":"editor/advanced-form-programming/local-content-development/#step-3","text":"Restart Visual Studio.","title":"Step 3"},{"location":"editor/case-module/","text":"Case Module \u00b6 Case Module allows us to define Case Definitions for different purposes such as following a participant in a drug trial over the course of many events, where each event may require many forms to be filled out. In order to create and find cases, you will need to configure the \"case-home\" as the \"homeUrl\" value in app-config.json . Configuring Cases \u00b6 Case Module allows us to define Case Definitions for different purposes such as following a participant in a drug trial over the course of many events, where each event may require many forms to be filled out. To configure cases, there are four files to modify. First add a reference to the new Case Definition in the case-definitions.json . Here is an example of a case-definitions.json file that references two Case Definitions. File: case-definitions.json [ { \"id\": \"case-definition-1\", \"name\": \"Case Definition 1\", \"src\": \"./assets/case-definition-1.json\" }, { \"id\": \"case-definition-2\", \"name\": \"Case Definition 2\", \"src\": \"./assets/case-definition-2.json\" } ] Then create the corresponding Case Definition file... File: case-definition-1.json { \"id\" : \"case-definition-1\" , \"formId\" : \"case-definition-1-manifest\" , \"name\" : \"Case Definition 1\" , \"description\" : \"Description...\" , \"startFormOnOpen\" : { \"eventId\" : \"event-definition-1\" , \"eventFormId\" : \"event-form-1\" }, \"eventDefinitions\" : [ { \"id\" : \"event-definition-1\" , \"name\" : \"Event Definition 1\" , \"description\" : \"Description...\" , \"repeatable\" : false , \"required\" : true , \"eventFormDefinitions\" : [ { \"id\" : \"event-form-definition-1\" , \"formId\" : \"form-1\" , \"name\" : \"Form 1\" , \"required\" : true , \"repeatable\" : false } ] } ] } Case Definition Templates \u00b6 As a Data Collector uses the Client App, they navigate a Case's hierarchy of Events and Forms. Almost every piece of information they see can be overriden to display custom variables and logic by using the Case Definition's templates. This section describes the templates available and what variables are available. Note that all templates are evaluated as Javascript Template Literals. There are many good tutorials online about how to use Javascipt Template Literals, here are a couple of Javascript Template Literals examples that we reference often for things like doing conditionals and loops. Schedule \u00b6 templateScheduleListItemIcon default: \"templateScheduleListItemIcon\": \"${caseEvent.status === 'CASE_EVENT_STATUS_COMPLETED' ? 'event_note' : 'event_available'}\" templateScheduleListItemPrimary default: \"templateScheduleListItemPrimary\": \"<span>${caseEventDefinition.name}</span> in Case ${caseService.case._id.substr(0,5)}\" templateScheduleListItemSecondary default: \"templateScheduleListItemSecondary\": \"<span>${caseInstance.label}</span>\" Variables available: - caseService : CaseService - caseDefinition : CaseDefinition - caseEventDefinition : CaseEventDefinition - caseInstance : Case - caseEvent : CaseEvent Debugging Case Definition Templates \u00b6 Configuring forms.json \u00b6 The case references a Form in the formId property of the Case Definition. Make sure there is a form with that corresponding Form ID listed in forms.json with additional configuration for search. File: forms.json [ { \"id\" : \"case-definition-1-manifest\" , \"type\" : \"case\" , \"title\" : \"Case Definition 1 Manifest\" , \"description\" : \"Description...\" , \"listed\" : true , \"src\" : \"./assets/case-definition-1-manifest/form.html\" , \"searchSettings\" : { \"primaryTemplate\" : \"${searchDoc.variables.status === 'Enrolled' ? `Participant ID: ${searchDoc.variables.participant_id} &nbsp; &nbsp; &nbsp; Enrollment Date: ${(searchDoc.variables.enrollment_date).substring(8,10) + '-' + (searchDoc.variables.enrollment_date).substring(5,7)+ '-' + (searchDoc.variables.enrollment_date).substring(0,4)}` : `Screening ID: ${searchDoc._id.substr(0,6)} &nbsp; &nbsp; &nbsp; Screening Date: ${searchDoc.variables.screening_date ? searchDoc.variables.screening_date : 'N/A' }` }\" , \"shouldIndex\" : true , \"secondaryTemplate\" : \"${searchDoc.variables.status === 'Enrolled' ? `Name: ${searchDoc.variables.first_name} ${searchDoc.variables.last_name} &nbsp; &nbsp; &nbsp; Location: ${searchDoc.variables.location} &nbsp; &nbsp; &nbsp; Status: Enrolled &nbsp; &nbsp; &nbsp;` : `Status: Not enrolled &nbsp; &nbsp; &nbsp;` }\" , \"variablesToIndex\" : [ \"first_name\" , \"last_name\" , \"status\" , \"location\" , \"participant_id\" , \"enrollment_date\" , \"screening_date\" ] }, } ] The properties in forms.json often change; check the Content Sets for current examples. Configuring Text Search \u00b6 The variables listed in variablesToIndex will be available for searching on with the Tablet level search as well as in Editor. You also must set \"shouldIndex\" : true . All forms that should not be searched must also have the searchSettings configured. Here is an example that must be implemented: \"searchSettings\" : { \"shouldIndex\" : false , \"primaryTemplate\" : \"\" , \"secondaryTemplate\" : \"\" , \"variablesToIndex\" : [ ] }, Configuring QR code search \u00b6 To configure the QR code search on Tablets, in your app-config.json , there is a \"barcodeSearchMapFunction\" property. This is a map function for receiving the value of the Search Scan for you to parse out and return the value that should be used for search. A data variable is passed in for you to parse, and the return value is what ends up in the search bar as a text search. Example: if ((JSON.parse(data)).participant_id) { return (JSON.parse(data)).participant_id } else { throw 'Incorrect format' } Configuring two-way sync \u00b6 Because you may need to share cases across devices, configuring two-way sync may be necessary. See the Two-way Sync Documentation for more details. Note that you sync Form Responses, and it's the IDs of that you'll want to sync in the \"formId\" of the Case Definition in order to sync cases. Configuring the Schedule \u00b6 One of the two tabs that Data Collectors see when they log into Tangerine is a \"Schedule\" tab. This schedule will show Case Event's on days where they are have an estimated day, scheduled day, and/or occurred on day. You can set these three dates on an event using the following APIs. caseService.setEventEstimatedDay(idOfEvent, timeInUnixMilliseconds) caseService.setEventOccurredOn(idOfEvent, timeInUnixMilliseconds) caseService.setEventScheduledDay(idOfEvent, timeInUnixMilliseconds)","title":"Case Module"},{"location":"editor/case-module/#case-module","text":"Case Module allows us to define Case Definitions for different purposes such as following a participant in a drug trial over the course of many events, where each event may require many forms to be filled out. In order to create and find cases, you will need to configure the \"case-home\" as the \"homeUrl\" value in app-config.json .","title":"Case Module"},{"location":"editor/case-module/#configuring-cases","text":"Case Module allows us to define Case Definitions for different purposes such as following a participant in a drug trial over the course of many events, where each event may require many forms to be filled out. To configure cases, there are four files to modify. First add a reference to the new Case Definition in the case-definitions.json . Here is an example of a case-definitions.json file that references two Case Definitions. File: case-definitions.json [ { \"id\": \"case-definition-1\", \"name\": \"Case Definition 1\", \"src\": \"./assets/case-definition-1.json\" }, { \"id\": \"case-definition-2\", \"name\": \"Case Definition 2\", \"src\": \"./assets/case-definition-2.json\" } ] Then create the corresponding Case Definition file... File: case-definition-1.json { \"id\" : \"case-definition-1\" , \"formId\" : \"case-definition-1-manifest\" , \"name\" : \"Case Definition 1\" , \"description\" : \"Description...\" , \"startFormOnOpen\" : { \"eventId\" : \"event-definition-1\" , \"eventFormId\" : \"event-form-1\" }, \"eventDefinitions\" : [ { \"id\" : \"event-definition-1\" , \"name\" : \"Event Definition 1\" , \"description\" : \"Description...\" , \"repeatable\" : false , \"required\" : true , \"eventFormDefinitions\" : [ { \"id\" : \"event-form-definition-1\" , \"formId\" : \"form-1\" , \"name\" : \"Form 1\" , \"required\" : true , \"repeatable\" : false } ] } ] }","title":"Configuring Cases"},{"location":"editor/case-module/#case-definition-templates","text":"As a Data Collector uses the Client App, they navigate a Case's hierarchy of Events and Forms. Almost every piece of information they see can be overriden to display custom variables and logic by using the Case Definition's templates. This section describes the templates available and what variables are available. Note that all templates are evaluated as Javascript Template Literals. There are many good tutorials online about how to use Javascipt Template Literals, here are a couple of Javascript Template Literals examples that we reference often for things like doing conditionals and loops.","title":"Case Definition Templates"},{"location":"editor/case-module/#debugging-case-definition-templates","text":"","title":"Debugging Case Definition Templates"},{"location":"editor/case-module/#configuring-formsjson","text":"The case references a Form in the formId property of the Case Definition. Make sure there is a form with that corresponding Form ID listed in forms.json with additional configuration for search. File: forms.json [ { \"id\" : \"case-definition-1-manifest\" , \"type\" : \"case\" , \"title\" : \"Case Definition 1 Manifest\" , \"description\" : \"Description...\" , \"listed\" : true , \"src\" : \"./assets/case-definition-1-manifest/form.html\" , \"searchSettings\" : { \"primaryTemplate\" : \"${searchDoc.variables.status === 'Enrolled' ? `Participant ID: ${searchDoc.variables.participant_id} &nbsp; &nbsp; &nbsp; Enrollment Date: ${(searchDoc.variables.enrollment_date).substring(8,10) + '-' + (searchDoc.variables.enrollment_date).substring(5,7)+ '-' + (searchDoc.variables.enrollment_date).substring(0,4)}` : `Screening ID: ${searchDoc._id.substr(0,6)} &nbsp; &nbsp; &nbsp; Screening Date: ${searchDoc.variables.screening_date ? searchDoc.variables.screening_date : 'N/A' }` }\" , \"shouldIndex\" : true , \"secondaryTemplate\" : \"${searchDoc.variables.status === 'Enrolled' ? `Name: ${searchDoc.variables.first_name} ${searchDoc.variables.last_name} &nbsp; &nbsp; &nbsp; Location: ${searchDoc.variables.location} &nbsp; &nbsp; &nbsp; Status: Enrolled &nbsp; &nbsp; &nbsp;` : `Status: Not enrolled &nbsp; &nbsp; &nbsp;` }\" , \"variablesToIndex\" : [ \"first_name\" , \"last_name\" , \"status\" , \"location\" , \"participant_id\" , \"enrollment_date\" , \"screening_date\" ] }, } ] The properties in forms.json often change; check the Content Sets for current examples.","title":"Configuring forms.json"},{"location":"editor/case-module/#configuring-text-search","text":"The variables listed in variablesToIndex will be available for searching on with the Tablet level search as well as in Editor. You also must set \"shouldIndex\" : true . All forms that should not be searched must also have the searchSettings configured. Here is an example that must be implemented: \"searchSettings\" : { \"shouldIndex\" : false , \"primaryTemplate\" : \"\" , \"secondaryTemplate\" : \"\" , \"variablesToIndex\" : [ ] },","title":"Configuring Text Search"},{"location":"editor/case-module/#configuring-qr-code-search","text":"To configure the QR code search on Tablets, in your app-config.json , there is a \"barcodeSearchMapFunction\" property. This is a map function for receiving the value of the Search Scan for you to parse out and return the value that should be used for search. A data variable is passed in for you to parse, and the return value is what ends up in the search bar as a text search. Example: if ((JSON.parse(data)).participant_id) { return (JSON.parse(data)).participant_id } else { throw 'Incorrect format' }","title":"Configuring QR code search"},{"location":"editor/case-module/#configuring-two-way-sync","text":"Because you may need to share cases across devices, configuring two-way sync may be necessary. See the Two-way Sync Documentation for more details. Note that you sync Form Responses, and it's the IDs of that you'll want to sync in the \"formId\" of the Case Definition in order to sync cases.","title":"Configuring two-way sync"},{"location":"editor/case-module/#configuring-the-schedule","text":"One of the two tabs that Data Collectors see when they log into Tangerine is a \"Schedule\" tab. This schedule will show Case Event's on days where they are have an estimated day, scheduled day, and/or occurred on day. You can set these three dates on an event using the following APIs. caseService.setEventEstimatedDay(idOfEvent, timeInUnixMilliseconds) caseService.setEventOccurredOn(idOfEvent, timeInUnixMilliseconds) caseService.setEventScheduledDay(idOfEvent, timeInUnixMilliseconds)","title":"Configuring the Schedule"},{"location":"editor/case-module/case-service-api/","text":"API: caseService \u00b6 Warning Use of the caseService Class is only available when the case module is enabled on the server. TODO: Link to the page that describes how to enable the case service The caseService class allows the form developer to programmatically interact with the case from within the form. Case APIs \u00b6 changeLocation \u00b6 Change the location of a Case. This also changes the location information on all related Form Responses. Parameters \u00b6 Param Type Description location object An object where the properties are the levels and the values are the location node IDs Example \u00b6 video example code setVariable \u00b6 Set a Case level variable in a Case. Parameters \u00b6 Param Type Description variableName string The variable name. value any The value for the variable. Example \u00b6 caseService . setVariable ( 'participant_id' , getValue ( 'participant_id' )) caseService . setVariable ( 'first_name' , getValue ( 'first_name' )) caseService . setVariable ( 'last_name' , getValue ( 'last_name' )) - example code getVariable \u00b6 Get a Case level variable in a Case. Parameters \u00b6 Param Type Description variableName string The variable name. Returns \u00b6 The value requested. Many be any data type that was set Example \u00b6 if ( ! caseService . getVariable ( 'status' )) { caseService . setVariable ( 'status' , 'screening' ) } - example code Case Event API \u00b6 createEvent \u00b6 Dynamically create an instance of an event (defined in the case json) and add it to the current case Parameters \u00b6 Param Type Description eventDefinitionId string Event Definition ID from the Case Definition Document createRequiredEventForms (Optional) boolean (Default: False) Instantiate any required forms within the Event Returns \u00b6 CaseEvent object Example \u00b6 const event1 = caseService . createEvent ( 'event-definition-cf58ca' ) const event2 = caseService . createEvent ( 'event-definition-682ca6' , true ) setEventEstimatedDay \u00b6 Set the estimated day of expected date completion. This is used by the calendar for displaying events. TODO: Improve Description Parameters \u00b6 Param Type Description eventId string (UUID) Event Instance ID from the Case timeInMs number Unix timestamp for the event date/time Example \u00b6 caseService . setEventEstimatedDay ( event1 . id , now ) caseService . setEventEstimatedDay ( 'f9a25042-b03e-11ea-b3de-0242ac130004' , 1592359411 ) setEventScheduledDay \u00b6 Set the scheduled day of expected date completion. This is used by the calendar for displaying events. TODO: Improve Description Parameters \u00b6 Param Type Description eventId string (UUID) Event Instance ID from the Case timeInMs number Unix timestamp for the event date/time Example \u00b6 caseService . setEventScheduledDay ( event1 . id , now ) caseService . setEventScheduledDay ( 'f9a25042-b03e-11ea-b3de-0242ac130004' , 1592359411 ) setEventWindow \u00b6 Set the expected event completion. TODO: Improve Description Parameters \u00b6 Param Type Description eventId string (UUID) Event Instance ID from the Case windowStartDayTimeInMs number Unix timestamp for the event start date/time windowEndDayTimeInMs number Unix timestamp for the event end date/time Example \u00b6 caseService . setEventWindow ( event1 . id , 1592359411 , 1592618611 ) caseService . setEventWindow ( 'f9a25042-b03e-11ea-b3de-0242ac130004' , 1592359411 , 1592618611 ) setEventOccurredOn \u00b6 Set the date in which the event occurred TODO: Improve Description Parameters \u00b6 Param Type Description eventId string (UUID) Event Instance ID from the Case timeInMs number Unix timestamp for the event completion date/time Example \u00b6 caseService . setEventOccurredOn ( event1 . id , now ) caseService . setEventOccurredOn ( 'f9a25042-b03e-11ea-b3de-0242ac130004' , 1592359411 ) disableEventDefinition \u00b6 Prevent creation of an via the new event menu. Parameters \u00b6 Param Type Description eventDefinitionId string (UUID) Event Definition ID from the Case Definition Example \u00b6 caseService . disableEventDefinition ( 'event-definition-1' ) Event Form API \u00b6 createEventForm \u00b6 Dynamically create an instance of an event form (defined in the case json) and add it to the current Case. Parameters \u00b6 Param Type Description caseEventId string Event ID of the Event you want to add this Form to eventFormDefinitionId string Event Form Definition ID of the Event Form ou want to create participantId (optional) string ID of the Participant this Event Form is for. Returns \u00b6 EventForm object Example \u00b6 const eventForm = caseService . startEventForm ( caseEvent . id , 'event-form-definition-fdkai3' , participant . id ) code example video demo deleteEventForm \u00b6 Dynamically delete an instance of an event form. Parameters \u00b6 Param Type Description caseEventId string Event ID of the Event you want to add this Form to eventFormId string Event Form ID of the Event Form you want to delete Example \u00b6 // Find a Case Event and corresponding Event Form instance to delete. const caseEvent = caseService . case . events . find ( event => event . eventDefinitionId === 'event-definition-1' ) const eventForm = caseEvent . eventForms . find ( eventForm => eventForm . eventFormDefinitionId === 'event-form-definition-1' ) // Delete the EventForm. caseService . deleteEventForm ( caseEvent . id , eventForm . id ) setEventFormData \u00b6 Set a custom piece of data for an event form. Note this is a separate data collection than the data on the Form Response related to the Event Form. Parameters \u00b6 Param Type Description caseEventId string Event ID of the Event the Event Form lives in eventFormId string Event Form ID of the Event Form you want to set data on variableName string Variable name you are setting value any Value you want to set Example \u00b6 caseService . setEventFormData ( caseEvent . id , eventForm . id , 'foo' , 'bar' ) getEventFormData \u00b6 Get a custom piece of data for an event form. Note this is a separate data collection than the data on the Form Response related to the Event Form. Parameters \u00b6 Param Type Description caseEventId string Event ID of the Event the Event Form lives in eventFormId string Event Form ID of the Event Form you want to get data of variableName string Variable name you are getting Example \u00b6 const fooData = caseService . getEventFormData ( caseEvent . id , eventForm . id , 'foo' ) markEventFormRequired \u00b6 Mark an Even Form instance as being required. You might do this on a form that was optional, but it has come to lite that it must be filled out before the event is marked as complete. Parameters \u00b6 Param Type Description caseEventId string Event ID of the Event the Event Form lives in eventFormId string Event Form ID of the Event Form you want to mark required Example \u00b6 // Create an EventForm in the current event. You could also find one. const form2 = caseService . createEventForm ( caseEvent . id , 'event-form--mark-form-as-required-example-2' , participant . id ) // Mark EventForm as required. caseService . markEventFormRequired ( caseEvent . id , form2 . id ) example code video markEventFormNotRequired \u00b6 Mark and event form as not required. Parameters \u00b6 Param Type Description caseEventId string Event ID of the Event the Event Form lives in eventFormId string Event Form ID of the Event Form you want to mark not required Example \u00b6 // Mark EventForm as required. caseService . markEventFormRequired ( caseEvent . id , eventForm . id ) Participant API \u00b6 createParticipant \u00b6 Create a participant in a Case. Parameters \u00b6 Param Type Description caseRoleId string A Case Role ID as defined in the Case Role Definitions Returns \u00b6 Participant object Example \u00b6 const participantRole1 = caseService . createParticipant ( 'role-1' ) example code setParticipantData \u00b6 Set some data for a specific Participant. Parameters \u00b6 Param Type Description participantId string ID of the participant variableName string Variable name you are setting value any Value you want to set Example \u00b6 Create a participant and set some data from the current form... const participantRole1 = caseService . createParticipant ( 'role-1' ) caseService . setParticipantData ( participantRole1 . id , 'participant_id' , getValue ( 'participant_id' )) caseService . setParticipantData ( participantRole1 . id , 'first_name' , getValue ( 'first_name' )) caseService . setParticipantData ( participantRole1 . id , 'last_name' , getValue ( 'last_name' )) example code Set data on participant whom this Event Form is assigned to using the global participant object that is active when an EventForm is open that has an assigned Participant... caseService . setParticipantData ( participant . id , 'first_name' , getValue ( 'first_name' )) caseService . setParticipantData ( participant . id , 'last_name' , getValue ( 'last_name' )) example code Find a participant by role and set some data from the current form... const participantRole1 = caseService . case . participants . find ( participant => paritipcant . caseRoleId === 'role-1' ) caseService . setParticipantData ( participantRole1 . id , 'participant_id' , getValue ( 'participant_id' )) caseService . setParticipantData ( participantRole1 . id , 'first_name' , getValue ( 'first_name' )) caseService . setParticipantData ( participantRole1 . id , 'last_name' , getValue ( 'last_name' )) getParticipantData \u00b6 Get some data for a specific Participant. Parameters \u00b6 Param Type Description participantId string ID of the participant variableName string Variable name you are getting Returns \u00b6 This function returns the value of the variable you requested which may consist of any data type you set it to. Example \u00b6 Get participant data of the form whom is assigned to the current form... caseService . getParticipantData ( participant . id , 'first_name' ) example code","title":"API: caseService"},{"location":"editor/case-module/case-service-api/#api-caseservice","text":"Warning Use of the caseService Class is only available when the case module is enabled on the server. TODO: Link to the page that describes how to enable the case service The caseService class allows the form developer to programmatically interact with the case from within the form.","title":"API: caseService"},{"location":"editor/case-module/case-service-api/#case-apis","text":"","title":"Case APIs"},{"location":"editor/case-module/case-service-api/#changelocation","text":"Change the location of a Case. This also changes the location information on all related Form Responses.","title":"changeLocation"},{"location":"editor/case-module/case-service-api/#setvariable","text":"Set a Case level variable in a Case.","title":"setVariable"},{"location":"editor/case-module/case-service-api/#getvariable","text":"Get a Case level variable in a Case.","title":"getVariable"},{"location":"editor/case-module/case-service-api/#case-event-api","text":"","title":"Case Event API"},{"location":"editor/case-module/case-service-api/#createevent","text":"Dynamically create an instance of an event (defined in the case json) and add it to the current case","title":"createEvent"},{"location":"editor/case-module/case-service-api/#seteventestimatedday","text":"Set the estimated day of expected date completion. This is used by the calendar for displaying events. TODO: Improve Description","title":"setEventEstimatedDay"},{"location":"editor/case-module/case-service-api/#seteventscheduledday","text":"Set the scheduled day of expected date completion. This is used by the calendar for displaying events. TODO: Improve Description","title":"setEventScheduledDay"},{"location":"editor/case-module/case-service-api/#seteventwindow","text":"Set the expected event completion. TODO: Improve Description","title":"setEventWindow"},{"location":"editor/case-module/case-service-api/#seteventoccurredon","text":"Set the date in which the event occurred TODO: Improve Description","title":"setEventOccurredOn"},{"location":"editor/case-module/case-service-api/#disableeventdefinition","text":"Prevent creation of an via the new event menu.","title":"disableEventDefinition"},{"location":"editor/case-module/case-service-api/#event-form-api","text":"","title":"Event Form API"},{"location":"editor/case-module/case-service-api/#createeventform","text":"Dynamically create an instance of an event form (defined in the case json) and add it to the current Case.","title":"createEventForm"},{"location":"editor/case-module/case-service-api/#deleteeventform","text":"Dynamically delete an instance of an event form.","title":"deleteEventForm"},{"location":"editor/case-module/case-service-api/#seteventformdata","text":"Set a custom piece of data for an event form. Note this is a separate data collection than the data on the Form Response related to the Event Form.","title":"setEventFormData"},{"location":"editor/case-module/case-service-api/#geteventformdata","text":"Get a custom piece of data for an event form. Note this is a separate data collection than the data on the Form Response related to the Event Form.","title":"getEventFormData"},{"location":"editor/case-module/case-service-api/#markeventformrequired","text":"Mark an Even Form instance as being required. You might do this on a form that was optional, but it has come to lite that it must be filled out before the event is marked as complete.","title":"markEventFormRequired"},{"location":"editor/case-module/case-service-api/#markeventformnotrequired","text":"Mark and event form as not required.","title":"markEventFormNotRequired"},{"location":"editor/case-module/case-service-api/#participant-api","text":"","title":"Participant API"},{"location":"editor/case-module/case-service-api/#createparticipant","text":"Create a participant in a Case.","title":"createParticipant"},{"location":"editor/case-module/case-service-api/#setparticipantdata","text":"Set some data for a specific Participant.","title":"setParticipantData"},{"location":"editor/case-module/case-service-api/#getparticipantdata","text":"Get some data for a specific Participant.","title":"getParticipantData"},{"location":"editor/case-module/custom-case-reports/","text":"Custom Case Reports \u00b6 The Custom Case Reports features enables the developer to create custom reports or a dashboard. This feature is accessible using a tab when viewing a case. To enable this feature, add showCaseReports: true to the group's app-config.json. Demo and description of this feature's assets \u00b6 This demo is based on the case module content set ; therefore, you might want to install that in order to follow the demo. There are three files used for custom reports, which must be placed in the group directory. queries.js - has the map/reduce queries used to index the docs. Note that the sample queries.js file has a function called registrationResults with a map and a reduce query. The map function is explained above; the reduce uses Couchdb's built-in _sum keyword. The queries in this doc are installed when the app is installed. Support for updating these queries is not yet implemented. reports.js - runs the queries and fills out the content for reports.html. The reduce function is used to provide the counts in report2. The options in report2 options = {reduce: true} activate the reduce function. reports.html - provides a basic html frame for the data. Helper functions \u00b6 When writing queries or organizing the javascript logic to fetch the results, use the globally-exposed T.form.Get function to get the value of inputs; this will save you from having to wrote deeply nested code ( doc.items[0].inputs[3].value[0].value ) T.form.Get(doc, 'consent') Other helper function are available: T.user: userService T.case: caseService","title":"Custom Case Reports"},{"location":"editor/case-module/custom-case-reports/#custom-case-reports","text":"The Custom Case Reports features enables the developer to create custom reports or a dashboard. This feature is accessible using a tab when viewing a case. To enable this feature, add showCaseReports: true to the group's app-config.json.","title":"Custom Case Reports"},{"location":"editor/case-module/custom-case-reports/#demo-and-description-of-this-features-assets","text":"This demo is based on the case module content set ; therefore, you might want to install that in order to follow the demo. There are three files used for custom reports, which must be placed in the group directory. queries.js - has the map/reduce queries used to index the docs. Note that the sample queries.js file has a function called registrationResults with a map and a reduce query. The map function is explained above; the reduce uses Couchdb's built-in _sum keyword. The queries in this doc are installed when the app is installed. Support for updating these queries is not yet implemented. reports.js - runs the queries and fills out the content for reports.html. The reduce function is used to provide the counts in report2. The options in report2 options = {reduce: true} activate the reduce function. reports.html - provides a basic html frame for the data.","title":"Demo and description of this feature's assets"},{"location":"editor/case-module/custom-case-reports/#helper-functions","text":"When writing queries or organizing the javascript logic to fetch the results, use the globally-exposed T.form.Get function to get the value of inputs; this will save you from having to wrote deeply nested code ( doc.items[0].inputs[3].value[0].value ) T.form.Get(doc, 'consent') Other helper function are available: T.user: userService T.case: caseService","title":"Helper functions"},{"location":"editor/case-module/developing-custom-reports/","text":"Develop custom reports for Client \u00b6 LitElement Documentation LitElement Examples Web Components","title":"Develop custom reports for Client"},{"location":"editor/case-module/developing-custom-reports/#develop-custom-reports-for-client","text":"LitElement Documentation LitElement Examples Web Components","title":"Develop custom reports for Client"},{"location":"editor/case-module/get-and-set-event-data/","text":"For lack of a T.case.setEventData()/T.case.getEventData() API, use T.case.setVariable and T.case.getVariable with variable names that are namespaced using the Event ID. // 3 ingredients are needed to set an Event Variable. const eventId = '123' const variableName = 'foo' const variableValue = 'bar' // Set Event Variable. T . case . setVariable ( ` ${ eventId } - ${ variableName } ` , variableValue ) // Get Event Variable. const shouldBeValueOfBar = T . case . getVariable ( ` ${ eventId } - ${ variableName } ` ) There is an example in the case-module Content Set which consists of three parts: Event Definition with Event Form Definition referencing a Form that sets Event Data: https://github.com/Tangerine-Community/Tangerine/blob/master/content-sets/case-module/case-type-1.json#L159 Form that sets Event Data: https://github.com/Tangerine-Community/Tangerine/blob/master/content-sets/case-module/template-event-listing/form.html#L5 Template using Event Data: https://github.com/Tangerine-Community/Tangerine/blob/master/content-sets/case-module/case-type-1.json#L21","title":"Get and set event data"},{"location":"editor/case-module/how-to-create-a-workflow-for-changing-case-location/","text":"How to create a workflow for changing a Case's location \u00b6 Using a combination of a <tangy-location> input on a form and some logic in the same form's on-submit hook, you can empower users to reassign a Case to a new location. In the Case Module's Content Set we have a \"Change Location of Case\" Case Event Definition, a \"Change Location of Case\" Event Form, and corresponding \"Change Location of Case\" Form. We'll use that Content Set as our example. The form could be in any event, or even it's own event as it is in the Case Module content set. The important part is in the form you place the <tangy-location> for selecting a new locatoin to assign the case to. The following shows the markup of a form that uses the caseService.changeLocation() API to change the location of a Case given the value selected in the <tangy-location> input. < tangy-form title = \"Change location of case\" id = \"change-location-of-case\" on-submit = \" caseService.changeLocation(inputs.new_location_assignment.value) \" > < tangy-form-item id = \"item1\" > < tangy-location label = \"Choose a location to assign this case to.\" name = \"new_location_assignment\" required ></ tangy-location > </ tangy-form-item > </ tangy-form >","title":"How to create a workflow for changing a Case's location"},{"location":"editor/case-module/how-to-create-a-workflow-for-changing-case-location/#how-to-create-a-workflow-for-changing-a-cases-location","text":"Using a combination of a <tangy-location> input on a form and some logic in the same form's on-submit hook, you can empower users to reassign a Case to a new location. In the Case Module's Content Set we have a \"Change Location of Case\" Case Event Definition, a \"Change Location of Case\" Event Form, and corresponding \"Change Location of Case\" Form. We'll use that Content Set as our example. The form could be in any event, or even it's own event as it is in the Case Module content set. The important part is in the form you place the <tangy-location> for selecting a new locatoin to assign the case to. The following shows the markup of a form that uses the caseService.changeLocation() API to change the location of a Case given the value selected in the <tangy-location> input. < tangy-form title = \"Change location of case\" id = \"change-location-of-case\" on-submit = \" caseService.changeLocation(inputs.new_location_assignment.value) \" > < tangy-form-item id = \"item1\" > < tangy-location label = \"Choose a location to assign this case to.\" name = \"new_location_assignment\" required ></ tangy-location > </ tangy-form-item > </ tangy-form >","title":"How to create a workflow for changing a Case's location"},{"location":"editor/case-module/how-to-pass-data-between-forms-in-a-case/","text":"How to pass data between Forms in a Case \u00b6 Let's say you had two forms in a Case, Form X and Form Y. In Form X, you collect the respondent's first name and last name, meanwhile in Form Y you want to confirm the data they entered on Form X. Form X \u00b6 In Form X, we bubble up the first_name and last_name variables on Form X to the first_name and last_name variables at the Case level. < tangy-form id = \"form-x\" title = \"Form X\" on-submit = \" T.case.setVariable('first_name', getValue('first_name')) T.case.setVariable('last_name', getValue('last_name')) \" > < tangy-form-item id = \"item1\" > < tangy-input name = \"first_name\" label = \"First name\" required > < tangy-input name = \"last_name\" label = \"Last name\" required > </ tangy-form-item > </ tangy-form > Form Y \u00b6 In Form Y, we get the Case level variables of first_name and last_name and set them on the first_name and last_name inputs. This results in the form loading with the previously entered first and last names already filled out. < tangy-form id = \"form-y\" title = \"Form Y\" > < tangy-form-item id = \"item1\" on-open = \" inputs.first_name.value = T.case.getVariable('first_name') inputs.last_name.value = T.case.getVariable('last_name') \" > < tangy-input name = \"first_name\" label = \"Confirm your first name\" required > < tangy-input name = \"last_name\" label = \"Confirm your last name\" required > </ tangy-form-item > </ tangy-form >","title":"How to pass data between Forms in a Case"},{"location":"editor/case-module/how-to-pass-data-between-forms-in-a-case/#how-to-pass-data-between-forms-in-a-case","text":"Let's say you had two forms in a Case, Form X and Form Y. In Form X, you collect the respondent's first name and last name, meanwhile in Form Y you want to confirm the data they entered on Form X.","title":"How to pass data between Forms in a Case"},{"location":"editor/case-module/how-to-pass-data-between-forms-in-a-case/#form-x","text":"In Form X, we bubble up the first_name and last_name variables on Form X to the first_name and last_name variables at the Case level. < tangy-form id = \"form-x\" title = \"Form X\" on-submit = \" T.case.setVariable('first_name', getValue('first_name')) T.case.setVariable('last_name', getValue('last_name')) \" > < tangy-form-item id = \"item1\" > < tangy-input name = \"first_name\" label = \"First name\" required > < tangy-input name = \"last_name\" label = \"Last name\" required > </ tangy-form-item > </ tangy-form >","title":"Form X"},{"location":"editor/case-module/how-to-pass-data-between-forms-in-a-case/#form-y","text":"In Form Y, we get the Case level variables of first_name and last_name and set them on the first_name and last_name inputs. This results in the form loading with the previously entered first and last names already filled out. < tangy-form id = \"form-y\" title = \"Form Y\" > < tangy-form-item id = \"item1\" on-open = \" inputs.first_name.value = T.case.getVariable('first_name') inputs.last_name.value = T.case.getVariable('last_name') \" > < tangy-input name = \"first_name\" label = \"Confirm your first name\" required > < tangy-input name = \"last_name\" label = \"Confirm your last name\" required > </ tangy-form-item > </ tangy-form >","title":"Form Y"},{"location":"editor/case-module/how-to-use-form-response-data-in-an-event-form-listing/","text":"How to use Form Response data in an Event Form Listing \u00b6 The following tutorial uses content from the case-module Content Set found here . Step 1: On submit of a Form, capture data as a Case Level variable \u00b6 In Step 2, we'll template out data for the Event Form listing, but before we can do that we need to transfer some data from a form up to the Event Form data in the Case using the T.case.setEventFormData API. File: ./template-event-form-listing/form.html < tangy-form id = \"template-event-form-listing\" title = \"Template Event Form Listing\" on-submit = \" T.case.setEventFormData(caseEvent.id, eventForm.id, 'title', getValue('title')) \" > < tangy-form-item id = \"item-1\" > < tangy-input type = \"text\" name = \"title\" label = \"Set the custom title for this Event Form.\" ></ tangy-input > </ tangy-form-item > </ tangy-form > Step 2: Use templateCaseEventListItemPrimary property in the Case Definition to print the Case variable in the Event Listing \u00b6 After a user has submitted the Event Form mentioned above, we can now use the Event Form data for templating out Event listings. In the Case Definition, we add ternary to check if the variable exists, if it does then print it out in the listing, else show the name of the Event Form Definition. Section of File: ./case-definition-1.json \"templateEventFormListItemPrimary\": \"<span>${eventForm?.data?.title ? eventForm.data.title : eventFormDefinition.name}</span>\",","title":"How to use Form Response data in an Event Form Listing"},{"location":"editor/case-module/how-to-use-form-response-data-in-an-event-form-listing/#how-to-use-form-response-data-in-an-event-form-listing","text":"The following tutorial uses content from the case-module Content Set found here .","title":"How to use Form Response data in an Event Form Listing"},{"location":"editor/case-module/how-to-use-form-response-data-in-an-event-form-listing/#step-1-on-submit-of-a-form-capture-data-as-a-case-level-variable","text":"In Step 2, we'll template out data for the Event Form listing, but before we can do that we need to transfer some data from a form up to the Event Form data in the Case using the T.case.setEventFormData API. File: ./template-event-form-listing/form.html < tangy-form id = \"template-event-form-listing\" title = \"Template Event Form Listing\" on-submit = \" T.case.setEventFormData(caseEvent.id, eventForm.id, 'title', getValue('title')) \" > < tangy-form-item id = \"item-1\" > < tangy-input type = \"text\" name = \"title\" label = \"Set the custom title for this Event Form.\" ></ tangy-input > </ tangy-form-item > </ tangy-form >","title":"Step 1: On submit of a Form, capture data as a Case Level variable"},{"location":"editor/case-module/how-to-use-form-response-data-in-an-event-form-listing/#step-2-use-templatecaseeventlistitemprimary-property-in-the-case-definition-to-print-the-case-variable-in-the-event-listing","text":"After a user has submitted the Event Form mentioned above, we can now use the Event Form data for templating out Event listings. In the Case Definition, we add ternary to check if the variable exists, if it does then print it out in the listing, else show the name of the Event Form Definition. Section of File: ./case-definition-1.json \"templateEventFormListItemPrimary\": \"<span>${eventForm?.data?.title ? eventForm.data.title : eventFormDefinition.name}</span>\",","title":"Step 2: Use templateCaseEventListItemPrimary property in the Case Definition to print the Case variable in the Event Listing"},{"location":"editor/case-module/how-to-use-form-response-data-in-an-event-listing/","text":"How to use Form Response data in an Event Listing \u00b6 The following tutorial uses content from the case-module Content Set found here . Step 1: On submit of a Form, capture data as a Case Level variable \u00b6 In Step 2, we'll template out data for the event listing, but before we can do that we need to transfer some data from a form up to the Case level variable. In the example below, we bubble up the title variable in the form to a title variable on the Case. However, note how we prepend the current Event ID on the case level title variable. This is important to do if you are going to bubble up variables that may have the same name across events. By prepending the current Event ID, we guarantee that any other Event that bubbles up a title variable will not overwrite the title variable for this Event. File: ./template-event-listing/form.html < tangy-form id = \"template-event-listing\" title = \"Template Event Listing\" on-submit = \" T.case.setVariable(`${caseEvent.id}-title`, getValue('title')) \" > < tangy-form-item id = \"item-1\" > < tangy-input type = \"text\" name = \"title\" label = \"Set the custom title for this event.\" ></ tangy-input > </ tangy-form-item > </ tangy-form > Step 2: Use templateCaseEventListItemPrimary property in the Case Definition to print the Case variable in the Event Listing \u00b6 After a user has submitted the Event Form mentioned above, we can now get that Case level variable when templating out Event listings. In the Case Definition, we add ternary to check if the variable exists, if it does then print it out in the listing, else show the name of the Event Definition. Note how we are again referencing the variable name by preprending the Event ID on the variable name. This ensures we are getting the title variable for that specific event and not accidentally overriding other/all event listings. Section of File: ./case-definition-1.json \"templateCaseEventListItemPrimary\": \"<span>${T.case.getVariable(`${caseEvent.id}-title`) ? T.case.getVariable(`${caseEvent.id}-title`) : caseEventDefinition.name}</span>\",","title":"How to use Form Response data in an Event Listing"},{"location":"editor/case-module/how-to-use-form-response-data-in-an-event-listing/#how-to-use-form-response-data-in-an-event-listing","text":"The following tutorial uses content from the case-module Content Set found here .","title":"How to use Form Response data in an Event Listing"},{"location":"editor/case-module/how-to-use-form-response-data-in-an-event-listing/#step-1-on-submit-of-a-form-capture-data-as-a-case-level-variable","text":"In Step 2, we'll template out data for the event listing, but before we can do that we need to transfer some data from a form up to the Case level variable. In the example below, we bubble up the title variable in the form to a title variable on the Case. However, note how we prepend the current Event ID on the case level title variable. This is important to do if you are going to bubble up variables that may have the same name across events. By prepending the current Event ID, we guarantee that any other Event that bubbles up a title variable will not overwrite the title variable for this Event. File: ./template-event-listing/form.html < tangy-form id = \"template-event-listing\" title = \"Template Event Listing\" on-submit = \" T.case.setVariable(`${caseEvent.id}-title`, getValue('title')) \" > < tangy-form-item id = \"item-1\" > < tangy-input type = \"text\" name = \"title\" label = \"Set the custom title for this event.\" ></ tangy-input > </ tangy-form-item > </ tangy-form >","title":"Step 1: On submit of a Form, capture data as a Case Level variable"},{"location":"editor/case-module/how-to-use-form-response-data-in-an-event-listing/#step-2-use-templatecaseeventlistitemprimary-property-in-the-case-definition-to-print-the-case-variable-in-the-event-listing","text":"After a user has submitted the Event Form mentioned above, we can now get that Case level variable when templating out Event listings. In the Case Definition, we add ternary to check if the variable exists, if it does then print it out in the listing, else show the name of the Event Definition. Note how we are again referencing the variable name by preprending the Event ID on the variable name. This ensures we are getting the title variable for that specific event and not accidentally overriding other/all event listings. Section of File: ./case-definition-1.json \"templateCaseEventListItemPrimary\": \"<span>${T.case.getVariable(`${caseEvent.id}-title`) ? T.case.getVariable(`${caseEvent.id}-title`) : caseEventDefinition.name}</span>\",","title":"Step 2: Use templateCaseEventListItemPrimary property in the Case Definition to print the Case variable in the Event Listing"},{"location":"editor/case-module/prepare-form-logic-for-issues/","text":"Preparing form logic for compatibility with Issues \u00b6 Issues is a server level feature in Tangerine that allows privileged users to make proposals on changes to Form Responses. When a user is proposing changes, the system unlocks an already completed form. Form Developers must be careful when writing logic they only expect to be ran once in a form. For example, setting a \"caseOpenedOn\" variable in the on-open of a form. When a form is reopened in an Issue, the logic could potentially overwrite the \"caseOpenedOn\" variable using the current date of the proposed change. < tangy-form on-open = \" T.case.setVariable('caseOpenedOn', moment.now()) \" > This can be remedied by using the T.case.isIssueContext() helper function to ensure our variable setting does not happen in a reopen in the issue context. < tangy-form on-open = \" if (!T.case.isIssueContext()) { T.case.setVariable('caseOpenedOn', moment.now()) } \" > The same is true if you have any <tangy-form-item> level on-open or on-change logic that should not run in when being modified in an Issue. However, writing <tangy-form> logic for on-submit is a little different because on-submit code will not run when in the Issue context. Instead, if some code does need to run, place it in the on-resubmit code for a <tangy-form> . Note in the following example how we only set caseOpenedOn in on-submit . This ensure this variable will only be set once. However, note how put the setting of firstName and lastName in the on-resubmit . This ensures that if the proposed change to this Form Response changes the firstName or lastName values, the Case will be updated to reflect this proposed change. < tangy-form on-submit = \" T.case.setVariable('caseOpenedOn', moment.now()) T.case.setVariable('firstName', getValue('firstName')) T.case.setVariable('lastName', getValue('firstName')) \" on-resubmit = \" T.case.setVariable('firstName', getValue('firstName')) T.case.setVariable('lastName', getValue('firstName')) \" > There are also many input types such as GPS and Signature where it often does not make sense to recollect data upon submitting a proposal on an Issue. Consider adding disable-if=\"T.case.isIssueContext()\" to these inputs. < tangy-gps name = \"gps\" disable-if = \"T.case.isIssueContext()\" ></ tangy-gps > < tangy-signature name = \"signature\" disable-if = \"T.case.isIssueContext()\" ></ tangy-signature >","title":"Preparing form logic for compatibility with Issues"},{"location":"editor/case-module/prepare-form-logic-for-issues/#preparing-form-logic-for-compatibility-with-issues","text":"Issues is a server level feature in Tangerine that allows privileged users to make proposals on changes to Form Responses. When a user is proposing changes, the system unlocks an already completed form. Form Developers must be careful when writing logic they only expect to be ran once in a form. For example, setting a \"caseOpenedOn\" variable in the on-open of a form. When a form is reopened in an Issue, the logic could potentially overwrite the \"caseOpenedOn\" variable using the current date of the proposed change. < tangy-form on-open = \" T.case.setVariable('caseOpenedOn', moment.now()) \" > This can be remedied by using the T.case.isIssueContext() helper function to ensure our variable setting does not happen in a reopen in the issue context. < tangy-form on-open = \" if (!T.case.isIssueContext()) { T.case.setVariable('caseOpenedOn', moment.now()) } \" > The same is true if you have any <tangy-form-item> level on-open or on-change logic that should not run in when being modified in an Issue. However, writing <tangy-form> logic for on-submit is a little different because on-submit code will not run when in the Issue context. Instead, if some code does need to run, place it in the on-resubmit code for a <tangy-form> . Note in the following example how we only set caseOpenedOn in on-submit . This ensure this variable will only be set once. However, note how put the setting of firstName and lastName in the on-resubmit . This ensures that if the proposed change to this Form Response changes the firstName or lastName values, the Case will be updated to reflect this proposed change. < tangy-form on-submit = \" T.case.setVariable('caseOpenedOn', moment.now()) T.case.setVariable('firstName', getValue('firstName')) T.case.setVariable('lastName', getValue('firstName')) \" on-resubmit = \" T.case.setVariable('firstName', getValue('firstName')) T.case.setVariable('lastName', getValue('firstName')) \" > There are also many input types such as GPS and Signature where it often does not make sense to recollect data upon submitting a proposal on an Issue. Consider adding disable-if=\"T.case.isIssueContext()\" to these inputs. < tangy-gps name = \"gps\" disable-if = \"T.case.isIssueContext()\" ></ tangy-gps > < tangy-signature name = \"signature\" disable-if = \"T.case.isIssueContext()\" ></ tangy-signature >","title":"Preparing form logic for compatibility with Issues"},{"location":"editor/case-module/role-base-access/","text":"Role Based Access \u00b6 A Device Users' Role can be used restrict access to specific Case Events, Event Forms, and inputs on Forms. Getting started with using Device User Roles Demo: Device User role based access to Event Forms Demo: Device user role based permissions for Case Events To retrict access to an input on a form by role, use the T.user.getRoles() function to get the roles of the currently logged in user. < tangy-input name = \"example\" label = \"Example\" show-if = \"T.user.getRoles().includes('admin')\" > </ tangy-input >","title":"Role Based Access"},{"location":"editor/case-module/role-base-access/#role-based-access","text":"A Device Users' Role can be used restrict access to specific Case Events, Event Forms, and inputs on Forms. Getting started with using Device User Roles Demo: Device User role based access to Event Forms Demo: Device user role based permissions for Case Events To retrict access to an input on a form by role, use the T.user.getRoles() function to get the roles of the currently logged in user. < tangy-input name = \"example\" label = \"Example\" show-if = \"T.user.getRoles().includes('admin')\" > </ tangy-input >","title":"Role Based Access"},{"location":"editor/form-developers-cookbook/","text":"The Tangerine Form Editor's Cookbook \u00b6 Examples of various recipes for Tangerine Forms collected throughout the years. To create your own example, remix the example on glitch.com. Skip a question based on input in another question \u00b6 In the following example we ask an additional question about tangerines if the user indicates that they do like tangerines. Run example - Open Editor - View Code Skip sections based on input \u00b6 In the following example, wether or not you answer yes or no to the question, you will end up on a different item. Run example - Open Editor - View Code Valid by number of decimal points \u00b6 In the following example, we validate user input by number of decimal points. Run example - Open Editor - View Code Valid if greater or less than other input \u00b6 Run example - Open Editor - View Code Allowed date range based on today \u00b6 Run example - Open Editor - View Code Flag choice as discrepancy and/or warning and show or hide content depending \u00b6 Run example - Open Editor - View Code Indicate a mutually exclusive option in a checkboxes group such as \"None of the above\" \u00b6 In the following example when you make a selection of a fruit and then choose one of the mutually exclusive options, your prior selections will be deselected. Run example - Open Editor - View Code Capture and show local date and time \u00b6 Sometimes we want to show the user the local date and time to ensure their time settings are correct. Run example - Open Editor - View Code Show a timer in an item \u00b6 Let's say you want to show a timer of how long someone has been on a single item. This calculates the time since item open and displays number of seconds since then in a tangy-box. Run example - Open Editor - View Code Capture the time between two items \u00b6 Sometimes we want to know how much time passed between two points in a form. This example captures, the start_time variable on the first item, then end_time on the last item. Lastly it calculates the length of time. Run example - Open Editor - View Code Hard checks vs. soft checks \u00b6 A \"hard check\" using \"valid if\" will not allow you to proceed. However a \"soft check\" using \"warn if\" will allow you to proceed after confirming. Run example - Open Editor - View Code Set selected value in radio buttons \u00b6 In the following example we set the value of a <tangy-radio-buttons> . Run example - Open Editor - View Code Dynamically prevent proceeding to next section \u00b6 In the following example hide the next button given the value of some user input. Run example - Open Editor - View Code Proactive input validation \u00b6 In the following example we validate an input after focusing on the next input. This approach is more proactive than running the validation logic when clicking next or submit. Run example - Open Editor - View Code Content Box with Tabs \u00b6 In the following example we display content in a set of tabs. Run example - Open Editor - View Code Dynamic Changing of Text Color \u00b6 In the following example we change the color of text depending on a user's selection. Run example - Open Editor - View Code Use skip-if to reference variable inside tangy-inputs-group \u00b6 In the following example a skip-if refers to an other variable local to the group itself is in. The trick is using backticks around the variable name (not quotes) you are referencing and prepending the variable name you are referencing with ${context.split('.')[0]}.${context.split('.')[1]}. . Run example - Open Editor - View Code Use valid-if to reference variable inside tangy-inputs-group \u00b6 In the following example a valid-if refers to an other variable local to the group itself is in. The trick is using backticks around the variable name (not quotes) you are referencing and prepending the variable name you are referencing with ${input.name.split('.')[0]}.${input.name.split('.')[1]}. . Watch out for the gotcha of not using input.name instead of context like we do in a skip-if . Run example - Open Editor - View Code Dynamic Location Level \u00b6 In the following example we empower the Data Collector to select which Location Level at which they will provide their answer. This example can also be used in a more advanced way to base the level of location required for entry given some other set of inputs. Run example - Open Editor - View Code Prevent user from proceeding during asynchronous logic \u00b6 Sometimes in a form the logic calls for running some code that is asynchronous such as database saves and HTTP calls. As this logic runs, we would like to prevent the user from proceeding in the form. This is a job for a <tangy-gate> . Tangy Gate is an input that by default will not allow a user to proceed in a form. The gate can only be \"opened\" by some form logic that set's that Tangy Gate's variable name's value to true . This gives your logic in your forms an opportunity to run asynchronously, blocking the user from proceeding, then when async code is done your code sets the the gate to open. Run example - Open Editor - View Code","title":"The Tangerine Form Editor's Cookbook"},{"location":"editor/form-developers-cookbook/#the-tangerine-form-editors-cookbook","text":"Examples of various recipes for Tangerine Forms collected throughout the years. To create your own example, remix the example on glitch.com.","title":"The Tangerine Form Editor's Cookbook"},{"location":"editor/form-developers-cookbook/#skip-a-question-based-on-input-in-another-question","text":"In the following example we ask an additional question about tangerines if the user indicates that they do like tangerines. Run example - Open Editor - View Code","title":"Skip a question based on input in another question"},{"location":"editor/form-developers-cookbook/#skip-sections-based-on-input","text":"In the following example, wether or not you answer yes or no to the question, you will end up on a different item. Run example - Open Editor - View Code","title":"Skip sections based on input"},{"location":"editor/form-developers-cookbook/#valid-by-number-of-decimal-points","text":"In the following example, we validate user input by number of decimal points. Run example - Open Editor - View Code","title":"Valid by number of decimal points"},{"location":"editor/form-developers-cookbook/#valid-if-greater-or-less-than-other-input","text":"Run example - Open Editor - View Code","title":"Valid if greater or less than other input"},{"location":"editor/form-developers-cookbook/#allowed-date-range-based-on-today","text":"Run example - Open Editor - View Code","title":"Allowed date range based on today"},{"location":"editor/form-developers-cookbook/#flag-choice-as-discrepancy-andor-warning-and-show-or-hide-content-depending","text":"Run example - Open Editor - View Code","title":"Flag choice as discrepancy and/or warning and show or hide content depending"},{"location":"editor/form-developers-cookbook/#indicate-a-mutually-exclusive-option-in-a-checkboxes-group-such-as-none-of-the-above","text":"In the following example when you make a selection of a fruit and then choose one of the mutually exclusive options, your prior selections will be deselected. Run example - Open Editor - View Code","title":"Indicate a mutually exclusive option in a checkboxes group such as \"None of the above\""},{"location":"editor/form-developers-cookbook/#capture-and-show-local-date-and-time","text":"Sometimes we want to show the user the local date and time to ensure their time settings are correct. Run example - Open Editor - View Code","title":"Capture and show local date and time"},{"location":"editor/form-developers-cookbook/#show-a-timer-in-an-item","text":"Let's say you want to show a timer of how long someone has been on a single item. This calculates the time since item open and displays number of seconds since then in a tangy-box. Run example - Open Editor - View Code","title":"Show a timer in an item"},{"location":"editor/form-developers-cookbook/#capture-the-time-between-two-items","text":"Sometimes we want to know how much time passed between two points in a form. This example captures, the start_time variable on the first item, then end_time on the last item. Lastly it calculates the length of time. Run example - Open Editor - View Code","title":"Capture the time between two items"},{"location":"editor/form-developers-cookbook/#hard-checks-vs-soft-checks","text":"A \"hard check\" using \"valid if\" will not allow you to proceed. However a \"soft check\" using \"warn if\" will allow you to proceed after confirming. Run example - Open Editor - View Code","title":"Hard checks vs. soft checks"},{"location":"editor/form-developers-cookbook/#set-selected-value-in-radio-buttons","text":"In the following example we set the value of a <tangy-radio-buttons> . Run example - Open Editor - View Code","title":"Set selected value in radio buttons"},{"location":"editor/form-developers-cookbook/#dynamically-prevent-proceeding-to-next-section","text":"In the following example hide the next button given the value of some user input. Run example - Open Editor - View Code","title":"Dynamically prevent proceeding to next section"},{"location":"editor/form-developers-cookbook/#proactive-input-validation","text":"In the following example we validate an input after focusing on the next input. This approach is more proactive than running the validation logic when clicking next or submit. Run example - Open Editor - View Code","title":"Proactive input validation"},{"location":"editor/form-developers-cookbook/#content-box-with-tabs","text":"In the following example we display content in a set of tabs. Run example - Open Editor - View Code","title":"Content Box with Tabs"},{"location":"editor/form-developers-cookbook/#dynamic-changing-of-text-color","text":"In the following example we change the color of text depending on a user's selection. Run example - Open Editor - View Code","title":"Dynamic Changing of Text Color"},{"location":"editor/form-developers-cookbook/#use-skip-if-to-reference-variable-inside-tangy-inputs-group","text":"In the following example a skip-if refers to an other variable local to the group itself is in. The trick is using backticks around the variable name (not quotes) you are referencing and prepending the variable name you are referencing with ${context.split('.')[0]}.${context.split('.')[1]}. . Run example - Open Editor - View Code","title":"Use skip-if to reference variable inside tangy-inputs-group"},{"location":"editor/form-developers-cookbook/#use-valid-if-to-reference-variable-inside-tangy-inputs-group","text":"In the following example a valid-if refers to an other variable local to the group itself is in. The trick is using backticks around the variable name (not quotes) you are referencing and prepending the variable name you are referencing with ${input.name.split('.')[0]}.${input.name.split('.')[1]}. . Watch out for the gotcha of not using input.name instead of context like we do in a skip-if . Run example - Open Editor - View Code","title":"Use valid-if to reference variable inside tangy-inputs-group"},{"location":"editor/form-developers-cookbook/#dynamic-location-level","text":"In the following example we empower the Data Collector to select which Location Level at which they will provide their answer. This example can also be used in a more advanced way to base the level of location required for entry given some other set of inputs. Run example - Open Editor - View Code","title":"Dynamic Location Level"},{"location":"editor/form-developers-cookbook/#prevent-user-from-proceeding-during-asynchronous-logic","text":"Sometimes in a form the logic calls for running some code that is asynchronous such as database saves and HTTP calls. As this logic runs, we would like to prevent the user from proceeding in the form. This is a job for a <tangy-gate> . Tangy Gate is an input that by default will not allow a user to proceed in a form. The gate can only be \"opened\" by some form logic that set's that Tangy Gate's variable name's value to true . This gives your logic in your forms an opportunity to run asynchronously, blocking the user from proceeding, then when async code is done your code sets the the gate to open. Run example - Open Editor - View Code","title":"Prevent user from proceeding during asynchronous logic"},{"location":"editor/getting-started-editor/add-sections/","text":"Adding Sections and Question to a Form \u00b6 To add a new section to your instrument, hit \"ADD SECTION\". The interface allows a drag-and-drop feature which enables reordering of the sections already created. The order in which the sections are listed, is the same as the sequence of screens that will be shown on the tablet when the tablet user is filling in the form. Section Editor \u00b6 Upon adding a new section, or selecting to \"EDIT\" your instrument section, you will see the section editor screen below. If this is a new section, you might give it a new name from the section header. Click the pen icon on the right of the blue bar and overwrite the \"title\". Or any other of the configuration options. Then hit SUBMIT to save your edits. Section Options \u00b6 Each one of the sections has some options that you can control: Show this section in the summary at the end -- mark only if this section is the last one, and if you have coded some summary/feedback otherwise leave unchecked. Hide the back button -- checking this option will remove the Back button from the section when rendered on the tablet. Hide the next button -- hides the Next button on a section. Sometimes advancing the page may depend on the selection of an item, just like it is on some EF inputs. Generally, you keep this unchecked. right-to-left orientation -- switches the position of the Back and Next buttons for RTL languages. Hide navigation labels -- Hides the label from the Back and Next buttons so that it becomes an arrow. Hide navigation icons -- Hides the arrow from the back and Next buttons. If both this and the above are checked you will only see an orange button without labels and text. Threshold: Number of incorrect answers before disabling remaining questions -- This option is used in conjunction with radio button questions only. Set it to the number of consecutive incorrect replies before the test is discontinued. You must mark an option in the radio button group as Correct for this to work. Only one correct option per question can be defined. To add an item to your instrument section, click This opens the item type selection interface. These elements are subdivided into groups of item types (e.g., inputs, location, lists, misc): Inputs \u00b6 INPUT-DATE: This item type renders a calendar widget on the tablet INPUT-TEXT: This item type is a standard numbers and letters field INPUT-TIME: This item type displays a clock hour selection on the tablet INPUT-NUMBER: This item type opens up the number keyboard on the tablet and doesn't allow any other non-number characters to be inserted here Location \u00b6 GPS: This item type automatically collects GPS coordinates of the tablet LOCATION: The location item type requires a list of locations, e.g. school names by district and region to be imported to the Tangerine editor. Check out the location list section Lists \u00b6 CHECKBOX: This item type allows for multiple answers to be selected from a list of options CHECKBOX GROUP: Allows for multiple answer options to be selected from a group of options DROPDOWN (select): This item type allows for a single answer selection for longer lists RADIO BUTTONS: This item type only allows for a single answer selection from a list of answer options Miscellaneous \u00b6 IMAGE: the image items allows you to select an image already uploaded by the media library and present it to the user on a particular section SIGNATURE: this input type allows you to capture a signature by the assessor. HTML CONTENT CONTAINER: This item type allows for flexible integration of headers, help text, or transition messages that do not require any user input or response. QR CODE SCANNER: This item allows scanning of a QR and Data Matrix codes. Tangerine will capture and save the target info (e.g. URL). EF TOUCH: This item type is to assess children's executive functions, including working memory, inhibitory control, and cognitive flexibility (requires RTI manual support to upload your images and sounds). TIMED GRID: This item type facilitates timed assessment approaches, e.g., to assess letter sound knowledge, oral reading fluency or math operations. UNTIMED GRID: This item type facilitates assessment approaches that are not timed, but require many items, e.g. oral counting, untimed reading comprehension tasks, etc. CONSENT: This item is a special function for participant consent. If the participants responds that no consent is given, the form will be closed and data saved accordingly. Depending on the element chosen, an interface for providing more detail on the item being rendered/created is presented in the Item Editor.","title":"Adding Sections and Question to a Form"},{"location":"editor/getting-started-editor/add-sections/#adding-sections-and-question-to-a-form","text":"To add a new section to your instrument, hit \"ADD SECTION\". The interface allows a drag-and-drop feature which enables reordering of the sections already created. The order in which the sections are listed, is the same as the sequence of screens that will be shown on the tablet when the tablet user is filling in the form.","title":"Adding Sections and Question to a Form"},{"location":"editor/getting-started-editor/add-sections/#section-editor","text":"Upon adding a new section, or selecting to \"EDIT\" your instrument section, you will see the section editor screen below. If this is a new section, you might give it a new name from the section header. Click the pen icon on the right of the blue bar and overwrite the \"title\". Or any other of the configuration options. Then hit SUBMIT to save your edits.","title":"Section Editor"},{"location":"editor/getting-started-editor/add-sections/#section-options","text":"Each one of the sections has some options that you can control: Show this section in the summary at the end -- mark only if this section is the last one, and if you have coded some summary/feedback otherwise leave unchecked. Hide the back button -- checking this option will remove the Back button from the section when rendered on the tablet. Hide the next button -- hides the Next button on a section. Sometimes advancing the page may depend on the selection of an item, just like it is on some EF inputs. Generally, you keep this unchecked. right-to-left orientation -- switches the position of the Back and Next buttons for RTL languages. Hide navigation labels -- Hides the label from the Back and Next buttons so that it becomes an arrow. Hide navigation icons -- Hides the arrow from the back and Next buttons. If both this and the above are checked you will only see an orange button without labels and text. Threshold: Number of incorrect answers before disabling remaining questions -- This option is used in conjunction with radio button questions only. Set it to the number of consecutive incorrect replies before the test is discontinued. You must mark an option in the radio button group as Correct for this to work. Only one correct option per question can be defined. To add an item to your instrument section, click This opens the item type selection interface. These elements are subdivided into groups of item types (e.g., inputs, location, lists, misc):","title":"Section Options"},{"location":"editor/getting-started-editor/add-sections/#inputs","text":"INPUT-DATE: This item type renders a calendar widget on the tablet INPUT-TEXT: This item type is a standard numbers and letters field INPUT-TIME: This item type displays a clock hour selection on the tablet INPUT-NUMBER: This item type opens up the number keyboard on the tablet and doesn't allow any other non-number characters to be inserted here","title":"Inputs"},{"location":"editor/getting-started-editor/add-sections/#location","text":"GPS: This item type automatically collects GPS coordinates of the tablet LOCATION: The location item type requires a list of locations, e.g. school names by district and region to be imported to the Tangerine editor. Check out the location list section","title":"Location"},{"location":"editor/getting-started-editor/add-sections/#lists","text":"CHECKBOX: This item type allows for multiple answers to be selected from a list of options CHECKBOX GROUP: Allows for multiple answer options to be selected from a group of options DROPDOWN (select): This item type allows for a single answer selection for longer lists RADIO BUTTONS: This item type only allows for a single answer selection from a list of answer options","title":"Lists"},{"location":"editor/getting-started-editor/add-sections/#miscellaneous","text":"IMAGE: the image items allows you to select an image already uploaded by the media library and present it to the user on a particular section SIGNATURE: this input type allows you to capture a signature by the assessor. HTML CONTENT CONTAINER: This item type allows for flexible integration of headers, help text, or transition messages that do not require any user input or response. QR CODE SCANNER: This item allows scanning of a QR and Data Matrix codes. Tangerine will capture and save the target info (e.g. URL). EF TOUCH: This item type is to assess children's executive functions, including working memory, inhibitory control, and cognitive flexibility (requires RTI manual support to upload your images and sounds). TIMED GRID: This item type facilitates timed assessment approaches, e.g., to assess letter sound knowledge, oral reading fluency or math operations. UNTIMED GRID: This item type facilitates assessment approaches that are not timed, but require many items, e.g. oral counting, untimed reading comprehension tasks, etc. CONSENT: This item is a special function for participant consent. If the participants responds that no consent is given, the form will be closed and data saved accordingly. Depending on the element chosen, an interface for providing more detail on the item being rendered/created is presented in the Item Editor.","title":"Miscellaneous"},{"location":"editor/getting-started-editor/create-new-form/","text":"Creating a New Instrument/Form \u00b6 Prerequisite: Existing group or create a new Group \u00b6 After creating a group or opening an existing one, you will be presented with various options. The first action that you may wish to take is to create a new Form From the main menu options, select Author and then click Forms. This will bring up a listing of all forms for this group. You will notice that there is also a User Profile form. This form represents the profile each user has to fill in on the tablet, after they create their user login details. All information that you require in the user profile is attached to each record in the CSV export file. The user profile represents your assessor's information. Click the plus icon to create a new form. A new form with a default name is created and a default section is placed into this form. To change the form's name, type in the new text and click Save. Form Actions \u00b6 Beside each of the forms you will see some action available. From here you can Edit, Print, Copy, Delete, or Archive a form. We recommend that you archive your forms instead of removing them. This will ensure that you can export the data of a form that is no longer in use. Click on the pen icon to modify the form. Each form contains a number of sections that represent your form's pages Click on the print icon to open a new printable menu where you can select two of the print details. This printable view we often use to quality assure (QA) the instrument or to get a list of variables and their definition. You can also use the print screen to save paper copy of your form. Click on the copy icon to create a copy of the current instrument. You can copy an instrument to a different group or to the current one. Click on the trash icon to delete this form. Click on the archive icon to archive an assessment. All archived forms are moved to the bottom of the page If a form is archived, click the un-archive button to activate a form. Only active forms are displayed in tablet listing of forms to the assessor.","title":"Creating a New Instrument/Form"},{"location":"editor/getting-started-editor/create-new-form/#creating-a-new-instrumentform","text":"","title":"Creating a New Instrument/Form"},{"location":"editor/getting-started-editor/create-new-form/#prerequisite-existing-group-or-create-a-new-group","text":"After creating a group or opening an existing one, you will be presented with various options. The first action that you may wish to take is to create a new Form From the main menu options, select Author and then click Forms. This will bring up a listing of all forms for this group. You will notice that there is also a User Profile form. This form represents the profile each user has to fill in on the tablet, after they create their user login details. All information that you require in the user profile is attached to each record in the CSV export file. The user profile represents your assessor's information. Click the plus icon to create a new form. A new form with a default name is created and a default section is placed into this form. To change the form's name, type in the new text and click Save.","title":"Prerequisite: Existing group or create a new Group"},{"location":"editor/getting-started-editor/create-new-form/#form-actions","text":"Beside each of the forms you will see some action available. From here you can Edit, Print, Copy, Delete, or Archive a form. We recommend that you archive your forms instead of removing them. This will ensure that you can export the data of a form that is no longer in use. Click on the pen icon to modify the form. Each form contains a number of sections that represent your form's pages Click on the print icon to open a new printable menu where you can select two of the print details. This printable view we often use to quality assure (QA) the instrument or to get a list of variables and their definition. You can also use the print screen to save paper copy of your form. Click on the copy icon to create a copy of the current instrument. You can copy an instrument to a different group or to the current one. Click on the trash icon to delete this form. Click on the archive icon to archive an assessment. All archived forms are moved to the bottom of the page If a form is archived, click the un-archive button to activate a form. Only active forms are displayed in tablet listing of forms to the assessor.","title":"Form Actions"},{"location":"editor/getting-started-editor/create-new-group/","text":"Creating a New Group \u00b6 Upon logging into your Tangerine instance, you will see a screen listing your Tangerine groups. You might think of groups as discrete data collection efforts that might contain several instruments or forms. If you have, e.g., a baseline data collection and an endline data collection for the same project, you might make these two different groups. When packaging your instruments into the apk (.apk is the application installation file format for Android devices) for installation on an Android device, Tangerine packages all instruments in a group. Thus, you should set up groups and categorize instruments accordingly. On the main group listing page, click \"+\" button in the bottom right corner to create a new group Enter a name for your group and click Submit WARNING: If you are using the free service you are not able to create new groups. If you are a Tangerine subscriber, or run Tangerine on your own server, the user1 account can be configured to be the only account with permissions to create new groups. If this is desired, please send a request for this configuration to support@tangerinehelp.zendesk.com Any Admin user can create a new group unless configured for the user1 account only","title":"Creating a New Group"},{"location":"editor/getting-started-editor/create-new-group/#creating-a-new-group","text":"Upon logging into your Tangerine instance, you will see a screen listing your Tangerine groups. You might think of groups as discrete data collection efforts that might contain several instruments or forms. If you have, e.g., a baseline data collection and an endline data collection for the same project, you might make these two different groups. When packaging your instruments into the apk (.apk is the application installation file format for Android devices) for installation on an Android device, Tangerine packages all instruments in a group. Thus, you should set up groups and categorize instruments accordingly. On the main group listing page, click \"+\" button in the bottom right corner to create a new group Enter a name for your group and click Submit WARNING: If you are using the free service you are not able to create new groups. If you are a Tangerine subscriber, or run Tangerine on your own server, the user1 account can be configured to be the only account with permissions to create new groups. If this is desired, please send a request for this configuration to support@tangerinehelp.zendesk.com Any Admin user can create a new group unless configured for the user1 account only","title":"Creating a New Group"},{"location":"editor/getting-started-editor/downloading-your-data/","text":"Downloading your data (Download CSV) \u00b6 Tangerine provides a download CSV function that is accessible from the Data section. Click Data->Download CSV. Here you will see a listing of all forms and a download icon beside each one of them. Click the download icon to get to the download screen page. to see the interface below. From here, you can select the results for a specific month or year of data collection. On this page you will see a selection for Month, Year and personally identifiable information (PII). Please select the desired month and year for the CSV export file, or keep the * selection for all months and year of the data collection. If want to get anonymized data for sending to third parties, select the Exclude PII checkbox and then click Submit. Warning To make use of the Exclude PII function, all of your personally identifiable inputs must be marked like such on the input edit page, or when inserting a new input/question on the insert new input page. Warning To be able to download all the data select the * on both Month and Year and click the SUBMIT button. If the CSV generation was successful, the following screen will present the group name, Form id , Start time and progress of the CSV download. Click Download to download the file. Once the CSV has been downloaded, you can find it in your Downloads folder. Metadata included in CSV \u00b6 Each csv output from data collected by Tangerine has a set of metadata variables that are automatically output. Here is the current list: Variable Name Meaning _id 32-digit uuid identifying the unique form taken formId text name of the form startUnixtime unix timestamp that the form was first opened endUnixtime unix timestamp that the form was completed lastSaveUnixtime unix timestamp that the form was last opened and saved buildId 32-digit uuid identifying the app version buildChannel type of build: will be either build or production deviceId 32-digit uuid identifying the registered device groupId identifyer of the Tangerine group to which this device is registered complete TRUE or FALSE, whether the form is complete tangerineModifiedByUserId 3 2-digit uuid identifying the registered user who filled the form caseId 32-digit uuid identifying the Case the form is associated with eventId 32-digit uuid identifying the Event within the Case that the form is associated with eventFormId 32-digit uuid identifying the Form within the Event within the Case that the form is associated with participantId 32-digit uuid identifying the participant for whom the form was filled User Profile Metadata \u00b6 The information for the user logged in to the Tangerine app is also included in the CSV outputs. This includes the metadata below. The location metadata is based on the location defined in the location list. The table below includes three location levels as an example. Variable Name Meaning user-profile._id 32-digit uuid identifying the registered user who filled the form user-profile.item-1_firstOpenTime unix timestamp of when the form was opened user-profile.item-1.first_name user's first name user-profile.item-1.last_name user's last name user-profile.item-1.gender user's gender user-profile.item-1.phone user's phone number user-profile.item-1.location.Region user's assigned Region user-profile.item-1.location.District user's assigned District user-profile.item-1.location.Village user's assigned Village","title":"Downloading your data"},{"location":"editor/getting-started-editor/downloading-your-data/#downloading-your-data-download-csv","text":"Tangerine provides a download CSV function that is accessible from the Data section. Click Data->Download CSV. Here you will see a listing of all forms and a download icon beside each one of them. Click the download icon to get to the download screen page. to see the interface below. From here, you can select the results for a specific month or year of data collection. On this page you will see a selection for Month, Year and personally identifiable information (PII). Please select the desired month and year for the CSV export file, or keep the * selection for all months and year of the data collection. If want to get anonymized data for sending to third parties, select the Exclude PII checkbox and then click Submit. Warning To make use of the Exclude PII function, all of your personally identifiable inputs must be marked like such on the input edit page, or when inserting a new input/question on the insert new input page. Warning To be able to download all the data select the * on both Month and Year and click the SUBMIT button. If the CSV generation was successful, the following screen will present the group name, Form id , Start time and progress of the CSV download. Click Download to download the file. Once the CSV has been downloaded, you can find it in your Downloads folder.","title":"Downloading your data (Download CSV)"},{"location":"editor/getting-started-editor/downloading-your-data/#metadata-included-in-csv","text":"Each csv output from data collected by Tangerine has a set of metadata variables that are automatically output. Here is the current list: Variable Name Meaning _id 32-digit uuid identifying the unique form taken formId text name of the form startUnixtime unix timestamp that the form was first opened endUnixtime unix timestamp that the form was completed lastSaveUnixtime unix timestamp that the form was last opened and saved buildId 32-digit uuid identifying the app version buildChannel type of build: will be either build or production deviceId 32-digit uuid identifying the registered device groupId identifyer of the Tangerine group to which this device is registered complete TRUE or FALSE, whether the form is complete tangerineModifiedByUserId 3 2-digit uuid identifying the registered user who filled the form caseId 32-digit uuid identifying the Case the form is associated with eventId 32-digit uuid identifying the Event within the Case that the form is associated with eventFormId 32-digit uuid identifying the Form within the Event within the Case that the form is associated with participantId 32-digit uuid identifying the participant for whom the form was filled","title":"Metadata included in CSV"},{"location":"editor/getting-started-editor/edit-form/","text":"Editing the Form \u00b6 Once you have selected to edit your new or existing instrument/form, you will see a screen like the one below. This view lists the different sections of your instrument. Each section can contain one or more items. On the tablet, items in any one section can be seen on a single screen. The user moves through items by \"scrolling\" down the screen. The user moves through sections by hitting \"Next\" or \"Back\" on the tablet. The form editor provides the interface for adding and editing instrument sections and items. This interface provides controls that make the following actions possible: EDIT HTML - Clicking this button shows you the HTML code behind the form. Please edit the HTML with care. PREVIEW -- This control enables you to have a preview of your form in the current state SAVE -- This control allows you to save the form in its current state ADVANCED -- This Control enables you to access the on-open logic and on-change logic. This logic is used for skipping an entire instrument section. ADD SECTION -- This allows you to add a section of items to your instrument. For each section there are two actions available. EDIT -- This icon opens the interface to edit an instrument section (e.g., add items) DELETE -- This icon deletes this instrument section In this view, you can drag sections to reorder them.","title":"Editing the Form"},{"location":"editor/getting-started-editor/edit-form/#editing-the-form","text":"Once you have selected to edit your new or existing instrument/form, you will see a screen like the one below. This view lists the different sections of your instrument. Each section can contain one or more items. On the tablet, items in any one section can be seen on a single screen. The user moves through items by \"scrolling\" down the screen. The user moves through sections by hitting \"Next\" or \"Back\" on the tablet. The form editor provides the interface for adding and editing instrument sections and items. This interface provides controls that make the following actions possible: EDIT HTML - Clicking this button shows you the HTML code behind the form. Please edit the HTML with care. PREVIEW -- This control enables you to have a preview of your form in the current state SAVE -- This control allows you to save the form in its current state ADVANCED -- This Control enables you to access the on-open logic and on-change logic. This logic is used for skipping an entire instrument section. ADD SECTION -- This allows you to add a section of items to your instrument. For each section there are two actions available. EDIT -- This icon opens the interface to edit an instrument section (e.g., add items) DELETE -- This icon deletes this instrument section In this view, you can drag sections to reorder them.","title":"Editing the Form"},{"location":"editor/getting-started-editor/editor-overview/","text":"Overview \u00b6 Tangerine contains an extremely extensible foundational framework that allows the form developer to highly customize the core functioanlity, actions, and progression. The following section provides guidance and common examples for extending Tangerine. What is a Tangerine form? \u00b6 Create a New Group Create New Form Editing the Form Adding Sections and Questions Section Editor Copying Items Different Input Types Location list import Skip Logic Validation Why custom build forms? Custom Form Building in JavaScript Tangerine Preview \u00b6 Tangerine Preview \u00b6","title":"Overview"},{"location":"editor/getting-started-editor/editor-overview/#overview","text":"Tangerine contains an extremely extensible foundational framework that allows the form developer to highly customize the core functioanlity, actions, and progression. The following section provides guidance and common examples for extending Tangerine.","title":"Overview"},{"location":"editor/getting-started-editor/editor-overview/#what-is-a-tangerine-form","text":"Create a New Group Create New Form Editing the Form Adding Sections and Questions Section Editor Copying Items Different Input Types Location list import Skip Logic Validation Why custom build forms? Custom Form Building in JavaScript","title":"What is a Tangerine form?"},{"location":"editor/getting-started-editor/editor-overview/#tangerine-preview","text":"Tangerine Preview","title":"Tangerine Preview"},{"location":"editor/getting-started-editor/editor-overview/#_1","text":"","title":""},{"location":"editor/getting-started-editor/input-types/","text":"Different Input Types \u00b6 Item Editor \u00b6 The item editor screen is similar for many of the item types. It usually contains the following elements: Variable name: This name has to be unique for any instrument/form, as this will be used for the CSV data output as column header with each observation/child assessed/interview being a row. Avoid special characters and spaces, use lowercase only (e.g., \"age\"). Label: This will be the item label/name that will be displayed to the user (e.g. \"How old are you?\") Question number: If you input a number in here, you will see that the entire questions is moved to the right and the question number stands out when looking at the page. Use this if you are looking for a visual effect like this. Hint Text: This field allows you to add text that acts as a hint for the user (e.g., \"Enter child's age or year of birth, if known\") Toggle (On/Off) settings per question Required: Selecting this checkbox marks the element as a required field. This ensures that users will enter a value before proceeding to other instrument sections or finalizing the instrument/form. Disabled: Selecting this checkbox marks the element as inactive. The item is visible to the user on the tablet, but its value cannot be changed. Hidden: Selecting this checkbox makes the element inactive AND invisible on the tablet. PII - Personally Identifiable Information. This setting marks the input as PII which lets you remove this field from the CSV export file when this option is selected. Easily share data by de-identifying it whn using this option. You will have access to two more tabs allowing you to add Skip Logic and Validation to your questions. Conditional Display tab Skip if - Use this field to define logic for the input to be omitted if the condition is true. Show if - Use this field to define logic for the input to be displayed when the condition is true. Find examples of skip logic here Validation tab Warn if - fail the user submission with a warning only once. This is to alert the user that perhaps they are entering something out of the defined boundaries. The warn if logic will allow the user to proceed if they click the Next/Submit button a second time. Warning Text - The warning text to be displayed to the user when the condition is triggered. Valid if - define logic to contain a valid definition of the input Error text - the text to be displayed when the above condition is not met. Find examples of validation logic here GPS Item \u00b6 Use the GPS item to record the location (longitude & latitude) of the user while filling in the instrument/form. We suggest placing a GPS item always in its own section. Do not combine with other items. When selecting to add an item of the GPS type, Tangerine presents the below item editor screen. The following might be a way to configure this item: Variable name: Enter \"gps\". Hint Text: Leave blank Hit \"SUBMIT\" to see the below item added to the section editor. On the tablet this item will look like this: Location \u00b6 This item type offers a dropdown listing of predefined location information such as, e.g., region, district, and school name. Before you add this item to your form, you need to upload a location list and configure Tangerine: To see a video of how to do this Watch the video First, decide what levels you would like to show and prepare a CSV file that contains your locations and ids. Each column header will present a location level (e.g. column A header might be region; column B header might be district, etc.). Make sure each level/column header contains only a single word and no spaces. Second, define the location levels for Tangerine. Click Configure/Location Lists and add the desired levels using the '+' sign Click \"Create a New Location Level\". Enter the name of the \"highest\" location level under \"Label\" (e.g. region). Repeat this process for all other location levels, however, for each \"child\" level, select which is the parent level. E.g. in the case of district, the \"Parent Level\" would be \"region\", and so forth. Hit \"Submit\" to save. Warning You cannot delete location levels. Be careful and deliberate as you define them for your group. If you made a mistake or need to make changes, contact the Tangerine helpdesk. Next, click the Import tab and select \"Import CSV\". Double check that your CSV file contains only those columns that you have defined as levels and spelled exactly the same! Download a sample location list file with IDs:( https://drive.google.com/file/d/1y3X0aMJKRYx51--jPC_3OUkMpmkhyEn-/view ) Once you selected the CSV, Tangerine will ask you to map the location levels you already defined to the column headers found in your csv file. Click on the small arrows to select the matching column header. For each ID field, select \"Map a column to a level and select \"AutoGeneratedID\" for the ID as shown in the example below. Then click \"Process CSV\" as shown in the screen above. Once processing is completed, you will receive a notification like this: Once you have successfully uploaded a location list and prepared Tangerine, you can add the location input item to your form. The following might be a way to configure this item, once you completed the above steps. If you think that your location list may change significantly, and you'd like to re-upload it at some point thus not implementing any changes manually, consider adding manual IDs to your location file. In the instruction above, you saw how to add the Autogenerated ID that Tangerine inserts. These IDs, however, are not persisted when you re-upload your location file. In such cases, where you know that you'd rather re-upload the entire file, we recommend that you insert an ID column and you preserve those IDs across versions of your location list. By doing that you ensure that any matching on location IDs (and not on Location labels) will be persisted. To upload a location file with IDs, first create those IDS in the Excel file. Then, on the Map location field instead of selecting Autogenerated ID, select the column representing the ID for the corresponding level. Warning We highly recommend that you create a location list export before importing any new data. Click the Export tab and export your current location list. ALways work with this export file to make sure your list is up-to-date Warning Upon upload you are wiping out the location list. All previous results collected will be missing the labels for those location and will contain only the old IDs; all data on the tablets under the Visits tab will show the ID rather than the label. This is why we highly recommend altering the location list manually or maintaining the IDs across different version of the location list in your Excel file. Check out this Excel file to see a location list with IDs that you can import in Tangerine. The formula for generating the IDs can be copied to your own file: Download a sample location list file with IDs: ( https://drive.google.com/file/d/1y3X0aMJKRYx51--jPC_3OUkMpmkhyEn-/view ) Variable name: Enter \"location\". Hint Text: Leave blank Show levels (ex. county,subcounty): Enter \"province,district,school\" Show meta-data: Leave blank Hit \"SUBMIT\" to see the below item added to the section editor. On the tablet this item will look like this: Warning Without a location list, no location will be displayed, and the item will be seen as \"loading\". Checkbox group (Checkbox, Radio Buttons, or Dropdowns) \u00b6 This item type lets you define a checkbox item that lets a user pick one or more options. The following might be a way to configure this item: Variable name: Enter \"books\". Label: Enter \"What kind of books do you like to read?\" Hint Text: Enter \"Tick all that apply\" Value (answer option): Enter the data value for the first answer option, e.g., \"0\" Label (answer option): Enter the label for the first answer option, e.g., \"None\" Hit \"ADD ANOTHER\" to add additional answer options, e.g.: Value (answer option): \"1\" Label (answer option): \"Storybooks (fiction)\" Hit \"ADD ANOTHER\" to add additional answer options, e.g.: Value (answer option): \"2\" Label (answer option): \"Books about real things (non-fiction) When done adding all answer options, hit \"SUBMIT\". Warning The item type \"CHECKBOX\" only adds a single checkbox to the form, with the item label being the answer option label. On the tablet this single checkbox item will look like this: Radio Buttons \u00b6 Radio buttons are an item type used for items that allow for only one answer. The configuration for radio buttons is the same as for checkbox group with one exception. You will see that radio button options have a check mark to indicate which answer is correct. This is used in conjunction with the Threshold defined in the section header. When you have a threshold defined as 4, and for each question there is only one question option defined as correct, Tangerine will discontinue (hide the questions) after 4 consecutive replies are given as not correct. You can use this in EGMA tasks or in any other scenario where this makes sense On the tablet the radio button item will look like this: Dropdown \u00b6 Dropdown is an item type used for items that allow for only one answer to be picked from a dropdown list of items. This item type is convenient when there are many options to choose from. The configuration for a dropdown item is the same as for checkbox group. On the tablet the dropdown item will look like this: Timed Grid \u00b6 This item type facilitates timed assessment approaches, e.g., to assess letter sound knowledge, oral reading fluency or math operations. The following might be a way to configure this item: Variable name: Enter \"letter_sound\". Number of columns: Enter the number of columns by which you'd like to organize the items. Enter, e.g. \"4\" (Tip: choose less columns for larger items, like words or operation problems) Hint Text: Leave blank Auto Stop: The autostop field defines the number of consecutive incorrect items, starting from the first one, after which the test stops automatically. For example, with an autostop value of 10, if a child has the first 10 items all incorrect, the test will stop. If a child has the first 4 items correct and then the following 10 items incorrect, the test will not autostop. Mark entire rows: This option allows the user to mark and entire row of items as incorrect (e.g. if a child skipped an entire row of sounds in a letter sound assessment) Duration in seconds: Enter the time allowed to complete this assessment, e.g. \"60\" for 60 seconds or one minute. Options (each option separated by a space): Enter all grid items here. Separate each item by a space from the next; if you have extra spaces please remove them! When done adding all answer options, hit \"SUBMIT\". Warning For these kids of assessments there are usually instructions preceding the assessment items. Insert those instructions as a \"HTML CONTENT CONTAINER\" item first, as shown below, followed by the \"TIMED GRID\" in the same section. We recommend to only feature the instructions (HTML Content) and Timed Grid in any one section of your instrument/form On the tablet the timed grid item will look like this: HTML Content Container \u00b6 This item type allows for flexible integration of headers, help text, or transition messages that do not require any user input or response. You can treat this container as a variable and hide or show different instructional text upon the selection of different options. The following might be a way to configure this item: Variable name: Enter \"Assessor instructions\". Mark entire rows: This option allows the user to mark an entire row of items as incorrect (e.g. if a child skipped an entire row of sounds in a letter sound assessment) Rows 1-X: Insert assessor instructions, use html tags to insert line breaks or formatting (e.g. for a line break; text for bolding a piece of text, etc.). When done adding all answer options, hit \"SUBMIT\". On the tablet this HTML container item will look like this: Copying Items \u00b6 If you have an element and/or content which is the same as a previous element (e.g., radio buttons) that you would like to insert into your instrument quickly, without having to click \"INSERT HERE\" again, there is a COPY feature that you can use to do this. First, enter your original content (e.g., variable name, labels, and values) and then click SUBMIT. Once the first step is complete, next you click on the icon. Doing so automatically creates a duplicate of all your original content, except the variable name, which you will need to edit, if desired. In the image below, you can see that all duplicates are auto-populated with the name \"widget,\" followed by an underscore, and a mix of letters and numbers (always different from the previous copy). If you would like to, you can edit all the content of the copy to fit your needs.","title":"Different Input Types"},{"location":"editor/getting-started-editor/input-types/#different-input-types","text":"","title":"Different Input Types"},{"location":"editor/getting-started-editor/input-types/#item-editor","text":"The item editor screen is similar for many of the item types. It usually contains the following elements: Variable name: This name has to be unique for any instrument/form, as this will be used for the CSV data output as column header with each observation/child assessed/interview being a row. Avoid special characters and spaces, use lowercase only (e.g., \"age\"). Label: This will be the item label/name that will be displayed to the user (e.g. \"How old are you?\") Question number: If you input a number in here, you will see that the entire questions is moved to the right and the question number stands out when looking at the page. Use this if you are looking for a visual effect like this. Hint Text: This field allows you to add text that acts as a hint for the user (e.g., \"Enter child's age or year of birth, if known\") Toggle (On/Off) settings per question Required: Selecting this checkbox marks the element as a required field. This ensures that users will enter a value before proceeding to other instrument sections or finalizing the instrument/form. Disabled: Selecting this checkbox marks the element as inactive. The item is visible to the user on the tablet, but its value cannot be changed. Hidden: Selecting this checkbox makes the element inactive AND invisible on the tablet. PII - Personally Identifiable Information. This setting marks the input as PII which lets you remove this field from the CSV export file when this option is selected. Easily share data by de-identifying it whn using this option. You will have access to two more tabs allowing you to add Skip Logic and Validation to your questions. Conditional Display tab Skip if - Use this field to define logic for the input to be omitted if the condition is true. Show if - Use this field to define logic for the input to be displayed when the condition is true. Find examples of skip logic here Validation tab Warn if - fail the user submission with a warning only once. This is to alert the user that perhaps they are entering something out of the defined boundaries. The warn if logic will allow the user to proceed if they click the Next/Submit button a second time. Warning Text - The warning text to be displayed to the user when the condition is triggered. Valid if - define logic to contain a valid definition of the input Error text - the text to be displayed when the above condition is not met. Find examples of validation logic here","title":"Item Editor"},{"location":"editor/getting-started-editor/input-types/#gps-item","text":"Use the GPS item to record the location (longitude & latitude) of the user while filling in the instrument/form. We suggest placing a GPS item always in its own section. Do not combine with other items. When selecting to add an item of the GPS type, Tangerine presents the below item editor screen. The following might be a way to configure this item: Variable name: Enter \"gps\". Hint Text: Leave blank Hit \"SUBMIT\" to see the below item added to the section editor. On the tablet this item will look like this:","title":"GPS Item"},{"location":"editor/getting-started-editor/input-types/#location","text":"This item type offers a dropdown listing of predefined location information such as, e.g., region, district, and school name. Before you add this item to your form, you need to upload a location list and configure Tangerine: To see a video of how to do this Watch the video First, decide what levels you would like to show and prepare a CSV file that contains your locations and ids. Each column header will present a location level (e.g. column A header might be region; column B header might be district, etc.). Make sure each level/column header contains only a single word and no spaces. Second, define the location levels for Tangerine. Click Configure/Location Lists and add the desired levels using the '+' sign Click \"Create a New Location Level\". Enter the name of the \"highest\" location level under \"Label\" (e.g. region). Repeat this process for all other location levels, however, for each \"child\" level, select which is the parent level. E.g. in the case of district, the \"Parent Level\" would be \"region\", and so forth. Hit \"Submit\" to save. Warning You cannot delete location levels. Be careful and deliberate as you define them for your group. If you made a mistake or need to make changes, contact the Tangerine helpdesk. Next, click the Import tab and select \"Import CSV\". Double check that your CSV file contains only those columns that you have defined as levels and spelled exactly the same! Download a sample location list file with IDs:( https://drive.google.com/file/d/1y3X0aMJKRYx51--jPC_3OUkMpmkhyEn-/view ) Once you selected the CSV, Tangerine will ask you to map the location levels you already defined to the column headers found in your csv file. Click on the small arrows to select the matching column header. For each ID field, select \"Map a column to a level and select \"AutoGeneratedID\" for the ID as shown in the example below. Then click \"Process CSV\" as shown in the screen above. Once processing is completed, you will receive a notification like this: Once you have successfully uploaded a location list and prepared Tangerine, you can add the location input item to your form. The following might be a way to configure this item, once you completed the above steps. If you think that your location list may change significantly, and you'd like to re-upload it at some point thus not implementing any changes manually, consider adding manual IDs to your location file. In the instruction above, you saw how to add the Autogenerated ID that Tangerine inserts. These IDs, however, are not persisted when you re-upload your location file. In such cases, where you know that you'd rather re-upload the entire file, we recommend that you insert an ID column and you preserve those IDs across versions of your location list. By doing that you ensure that any matching on location IDs (and not on Location labels) will be persisted. To upload a location file with IDs, first create those IDS in the Excel file. Then, on the Map location field instead of selecting Autogenerated ID, select the column representing the ID for the corresponding level. Warning We highly recommend that you create a location list export before importing any new data. Click the Export tab and export your current location list. ALways work with this export file to make sure your list is up-to-date Warning Upon upload you are wiping out the location list. All previous results collected will be missing the labels for those location and will contain only the old IDs; all data on the tablets under the Visits tab will show the ID rather than the label. This is why we highly recommend altering the location list manually or maintaining the IDs across different version of the location list in your Excel file. Check out this Excel file to see a location list with IDs that you can import in Tangerine. The formula for generating the IDs can be copied to your own file: Download a sample location list file with IDs: ( https://drive.google.com/file/d/1y3X0aMJKRYx51--jPC_3OUkMpmkhyEn-/view ) Variable name: Enter \"location\". Hint Text: Leave blank Show levels (ex. county,subcounty): Enter \"province,district,school\" Show meta-data: Leave blank Hit \"SUBMIT\" to see the below item added to the section editor. On the tablet this item will look like this: Warning Without a location list, no location will be displayed, and the item will be seen as \"loading\".","title":"Location"},{"location":"editor/getting-started-editor/input-types/#checkbox-group-checkbox-radio-buttons-or-dropdowns","text":"This item type lets you define a checkbox item that lets a user pick one or more options. The following might be a way to configure this item: Variable name: Enter \"books\". Label: Enter \"What kind of books do you like to read?\" Hint Text: Enter \"Tick all that apply\" Value (answer option): Enter the data value for the first answer option, e.g., \"0\" Label (answer option): Enter the label for the first answer option, e.g., \"None\" Hit \"ADD ANOTHER\" to add additional answer options, e.g.: Value (answer option): \"1\" Label (answer option): \"Storybooks (fiction)\" Hit \"ADD ANOTHER\" to add additional answer options, e.g.: Value (answer option): \"2\" Label (answer option): \"Books about real things (non-fiction) When done adding all answer options, hit \"SUBMIT\". Warning The item type \"CHECKBOX\" only adds a single checkbox to the form, with the item label being the answer option label. On the tablet this single checkbox item will look like this:","title":"Checkbox group (Checkbox, Radio Buttons, or Dropdowns)"},{"location":"editor/getting-started-editor/input-types/#radio-buttons","text":"Radio buttons are an item type used for items that allow for only one answer. The configuration for radio buttons is the same as for checkbox group with one exception. You will see that radio button options have a check mark to indicate which answer is correct. This is used in conjunction with the Threshold defined in the section header. When you have a threshold defined as 4, and for each question there is only one question option defined as correct, Tangerine will discontinue (hide the questions) after 4 consecutive replies are given as not correct. You can use this in EGMA tasks or in any other scenario where this makes sense On the tablet the radio button item will look like this:","title":"Radio Buttons"},{"location":"editor/getting-started-editor/input-types/#dropdown","text":"Dropdown is an item type used for items that allow for only one answer to be picked from a dropdown list of items. This item type is convenient when there are many options to choose from. The configuration for a dropdown item is the same as for checkbox group. On the tablet the dropdown item will look like this:","title":"Dropdown"},{"location":"editor/getting-started-editor/input-types/#timed-grid","text":"This item type facilitates timed assessment approaches, e.g., to assess letter sound knowledge, oral reading fluency or math operations. The following might be a way to configure this item: Variable name: Enter \"letter_sound\". Number of columns: Enter the number of columns by which you'd like to organize the items. Enter, e.g. \"4\" (Tip: choose less columns for larger items, like words or operation problems) Hint Text: Leave blank Auto Stop: The autostop field defines the number of consecutive incorrect items, starting from the first one, after which the test stops automatically. For example, with an autostop value of 10, if a child has the first 10 items all incorrect, the test will stop. If a child has the first 4 items correct and then the following 10 items incorrect, the test will not autostop. Mark entire rows: This option allows the user to mark and entire row of items as incorrect (e.g. if a child skipped an entire row of sounds in a letter sound assessment) Duration in seconds: Enter the time allowed to complete this assessment, e.g. \"60\" for 60 seconds or one minute. Options (each option separated by a space): Enter all grid items here. Separate each item by a space from the next; if you have extra spaces please remove them! When done adding all answer options, hit \"SUBMIT\". Warning For these kids of assessments there are usually instructions preceding the assessment items. Insert those instructions as a \"HTML CONTENT CONTAINER\" item first, as shown below, followed by the \"TIMED GRID\" in the same section. We recommend to only feature the instructions (HTML Content) and Timed Grid in any one section of your instrument/form On the tablet the timed grid item will look like this:","title":"Timed Grid"},{"location":"editor/getting-started-editor/input-types/#html-content-container","text":"This item type allows for flexible integration of headers, help text, or transition messages that do not require any user input or response. You can treat this container as a variable and hide or show different instructional text upon the selection of different options. The following might be a way to configure this item: Variable name: Enter \"Assessor instructions\". Mark entire rows: This option allows the user to mark an entire row of items as incorrect (e.g. if a child skipped an entire row of sounds in a letter sound assessment) Rows 1-X: Insert assessor instructions, use html tags to insert line breaks or formatting (e.g. for a line break; text for bolding a piece of text, etc.). When done adding all answer options, hit \"SUBMIT\". On the tablet this HTML container item will look like this:","title":"HTML Content Container"},{"location":"editor/getting-started-editor/input-types/#copying-items","text":"If you have an element and/or content which is the same as a previous element (e.g., radio buttons) that you would like to insert into your instrument quickly, without having to click \"INSERT HERE\" again, there is a COPY feature that you can use to do this. First, enter your original content (e.g., variable name, labels, and values) and then click SUBMIT. Once the first step is complete, next you click on the icon. Doing so automatically creates a duplicate of all your original content, except the variable name, which you will need to edit, if desired. In the image below, you can see that all duplicates are auto-populated with the name \"widget,\" followed by an underscore, and a mix of letters and numbers (always different from the previous copy). If you would like to, you can edit all the content of the copy to fit your needs.","title":"Copying Items"},{"location":"editor/getting-started-editor/skip-logic/","text":"Skip Logic \u00b6 Every instrument/form, section, and individual item provides an interface for adding logic, e.g. skip logic, that controls the interactivity and presentation of the instrument, section, or item. There are two types of skip logic that can be applied: On form level - used to skip an entire section and implement logic that is applicable to the entire form On section/page level Most common case: You can implement those in the item's 'Skip If' field, or Used for more complex conditions Implement the skip in the section's on-change logic The functions that we use for skip logic are: getValue('name') - to check the value of input 'name' Use this for Text, Number, Dates, Time, Radio buttons, or Drop down lists getValue('name').includes('value') - to check if 'value' is in the selected items of 'name' Use this call to check if a value is in the list of selected values of a checkbox group input. grid specific functions - look at the end of this page for more information. Join skip logic conditions using the && (AND) and || (OR) operators getValue('repeatedgrade') == '1' && getValue('age') >= 1 Negate a condition using the ! (NOT) operator getValue('repeatedgrade') != '1' Or !getValue('grades_taught').includes('1') Logic at item level \u00b6 You want to skip an item question: Navigate to the \"Show if\" in the Item Editor. In this example this item (e.g., \"Which grade did you repeat?\" will ONLY be shown if the response to the previous item (e.g., asking about whether the person ever repeated a grade) was \"yes\" (data value 1). getValue('repeatedgrade') == '1' Alternatively, for a preceding question that had \"Other\" as an answer option, the logic here might look like this: getValue('q10') == '9' Other examples might include a specific value of a preceding item. Use the below example for questions of type checkbox group, where more than one answer can be selected. getValue('q12').includes('5') Warning The skip logic commands used in Tangerine are case-sensitive and space-sensitive. You must type precisely the name of the variables which you want to reference. Warning Use single straight quotation marks to demarcate variables names ', do NOT use single slanted quotation marks ' or double quotation marks \". Logic at instrument/form level \u00b6 At the instrument/form level, accessing this logic editor is via advanced settings in the section editor. Click on ADVANCED to see the screen below with \"on-open\" and \"on-change\" entries. As outlined earlier, at the item level, such logic can be added in the \"Show if\" field in the item editor. On-open and on-change As the name suggest, on-open logic is only executed when the form is opened whereas on-change logic is always executed whenever a change happens in the whole form. When selecting on-open logic either at the instrument/form level or in the section editor, the following screen appears. The interface allows JavaScript logic to be incorporated into the instrument. (Skip) Logic Examples \u00b6 You want to skip an entire section: Navigate to and select the \"on-change\" at the instrument/form level. This logic will not work if you insert it in a section (it must be defined on form level) In this example, the section gets skipped based on responses from a previous item, e.g., if the respondent answered negatively to a previous question \"Do you have children?\". Note that the sectionID is provided in Tangerine in the section details as shown below. Form level skip logic is used to present or hide an entire section page to the user. This is very useful when managing a workflow and you need to display some sections but hide others according to the selected option for a question. For example, you can show a certain section only for grade 1 and hide it if grade 2 is selected. if ( getValue ( 'children' ) == '1' ) { sectionEnable ( 'item_1' )} else { sectionDisable ( 'item_1' )} You want to hide a set of items based on responses to an item in a previous section: Navigate to and select the \"on-open\" at the section level. In this example several items in this section are hidden based on the participant's response to the item about the child's schooling experience in a previous section. if ( getValue ( 'school' ) == '1' ) { itemShow ( 'grade' ) itemShow ( 'repeatedgrade' ) itemShow ( 'dropout' )} else { itemHide ( 'grade' ) itemHide ( 'repeatedgrade' ) itemHide ( 'dropout' )} You want to hide a set of items based on responses to two items in a previous section: Navigate to and select the \"on-open\" at the section level. In this example the item \"teachers_name\" should only be shown if the participant's previous response to \"teacher_available\" was yes = 1 AND if the participant' previous response to \"class_selected\" was \"1\". if ( getValue ( ' teacher_available' ) === '1' && getValue ( 'class_selected' ) === '1' ) { itemShow ( 'teachers_name' )} else { itemHide ( 'teachers_name' )} The Logic interface offer syntax highlighting. This is handy when you have errors in your code. Below is an example of an error and sample message. Logic at section level \u00b6 At the section level, the logic editor can be accessed by editing the Section Details clicking the pen icon on the right of the blue bar (where one can also rename the section). Skip logic with grid specific functions \u00b6 You may be in the situation where you are required to perform a skip based on some results from a grid. We provide four functions that you can use in your skip logic to show or hide questions or sections based on the results of a grid. Showing a question based on the number of attempted items on a grid If you'd like to hide a question when the number of attempted items on a particular grid is over a certain threshold you can make use of the 'numberOfItemsAttempted(input)' function. If your grid variable is 'letter_sound' and the question you want to skip is 'Q_1' then in the question Q_1 I can insert the below skip logic(under Show If) to show it only when the number of attempted items on the grid is greater than 10 numberOfItemsAttempted ( inputs . letter_sound ) > 10 Showing a question based on the number of correct items of a grid Sometimes it may be the case where you want to show a question only if there are a certain N items on the grid answered correctly. In those cases, we make use of the 'numberOfCorrectItems(input)' function. If your grid variable is 'letter_sound' and the question you want to skip is 'Q_1' then in the question Q_1 I can insert the below skip logic(under Show If) to show this question only when the number of correct items on the grid is greater than 0 numberOfCorrectItems ( inputs . letter_sound ) > 0 Show a question only if the grid did not auto stop If you have set the autostop value of a grid with variable name 'letter_sound' and you want to show a question only when the grid did not discontinue due to a triggered auto stop, then you can insert the below logic into the question's Show If field: typeof inputs . letter_sound != 'undefined' && inputs . letter_sound . gridAutoStopped The use of the '!' gives us the opposite of the result returned by the function. If the grid stopped the result will be true. When we use the '!' in front of the function, it means that, when the grid did not stop we want a positive answer hence show the question. Show a question based on the words per minute read on a grid It may happen that you need to show a question only to advanced students. In those cases, we make use of the function 'itemsPerMinute(input)' This function returns the number of items per minute read by the student. We can use it, just as before, in the Show If input field of a question, like so: itemsPerMinute ( inputs . letter_sound ) > 35 This call will force a question to be displayed only when the rate of reading was higher than 35 workds per minute. NOTE: All of the above functions can also be used to show or a hide an entire section page.","title":"Skip Logic"},{"location":"editor/getting-started-editor/skip-logic/#skip-logic","text":"Every instrument/form, section, and individual item provides an interface for adding logic, e.g. skip logic, that controls the interactivity and presentation of the instrument, section, or item. There are two types of skip logic that can be applied: On form level - used to skip an entire section and implement logic that is applicable to the entire form On section/page level Most common case: You can implement those in the item's 'Skip If' field, or Used for more complex conditions Implement the skip in the section's on-change logic The functions that we use for skip logic are: getValue('name') - to check the value of input 'name' Use this for Text, Number, Dates, Time, Radio buttons, or Drop down lists getValue('name').includes('value') - to check if 'value' is in the selected items of 'name' Use this call to check if a value is in the list of selected values of a checkbox group input. grid specific functions - look at the end of this page for more information. Join skip logic conditions using the && (AND) and || (OR) operators getValue('repeatedgrade') == '1' && getValue('age') >= 1 Negate a condition using the ! (NOT) operator getValue('repeatedgrade') != '1' Or !getValue('grades_taught').includes('1')","title":"Skip Logic"},{"location":"editor/getting-started-editor/skip-logic/#logic-at-item-level","text":"You want to skip an item question: Navigate to the \"Show if\" in the Item Editor. In this example this item (e.g., \"Which grade did you repeat?\" will ONLY be shown if the response to the previous item (e.g., asking about whether the person ever repeated a grade) was \"yes\" (data value 1). getValue('repeatedgrade') == '1' Alternatively, for a preceding question that had \"Other\" as an answer option, the logic here might look like this: getValue('q10') == '9' Other examples might include a specific value of a preceding item. Use the below example for questions of type checkbox group, where more than one answer can be selected. getValue('q12').includes('5') Warning The skip logic commands used in Tangerine are case-sensitive and space-sensitive. You must type precisely the name of the variables which you want to reference. Warning Use single straight quotation marks to demarcate variables names ', do NOT use single slanted quotation marks ' or double quotation marks \".","title":"Logic at item level"},{"location":"editor/getting-started-editor/skip-logic/#logic-at-instrumentform-level","text":"At the instrument/form level, accessing this logic editor is via advanced settings in the section editor. Click on ADVANCED to see the screen below with \"on-open\" and \"on-change\" entries. As outlined earlier, at the item level, such logic can be added in the \"Show if\" field in the item editor. On-open and on-change As the name suggest, on-open logic is only executed when the form is opened whereas on-change logic is always executed whenever a change happens in the whole form. When selecting on-open logic either at the instrument/form level or in the section editor, the following screen appears. The interface allows JavaScript logic to be incorporated into the instrument.","title":"Logic at instrument/form level"},{"location":"editor/getting-started-editor/skip-logic/#skip-logic-examples","text":"You want to skip an entire section: Navigate to and select the \"on-change\" at the instrument/form level. This logic will not work if you insert it in a section (it must be defined on form level) In this example, the section gets skipped based on responses from a previous item, e.g., if the respondent answered negatively to a previous question \"Do you have children?\". Note that the sectionID is provided in Tangerine in the section details as shown below. Form level skip logic is used to present or hide an entire section page to the user. This is very useful when managing a workflow and you need to display some sections but hide others according to the selected option for a question. For example, you can show a certain section only for grade 1 and hide it if grade 2 is selected. if ( getValue ( 'children' ) == '1' ) { sectionEnable ( 'item_1' )} else { sectionDisable ( 'item_1' )} You want to hide a set of items based on responses to an item in a previous section: Navigate to and select the \"on-open\" at the section level. In this example several items in this section are hidden based on the participant's response to the item about the child's schooling experience in a previous section. if ( getValue ( 'school' ) == '1' ) { itemShow ( 'grade' ) itemShow ( 'repeatedgrade' ) itemShow ( 'dropout' )} else { itemHide ( 'grade' ) itemHide ( 'repeatedgrade' ) itemHide ( 'dropout' )} You want to hide a set of items based on responses to two items in a previous section: Navigate to and select the \"on-open\" at the section level. In this example the item \"teachers_name\" should only be shown if the participant's previous response to \"teacher_available\" was yes = 1 AND if the participant' previous response to \"class_selected\" was \"1\". if ( getValue ( ' teacher_available' ) === '1' && getValue ( 'class_selected' ) === '1' ) { itemShow ( 'teachers_name' )} else { itemHide ( 'teachers_name' )} The Logic interface offer syntax highlighting. This is handy when you have errors in your code. Below is an example of an error and sample message.","title":"(Skip) Logic Examples"},{"location":"editor/getting-started-editor/skip-logic/#logic-at-section-level","text":"At the section level, the logic editor can be accessed by editing the Section Details clicking the pen icon on the right of the blue bar (where one can also rename the section).","title":"Logic at section level"},{"location":"editor/getting-started-editor/skip-logic/#skip-logic-with-grid-specific-functions","text":"You may be in the situation where you are required to perform a skip based on some results from a grid. We provide four functions that you can use in your skip logic to show or hide questions or sections based on the results of a grid. Showing a question based on the number of attempted items on a grid If you'd like to hide a question when the number of attempted items on a particular grid is over a certain threshold you can make use of the 'numberOfItemsAttempted(input)' function. If your grid variable is 'letter_sound' and the question you want to skip is 'Q_1' then in the question Q_1 I can insert the below skip logic(under Show If) to show it only when the number of attempted items on the grid is greater than 10 numberOfItemsAttempted ( inputs . letter_sound ) > 10 Showing a question based on the number of correct items of a grid Sometimes it may be the case where you want to show a question only if there are a certain N items on the grid answered correctly. In those cases, we make use of the 'numberOfCorrectItems(input)' function. If your grid variable is 'letter_sound' and the question you want to skip is 'Q_1' then in the question Q_1 I can insert the below skip logic(under Show If) to show this question only when the number of correct items on the grid is greater than 0 numberOfCorrectItems ( inputs . letter_sound ) > 0 Show a question only if the grid did not auto stop If you have set the autostop value of a grid with variable name 'letter_sound' and you want to show a question only when the grid did not discontinue due to a triggered auto stop, then you can insert the below logic into the question's Show If field: typeof inputs . letter_sound != 'undefined' && inputs . letter_sound . gridAutoStopped The use of the '!' gives us the opposite of the result returned by the function. If the grid stopped the result will be true. When we use the '!' in front of the function, it means that, when the grid did not stop we want a positive answer hence show the question. Show a question based on the words per minute read on a grid It may happen that you need to show a question only to advanced students. In those cases, we make use of the function 'itemsPerMinute(input)' This function returns the number of items per minute read by the student. We can use it, just as before, in the Show If input field of a question, like so: itemsPerMinute ( inputs . letter_sound ) > 35 This call will force a question to be displayed only when the rate of reading was higher than 35 workds per minute. NOTE: All of the above functions can also be used to show or a hide an entire section page.","title":"Skip logic with grid specific functions"},{"location":"editor/getting-started-editor/validation/","text":"Validation \u00b6 Tangerine provides the option to check the validity of an input field. Navigate to the \"Valid if\" field in the Item Editor. Field Validation Examples \u00b6 If, for example, the value entered into an \"INPUT-NUMBER\" field should have 9 or more characters, enter the following into \"Valid if\" for this item: input . value . length > 9 Tangerine also allow you to compare the value entered in the current item to a value entered for another, earlier item. This might be the case, e.g. for attendance when observing a classroom. That is, when recording attendance, the number of children present should not exceed the number of children enrolled. Assume that a relevant variable name of the earlier item was \"boys_enrolled\" and the current items is about the boys present, this might be the validation logic to enter under \"Valid if\" for boys_present. parseInt ( input . value ) <= inputs . boys_enrolled . value If you want to validate that a number input is in between a particular range but also allow a 'No Reply' answer, use the below validation rule: input . value >= 0 && input . value <= 10 || input . value == 999 Here we make sure that the user can only enter numbers between 0 and 10 but also 999 as a reply to this question. You can now use the Mutually Exclusive option on the checkbox edit page to achieve the same functionality. Deprecated If you have a list of checkboxes with the option No (value 0), NA (value 888), and some other options, and you'd like to make sure that the assessor cannot select the options No or the option NA along with other available options you need to implement a rule like the one below. The variable name in the below example is TQ1 ( ! getValue ( 'TQ1' ). includes ( '888' ) && ! getValue ( 'TQ1' ). includes ( '0' )) || ( getValue ( 'TQ1' ). includes ( '888' ) || getValue ( 'TQ1' ). includes ( '0' )) && getValue ( 'TQ1' ). length == 1","title":"Validation"},{"location":"editor/getting-started-editor/validation/#validation","text":"Tangerine provides the option to check the validity of an input field. Navigate to the \"Valid if\" field in the Item Editor.","title":"Validation"},{"location":"editor/getting-started-editor/validation/#field-validation-examples","text":"If, for example, the value entered into an \"INPUT-NUMBER\" field should have 9 or more characters, enter the following into \"Valid if\" for this item: input . value . length > 9 Tangerine also allow you to compare the value entered in the current item to a value entered for another, earlier item. This might be the case, e.g. for attendance when observing a classroom. That is, when recording attendance, the number of children present should not exceed the number of children enrolled. Assume that a relevant variable name of the earlier item was \"boys_enrolled\" and the current items is about the boys present, this might be the validation logic to enter under \"Valid if\" for boys_present. parseInt ( input . value ) <= inputs . boys_enrolled . value If you want to validate that a number input is in between a particular range but also allow a 'No Reply' answer, use the below validation rule: input . value >= 0 && input . value <= 10 || input . value == 999 Here we make sure that the user can only enter numbers between 0 and 10 but also 999 as a reply to this question. You can now use the Mutually Exclusive option on the checkbox edit page to achieve the same functionality. Deprecated If you have a list of checkboxes with the option No (value 0), NA (value 888), and some other options, and you'd like to make sure that the assessor cannot select the options No or the option NA along with other available options you need to implement a rule like the one below. The variable name in the below example is TQ1 ( ! getValue ( 'TQ1' ). includes ( '888' ) && ! getValue ( 'TQ1' ). includes ( '0' )) || ( getValue ( 'TQ1' ). includes ( '888' ) || getValue ( 'TQ1' ). includes ( '0' )) && getValue ( 'TQ1' ). length == 1","title":"Field Validation Examples"},{"location":"editor/project_managment/class/","text":"Class module \u00b6 Setup \u00b6 Add class to the T_MODULES property in config.sh. Create a new group via editor; this takes advantage of the class module which sets important class-related properties and file. If you /must/ use the create-group command, change homeUrl to dashboard and set uploadUnlockedFormReponses = true . Feedback \u00b6 Feedback for each form item (subtask) can be entered using the Settings editor. Feedback is displayed if available on the Student grouping report. The following fields are available: - ${feedback.example} - ${feedback.skill} - ${feedback.assignment} The following code can be used to format feedback on the Student Grouping report: <div class='feedback-assignment'>${feedback.assignment}</div> <div class='feedback-example'>${feedback.example}.</div> Note that the use of these formatting commands are optional. Here is a sample feedback message that uses this formatting: These students are doing really well. Consider framing your feedback to these student as follows: <div class='feedback-example'>${feedback.example}.</div> Reflect on these students results: why do you think did these students were particularly successful in ${feedback.skill}. Was there a specific ${feedback.skill} strategy or activity you used? Did they already know this content? Is there another strategy or activity they could do to extend their ${feedback.skill} skills? Consider giving these students supplementary story: <div class='feedback-assignment'>${feedback.assignment}</div> to read and make 3-5 inferential questions for them to answer. You may also consider engaging these students as peer mentors to others as these other students do additional practice. Scoring \u00b6 There are 3 options for scoring in Class: - Using a TANGY-TIMED grid - Using a hidden formId+_score field to store the calculated score value when the form is submitted using the on-change javascript - Using a score calculated at report run-time. The dashboard.service populaceTransformedResult function loops through the inputs; for each item type, it calculates the value, score, and max. It also keeps a running tally of the sum of all max values (totalMax). Here are the default rules for each input type: * TANGY-INPUT: * value: value field * score: value field * max: max field * TANGY-RADIO-BUTTONS: * value: loops through the options and uses the value from the non-empty option * score: value * max: Use value of the highest option. * TANGY-CHECKBOXES: * value: loops through the options and uses the value from the non-empty option * score: value * max: Use value of the highest option. For a TANGY-TIMED input, once the value and score have been calculated for each item and populated into an answeredQuestions array, we loop through this array and calculate aggregates for the tangy-form-item. TANGY-TIMED: value: score: totalCorrect For tangy form items that use a _score field: Calculate the totalAnswers by subtracting 1 from the item.inputs.length (to account for the _score field) Use score for totalCorrect and totalAnswers for maxValueAnswer, unless the max value was assigned earlier. Finally, there is support for calculating the score at report-time by looping through answeredQuestions and summing the score and max values.","title":"Class module"},{"location":"editor/project_managment/class/#class-module","text":"","title":"Class module"},{"location":"editor/project_managment/class/#setup","text":"Add class to the T_MODULES property in config.sh. Create a new group via editor; this takes advantage of the class module which sets important class-related properties and file. If you /must/ use the create-group command, change homeUrl to dashboard and set uploadUnlockedFormReponses = true .","title":"Setup"},{"location":"editor/project_managment/class/#feedback","text":"Feedback for each form item (subtask) can be entered using the Settings editor. Feedback is displayed if available on the Student grouping report. The following fields are available: - ${feedback.example} - ${feedback.skill} - ${feedback.assignment} The following code can be used to format feedback on the Student Grouping report: <div class='feedback-assignment'>${feedback.assignment}</div> <div class='feedback-example'>${feedback.example}.</div> Note that the use of these formatting commands are optional. Here is a sample feedback message that uses this formatting: These students are doing really well. Consider framing your feedback to these student as follows: <div class='feedback-example'>${feedback.example}.</div> Reflect on these students results: why do you think did these students were particularly successful in ${feedback.skill}. Was there a specific ${feedback.skill} strategy or activity you used? Did they already know this content? Is there another strategy or activity they could do to extend their ${feedback.skill} skills? Consider giving these students supplementary story: <div class='feedback-assignment'>${feedback.assignment}</div> to read and make 3-5 inferential questions for them to answer. You may also consider engaging these students as peer mentors to others as these other students do additional practice.","title":"Feedback"},{"location":"editor/project_managment/class/#scoring","text":"There are 3 options for scoring in Class: - Using a TANGY-TIMED grid - Using a hidden formId+_score field to store the calculated score value when the form is submitted using the on-change javascript - Using a score calculated at report run-time. The dashboard.service populaceTransformedResult function loops through the inputs; for each item type, it calculates the value, score, and max. It also keeps a running tally of the sum of all max values (totalMax). Here are the default rules for each input type: * TANGY-INPUT: * value: value field * score: value field * max: max field * TANGY-RADIO-BUTTONS: * value: loops through the options and uses the value from the non-empty option * score: value * max: Use value of the highest option. * TANGY-CHECKBOXES: * value: loops through the options and uses the value from the non-empty option * score: value * max: Use value of the highest option. For a TANGY-TIMED input, once the value and score have been calculated for each item and populated into an answeredQuestions array, we loop through this array and calculate aggregates for the tangy-form-item. TANGY-TIMED: value: score: totalCorrect For tangy form items that use a _score field: Calculate the totalAnswers by subtracting 1 from the item.inputs.length (to account for the _score field) Use score for totalCorrect and totalAnswers for maxValueAnswer, unless the max value was assigned earlier. Finally, there is support for calculating the score at report-time by looping through answeredQuestions and summing the score and max values.","title":"Scoring"},{"location":"editor/project_managment/configuration/","text":"Configuration \u00b6 App Configuration \u00b6 app-config.json should have the following properties defined. homeUrl:string The default route to load when no route is specified. Think of this as the root url securityPolicy:string[] . This is an array of all the combinations of the security policies to be enforced in the app. NOTE: noPassword and password are mutually exclusive. Only one should be provided and not both. password noPassword associateUserProfileMode : This is the mode that determines where a user profiles comes from after a user has created an account on a device. Note, a \"User\" is tied together across devices by a single \"User Profile\". The account on the device is simply a security mechanism for using the profiles. remote : Selecting this will result in a user being promted to enter a \"code\" after they register an account. This code is the last 6 characters of their User Profile ID. Typically a Group Admin would create a User Profile doc on the server and then send this code to the person associated with the User Profile. When the user enters this code on the tablet, the tablet will reach out over the Internet and download the corresponding User Profile and any content associated with that User Profile. Because all content is downloaded for that user, it can also be used as a way to fully restore a user's data on a new or recovered tablet. However note that this data is mode is not compatible with using CouchDB sync settings on any form definitions' sync settings. local-new : This option allows users who register an Account on a tablet to create a new User Profile. This is also the default if no option is selected. local-exists : This option is useful when using devices are set up using the \"Centrally Managed Device\" setup which would result in a facility's User Profiles already being on that device. When this option is selected, a drop down of unclaimed user profiles appears when accounts are being registered.","title":"Configuration"},{"location":"editor/project_managment/configuration/#configuration","text":"","title":"Configuration"},{"location":"editor/project_managment/configuration/#app-configuration","text":"app-config.json should have the following properties defined. homeUrl:string The default route to load when no route is specified. Think of this as the root url securityPolicy:string[] . This is an array of all the combinations of the security policies to be enforced in the app. NOTE: noPassword and password are mutually exclusive. Only one should be provided and not both. password noPassword associateUserProfileMode : This is the mode that determines where a user profiles comes from after a user has created an account on a device. Note, a \"User\" is tied together across devices by a single \"User Profile\". The account on the device is simply a security mechanism for using the profiles. remote : Selecting this will result in a user being promted to enter a \"code\" after they register an account. This code is the last 6 characters of their User Profile ID. Typically a Group Admin would create a User Profile doc on the server and then send this code to the person associated with the User Profile. When the user enters this code on the tablet, the tablet will reach out over the Internet and download the corresponding User Profile and any content associated with that User Profile. Because all content is downloaded for that user, it can also be used as a way to fully restore a user's data on a new or recovered tablet. However note that this data is mode is not compatible with using CouchDB sync settings on any form definitions' sync settings. local-new : This option allows users who register an Account on a tablet to create a new User Profile. This is also the default if no option is selected. local-exists : This option is useful when using devices are set up using the \"Centrally Managed Device\" setup which would result in a facility's User Profiles already being on that device. When this option is selected, a drop down of unclaimed user profiles appears when accounts are being registered.","title":"App Configuration"},{"location":"editor/project_managment/editor-guide/","text":"Releasing updates to existing forms \u00b6 Gotchas \u00b6 If you remove an input from an item or move that input to another item, when a user resumes a form response that was created with the prior version, content for that input will appear to have dissappeared. If you add remove an item from a form, when users resume form responses created on with the prior version, it will appear they have lost data since the item has been removed.","title":"Releasing updates to existing forms"},{"location":"editor/project_managment/editor-guide/#releasing-updates-to-existing-forms","text":"","title":"Releasing updates to existing forms"},{"location":"editor/project_managment/editor-guide/#gotchas","text":"If you remove an input from an item or move that input to another item, when a user resumes a form response that was created with the prior version, content for that input will appear to have dissappeared. If you add remove an item from a form, when users resume form responses created on with the prior version, it will appear they have lost data since the item has been removed.","title":"Gotchas"},{"location":"editor/project_managment/project_admin/","text":"Project Managment Overview \u00b6 How do you manage a project in Tangerine? What is a group? Why do you need a group? Creating a group What is a role in Tangerine? Creating roles How to create new users and add them to a group? How do you manage users? Mobile Device Use \u00b6 What devices will Tangerine work with? How do you manage devices? How to manage Tangerine Updates? Android Installation Web Browser Installation Tangerine Installation Decision Tree Registration and Login Administering Instruments Resuming Instruments Syncing Data Location Data Management Filter location data based on the user\u2019s profile location Import a location list Location list sample file with IDs","title":"Project Managment Overview"},{"location":"editor/project_managment/project_admin/#project-managment-overview","text":"How do you manage a project in Tangerine? What is a group? Why do you need a group? Creating a group What is a role in Tangerine? Creating roles How to create new users and add them to a group? How do you manage users?","title":"Project Managment Overview"},{"location":"editor/project_managment/project_admin/#mobile-device-use","text":"What devices will Tangerine work with? How do you manage devices? How to manage Tangerine Updates? Android Installation Web Browser Installation Tangerine Installation Decision Tree Registration and Login Administering Instruments Resuming Instruments Syncing Data Location Data Management Filter location data based on the user\u2019s profile location Import a location list Location list sample file with IDs","title":"Mobile Device Use"},{"location":"editor/project_managment/case-module/case-data-model/","text":"Case Management Data Model \u00b6 Case Entities and Relationships: \u00b6 Entities: Participant, Case, CaseEvent, EventForm, FormResponse Relationships: A Case is related to many Participants. A Case is related to many CaseEvents. A CaseEvent is related to many EventForms. An EventForm is related to one FormResponse. An EventForm is related to one Participant. Then there are definition Entities that are not in the data: Entities: ParticipantDefinition, CaseDefinition, CaseEventDefinition, EventFormDefinition, FormDefinition How the Case Entities and Relationships are expressed in Tangerine \u00b6 A typical Tangerine Case will feature: - one document (type = case) that has all of the Case-related meta-data mentioned below, and - multiple documents with forms data. These forms are linked by formResponseId in the case's eventForms array. There is not a 1-to-1 mapping between Tangerine entities and data persisted to the server. Records are saved in Tangerine as a TangyFormResponse doc, identified by \"collection\": \"TangyFormResponse\" in the Couchdb document. A TangyFormResponse is a very generic container for data; it does not by default manage any of its relationships. Most of the Case-related entities are saved in a single TangyFormResponse as \"type\": \"case\" and explicitly manages these relationships inside the eventForms array: { \"_id\" : \"8744ff38-4c3e-487d-814d-ddcb916a41d5\" , \"collection\" : \"TangyFormResponse\" , \"type\" : \"case\" , \"eventForms\" : [ { \"id\" : \"c7b6ee21-793a-11ea-9144-710703689c79\" , \"complete\" : true , \"caseId\" : \"c7b23330-793a-11ea-9144-710703689c79\" , \"participantId\" : \"\" , \"caseEventId\" : \"c7b6ee20-793a-11ea-9144-710703689c79\" , \"eventFormDefinitionId\" : \"enrollment-screening-form\" , \"formResponseId\" : \"c7b6ee22-793a-11ea-9144-710703689c79\" }, { \"id\" : \"c7b6ee23-793a-11ea-9144-710703689c79\" , \"complete\" : true , \"caseId\" : \"c7b23330-793a-11ea-9144-710703689c79\" , \"participantId\" : \"8a46e841-d80c-4038-857c-7ae43c1d42cf\" , \"caseEventId\" : \"c7b6ee20-793a-11ea-9144-710703689c79\" , \"eventFormDefinitionId\" : \"mnh-sociodemographic-form\" , \"formResponseId\" : \"c7b6ee24-793a-11ea-9144-710703689c79\" } ] } Any other documents related to a case save only form data and a small amount of meta-data. How relationships are mapped in an EventForm \u00b6 Let's first look at the Case hierarchy: A Case has a collection of CaseEvents . A CaseEvent has a collection of EventForms , which manage the relationship between : - the CaseEvent (stored as _id in the CaseEvent and caseId in the CaseEvent eventForms array ) - Participant (stored in the CaseEvent's particiaptns array and also linked via participantId in the CaseEvent's eventForms's array) - CaseEvent (stored as caseEventId in the CaseEvent's events array) - TangyFormResponse (stored as formResponseId and available externally in a separate document) class EventForm { id : string ; participantId : string complete : boolean = false caseId : string ; caseEventId : string ; eventFormDefinitionId : string ; formResponseId : string ; data ?: any ; constructor () { } } The formResponseId links to a TangyFormResponse, which contains the data filled out in a form.","title":"Case Management Data Model"},{"location":"editor/project_managment/case-module/case-data-model/#case-management-data-model","text":"","title":"Case Management Data Model"},{"location":"editor/project_managment/case-module/case-data-model/#case-entities-and-relationships","text":"Entities: Participant, Case, CaseEvent, EventForm, FormResponse Relationships: A Case is related to many Participants. A Case is related to many CaseEvents. A CaseEvent is related to many EventForms. An EventForm is related to one FormResponse. An EventForm is related to one Participant. Then there are definition Entities that are not in the data: Entities: ParticipantDefinition, CaseDefinition, CaseEventDefinition, EventFormDefinition, FormDefinition","title":"Case Entities and Relationships:"},{"location":"editor/project_managment/case-module/case-data-model/#how-the-case-entities-and-relationships-are-expressed-in-tangerine","text":"A typical Tangerine Case will feature: - one document (type = case) that has all of the Case-related meta-data mentioned below, and - multiple documents with forms data. These forms are linked by formResponseId in the case's eventForms array. There is not a 1-to-1 mapping between Tangerine entities and data persisted to the server. Records are saved in Tangerine as a TangyFormResponse doc, identified by \"collection\": \"TangyFormResponse\" in the Couchdb document. A TangyFormResponse is a very generic container for data; it does not by default manage any of its relationships. Most of the Case-related entities are saved in a single TangyFormResponse as \"type\": \"case\" and explicitly manages these relationships inside the eventForms array: { \"_id\" : \"8744ff38-4c3e-487d-814d-ddcb916a41d5\" , \"collection\" : \"TangyFormResponse\" , \"type\" : \"case\" , \"eventForms\" : [ { \"id\" : \"c7b6ee21-793a-11ea-9144-710703689c79\" , \"complete\" : true , \"caseId\" : \"c7b23330-793a-11ea-9144-710703689c79\" , \"participantId\" : \"\" , \"caseEventId\" : \"c7b6ee20-793a-11ea-9144-710703689c79\" , \"eventFormDefinitionId\" : \"enrollment-screening-form\" , \"formResponseId\" : \"c7b6ee22-793a-11ea-9144-710703689c79\" }, { \"id\" : \"c7b6ee23-793a-11ea-9144-710703689c79\" , \"complete\" : true , \"caseId\" : \"c7b23330-793a-11ea-9144-710703689c79\" , \"participantId\" : \"8a46e841-d80c-4038-857c-7ae43c1d42cf\" , \"caseEventId\" : \"c7b6ee20-793a-11ea-9144-710703689c79\" , \"eventFormDefinitionId\" : \"mnh-sociodemographic-form\" , \"formResponseId\" : \"c7b6ee24-793a-11ea-9144-710703689c79\" } ] } Any other documents related to a case save only form data and a small amount of meta-data.","title":"How the Case Entities and Relationships are expressed in Tangerine"},{"location":"editor/project_managment/case-module/case-data-model/#how-relationships-are-mapped-in-an-eventform","text":"Let's first look at the Case hierarchy: A Case has a collection of CaseEvents . A CaseEvent has a collection of EventForms , which manage the relationship between : - the CaseEvent (stored as _id in the CaseEvent and caseId in the CaseEvent eventForms array ) - Participant (stored in the CaseEvent's particiaptns array and also linked via participantId in the CaseEvent's eventForms's array) - CaseEvent (stored as caseEventId in the CaseEvent's events array) - TangyFormResponse (stored as formResponseId and available externally in a separate document) class EventForm { id : string ; participantId : string complete : boolean = false caseId : string ; caseEventId : string ; eventFormDefinitionId : string ; formResponseId : string ; data ?: any ; constructor () { } } The formResponseId links to a TangyFormResponse, which contains the data filled out in a form.","title":"How relationships are mapped in an EventForm"},{"location":"editor/project_managment/case-module/case-management-group/","text":"Case Management Group \u00b6 Case Management allows us to define Case Definitions for different purposes such as following a participant in a drug trial over the course of many events, where each event may require many forms to be filled out. In order to create and find cases, you will need to configure the \"case-home\" as the \"homeUrl\" value in app-config.json . Configuring Cases \u00b6 Case Management allows us to define Case Definitions for different purposes such as following a participant in a drug trial over the course of many events, where each event may require many forms to be filled out. To configure cases, there are four files to modify. First add a reference to the new Case Definition in the case-definitions.json . Here is an example of a case-definitions.json file that references two Case Definitions. File: case-definitions.json [ { \"id\": \"case-definition-1\", \"name\": \"Case Definition 1\", \"src\": \"./assets/case-definition-1.json\" }, { \"id\": \"case-definition-2\", \"name\": \"Case Definition 2\", \"src\": \"./assets/case-definition-2.json\" } ] Then create the corresponding Case Definition file... File: case-definition-1.json { \"id\" : \"case-definition-1\" , \"formId\" : \"case-definition-1-manifest\" , \"name\" : \"Case Definition 1\" , \"description\" : \"Description...\" , \"startFormOnOpen\" : { \"eventId\" : \"event-definition-1\" , \"eventFormId\" : \"event-form-1\" }, \"eventDefinitions\" : [ { \"id\" : \"event-definition-1\" , \"name\" : \"Event Definition 1\" , \"description\" : \"Description...\" , \"repeatable\" : false , \"required\" : true , \"eventFormDefinitions\" : [ { \"id\" : \"event-form-definition-1\" , \"formId\" : \"form-1\" , \"name\" : \"Form 1\" , \"required\" : true , \"repeatable\" : false } ] } ] } Case Definition Templates \u00b6 As a Data Collector uses the Client App, they navigate a Case's hierarchy of Events and Forms. Almost every piece of information they see can be overriden to display custom variables and logic by using the Case Definition's templates. This section describes the templates available and what variables are available. Note that all templates are evaluated as Javascript Template Literals. There are many good tutorials online about how to use Javascipt Template Literals, here are a couple of Javascript Template Literals examples that we reference often for things like doing conditionals and loops. Schedule \u00b6 templateScheduleListItemIcon default: \"templateScheduleListItemIcon\": \"${caseEvent.status === 'CASE_EVENT_STATUS_COMPLETED' ? 'event_note' : 'event_available'}\" templateScheduleListItemPrimary default: \"templateScheduleListItemPrimary\": \"<span>${caseEventDefinition.name}</span> in Case ${caseService.case._id.substr(0,5)}\" templateScheduleListItemSecondary default: \"templateScheduleListItemSecondary\": \"<span>${caseInstance.label}</span>\" Variables available: - caseService : CaseService - caseDefinition : CaseDefinition - caseEventDefinition : CaseEventDefinition - caseInstance : Case - caseEvent : CaseEvent Debugging Case Definition Templates \u00b6 Configuring search \u00b6 The case references a Form in the formId property of the Case Definition. Make sure there is a form with that corresponding Form ID listed in forms.json with additional configuration for search. File: forms.json [ { \"id\" : \"case-definition-1-manifest\" , \"type\" : \"case\" , \"title\" : \"Case Definition 1 Manifest\" , \"description\" : \"Description...\" , \"listed\" : true , \"src\" : \"./assets/case-definition-1-manifest/form.html\" , \"searchSettings\" : { \"primaryTemplate\" : \"Participant ID: ${searchDoc.variables.participant_id}\" , \"shouldIndex\" : true , \"secondaryTemplate\" : \"Enrollment Date: ${searchDoc.variables.enrollment_date}, Case ID: ${searchDoc._id}\" , \"variablesToIndex\" : [ \"participant_id\" , \"enrollment_date\" ] } } ] Configuring two-way sync \u00b6 Because you may need to share cases across devices, configuring two-way sync may be necessary. See the Two-way Sync Documentation for more details. Note that you sync Form Responses, and it's the IDs of that you'll want to sync in the \"formId\" of the Case Definition in order to sync cases. Configuring the Schedule \u00b6 One of the two tabs that Data Collectors see when they log into Tangerine is a \"Schedule\" tab. This schedule will show Case Event's on days where they are have an estimated day, scheduled day, and/or occurred on day. You can set these three dates on an event using the following APIs. caseService.setEventEstimatedDay(idOfEvent, timeInUnixMilliseconds) caseService.setEventOccurredOn(idOfEvent, timeInUnixMilliseconds) caseService.setEventScheduledDay(idOfEvent, timeInUnixMilliseconds)","title":"Case Management Group"},{"location":"editor/project_managment/case-module/case-management-group/#case-management-group","text":"Case Management allows us to define Case Definitions for different purposes such as following a participant in a drug trial over the course of many events, where each event may require many forms to be filled out. In order to create and find cases, you will need to configure the \"case-home\" as the \"homeUrl\" value in app-config.json .","title":"Case Management Group"},{"location":"editor/project_managment/case-module/case-management-group/#configuring-cases","text":"Case Management allows us to define Case Definitions for different purposes such as following a participant in a drug trial over the course of many events, where each event may require many forms to be filled out. To configure cases, there are four files to modify. First add a reference to the new Case Definition in the case-definitions.json . Here is an example of a case-definitions.json file that references two Case Definitions. File: case-definitions.json [ { \"id\": \"case-definition-1\", \"name\": \"Case Definition 1\", \"src\": \"./assets/case-definition-1.json\" }, { \"id\": \"case-definition-2\", \"name\": \"Case Definition 2\", \"src\": \"./assets/case-definition-2.json\" } ] Then create the corresponding Case Definition file... File: case-definition-1.json { \"id\" : \"case-definition-1\" , \"formId\" : \"case-definition-1-manifest\" , \"name\" : \"Case Definition 1\" , \"description\" : \"Description...\" , \"startFormOnOpen\" : { \"eventId\" : \"event-definition-1\" , \"eventFormId\" : \"event-form-1\" }, \"eventDefinitions\" : [ { \"id\" : \"event-definition-1\" , \"name\" : \"Event Definition 1\" , \"description\" : \"Description...\" , \"repeatable\" : false , \"required\" : true , \"eventFormDefinitions\" : [ { \"id\" : \"event-form-definition-1\" , \"formId\" : \"form-1\" , \"name\" : \"Form 1\" , \"required\" : true , \"repeatable\" : false } ] } ] }","title":"Configuring Cases"},{"location":"editor/project_managment/case-module/case-management-group/#case-definition-templates","text":"As a Data Collector uses the Client App, they navigate a Case's hierarchy of Events and Forms. Almost every piece of information they see can be overriden to display custom variables and logic by using the Case Definition's templates. This section describes the templates available and what variables are available. Note that all templates are evaluated as Javascript Template Literals. There are many good tutorials online about how to use Javascipt Template Literals, here are a couple of Javascript Template Literals examples that we reference often for things like doing conditionals and loops.","title":"Case Definition Templates"},{"location":"editor/project_managment/case-module/case-management-group/#debugging-case-definition-templates","text":"","title":"Debugging Case Definition Templates"},{"location":"editor/project_managment/case-module/case-management-group/#configuring-search","text":"The case references a Form in the formId property of the Case Definition. Make sure there is a form with that corresponding Form ID listed in forms.json with additional configuration for search. File: forms.json [ { \"id\" : \"case-definition-1-manifest\" , \"type\" : \"case\" , \"title\" : \"Case Definition 1 Manifest\" , \"description\" : \"Description...\" , \"listed\" : true , \"src\" : \"./assets/case-definition-1-manifest/form.html\" , \"searchSettings\" : { \"primaryTemplate\" : \"Participant ID: ${searchDoc.variables.participant_id}\" , \"shouldIndex\" : true , \"secondaryTemplate\" : \"Enrollment Date: ${searchDoc.variables.enrollment_date}, Case ID: ${searchDoc._id}\" , \"variablesToIndex\" : [ \"participant_id\" , \"enrollment_date\" ] } } ]","title":"Configuring search"},{"location":"editor/project_managment/case-module/case-management-group/#configuring-two-way-sync","text":"Because you may need to share cases across devices, configuring two-way sync may be necessary. See the Two-way Sync Documentation for more details. Note that you sync Form Responses, and it's the IDs of that you'll want to sync in the \"formId\" of the Case Definition in order to sync cases.","title":"Configuring two-way sync"},{"location":"editor/project_managment/case-module/case-management-group/#configuring-the-schedule","text":"One of the two tabs that Data Collectors see when they log into Tangerine is a \"Schedule\" tab. This schedule will show Case Event's on days where they are have an estimated day, scheduled day, and/or occurred on day. You can set these three dates on an event using the following APIs. caseService.setEventEstimatedDay(idOfEvent, timeInUnixMilliseconds) caseService.setEventOccurredOn(idOfEvent, timeInUnixMilliseconds) caseService.setEventScheduledDay(idOfEvent, timeInUnixMilliseconds)","title":"Configuring the Schedule"},{"location":"editor/project_managment/case-module/case-module-cookbook/","text":"Case Module Cookbook \u00b6 Get data from participant related to current Event Form \u00b6 In the following example, from an on-change hook or on-open , we can look up the corresponding participant for the current form, then look the age variable that has been previously set on that participant. const currentEventId = window . location . hash . split ( '/' )[ 5 ] const currentFormId = window . location . hash . split ( '/' )[ 6 ] const participantId = caseService . case . events . find ( event => event . id === currentEventId ) . eventForms . find ( eventForm => eventForm . id === currentFormId ) . participantId const age = caseService . getParticipantData ( participantId , 'age' )","title":"Case Module Cookbook"},{"location":"editor/project_managment/case-module/case-module-cookbook/#case-module-cookbook","text":"","title":"Case Module Cookbook"},{"location":"editor/project_managment/case-module/case-module-cookbook/#get-data-from-participant-related-to-current-event-form","text":"In the following example, from an on-change hook or on-open , we can look up the corresponding participant for the current form, then look the age variable that has been previously set on that participant. const currentEventId = window . location . hash . split ( '/' )[ 5 ] const currentFormId = window . location . hash . split ( '/' )[ 6 ] const participantId = caseService . case . events . find ( event => event . id === currentEventId ) . eventForms . find ( eventForm => eventForm . id === currentFormId ) . participantId const age = caseService . getParticipantData ( participantId , 'age' )","title":"Get data from participant related to current Event Form"},{"location":"system-administrator/","text":"System Administrator Guide \u00b6","title":"System Administrator Guide"},{"location":"system-administrator/#system-administrator-guide","text":"","title":"System Administrator Guide"},{"location":"system-administrator/automating-upgrades-of-tangerine/","text":"Automating Upgrades of Tangerine \u00b6 If you have a particularly complex upgrade of Tangerine that involves changing configurations, writing your own upgrade script and testing that on a QA server can be a way to ensure smooth upgrades when you go to production. Below you will find various tips and tricks we've discovered along the way of writing our own upgrade scripts. Update a group's configuration in the groups database \u00b6 In this example, we modify the xyz group's configuration to implement some csvReplacementCharacters. First we install into the container the jq utility for modifying JSON on the command line, then we modify the group's config doc in the second command. To use this example, replace the two xyz instances with the group's ID you want to modify. docker exec -it tangerine apt install -y jq docker exec -it tangerine bash -c 'curl -s $T_COUCHDB_ENDPOINT/groups/xyz | jq \".csvReplacementCharacters = [[\\\",\\\",\\\"|\\\"],[\\\"\\n\\\",\\\"___\\\"]]\" | curl -s -T - -H \"Content-Type: application/json\" -X PUT $T_COUCHDB_ENDPOINT/groups/xyz' Updating a group's content repository \u00b6 Given the upgrade of Tangerine, there may be associated content changes required. Set up an deploy key in your content repository on github and modify the following script to suit your needs. cd /path-to-tangerine/tangerine/data/groups/some-group-id/ GIT_SSH_COMMAND = 'ssh -i /root/.ssh/id_github.pub' git fetch origin git checkout v2.0.0 Update a group's app-config.json \u00b6 Best practice for ensuring that configuration in client/app-config.json is maintained over time is to first update the configuration you want to modify in your group's client/app-config.defaults.json and then retemplate the defaults to the client/app-config.json file. To use the following example, replace instances of group-xyz with the relevant Group ID and GROUP XYZ with the relevant Group Name. docker exec -it tangerine apt install -y jq docker exec -it tangerine bash -c 'cat /tangerine/groups/group-xyz/client/app-config.defaults.json | jq \".serverUrl = \\\"$T_PROTOCOL://$T_HOST_NAME\\\"\" | jq \".groupId = \\\"group-xyz\\\"\" | jq \".groupName = \\\"Group XYZ\\\"\" > /tangerine/groups/group-xyz/client/app-config.json'","title":"Automating Upgrades of Tangerine"},{"location":"system-administrator/automating-upgrades-of-tangerine/#automating-upgrades-of-tangerine","text":"If you have a particularly complex upgrade of Tangerine that involves changing configurations, writing your own upgrade script and testing that on a QA server can be a way to ensure smooth upgrades when you go to production. Below you will find various tips and tricks we've discovered along the way of writing our own upgrade scripts.","title":"Automating Upgrades of Tangerine"},{"location":"system-administrator/automating-upgrades-of-tangerine/#update-a-groups-configuration-in-the-groups-database","text":"In this example, we modify the xyz group's configuration to implement some csvReplacementCharacters. First we install into the container the jq utility for modifying JSON on the command line, then we modify the group's config doc in the second command. To use this example, replace the two xyz instances with the group's ID you want to modify. docker exec -it tangerine apt install -y jq docker exec -it tangerine bash -c 'curl -s $T_COUCHDB_ENDPOINT/groups/xyz | jq \".csvReplacementCharacters = [[\\\",\\\",\\\"|\\\"],[\\\"\\n\\\",\\\"___\\\"]]\" | curl -s -T - -H \"Content-Type: application/json\" -X PUT $T_COUCHDB_ENDPOINT/groups/xyz'","title":"Update a group's configuration in the groups database"},{"location":"system-administrator/automating-upgrades-of-tangerine/#updating-a-groups-content-repository","text":"Given the upgrade of Tangerine, there may be associated content changes required. Set up an deploy key in your content repository on github and modify the following script to suit your needs. cd /path-to-tangerine/tangerine/data/groups/some-group-id/ GIT_SSH_COMMAND = 'ssh -i /root/.ssh/id_github.pub' git fetch origin git checkout v2.0.0","title":"Updating a group's content repository"},{"location":"system-administrator/automating-upgrades-of-tangerine/#update-a-groups-app-configjson","text":"Best practice for ensuring that configuration in client/app-config.json is maintained over time is to first update the configuration you want to modify in your group's client/app-config.defaults.json and then retemplate the defaults to the client/app-config.json file. To use the following example, replace instances of group-xyz with the relevant Group ID and GROUP XYZ with the relevant Group Name. docker exec -it tangerine apt install -y jq docker exec -it tangerine bash -c 'cat /tangerine/groups/group-xyz/client/app-config.defaults.json | jq \".serverUrl = \\\"$T_PROTOCOL://$T_HOST_NAME\\\"\" | jq \".groupId = \\\"group-xyz\\\"\" | jq \".groupName = \\\"Group XYZ\\\"\" > /tangerine/groups/group-xyz/client/app-config.json'","title":"Update a group's app-config.json"},{"location":"system-administrator/couchdb/","text":"CouchDB \u00b6 Upgrade \u00b6 If there has been a security update to CouchDB 2.x, all you must do is rerun the start.sh command and the new image for CouchDB will be downloaded and run. Change password \u00b6 # Shutdown tangerine and couchdb docker stop tangerine couchdb # Remove the docker files that cached the password for CouchDB. rm -r data/couchdb/local.d # Update the T_COUCHDB_USER_ADMIN_PASS variable. vim config.sh # update the cached password in the reporting worker configuration. vim data/reporting-worker-state.json # If using the mysql module, update the passwords in each group's mysql state file. vim data/mysql/state/<groupId>.ini # start.sh will rebuild the couchdb and tangerine containers which will update the password in all necessary places. ./start.sh <version>","title":"CouchDB"},{"location":"system-administrator/couchdb/#couchdb","text":"","title":"CouchDB"},{"location":"system-administrator/couchdb/#upgrade","text":"If there has been a security update to CouchDB 2.x, all you must do is rerun the start.sh command and the new image for CouchDB will be downloaded and run.","title":"Upgrade"},{"location":"system-administrator/couchdb/#change-password","text":"# Shutdown tangerine and couchdb docker stop tangerine couchdb # Remove the docker files that cached the password for CouchDB. rm -r data/couchdb/local.d # Update the T_COUCHDB_USER_ADMIN_PASS variable. vim config.sh # update the cached password in the reporting worker configuration. vim data/reporting-worker-state.json # If using the mysql module, update the passwords in each group's mysql state file. vim data/mysql/state/<groupId>.ini # start.sh will rebuild the couchdb and tangerine containers which will update the password in all necessary places. ./start.sh <version>","title":"Change password"},{"location":"system-administrator/install-on-aws/","text":"Installing Tangerine on AWS \u00b6 Creating the AWS instance \u00b6 Login to AWS and Launch a new instance with Ubuntu 18.04 using a t2.medium server with 4 GiB memory. Volume should be larger than the 8GB default. 24GB would be useful, but if you're planning to test different Tangerine images, go for 64GB. Security \u00b6 Make sure to assign a security group to your instance that allows you to access port 80 via a web browser and port 22 via ssh. HTTP: TCP 80 0.0.0.0/0 SSH TCP 22 0.0.0.0/0 Set up SSL \u00b6 Prerequisites: - An SSL Certificate. If you don't yet have one, we recommend using AWS's Certificate Manager (found under \"Security, Identity, and Compliance\"). Create and Configure an Elastic Load Balancer (ELB): - Go to EC2, click \"Load Balancers\" in the left column, click \"Create Load Balancer\", and then select \"Classic Load Balancer\". - Step 1: Define Load Balancer - Set a Load Balancer name to what you want. - Set \"Load Balancer Protocol\" on the left most column to \"HTTPS\". - Set \"Instance Protocol\" in the third column to \"HTTP\". - Click \"Add\". - In the new row set \"Load Balancer Protocol\" to \"HTTP\" and \"Instance Protocol\" to \"HTTP\". - Click \"Next\". - Step 2: Assign Security Groups - Select \"Create a new security group\". - Set rules for both HTTP and HTTPS. If you only do HTTPS, anyone who goes to http://yourdomain.com will get an Access Denied message. Allow them to access the site with HTTP, the software will forward them to HTTPS automatically. - Click \"Next\". - Step 3: Configure Security Settings - If you have an SSL certificate, you can upload that here. Otherwise select \"Choose an existing certificate from AWS Certificate Manager (ACM)\". - If you have not requested a certificate for your domain yet, you will need to click \"Request a new certificate from ACM\" and follow those instructions before proceeding. - Step 4: Configure Health Check - Ping Protocol: HTTP - Ping Port: 80 - Ping Path: /app/tangerine/index.html - Response Timeout: 5 seconds - Interval: 10 seconds - Unhealthy threshold: 10 - Healthy threshold: 2 - Step 5: Add EC2 Instances - Select the EC2 instance running Tangerine. - Step 6: Add Tags - No tags are required for Tangerine. - Step 7: Review - If everything looks good, go ahead and create it! - Now proceed to your Load Balancers dashboard, click on your load balancer, click on the Instances tab, and now wait for your EC2 instance to be listed as \"InService\". - Configure your domain's DNS to point to this load balancer by clicking on the load balancer's Description tab and using the \"DNS name\" given to configure your Domain's DNS. SSH Login to Server \u00b6 Once your server is created, login with your key: ssh -i ~/.ssh/iyour_key -l ubuntu <your EC2 instance's IP address> Now you may continue to step 2 in the installation instructions of Tangerine's README.md, then pick back up here. Configure Logs \u00b6 Send logs to AWS CloudWatch for building alarms and saving disk space. Create IAM user with programattic access and AWSAppSyncPushToCloudWatchLogs policy. Keep open credentials screen for reference. Install aws-cli with sudo apt-get install awscli . aws configure and give the credentials for the IAM user. Go to AWS Console -> IAM -> Access Management -> Roles -> Create Role , create a role called aws-cloudwatch-logs with an attached policy of AWSOpsWorksCloudWatchLogs . Go to AWS Console -> EC2 -> Instances -> <select your instance> -> Actions -> Security -> Modify IAM role and add the aws-cloudwatch-logs role to the EC2 instance. Go to AWS Console -> CloudWatch -> Logs -> Actions -> Create log group . Create the Log Group named after the instance name (ie. example-v3). Write the configuration to /etc/docker/daemon.json . Change awslogs-region to the \"less specific\" region name (eu-central-1 as opposed to eu-central-1b) and replace example-v3 in tag and awslogs-group to reflect the EC2 instance name. Then run systemctl restart docker . If containers were already running, you may need to recreate them for settings to take hold. For Tangerine, that just means running ./start.sh again. After setting up Tangerine, navigate in your browser to AWS Console -> CloudWatch -> Logs and select your instance's log group. There you will find two streams, one for the tangerine container the other for couchdb container using the \"tag\" pattern you configured in daemon.json . { \"log-driver\": \"awslogs\", \"log-opts\": { \"awslogs-region\": \"eu-central-1\", \"awslogs-group\": \"example-\", \"tag\": \"example-{{.Name}}\" } } Configure Alarm \u00b6 With Docker logs being sent to AWS CloudWatch, you can configure an alarm to detect if Tangerine is down. The following directions explain how to send an automated email if a Tangerine heartbeat log message is not heard for 15 minutes. Navigate in your browser to AWS Console -> CloudWatch -> Logs . Open your server's log group. Open the stream for Tangerine. If your tag pattern in /etc/docker/daemon.json is example-{{.Name}} , then your stream name will be example-tangerine . In the Filter events text box, type heartbeat and press enter. This will filter the logs to all heartbeat messages. With the filter still applied, click the \"Create Metric Filter\" button. Fill out \"Metric\" form as follows: Filter name: heartbeat Filter pattern: heartbeat Metric namespace: tangerine Metric name: heartbeat Metric value: 1 Default value: 0 Unit: leave blank Navigate to your log group and click the \"Metric filter\" tab, click the checkbox in your Metric's box, then click \"Create alarm\" button. Fill out the form: Metric name: heartbeat Statistic: Sum Period: 15 minutes Threshold type: Static Whenever heartbeat is...: Lower than...: 1 Additional configuration Datapoints to alarm: 1 out of 1 Missing data treatment: Treat missing data as bad (breaching the threshold) Fill out \"Notification\" form as follows: Alarm state trigger: In alarm Select an SNS topic: Create new topic Create a new topic...: <server name>-tangerine-heartbeat Email endpoints that will receive the notification...: <your email address> Click \"Create Topic\" button, then \"Next\" button. Fill out \"Name and description\" form as follows then click \"Next\" button: Alarm name: <server name>-tangerine-heartbeat Now on the \"Preview and create\" screen, click \"Create Alarm\" Check your email to confirm subscription to SNS Topic.","title":"Installing Tangerine on AWS"},{"location":"system-administrator/install-on-aws/#installing-tangerine-on-aws","text":"","title":"Installing Tangerine on AWS"},{"location":"system-administrator/install-on-aws/#creating-the-aws-instance","text":"Login to AWS and Launch a new instance with Ubuntu 18.04 using a t2.medium server with 4 GiB memory. Volume should be larger than the 8GB default. 24GB would be useful, but if you're planning to test different Tangerine images, go for 64GB.","title":"Creating the AWS instance"},{"location":"system-administrator/install-on-aws/#security","text":"Make sure to assign a security group to your instance that allows you to access port 80 via a web browser and port 22 via ssh. HTTP: TCP 80 0.0.0.0/0 SSH TCP 22 0.0.0.0/0","title":"Security"},{"location":"system-administrator/install-on-aws/#set-up-ssl","text":"Prerequisites: - An SSL Certificate. If you don't yet have one, we recommend using AWS's Certificate Manager (found under \"Security, Identity, and Compliance\"). Create and Configure an Elastic Load Balancer (ELB): - Go to EC2, click \"Load Balancers\" in the left column, click \"Create Load Balancer\", and then select \"Classic Load Balancer\". - Step 1: Define Load Balancer - Set a Load Balancer name to what you want. - Set \"Load Balancer Protocol\" on the left most column to \"HTTPS\". - Set \"Instance Protocol\" in the third column to \"HTTP\". - Click \"Add\". - In the new row set \"Load Balancer Protocol\" to \"HTTP\" and \"Instance Protocol\" to \"HTTP\". - Click \"Next\". - Step 2: Assign Security Groups - Select \"Create a new security group\". - Set rules for both HTTP and HTTPS. If you only do HTTPS, anyone who goes to http://yourdomain.com will get an Access Denied message. Allow them to access the site with HTTP, the software will forward them to HTTPS automatically. - Click \"Next\". - Step 3: Configure Security Settings - If you have an SSL certificate, you can upload that here. Otherwise select \"Choose an existing certificate from AWS Certificate Manager (ACM)\". - If you have not requested a certificate for your domain yet, you will need to click \"Request a new certificate from ACM\" and follow those instructions before proceeding. - Step 4: Configure Health Check - Ping Protocol: HTTP - Ping Port: 80 - Ping Path: /app/tangerine/index.html - Response Timeout: 5 seconds - Interval: 10 seconds - Unhealthy threshold: 10 - Healthy threshold: 2 - Step 5: Add EC2 Instances - Select the EC2 instance running Tangerine. - Step 6: Add Tags - No tags are required for Tangerine. - Step 7: Review - If everything looks good, go ahead and create it! - Now proceed to your Load Balancers dashboard, click on your load balancer, click on the Instances tab, and now wait for your EC2 instance to be listed as \"InService\". - Configure your domain's DNS to point to this load balancer by clicking on the load balancer's Description tab and using the \"DNS name\" given to configure your Domain's DNS.","title":"Set up SSL"},{"location":"system-administrator/install-on-aws/#ssh-login-to-server","text":"Once your server is created, login with your key: ssh -i ~/.ssh/iyour_key -l ubuntu <your EC2 instance's IP address> Now you may continue to step 2 in the installation instructions of Tangerine's README.md, then pick back up here.","title":"SSH Login to Server"},{"location":"system-administrator/install-on-aws/#configure-logs","text":"Send logs to AWS CloudWatch for building alarms and saving disk space. Create IAM user with programattic access and AWSAppSyncPushToCloudWatchLogs policy. Keep open credentials screen for reference. Install aws-cli with sudo apt-get install awscli . aws configure and give the credentials for the IAM user. Go to AWS Console -> IAM -> Access Management -> Roles -> Create Role , create a role called aws-cloudwatch-logs with an attached policy of AWSOpsWorksCloudWatchLogs . Go to AWS Console -> EC2 -> Instances -> <select your instance> -> Actions -> Security -> Modify IAM role and add the aws-cloudwatch-logs role to the EC2 instance. Go to AWS Console -> CloudWatch -> Logs -> Actions -> Create log group . Create the Log Group named after the instance name (ie. example-v3). Write the configuration to /etc/docker/daemon.json . Change awslogs-region to the \"less specific\" region name (eu-central-1 as opposed to eu-central-1b) and replace example-v3 in tag and awslogs-group to reflect the EC2 instance name. Then run systemctl restart docker . If containers were already running, you may need to recreate them for settings to take hold. For Tangerine, that just means running ./start.sh again. After setting up Tangerine, navigate in your browser to AWS Console -> CloudWatch -> Logs and select your instance's log group. There you will find two streams, one for the tangerine container the other for couchdb container using the \"tag\" pattern you configured in daemon.json . { \"log-driver\": \"awslogs\", \"log-opts\": { \"awslogs-region\": \"eu-central-1\", \"awslogs-group\": \"example-\", \"tag\": \"example-{{.Name}}\" } }","title":"Configure Logs"},{"location":"system-administrator/install-on-aws/#configure-alarm","text":"With Docker logs being sent to AWS CloudWatch, you can configure an alarm to detect if Tangerine is down. The following directions explain how to send an automated email if a Tangerine heartbeat log message is not heard for 15 minutes. Navigate in your browser to AWS Console -> CloudWatch -> Logs . Open your server's log group. Open the stream for Tangerine. If your tag pattern in /etc/docker/daemon.json is example-{{.Name}} , then your stream name will be example-tangerine . In the Filter events text box, type heartbeat and press enter. This will filter the logs to all heartbeat messages. With the filter still applied, click the \"Create Metric Filter\" button. Fill out \"Metric\" form as follows: Filter name: heartbeat Filter pattern: heartbeat Metric namespace: tangerine Metric name: heartbeat Metric value: 1 Default value: 0 Unit: leave blank Navigate to your log group and click the \"Metric filter\" tab, click the checkbox in your Metric's box, then click \"Create alarm\" button. Fill out the form: Metric name: heartbeat Statistic: Sum Period: 15 minutes Threshold type: Static Whenever heartbeat is...: Lower than...: 1 Additional configuration Datapoints to alarm: 1 out of 1 Missing data treatment: Treat missing data as bad (breaching the threshold) Fill out \"Notification\" form as follows: Alarm state trigger: In alarm Select an SNS topic: Create new topic Create a new topic...: <server name>-tangerine-heartbeat Email endpoints that will receive the notification...: <your email address> Click \"Create Topic\" button, then \"Next\" button. Fill out \"Name and description\" form as follows then click \"Next\" button: Alarm name: <server name>-tangerine-heartbeat Now on the \"Preview and create\" screen, click \"Create Alarm\" Check your email to confirm subscription to SNS Topic.","title":"Configure Alarm"},{"location":"system-administrator/integrate-group-with-github/","text":"Integrate a group's content with a repository on Github \u00b6 Step 1 \u00b6 Create a group in the Editor. Note the ID in the URL starting with group- . Step 2 \u00b6 Create a repository on Github for your group's content. Step 3 \u00b6 SSH into the server and create a \"deploy key\" the server will use to authenticate to Github with. When running ssh-keygen , do not password protect the key file. When it prompts you for a password, just hit enter. ssh <your server> sudo su ssh-keygen -t rsa -b 4096 -C \"root@domain_of_server\" cat /root/.ssh/id_rsa.pub Change the key permissions if necessary. Copy the key contents that we just \"cat'ed\" to the screen. Then go to your Repository on Github and click on Settings -> Deploy keys -> Add deploy key and paste that key in the key contents, enable \"Allow write access\" and save. Step 4 \u00b6 Now we push our group's initial content to our github repository with the following commands... cd tangerine/data/client/content/groups/<group id> git init git add . git commit -m \"first commit\" git remote add origin <githut repository SSH URL> git push origin master You should now see on your Github Repository code page a list of files pushed from the server. Step 5 \u00b6 We'll now configure your server to periodically pull content changes from Github. ssh <your server> sudo su crontab -e Enter the following onto a new line. Replace <group id> with appropriate Group ID. * * * * * cd /home/ubuntu/tangerine/data/client/content/groups/<group id> && GIT_SSH_COMMAND='ssh -i /root/.ssh/id_rsa' git pull origin master && git add . && git commit -m 'auto-commit' && GIT_SSH_COMMAND='ssh -i /root/.ssh/id_rsa' git push origin master","title":"Integrate a group's content with a repository on Github"},{"location":"system-administrator/integrate-group-with-github/#integrate-a-groups-content-with-a-repository-on-github","text":"","title":"Integrate a group's content with a repository on Github"},{"location":"system-administrator/integrate-group-with-github/#step-1","text":"Create a group in the Editor. Note the ID in the URL starting with group- .","title":"Step 1"},{"location":"system-administrator/integrate-group-with-github/#step-2","text":"Create a repository on Github for your group's content.","title":"Step 2"},{"location":"system-administrator/integrate-group-with-github/#step-3","text":"SSH into the server and create a \"deploy key\" the server will use to authenticate to Github with. When running ssh-keygen , do not password protect the key file. When it prompts you for a password, just hit enter. ssh <your server> sudo su ssh-keygen -t rsa -b 4096 -C \"root@domain_of_server\" cat /root/.ssh/id_rsa.pub Change the key permissions if necessary. Copy the key contents that we just \"cat'ed\" to the screen. Then go to your Repository on Github and click on Settings -> Deploy keys -> Add deploy key and paste that key in the key contents, enable \"Allow write access\" and save.","title":"Step 3"},{"location":"system-administrator/integrate-group-with-github/#step-4","text":"Now we push our group's initial content to our github repository with the following commands... cd tangerine/data/client/content/groups/<group id> git init git add . git commit -m \"first commit\" git remote add origin <githut repository SSH URL> git push origin master You should now see on your Github Repository code page a list of files pushed from the server.","title":"Step 4"},{"location":"system-administrator/integrate-group-with-github/#step-5","text":"We'll now configure your server to periodically pull content changes from Github. ssh <your server> sudo su crontab -e Enter the following onto a new line. Replace <group id> with appropriate Group ID. * * * * * cd /home/ubuntu/tangerine/data/client/content/groups/<group id> && GIT_SSH_COMMAND='ssh -i /root/.ssh/id_rsa' git pull origin master && git add . && git commit -m 'auto-commit' && GIT_SSH_COMMAND='ssh -i /root/.ssh/id_rsa' git push origin master","title":"Step 5"},{"location":"system-administrator/managing-data-conflicts/","text":"Managing Data Conflicts \u00b6 When using Sync Protocol 2 we can sync data down to Devices. Because of this it is possible for two Devices to edit the same data between syncs. This causes a \"Data Conflict\". When a Device is syncing and a conflict is detected. To manage Data Conflicts you will need to know the IP Address of your server and have the CouchDB Admin credentials found in config.sh . Step 1: Find Documents with Conflicts \u00b6 Go to <serverIpAddress>:5984/_utils/#database/<groupId>/_design/shared_conflicts/_view/shared_conflicts . This is a list of Documents with conflicts. Click the first one in the list which will open the Document with conflicts. Note this doc has link in the second bar from the top on the right with label of \"Conflicts\". Step 2: Merge Conflict Revisions contents into Doc \u00b6 With the Document open, in Fauxton, copy the URL and open another window with the same URL side by side. On the window on the left, click the \"Conflicts\" link in the top right of that window. Note the \"Conflicting Revisions\" drop down in the Conflicts Browser. These Conflicting Revisions are the contents of Documents that were the \"losing revision\" when in a conflict. Selecting a \"Conflict Rev\" in the Conlict Revisions dropdown will result in the difference between the Conflicting Revision's contents and the current revision's contents. JSON highlighted in green belongs to the Conflict Rev. Cycle through each of the Conflict Revs migrating JSON highlighted in green over to the current Document edit view in your browser on the right. When all contents in the Conflict Revs have been migrated (AKA \"merged\") into the current Document, save the current doc with the changes and proceed to the next step. Step 3: Archive Conflict Revisions \u00b6 Use the pouchdb-couchdb-archive-conflicts CLI tool to archive the conflicts in the Document. This will result in removing the Document for the conlist list in step 1 and save a copy of each conflict revision into `<serverIpAddress>:5984/_utils/#database/<groupId>-conflict-revs/ . Install the tool. Requires Node.js ( https://nodejs.org/ ). npm install -g pouchdb-couchdb-archive-conflicts archive-conflicts http://<username>:<password>@<serverIp>:5984/<groupId> <docId> Now return to Step 1 and pick the next Document in the list. Reviewing Archived Conflict Revisions \u00b6 To review a Documents archived conflict revisions, add a byConflictDocId view to the database. function (doc) { emit(doc.conflictDocId, doc.conflictRevId); } When viewing this view you can then click \"Options\" and enter the follwing under \"By Keys\" [\"<docId>\"] .","title":"Managing Data Conflicts"},{"location":"system-administrator/managing-data-conflicts/#managing-data-conflicts","text":"When using Sync Protocol 2 we can sync data down to Devices. Because of this it is possible for two Devices to edit the same data between syncs. This causes a \"Data Conflict\". When a Device is syncing and a conflict is detected. To manage Data Conflicts you will need to know the IP Address of your server and have the CouchDB Admin credentials found in config.sh .","title":"Managing Data Conflicts"},{"location":"system-administrator/managing-data-conflicts/#step-1-find-documents-with-conflicts","text":"Go to <serverIpAddress>:5984/_utils/#database/<groupId>/_design/shared_conflicts/_view/shared_conflicts . This is a list of Documents with conflicts. Click the first one in the list which will open the Document with conflicts. Note this doc has link in the second bar from the top on the right with label of \"Conflicts\".","title":"Step 1: Find Documents with Conflicts"},{"location":"system-administrator/managing-data-conflicts/#step-2-merge-conflict-revisions-contents-into-doc","text":"With the Document open, in Fauxton, copy the URL and open another window with the same URL side by side. On the window on the left, click the \"Conflicts\" link in the top right of that window. Note the \"Conflicting Revisions\" drop down in the Conflicts Browser. These Conflicting Revisions are the contents of Documents that were the \"losing revision\" when in a conflict. Selecting a \"Conflict Rev\" in the Conlict Revisions dropdown will result in the difference between the Conflicting Revision's contents and the current revision's contents. JSON highlighted in green belongs to the Conflict Rev. Cycle through each of the Conflict Revs migrating JSON highlighted in green over to the current Document edit view in your browser on the right. When all contents in the Conflict Revs have been migrated (AKA \"merged\") into the current Document, save the current doc with the changes and proceed to the next step.","title":"Step 2: Merge Conflict Revisions contents into Doc"},{"location":"system-administrator/managing-data-conflicts/#step-3-archive-conflict-revisions","text":"Use the pouchdb-couchdb-archive-conflicts CLI tool to archive the conflicts in the Document. This will result in removing the Document for the conlist list in step 1 and save a copy of each conflict revision into `<serverIpAddress>:5984/_utils/#database/<groupId>-conflict-revs/ . Install the tool. Requires Node.js ( https://nodejs.org/ ). npm install -g pouchdb-couchdb-archive-conflicts archive-conflicts http://<username>:<password>@<serverIp>:5984/<groupId> <docId> Now return to Step 1 and pick the next Document in the list.","title":"Step 3: Archive Conflict Revisions"},{"location":"system-administrator/managing-data-conflicts/#reviewing-archived-conflict-revisions","text":"To review a Documents archived conflict revisions, add a byConflictDocId view to the database. function (doc) { emit(doc.conflictDocId, doc.conflictRevId); } When viewing this view you can then click \"Options\" and enter the follwing under \"By Keys\" [\"<docId>\"] .","title":"Reviewing Archived Conflict Revisions"},{"location":"system-administrator/managing-legacy-conflict-issues/","text":"Managing Legacy Conflict Issues \u00b6 The following describes a process for managing data conflicts using a deprecated feature known as \"Auto-merge\" and \"Conflict Issues\". When using Sync Protocol 2 we can sync data down to Devices. Because of this it is possible for two Devices to edit the same data between syncs. This causes a \"Data Conflict\". When a Device is syncing and a conflict is detected, the Tangerine software will try to resolve that conflict by merging the two versions. When Tangerine does this, it creates a \"Conflict Issue\" which stores the two versions and the merged version for safe keeping (in Issue this is refered to as A, B, and Merged). These are important to review in the Issue queue to ensure that the merge is satisfactory. Sometimes a merge will not be possible and the data will be left in a Conflict state according to CouchDB's definition of Conflict. To manage Data Conflicts you will need to know the IP Address of your server and CouchDB Admin credentials found in config.sh . Monitor how many Conflict Issues there are by Document ID \u00b6 Go to <serverIpAddress>:5984/_utils/#/database/<groupId>/_design/issuesOfTypeConflictByConflictingDocTypeAndConflictingDocId/_view/issuesOfTypeConflictByConflictingDocTypeAndConflictingDocId Click wrench for view on left hand column, make sure \"Reduce: Count\" is enabled on the view. Click \"Options\", check \"Reduce\" and then set \"Group Level\" of 2. Get a list of all conflict issues in a group \u00b6 <serverIpAddress>/<groupId>/_design/issuesOfTypeConflictByConflictingDocTypeAndConflictingDocId/_view/issuesOfTypeConflictByConflictingDocTypeAndConflictingDocId?reduce=false Check a single document for conflicts \u00b6 Get a list of all conflict issues for a document \u00b6 If you know the document id for a case, you can get a list of its conflict issues. In the following example, the first parameter in the key is set to 'case' to signify that it is a case document ( type:'case'); however, in the future conflicts may also be type:'response'. Replace <docId> and enter the following into your browser: <serverIpAddress>/<groupId>/_design/issuesOfTypeConflictByConflictingDocTypeAndConflictingDocId/_view/issuesOfTypeConflictByConflictingDocTypeAndConflictingDocId?reduce=false&key=[\"case\",\"<docId>\"] Get the number of conflicts in a document \u00b6 If you know the document id for a case, replace <docId> and enter the following into your browser: <serverIpAddress>/<groupId>/_design/issuesOfTypeConflictByConflictingDocTypeAndConflictingDocId/_view/issuesOfTypeConflictByConflictingDocTypeAndConflictingDocId?reduce=true&group_level=2&key=[\"case\",\"<docId>\"] Monitor active Database Conflicts in CouchDB \u00b6 Go to <serverIpAddress>:5984/_utils/#database/<groupId>/_design/shared_conflicts/_view/shared_conflicts . To view the number of conflicts per document, click the table tab. To resolve a conflict, click on the row to open the Doc in conflict. Then click the \"Conflicts\" tab to resolve the Conflict. Viewing the history of Documents in the database \u00b6 Sometimes it helps to look back at the history of a Case. When a Case is open in Tangerine Editor, you can run the following in the Chrome Devtools Console. await T.case.getCaseHistory() To look at the full picture that CouchDB server is aware of, use the following URL structure... <serverIpAddress>:5984/<groupId>/<docId>?revs_info=true You will find the response contains a _revs_info property with an array of revisions. If a revisions has \"status\" of \"unavailable\" , then that revision is on the Device it came from. You can find out which Device likely has that revision by finding the next available revision, getting the doc at that revision, and inspecting the modifiedByDeviceId property. This is the version of the doc that was uploaded to the server. <serverIpAddress>:5984/<groupId>/<docId>?rev=<revId>","title":"Managing Legacy Conflict Issues"},{"location":"system-administrator/managing-legacy-conflict-issues/#managing-legacy-conflict-issues","text":"The following describes a process for managing data conflicts using a deprecated feature known as \"Auto-merge\" and \"Conflict Issues\". When using Sync Protocol 2 we can sync data down to Devices. Because of this it is possible for two Devices to edit the same data between syncs. This causes a \"Data Conflict\". When a Device is syncing and a conflict is detected, the Tangerine software will try to resolve that conflict by merging the two versions. When Tangerine does this, it creates a \"Conflict Issue\" which stores the two versions and the merged version for safe keeping (in Issue this is refered to as A, B, and Merged). These are important to review in the Issue queue to ensure that the merge is satisfactory. Sometimes a merge will not be possible and the data will be left in a Conflict state according to CouchDB's definition of Conflict. To manage Data Conflicts you will need to know the IP Address of your server and CouchDB Admin credentials found in config.sh .","title":"Managing Legacy Conflict Issues"},{"location":"system-administrator/managing-legacy-conflict-issues/#monitor-how-many-conflict-issues-there-are-by-document-id","text":"Go to <serverIpAddress>:5984/_utils/#/database/<groupId>/_design/issuesOfTypeConflictByConflictingDocTypeAndConflictingDocId/_view/issuesOfTypeConflictByConflictingDocTypeAndConflictingDocId Click wrench for view on left hand column, make sure \"Reduce: Count\" is enabled on the view. Click \"Options\", check \"Reduce\" and then set \"Group Level\" of 2.","title":"Monitor how many Conflict Issues there are by Document ID"},{"location":"system-administrator/managing-legacy-conflict-issues/#get-a-list-of-all-conflict-issues-in-a-group","text":"<serverIpAddress>/<groupId>/_design/issuesOfTypeConflictByConflictingDocTypeAndConflictingDocId/_view/issuesOfTypeConflictByConflictingDocTypeAndConflictingDocId?reduce=false","title":"Get a list of all conflict issues in a group"},{"location":"system-administrator/managing-legacy-conflict-issues/#check-a-single-document-for-conflicts","text":"","title":"Check a single document for conflicts"},{"location":"system-administrator/managing-legacy-conflict-issues/#monitor-active-database-conflicts-in-couchdb","text":"Go to <serverIpAddress>:5984/_utils/#database/<groupId>/_design/shared_conflicts/_view/shared_conflicts . To view the number of conflicts per document, click the table tab. To resolve a conflict, click on the row to open the Doc in conflict. Then click the \"Conflicts\" tab to resolve the Conflict.","title":"Monitor active Database Conflicts in CouchDB"},{"location":"system-administrator/managing-legacy-conflict-issues/#viewing-the-history-of-documents-in-the-database","text":"Sometimes it helps to look back at the history of a Case. When a Case is open in Tangerine Editor, you can run the following in the Chrome Devtools Console. await T.case.getCaseHistory() To look at the full picture that CouchDB server is aware of, use the following URL structure... <serverIpAddress>:5984/<groupId>/<docId>?revs_info=true You will find the response contains a _revs_info property with an array of revisions. If a revisions has \"status\" of \"unavailable\" , then that revision is on the Device it came from. You can find out which Device likely has that revision by finding the next available revision, getting the doc at that revision, and inspecting the modifiedByDeviceId property. This is the version of the doc that was uploaded to the server. <serverIpAddress>:5984/<groupId>/<docId>?rev=<revId>","title":"Viewing the history of Documents in the database"},{"location":"system-administrator/mysql-module/","text":"MySQL Module \u00b6 Enabling MySQL module \u00b6 Important! If reenabling the mysql module, remove the mysql folder: rm -r data/mysql Step 1 \u00b6 Ensure the variables from the MySQL section in config.defaults.sh are in your customized config.sh file. Step 2 \u00b6 Ensure the T_MYSQL_PASSWORD variable is set to a sufficiently secure string. Failure to properly secure this password will without a doubt result in ransomware bots hacking your database. Step 3 \u00b6 Add the mysql module to T_MODULES_ENABLED in config.sh . For example: T_MODULES=\"['csv','mysql']\" Step 4 \u00b6 Run the start script to load in new configuration. Do this even if your server is already running. Note that restarting the container will not work, we have to run ./start.sh to recreate the container with the new configuration. ./start.sh <version> Note: Upgrading an older version of Tangerine may require running docker exec tangerine push-all-groups-views after to enable indexes used for mysql Step 5 \u00b6 Clear reporting cache to start generating a MySQL database for each group. docker exec tangerine reporting-cache-clear You can check in on the progress of generating the mysql database using the mysql-report command. ( Warning The mysql-report command creates a heavy workload to an instance so do not use it when mysql is trying to process a lot of data from couchdb. See the \"Troubleshooting\" section below.) It will return for each kind of case data and form, how many records are in the source database vs. how many have made it over to mysql. Note that if your system is under heavy load during the processing of this, this command may stress it out even more so it may be best to wait until you see a load of less than one using a tool like top or htop . docker exec -it tangerine bash mysql-report <groupId> | json_pp Step 6 \u00b6 In the reboot instruction in crontab that to starts Tangerine on reboot, add mysql container to the containers that start before tangerine and increase the sleep command to 60 seconds. Failure to implement this will result in tangerine failing to start on reboot. @reboot docker start couchdb mysql && sleep 60 && docker start tangerine Also add a cron job to run mysql-report at 1 a.m every day - this will keep the mysql indexes current. # Run mysql-report at 1 a.m every day: # 0 1 * * * docker exec tangerine mysql-report group-479f455e-b1bd-481b-8bd7-0d985a07431c Step 7 \u00b6 The most basic way to access MySQL would be to use the MySQL CLI. docker exec -it tangerine bash mysql -u\"$T_MYSQL_USER\" -p\"$T_MYSQL_PASSWORD\" -hmysql On the mysql command line, list the available databases using show databases; . Note how the database names are similar to the Group ID's these correspond with except with dashes removed. For example, if the group ID was group-abc-123 , the corresponding MySQL database would be groupabc123 . To select a database, type use <database ID>; then show tables; to list out the available tables. Step 8 \u00b6 To set up remote encrypted connections to mysql, three options: TLS : In the tangerine/data/mysql/databases folder you will find files ca.pem , client-cert.pem , and client-key.pem . Distribute those files to your MySQL users so they may connnect to your server's IP addres port 3306 using these certificates. For example, mysql -u admin -p\"you-mysql-password\" --ssl-ca=ca.pem --ssl-cert=client-cert.pem --ssl-key=client-key.pem . SSH : For each person using MySQL, they will need SSH access to the server. When granted, they may use tunneling of mysql port 3306 over SSH to access mysql at 127.0.0.1:3306 . For example, to set up an SSH port forwarding on Mac or Linux, run ssh -L 3306:your-server:3306 your-server . VPN : If you connect to MySQL via the IP address of the server, using a VPN will ensure that communication with MySQL is encrypted. Note however that the traffic will be visible to those also on your VPN so make sure it's a trusted VPN only used by those who have permission to access the data. Troubleshooting \u00b6 Issue: Data on the Mysql db is far behind the Couchdb. \u00b6 This scenario can happen when replicating data from a Production database on another server instance. Step to triage and resolve this issue: run docker ps -a to see if the tangerine and couchdb instances are up Bring back up those instance by using the start.sh script. Confirm using docker logs -f tangerine that the docker containers are back up and processing data correctly. If the server must catch up more than a day's worth of documents, use the wedge pre-warm-views at the end of the day to hit all views in the couchdb to pre-warm them (i.e. index those views). After the indexes have been built, use the mysql-report groupID command to see if the mysql and couchdb databases are caught up.","title":"MySQL Module"},{"location":"system-administrator/mysql-module/#mysql-module","text":"","title":"MySQL Module"},{"location":"system-administrator/mysql-module/#enabling-mysql-module","text":"Important! If reenabling the mysql module, remove the mysql folder: rm -r data/mysql","title":"Enabling MySQL module"},{"location":"system-administrator/mysql-module/#step-1","text":"Ensure the variables from the MySQL section in config.defaults.sh are in your customized config.sh file.","title":"Step 1"},{"location":"system-administrator/mysql-module/#step-2","text":"Ensure the T_MYSQL_PASSWORD variable is set to a sufficiently secure string. Failure to properly secure this password will without a doubt result in ransomware bots hacking your database.","title":"Step 2"},{"location":"system-administrator/mysql-module/#step-3","text":"Add the mysql module to T_MODULES_ENABLED in config.sh . For example: T_MODULES=\"['csv','mysql']\"","title":"Step 3"},{"location":"system-administrator/mysql-module/#step-4","text":"Run the start script to load in new configuration. Do this even if your server is already running. Note that restarting the container will not work, we have to run ./start.sh to recreate the container with the new configuration. ./start.sh <version> Note: Upgrading an older version of Tangerine may require running docker exec tangerine push-all-groups-views after to enable indexes used for mysql","title":"Step 4"},{"location":"system-administrator/mysql-module/#step-5","text":"Clear reporting cache to start generating a MySQL database for each group. docker exec tangerine reporting-cache-clear You can check in on the progress of generating the mysql database using the mysql-report command. ( Warning The mysql-report command creates a heavy workload to an instance so do not use it when mysql is trying to process a lot of data from couchdb. See the \"Troubleshooting\" section below.) It will return for each kind of case data and form, how many records are in the source database vs. how many have made it over to mysql. Note that if your system is under heavy load during the processing of this, this command may stress it out even more so it may be best to wait until you see a load of less than one using a tool like top or htop . docker exec -it tangerine bash mysql-report <groupId> | json_pp","title":"Step 5"},{"location":"system-administrator/mysql-module/#step-6","text":"In the reboot instruction in crontab that to starts Tangerine on reboot, add mysql container to the containers that start before tangerine and increase the sleep command to 60 seconds. Failure to implement this will result in tangerine failing to start on reboot. @reboot docker start couchdb mysql && sleep 60 && docker start tangerine Also add a cron job to run mysql-report at 1 a.m every day - this will keep the mysql indexes current. # Run mysql-report at 1 a.m every day: # 0 1 * * * docker exec tangerine mysql-report group-479f455e-b1bd-481b-8bd7-0d985a07431c","title":"Step 6"},{"location":"system-administrator/mysql-module/#step-7","text":"The most basic way to access MySQL would be to use the MySQL CLI. docker exec -it tangerine bash mysql -u\"$T_MYSQL_USER\" -p\"$T_MYSQL_PASSWORD\" -hmysql On the mysql command line, list the available databases using show databases; . Note how the database names are similar to the Group ID's these correspond with except with dashes removed. For example, if the group ID was group-abc-123 , the corresponding MySQL database would be groupabc123 . To select a database, type use <database ID>; then show tables; to list out the available tables.","title":"Step 7"},{"location":"system-administrator/mysql-module/#step-8","text":"To set up remote encrypted connections to mysql, three options: TLS : In the tangerine/data/mysql/databases folder you will find files ca.pem , client-cert.pem , and client-key.pem . Distribute those files to your MySQL users so they may connnect to your server's IP addres port 3306 using these certificates. For example, mysql -u admin -p\"you-mysql-password\" --ssl-ca=ca.pem --ssl-cert=client-cert.pem --ssl-key=client-key.pem . SSH : For each person using MySQL, they will need SSH access to the server. When granted, they may use tunneling of mysql port 3306 over SSH to access mysql at 127.0.0.1:3306 . For example, to set up an SSH port forwarding on Mac or Linux, run ssh -L 3306:your-server:3306 your-server . VPN : If you connect to MySQL via the IP address of the server, using a VPN will ensure that communication with MySQL is encrypted. Note however that the traffic will be visible to those also on your VPN so make sure it's a trusted VPN only used by those who have permission to access the data.","title":"Step 8"},{"location":"system-administrator/mysql-module/#troubleshooting","text":"","title":"Troubleshooting"},{"location":"system-administrator/mysql-module/#issue-data-on-the-mysql-db-is-far-behind-the-couchdb","text":"This scenario can happen when replicating data from a Production database on another server instance. Step to triage and resolve this issue: run docker ps -a to see if the tangerine and couchdb instances are up Bring back up those instance by using the start.sh script. Confirm using docker logs -f tangerine that the docker containers are back up and processing data correctly. If the server must catch up more than a day's worth of documents, use the wedge pre-warm-views at the end of the day to hit all views in the couchdb to pre-warm them (i.e. index those views). After the indexes have been built, use the mysql-report groupID command to see if the mysql and couchdb databases are caught up.","title":"Issue: Data on the Mysql db is far behind the Couchdb."},{"location":"system-administrator/restore-from-backup/","text":"Restoring from a Backup \u00b6 Backing up \u00b6 The Export Backup feature is available from the right-hand menu by selecting \"Export Data.\" Backups come in two types: - tabs with in-app scryption: a single file per database - tabs with device encryption: one directory per database, each of which contain many files. The Export Backup screen displays the backup location, and if the device uses device encryption, an input where the user may modify the \"Docs per backup file\" parameter. Press \"Export Data for all Users\" to initiate export. It will display a status message after each database backup is saved. The backup files will be saved in the Documents/Tangerine/backups directory. Use Android File transfer tool to transfer the files. Save all of the database backup files or directories. There should be four databases backed up: shared-user-database users tangerine-lock-boxes tangerine-variables The listing is similar when backing up an encrypted database; however, it backs up 4 files instead of 4 directories: Restoring backups onto a fresh Tangerine app installation. \u00b6 This only works for sync-protocol-2. Connect the tablet to the pc with a USB cable. Use Android File transfer or Samsung Smart Switch to browse to the Documents/Tangerine/restore directory. Copy all database files or directories generated by the Export Data command from the pc to the restore directory. Install the Tangerine app on the tablet. DO NOT do the initial device setup (language selection/enter admin password/etc); instead, press the \"Restore Backup\" button to start the restore process. Read the instructions. When ready, press the \"Restore Backup\" button. It will display a confirmation prompt: If the device does not have a \"Documents\" directory in Internal Storage, it displays an error. The Troubleshooting section provides details about the error and its resolution: The restore feature logs the process for each database. After the databases have been restored, it initiates indexing of the databases: When restoring an encrypted database, indexing is not run due to the state of the application at this point of the installtion. In this case, prepare to wait a few minutes or longer after restarting the app and logging in to allow it to index the home page. Once the home page is displayed, do a Sync to upload/download any updated files; this will also kick off indexing. After the restore process is complete, click the context button (|||) to close Tangerine and launch it again to load with the restored databases. Restoring form history \u00b6 On a tablet, the history of every form response change is saved. An agglomeration of these changes is what is sync'd to the server. It is possible to view all of these changes using the tablet backup. After restoring the database, open the app in DevTools and in the javascript console enter the following commands: const db = await T . user . getUserDatabase () // docId is the document _id of the document you are trying to get the history from. let docId = 'uuid' const diffs = await T . tangyForms . getDocRevHistory ( docId ) // get diffs into copy buffer copy ( diffs ) If there were any conflicts in the doc, they should be in _conflicts. You may wish to list all issues: const issues = ( await db . query ( 'byType' , { key : 'issue' , include_docs : true })) . rows . map ( row => row . doc ) . filter ( issue => issue . resolveOnAppContexts && issue . resolveOnAppContexts . includes ( 'CLIENT' )) Viewing data from an encrypted backup \u00b6 This is a deep dive - you probably don't need to do this. Ask user to go to Export Data and press \"Export Data for all Users\". The backup files will be saved in the Android/data/org.rti.tangerine/files directory. Transfer the shared-user-database file. Then ask the user to go to the About menu and read off the Device ID. In Fauxton, look up the device record in the group-uuid-devices database. Copy the value for the key property. Building SqlCipher on MacOSX: ```shell script git clone https://github.com/sqlcipher/sqlcipher.git cd sqlcipher/sqlcipher ./configure --enable-tempstore=yes CFLAGS=\"-DSQLITE_HAS_CODEC -I/usr/local/opt/openssl/include/\" LDFLAGS=\"/usr/local/opt/openssl/lib/libcrypto.a\" To use the compiled sqlcipher: ```shell script sqlcipher/sqlcipher ~/Downloads/shared-user-database In the sqlcipher console, enter the key: PRAGMA key = 'secret-key-uuid-very-secret' ; To list tables: . tables Output: ```shell script attach-seq-store by-sequence local-store attach-store document-store metadata-store ## Recovering a corrupted database Open the database: ```shell script sqlcipher/sqlcipher ~/Downloads/shared-user-database Enter the key: PRAGMA key = 'secret-key-uuid-very-secret' ; Run a check on the database. It will probably return something like \"database disk image is malformed\", which is not terribly useful: sqlite>PRAGMA integrity_check; Run the following commands to dump the sql and build a new database (kudos: https://blog.niklasottosson.com/databases/sqlite-check-integrity-and-fix-common-problems/ ): sqlite>.output backup.db sqlite>.dump sqlite>.quit >sqlite3 database_fixed.db sqlite>.read backup.db sqlite>.quit If there were no errors, you should be able to query database_fixed.db. If not, open backup.db in a text editor and rummage through the sql statements.","title":"Restoring from a Backup"},{"location":"system-administrator/restore-from-backup/#restoring-from-a-backup","text":"","title":"Restoring from a Backup"},{"location":"system-administrator/restore-from-backup/#backing-up","text":"The Export Backup feature is available from the right-hand menu by selecting \"Export Data.\" Backups come in two types: - tabs with in-app scryption: a single file per database - tabs with device encryption: one directory per database, each of which contain many files. The Export Backup screen displays the backup location, and if the device uses device encryption, an input where the user may modify the \"Docs per backup file\" parameter. Press \"Export Data for all Users\" to initiate export. It will display a status message after each database backup is saved. The backup files will be saved in the Documents/Tangerine/backups directory. Use Android File transfer tool to transfer the files. Save all of the database backup files or directories. There should be four databases backed up: shared-user-database users tangerine-lock-boxes tangerine-variables The listing is similar when backing up an encrypted database; however, it backs up 4 files instead of 4 directories:","title":"Backing up"},{"location":"system-administrator/restore-from-backup/#restoring-backups-onto-a-fresh-tangerine-app-installation","text":"This only works for sync-protocol-2. Connect the tablet to the pc with a USB cable. Use Android File transfer or Samsung Smart Switch to browse to the Documents/Tangerine/restore directory. Copy all database files or directories generated by the Export Data command from the pc to the restore directory. Install the Tangerine app on the tablet. DO NOT do the initial device setup (language selection/enter admin password/etc); instead, press the \"Restore Backup\" button to start the restore process. Read the instructions. When ready, press the \"Restore Backup\" button. It will display a confirmation prompt: If the device does not have a \"Documents\" directory in Internal Storage, it displays an error. The Troubleshooting section provides details about the error and its resolution: The restore feature logs the process for each database. After the databases have been restored, it initiates indexing of the databases: When restoring an encrypted database, indexing is not run due to the state of the application at this point of the installtion. In this case, prepare to wait a few minutes or longer after restarting the app and logging in to allow it to index the home page. Once the home page is displayed, do a Sync to upload/download any updated files; this will also kick off indexing. After the restore process is complete, click the context button (|||) to close Tangerine and launch it again to load with the restored databases.","title":"Restoring backups onto a fresh Tangerine app installation."},{"location":"system-administrator/restore-from-backup/#restoring-form-history","text":"On a tablet, the history of every form response change is saved. An agglomeration of these changes is what is sync'd to the server. It is possible to view all of these changes using the tablet backup. After restoring the database, open the app in DevTools and in the javascript console enter the following commands: const db = await T . user . getUserDatabase () // docId is the document _id of the document you are trying to get the history from. let docId = 'uuid' const diffs = await T . tangyForms . getDocRevHistory ( docId ) // get diffs into copy buffer copy ( diffs ) If there were any conflicts in the doc, they should be in _conflicts. You may wish to list all issues: const issues = ( await db . query ( 'byType' , { key : 'issue' , include_docs : true })) . rows . map ( row => row . doc ) . filter ( issue => issue . resolveOnAppContexts && issue . resolveOnAppContexts . includes ( 'CLIENT' ))","title":"Restoring form history"},{"location":"system-administrator/restore-from-backup/#viewing-data-from-an-encrypted-backup","text":"This is a deep dive - you probably don't need to do this. Ask user to go to Export Data and press \"Export Data for all Users\". The backup files will be saved in the Android/data/org.rti.tangerine/files directory. Transfer the shared-user-database file. Then ask the user to go to the About menu and read off the Device ID. In Fauxton, look up the device record in the group-uuid-devices database. Copy the value for the key property. Building SqlCipher on MacOSX: ```shell script git clone https://github.com/sqlcipher/sqlcipher.git cd sqlcipher/sqlcipher ./configure --enable-tempstore=yes CFLAGS=\"-DSQLITE_HAS_CODEC -I/usr/local/opt/openssl/include/\" LDFLAGS=\"/usr/local/opt/openssl/lib/libcrypto.a\" To use the compiled sqlcipher: ```shell script sqlcipher/sqlcipher ~/Downloads/shared-user-database In the sqlcipher console, enter the key: PRAGMA key = 'secret-key-uuid-very-secret' ; To list tables: . tables Output: ```shell script attach-seq-store by-sequence local-store attach-store document-store metadata-store ## Recovering a corrupted database Open the database: ```shell script sqlcipher/sqlcipher ~/Downloads/shared-user-database Enter the key: PRAGMA key = 'secret-key-uuid-very-secret' ; Run a check on the database. It will probably return something like \"database disk image is malformed\", which is not terribly useful: sqlite>PRAGMA integrity_check; Run the following commands to dump the sql and build a new database (kudos: https://blog.niklasottosson.com/databases/sqlite-check-integrity-and-fix-common-problems/ ): sqlite>.output backup.db sqlite>.dump sqlite>.quit >sqlite3 database_fixed.db sqlite>.read backup.db sqlite>.quit If there were no errors, you should be able to query database_fixed.db. If not, open backup.db in a text editor and rummage through the sql statements.","title":"Viewing data from an encrypted backup"},{"location":"system-administrator/sync-protocol-2/","text":"Sync Protocol 2 (two-way sync) \u00b6 Background \u00b6 When Tangerine was originally created, devices would only use a one-way sync from the tablet to the server. Sync Protocol 2 was developed to enable two-way sync; typically, all data from the tablet is pushed to the server, and - in order to conserve bandwidth - only data from some forms is pulled to the tablet. The form responses that are synced depend on which forms are configured for sync and limited to a grouping by the \"location\" field in that users' profile. For example: An installation has two Forms, Form A and Form B. Only Form A is configured to sync. User A who has \"facility 1\" assigned to them in their user profile creates a form response for Form A and Form B then initiates a sync to find that two form responses have been pushed up. User B has \"facility 1\" assigned to them in their user profile and initiates a sync to find they pulled down one form response for Form A that originated on User A's device. If User B modifies this form response, it will be pushed on the next sync and then later User A would pull down the change. Let's say there is a User C who is assigned to \"facility 2\" in their user profile. When they initiate a sync, they will not receive any form responses from the server because the server only has form responses from User A who is assigned to \"facility 1\". Enabling Sync Protocol 2 for new Groups \u00b6 Note: Sync Protocol 2 is usually automatically enabled for new groups; however, these instructions show how to manually configure it. Enable Sync Protocol 2 before creating a new group by editing config.sh by adding \"sync-protocol-2\" to T_MODULES . Create a new group. Define location list levels and content in Config -> Location List . Create a new form in Author -> Forms . Go to Deploy -> Device Users and create new Device Users. Go to Deploy -> Devices and create new Devices. Go to Deploy -> Releases and release the app. \"syncProtocol\":\"2\" Enables a \"Device Setup\" process on first boot of the client application. This requires you set up a \"Device\" record on the server. When setting up a Device record on the server, it will give you a QR code to use to scan from the tablet in order to receive its device ID and token. Upgrade an existing group to Sync Protocol 2 \u00b6 If planning to use `\"syncProtocol\":\"2\" and a project already uses \"centrallyManagedUserProfile\" : true , remove \"centrallyManagedUserProfile\": true and configure the user profile's custom sync settings to push. Managing Data Conflicts \u00b6 Because we can sync data down to Devices, it's possible for two Devices to edit the same data between syncs. This causes a \"Data Conflict\". It's important for someone to monitor conflicts to ensure data integrity. Please refer to Managing Data Conflicts documentation. Modes and stages of Sync Protocol 2. \u00b6 There are two different modes of sync: Initial device setup: After a device has been registered (on tablet), the initial sync is executed. The initial sync has 3 stages: Pull: It pulls documents from the server in batches, set by initialBatchSize from app-config.json (default: 1000). No documents are pushed, since no data collection has happened so far. Status uploaded: Status of this sync process is uploaded. Database optimization: After this initial sync, database indexes are created an optimized, which takes a little while. These indexes are critical to the app's performance. Routine sync: After a short period of data collection, the user executes an Online sync. This sync has 4 stages: Pull: Pull any new or updated documents from the server. Push: Pushes any documents created on the tablet Status uploaded: Status of this sync process is uploaded. Database optimization: Indexes are updated. Sync settings in app-config.json \u00b6 Here are the settings that may be modified in app-config.json for sync: - initialBatchSize = (default: 1000) Number of documents downloaded in the first sync when setting up a device. - batchSize (default: 200) - Number of documents downloaded upon each subsequent sync. - writeBatchSize = (default: 50) - Number of documents written to the tablet during each sync batch. - changes_batch_size = (default: 50) - Enables support for reducing the number of documents processed in the changed feed when syncing. This setting will help sites that experience crashes when syncing or indexing documents. Using this setting will slow sync times. If the tablet user logs in as \"admin\", she may access the \"Admin Configuration\" menu. The \"Pull all docs from the server\" feature enables \"catching up\" any documents that were missed in previous syncs. This resets a placeholder variable (\"since\") to 0, causing the replication API to replicate any documents or updated documents that are not on the tablet. This feature uses the \"initialBatchSize\" setting to download larger batches of documents. If users report errors during sync, consider reducing these settings. The \"writeBatchSize\" is the most critical setting because it manages how many documents are written to the database at a time. If the batch is too large, the sync may fail. Security \u00b6 A big part of using Sync Protocol 2 is embracing device configuration into the workflow. Sync Protocol 2 is more than just sync: it also provides the structure for encrypting a database. A mobile device must be registered in Tangerine before it may sync. The \"Deploy / Devices\" page enables registration of a device. Device registration creates a key (for encrypting the db), token(for sync authentication with the server), and other identifiers associated with that device. The admin then scans a QR code for the device's registration that installs the device record (which includes the key) in the device's tangerine-lock-boxes IndexedDB database (see LockBoxService ), and is used to encrypt the Tangerine databases. A user's username and password are used to decrypt the lockbox. - See db.factory to see how a key is passed in to encrypt a db. - See sync.service to see how deviceToken is used for authentication in the syncSessionUrl.","title":"Sync Protocol 2 (two-way sync)"},{"location":"system-administrator/sync-protocol-2/#sync-protocol-2-two-way-sync","text":"","title":"Sync Protocol 2 (two-way sync)"},{"location":"system-administrator/sync-protocol-2/#background","text":"When Tangerine was originally created, devices would only use a one-way sync from the tablet to the server. Sync Protocol 2 was developed to enable two-way sync; typically, all data from the tablet is pushed to the server, and - in order to conserve bandwidth - only data from some forms is pulled to the tablet. The form responses that are synced depend on which forms are configured for sync and limited to a grouping by the \"location\" field in that users' profile. For example: An installation has two Forms, Form A and Form B. Only Form A is configured to sync. User A who has \"facility 1\" assigned to them in their user profile creates a form response for Form A and Form B then initiates a sync to find that two form responses have been pushed up. User B has \"facility 1\" assigned to them in their user profile and initiates a sync to find they pulled down one form response for Form A that originated on User A's device. If User B modifies this form response, it will be pushed on the next sync and then later User A would pull down the change. Let's say there is a User C who is assigned to \"facility 2\" in their user profile. When they initiate a sync, they will not receive any form responses from the server because the server only has form responses from User A who is assigned to \"facility 1\".","title":"Background"},{"location":"system-administrator/sync-protocol-2/#enabling-sync-protocol-2-for-new-groups","text":"Note: Sync Protocol 2 is usually automatically enabled for new groups; however, these instructions show how to manually configure it. Enable Sync Protocol 2 before creating a new group by editing config.sh by adding \"sync-protocol-2\" to T_MODULES . Create a new group. Define location list levels and content in Config -> Location List . Create a new form in Author -> Forms . Go to Deploy -> Device Users and create new Device Users. Go to Deploy -> Devices and create new Devices. Go to Deploy -> Releases and release the app. \"syncProtocol\":\"2\" Enables a \"Device Setup\" process on first boot of the client application. This requires you set up a \"Device\" record on the server. When setting up a Device record on the server, it will give you a QR code to use to scan from the tablet in order to receive its device ID and token.","title":"Enabling Sync Protocol 2 for new Groups"},{"location":"system-administrator/sync-protocol-2/#upgrade-an-existing-group-to-sync-protocol-2","text":"If planning to use `\"syncProtocol\":\"2\" and a project already uses \"centrallyManagedUserProfile\" : true , remove \"centrallyManagedUserProfile\": true and configure the user profile's custom sync settings to push.","title":"Upgrade an existing group to Sync Protocol 2"},{"location":"system-administrator/sync-protocol-2/#managing-data-conflicts","text":"Because we can sync data down to Devices, it's possible for two Devices to edit the same data between syncs. This causes a \"Data Conflict\". It's important for someone to monitor conflicts to ensure data integrity. Please refer to Managing Data Conflicts documentation.","title":"Managing Data Conflicts"},{"location":"system-administrator/sync-protocol-2/#modes-and-stages-of-sync-protocol-2","text":"There are two different modes of sync: Initial device setup: After a device has been registered (on tablet), the initial sync is executed. The initial sync has 3 stages: Pull: It pulls documents from the server in batches, set by initialBatchSize from app-config.json (default: 1000). No documents are pushed, since no data collection has happened so far. Status uploaded: Status of this sync process is uploaded. Database optimization: After this initial sync, database indexes are created an optimized, which takes a little while. These indexes are critical to the app's performance. Routine sync: After a short period of data collection, the user executes an Online sync. This sync has 4 stages: Pull: Pull any new or updated documents from the server. Push: Pushes any documents created on the tablet Status uploaded: Status of this sync process is uploaded. Database optimization: Indexes are updated.","title":"Modes and stages of Sync Protocol 2."},{"location":"system-administrator/sync-protocol-2/#sync-settings-in-app-configjson","text":"Here are the settings that may be modified in app-config.json for sync: - initialBatchSize = (default: 1000) Number of documents downloaded in the first sync when setting up a device. - batchSize (default: 200) - Number of documents downloaded upon each subsequent sync. - writeBatchSize = (default: 50) - Number of documents written to the tablet during each sync batch. - changes_batch_size = (default: 50) - Enables support for reducing the number of documents processed in the changed feed when syncing. This setting will help sites that experience crashes when syncing or indexing documents. Using this setting will slow sync times. If the tablet user logs in as \"admin\", she may access the \"Admin Configuration\" menu. The \"Pull all docs from the server\" feature enables \"catching up\" any documents that were missed in previous syncs. This resets a placeholder variable (\"since\") to 0, causing the replication API to replicate any documents or updated documents that are not on the tablet. This feature uses the \"initialBatchSize\" setting to download larger batches of documents. If users report errors during sync, consider reducing these settings. The \"writeBatchSize\" is the most critical setting because it manages how many documents are written to the database at a time. If the batch is too large, the sync may fail.","title":"Sync settings in app-config.json"},{"location":"system-administrator/sync-protocol-2/#security","text":"A big part of using Sync Protocol 2 is embracing device configuration into the workflow. Sync Protocol 2 is more than just sync: it also provides the structure for encrypting a database. A mobile device must be registered in Tangerine before it may sync. The \"Deploy / Devices\" page enables registration of a device. Device registration creates a key (for encrypting the db), token(for sync authentication with the server), and other identifiers associated with that device. The admin then scans a QR code for the device's registration that installs the device record (which includes the key) in the device's tangerine-lock-boxes IndexedDB database (see LockBoxService ), and is used to encrypt the Tangerine databases. A user's username and password are used to decrypt the lockbox. - See db.factory to see how a key is passed in to encrypt a db. - See sync.service to see how deviceToken is used for authentication in the syncSessionUrl.","title":"Security"},{"location":"system-administrator/sync-strategies/","text":"Sync Strategies \u00b6 Overview \u00b6 The choice of sync strategy impacts how Tangerine syncs with the server. If you configure a form to use two-way sync, it uses CouchDB replication; otherwise, it uses custom sync. How are these two types of sync different? - CouchDB replication: -- If there is conflicting data on the server, the document update fails and it creates a log of the conflict on the uploaded document -- It currently does not notify the tablet user that there was a conflict. The data on the server displays the previous data, not the new, conflict data. See below how to view the new, conflict data. -- Uses more bandwidth - Custom sync -- If there is conflicting data on the server, it overwrites the document and does not make a log of the conflict. It uses the pouchdb-upsert plugin to do the write. -- Uses less bandwidth How to tell if there are conflicts when using CouchDB replication? \u00b6 Add \"conflicts=true\" to the url if checking view curl, or in your application, add {conflicts: true} option when you get() it. It will list the conflicts: _conflicts:[ \"29-0003a0b8af090d907efecde3aa121416\", \"25-f712a217de615f44c66ddb16b1a53a19\", \"14-bad1258430d22ad41dc9ce4123283c4f\", \"5-3fcde4c45f910b7a0c541e837e4ffd3c\" ] Query the form using \"rev\" in the querystring to view the conflicted version. http://localhost:5984/group-58093841-eaeb-4e51-8675-29757d71fd35/3cec5368-7b89-43cd-9c59-bcd1584dd4ea?rev=5-3fcde4c45f910b7a0c541e837e4ffd3c See https://pouchdb.com/guides/conflicts.html for more information.","title":"Sync Strategies"},{"location":"system-administrator/sync-strategies/#sync-strategies","text":"","title":"Sync Strategies"},{"location":"system-administrator/sync-strategies/#overview","text":"The choice of sync strategy impacts how Tangerine syncs with the server. If you configure a form to use two-way sync, it uses CouchDB replication; otherwise, it uses custom sync. How are these two types of sync different? - CouchDB replication: -- If there is conflicting data on the server, the document update fails and it creates a log of the conflict on the uploaded document -- It currently does not notify the tablet user that there was a conflict. The data on the server displays the previous data, not the new, conflict data. See below how to view the new, conflict data. -- Uses more bandwidth - Custom sync -- If there is conflicting data on the server, it overwrites the document and does not make a log of the conflict. It uses the pouchdb-upsert plugin to do the write. -- Uses less bandwidth","title":"Overview"},{"location":"system-administrator/sync-strategies/#how-to-tell-if-there-are-conflicts-when-using-couchdb-replication","text":"Add \"conflicts=true\" to the url if checking view curl, or in your application, add {conflicts: true} option when you get() it. It will list the conflicts: _conflicts:[ \"29-0003a0b8af090d907efecde3aa121416\", \"25-f712a217de615f44c66ddb16b1a53a19\", \"14-bad1258430d22ad41dc9ce4123283c4f\", \"5-3fcde4c45f910b7a0c541e837e4ffd3c\" ] Query the form using \"rev\" in the querystring to view the conflicted version. http://localhost:5984/group-58093841-eaeb-4e51-8675-29757d71fd35/3cec5368-7b89-43cd-9c59-bcd1584dd4ea?rev=5-3fcde4c45f910b7a0c541e837e4ffd3c See https://pouchdb.com/guides/conflicts.html for more information.","title":"How to tell if there are conflicts when using CouchDB replication?"},{"location":"system-administrator/tangerine-nginx-ssl/","text":"Configuring Nginx as SSL proxy server for Tangerine \u00b6 Initial configuration \u00b6 First open config.sh and change the port mapping of Tangerine T_PORT_MAPPING=\"-p 8080:80\" Rebuild the container by running ./start.sh Pull nginx docker image and install certbot inside the nginx container \u00b6 If your container is not called tangerine adjust below. --link is to allow the ngin container to forward to the tangerine one docker pull nginx docker run -p 80:80 -p 443:443 --link tangerine:tangerine --restart always --name nginx -d nginx Go into the nginx container and execute the below commands docker exec -it nginx bash apt-get update apt-get install certbot python-certbot-nginx apt-get install vim Now execute and follow the promtps for cerbot. It will fail but that's ok certbot --nginx The above will generate the ertificate according to the DOMAIN.org name given. Modify the DOMAIN.ORG with your domain name in the file below and replace it with the content of the config vi /etc/nginx/conf.d/default.conf server { listen 80; listen [::]:80; server_name _; client_max_body_size 0; #charset koi8-r; #access_log /var/log/nginx/host.access.log main; location / { # First attempt to serve request as file, then # as directory, then fall back to displaying a 404. proxy_pass_header Server; proxy_set_header Host $http_host; proxy_redirect off; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Scheme $scheme; proxy_set_header X-Forwarded-Host $host:$server_port; proxy_set_header X-Forwarded-Proto https; proxy_pass http://tangerine; } #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } server { server_name DOMAIN.ORG client_max_body_size 0; location / { # First attempt to serve request as file, then # as directory, then fall back to displaying a 404. proxy_pass_header Server; proxy_set_header Host $http_host; proxy_redirect off; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Scheme $scheme; proxy_set_header X-Forwarded-Host $host:$server_port; proxy_set_header X-Forwarded-Proto https; proxy_pass http://tangerine; } error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } listen [::]:443 ssl ipv6only=on; # managed by Certbot listen 443 ssl; # managed by Certbot ssl_certificate /etc/letsencrypt/live/DOMAIN.ORG/fullchain.pem; # managed by Certbot ssl_certificate_key /etc/letsencrypt/live/DOMAIN.ORG/privkey.pem; # managed by Certbot include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot } server { if ($host = DOMAIN.ORG) { return 301 https://$host$request_uri; } # managed by Certbot listen 80 ; listen [::]:80 ; server_name DOMAIN.ORG; return 404; # managed by Certbot } Reload the config service nginx reload Exit the docker container and add the below entry to the root's crontab Add this like to cron (crontab -e) crontab -e 0 8 * * * docker exec -it nginx certbot renew --post-hook \"service nginx reload\" Point your DNS to the actual server","title":"Configuring Nginx as SSL proxy server for Tangerine"},{"location":"system-administrator/tangerine-nginx-ssl/#configuring-nginx-as-ssl-proxy-server-for-tangerine","text":"","title":"Configuring Nginx as SSL proxy server for Tangerine"},{"location":"system-administrator/tangerine-nginx-ssl/#initial-configuration","text":"First open config.sh and change the port mapping of Tangerine T_PORT_MAPPING=\"-p 8080:80\" Rebuild the container by running ./start.sh","title":"Initial configuration"},{"location":"system-administrator/tangerine-nginx-ssl/#pull-nginx-docker-image-and-install-certbot-inside-the-nginx-container","text":"If your container is not called tangerine adjust below. --link is to allow the ngin container to forward to the tangerine one docker pull nginx docker run -p 80:80 -p 443:443 --link tangerine:tangerine --restart always --name nginx -d nginx Go into the nginx container and execute the below commands docker exec -it nginx bash apt-get update apt-get install certbot python-certbot-nginx apt-get install vim Now execute and follow the promtps for cerbot. It will fail but that's ok certbot --nginx The above will generate the ertificate according to the DOMAIN.org name given. Modify the DOMAIN.ORG with your domain name in the file below and replace it with the content of the config vi /etc/nginx/conf.d/default.conf server { listen 80; listen [::]:80; server_name _; client_max_body_size 0; #charset koi8-r; #access_log /var/log/nginx/host.access.log main; location / { # First attempt to serve request as file, then # as directory, then fall back to displaying a 404. proxy_pass_header Server; proxy_set_header Host $http_host; proxy_redirect off; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Scheme $scheme; proxy_set_header X-Forwarded-Host $host:$server_port; proxy_set_header X-Forwarded-Proto https; proxy_pass http://tangerine; } #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } server { server_name DOMAIN.ORG client_max_body_size 0; location / { # First attempt to serve request as file, then # as directory, then fall back to displaying a 404. proxy_pass_header Server; proxy_set_header Host $http_host; proxy_redirect off; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Scheme $scheme; proxy_set_header X-Forwarded-Host $host:$server_port; proxy_set_header X-Forwarded-Proto https; proxy_pass http://tangerine; } error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } listen [::]:443 ssl ipv6only=on; # managed by Certbot listen 443 ssl; # managed by Certbot ssl_certificate /etc/letsencrypt/live/DOMAIN.ORG/fullchain.pem; # managed by Certbot ssl_certificate_key /etc/letsencrypt/live/DOMAIN.ORG/privkey.pem; # managed by Certbot include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot } server { if ($host = DOMAIN.ORG) { return 301 https://$host$request_uri; } # managed by Certbot listen 80 ; listen [::]:80 ; server_name DOMAIN.ORG; return 404; # managed by Certbot } Reload the config service nginx reload Exit the docker container and add the below entry to the root's crontab Add this like to cron (crontab -e) crontab -e 0 8 * * * docker exec -it nginx certbot renew --post-hook \"service nginx reload\" Point your DNS to the actual server","title":"Pull nginx docker image and install certbot inside the nginx container"},{"location":"system-administrator/upgrade-checklist/","text":"Test on QA server \u00b6 Clone production server to QA server. Update T_HOSTNAME in tangerine/config.sh . Run ./start.sh <currently used version of tangerine> . This puts the updated config in config.sh into the container. Update serverUrl in all app-config.json files for each group in tangerine/data/group/<your-group-id>/client/app-config.json . Find and replace from the tangerine folder by modifying the following command: find ./data/groups/ -type f -name \"app-config.json\" -print0 | xargs -0 sed -i '' -e 's/production-server-hostname/qa-server-hostname/g' Release all APKs and PWAs. This puts all updated app config into the APKs and PWAs. Install and set up PWA/APKs for groups to test. Upgrade the QA server following the server instructions for the release you are upgrading to in CHANGELOG.md ( https://github.com/Tangerine-Community/Tangerine/blob/master/CHANGELOG.md ). Note that you must upgrade incrementally between the versions. If you skip one you may miss important updates or they may not apply correctly and you risk corrupting your install without knowing it. Test functionality on the server. Release updated APKs and PWAs. Upgrade test tablet and test functionality. Deploy to production \u00b6 Make backup of production server. Release PWAs/APKs on the test channels for all groups. Install and set up PWA/APKs for groups to test using APK/PWA on the test channel. Upgrade the QA server following the server instructions for the release you are upgrading to in CHANGELOG.md ( https://github.com/Tangerine-Community/Tangerine/blob/master/CHANGELOG.md ). Note that you must upgrade incrementally between the versions. If you skip one you may miss important updates or they may not apply correctly and you risk corrupting your install without knowing it. Test functionality on the server. Release updated APKs and PWAs on the test channel. Upgrade test tablet and test functionality. Release updated APKs and PWAs on the live channel. Note the Build ID of the APK or PWA on the live channel, then in the content repository tag a release with a corresponding Build ID in git. If using Github, use the Releases feature and note the version of Tangerine upgraded to along with any other notes. Terminate the QA server.","title":"Upgrade checklist"},{"location":"system-administrator/upgrade-checklist/#test-on-qa-server","text":"Clone production server to QA server. Update T_HOSTNAME in tangerine/config.sh . Run ./start.sh <currently used version of tangerine> . This puts the updated config in config.sh into the container. Update serverUrl in all app-config.json files for each group in tangerine/data/group/<your-group-id>/client/app-config.json . Find and replace from the tangerine folder by modifying the following command: find ./data/groups/ -type f -name \"app-config.json\" -print0 | xargs -0 sed -i '' -e 's/production-server-hostname/qa-server-hostname/g' Release all APKs and PWAs. This puts all updated app config into the APKs and PWAs. Install and set up PWA/APKs for groups to test. Upgrade the QA server following the server instructions for the release you are upgrading to in CHANGELOG.md ( https://github.com/Tangerine-Community/Tangerine/blob/master/CHANGELOG.md ). Note that you must upgrade incrementally between the versions. If you skip one you may miss important updates or they may not apply correctly and you risk corrupting your install without knowing it. Test functionality on the server. Release updated APKs and PWAs. Upgrade test tablet and test functionality.","title":"Test on QA server"},{"location":"system-administrator/upgrade-checklist/#deploy-to-production","text":"Make backup of production server. Release PWAs/APKs on the test channels for all groups. Install and set up PWA/APKs for groups to test using APK/PWA on the test channel. Upgrade the QA server following the server instructions for the release you are upgrading to in CHANGELOG.md ( https://github.com/Tangerine-Community/Tangerine/blob/master/CHANGELOG.md ). Note that you must upgrade incrementally between the versions. If you skip one you may miss important updates or they may not apply correctly and you risk corrupting your install without knowing it. Test functionality on the server. Release updated APKs and PWAs on the test channel. Upgrade test tablet and test functionality. Release updated APKs and PWAs on the live channel. Note the Build ID of the APK or PWA on the live channel, then in the content repository tag a release with a corresponding Build ID in git. If using Github, use the Releases feature and note the version of Tangerine upgraded to along with any other notes. Terminate the QA server.","title":"Deploy to production"}]}